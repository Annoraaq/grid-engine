var GridEngine=(()=>{var lu=Object.create;var gr=Object.defineProperty,cu=Object.defineProperties,pu=Object.getOwnPropertyDescriptor,fu=Object.getOwnPropertyDescriptors,mu=Object.getOwnPropertyNames,To=Object.getOwnPropertySymbols,du=Object.getPrototypeOf,xo=Object.prototype.hasOwnProperty,gu=Object.prototype.propertyIsEnumerable;var wo=(r,e,t)=>e in r?gr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w=(r,e)=>{for(var t in e||(e={}))xo.call(e,t)&&wo(r,t,e[t]);if(To)for(var t of To(e))gu.call(e,t)&&wo(r,t,e[t]);return r},De=(r,e)=>cu(r,fu(e));var m=(r,e)=>()=>(r&&(e=r(r=0)),e);var v=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),yu=(r,e)=>{for(var t in e)gr(r,t,{get:e[t],enumerable:!0})},vu=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of mu(e))!xo.call(r,n)&&n!==t&&gr(r,n,{get:()=>e[n],enumerable:!(i=pu(e,n))||i.enumerable});return r};var So=(r,e,t)=>(t=r!=null?lu(du(r)):{},vu(e||!r||!r.__esModule?gr(t,"default",{value:r,enumerable:!0}):t,r));var g,re=m(()=>{g=class r{static get ZERO(){return new r(0,0)}static get ONE(){return new r(1,1)}static get UP(){return new r(0,-1)}static get DOWN(){return new r(0,1)}static get LEFT(){return new r(-1,0)}static get RIGHT(){return new r(1,0)}static get UP_LEFT(){return new r(-1,-1)}static get UP_RIGHT(){return new r(1,-1)}static get DOWN_RIGHT(){return new r(1,1)}static get DOWN_LEFT(){return new r(-1,1)}constructor(e,t){typeof e=="number"?(this.x=e,this.y=t||0):(this.x=e.x,this.y=e.y)}clone(){return new r(this.x,this.y)}add(e){return new r(this.x+e.x,this.y+e.y)}multiply(e){return new r(this.x*e.x,this.y*e.y)}divide(e){return new r(this.x/e.x,this.y/e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}equals(e){return this.x===e.x&&this.y===e.y}abs(){return new r(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}modulo(e){return new r(this.x%e.x,this.y%e.y)}scalarModulo(e){return new r(this.x%e,this.y%e)}scalarMult(e){return new r(this.x*e,this.y*e)}toPosition(){return{x:this.x,y:this.y}}toString(){return`${this.x}#${this.y}`}}});var b,Me=m(()=>{re();b=class{static equal(e,t){return e.position.x===t.position.x&&e.position.y===t.position.y&&e.layer===t.layer}static copyOver(e,t){t.position.x=e.position.x,t.position.y=e.position.y,t.layer=e.layer}static clone(e){return{position:e.position.clone(),layer:e.layer}}static toString(e){return`${e.position.toString()}#${e.layer}`}static toInternal(e){return{position:new g(e.position.x,e.position.y),layer:e.charLayer}}static fromInternal(e){return{position:e.position.toPosition(),charLayer:e.layer}}}});function $t(){return["up","down","left","right","none","up-left","up-right","down-right","down-left"]}function St(r){return xu.includes(r)}function Ui(r){return["left","right"].includes(r)}function Co(r){return["up","down"].includes(r)}function Lo(r){return wu[r]}function yr(r){return Tu[r]}function Se(r){return Pu[r]}function Eo(r){return bu[r]}function ie(r,e){if(r.x===e.x){if(r.y>e.y)return"up";if(r.y<e.y)return"down"}else if(r.y===e.y){if(r.x>e.x)return"left";if(r.x<e.x)return"right"}else if(r.x>e.x){if(r.y<e.y)return"down-left";if(r.y>e.y)return"up-left"}else if(r.x<e.x){if(r.y<e.y)return"down-right";if(r.y>e.y)return"up-right"}return"none"}function tt(r){return typeof r=="string"&&$t().includes(r)}var pe,bu,Pu,Tu,wu,xu,Qe,$=m(()=>{re();pe=(u=>(u.NONE="none",u.LEFT="left",u.UP_LEFT="up-left",u.UP="up",u.UP_RIGHT="up-right",u.RIGHT="right",u.DOWN_RIGHT="down-right",u.DOWN="down",u.DOWN_LEFT="down-left",u))(pe||{}),bu={up:"down",down:"up",left:"right",right:"left",none:"none","up-left":"down-right","up-right":"down-left","down-right":"up-left","down-left":"up-right"},Pu={up:g.UP,down:g.DOWN,left:g.LEFT,right:g.RIGHT,none:g.ZERO,"up-left":g.UP_LEFT,"up-right":g.UP_RIGHT,"down-right":g.DOWN_RIGHT,"down-left":g.DOWN_LEFT},Tu={left:"up-left","up-left":"up",up:"up-right","up-right":"right",right:"down-right","down-right":"down",down:"down-left","down-left":"left",none:"none"},wu={left:"down-left","up-left":"left",up:"up-left","up-right":"up",right:"up-right","down-right":"right",down:"down-right","down-left":"down",none:"none"},xu=["down-left","down-right","up-right","up-left"];Qe=(t=>(t[t.FOUR=4]="FOUR",t[t.EIGHT=8]="EIGHT",t))(Qe||{})});function rt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Hi(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Oo(r,e,t,i){function n(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(l){try{u(i.next(l))}catch(c){s(c)}}function h(l){try{u(i.throw(l))}catch(c){s(c)}}function u(l){l.done?o(l.value):n(l.value).then(a,h)}u((i=i.apply(r,e||[])).next())})}function vr(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return h([u,l])}}function h(u){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(t=0)),t;)try{if(i=1,n&&(o=u[0]&2?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],n=0}finally{i=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ke(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ie(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),n,o=[],s;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(a){s={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(s)throw s.error}}return o}function ke(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,o;i<n;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return r.concat(o||Array.prototype.slice.call(e))}function ct(r){return this instanceof ct?(this.v=r,this):new ct(r)}function Ao(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(p){i[p]&&(n[p]=function(f){return new Promise(function(d,y){o.push([p,f,d,y])>1||a(p,f)})})}function a(p,f){try{h(i[p](f))}catch(d){c(o[0][3],d)}}function h(p){p.value instanceof ct?Promise.resolve(p.value.v).then(u,l):c(o[0][2],p)}function u(p){a("next",p)}function l(p){a("throw",p)}function c(p,f){p(f),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Do(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ke=="function"?Ke(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=r[o]&&function(s){return new Promise(function(a,h){s=r[o](s),n(a,h,s.done,s.value)})}}function n(o,s,a,h){Promise.resolve(h).then(function(u){o({value:u,done:a})},s)}}var Hi,Fe=m(()=>{Hi=function(r,e){return Hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},Hi(r,e)}});function C(r){return typeof r=="function"}var fe=m(()=>{});function br(r){var e=function(i){Error.call(i),i.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Gi=m(()=>{});var Pr,Mo=m(()=>{Gi();Pr=br(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,n){return n+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}})});function Qt(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Bi=m(()=>{});function Tr(r){return r instanceof Ct||r&&"closed"in r&&C(r.remove)&&C(r.add)&&C(r.unsubscribe)}function Io(r){C(r)?r():r.unsubscribe()}var Ct,qi,wr=m(()=>{Fe();fe();Mo();Bi();Ct=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,i,n,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=Ke(s),h=a.next();!h.done;h=a.next()){var u=h.value;u.remove(this)}}catch(y){e={error:y}}finally{try{h&&!h.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var l=this.initialTeardown;if(C(l))try{l()}catch(y){o=y instanceof Pr?y.errors:[y]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var p=Ke(c),f=p.next();!f.done;f=p.next()){var d=f.value;try{Io(d)}catch(y){o=o!=null?o:[],y instanceof Pr?o=ke(ke([],Ie(o)),Ie(y.errors)):o.push(y)}}}catch(y){i={error:y}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}}if(o)throw new Pr(o)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Io(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Qt(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&Qt(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),qi=Ct.EMPTY});var Ce,Kt=m(()=>{Ce={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}});var Lt,Wi=m(()=>{Fe();Lt={setTimeout:function(r,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var n=Lt.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,ke([r,e],Ie(t))):setTimeout.apply(void 0,ke([r,e],Ie(t)))},clearTimeout:function(r){var e=Lt.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0}});function xr(r){Lt.setTimeout(function(){var e=Ce.onUnhandledError;if(e)e(r);else throw r})}var ji=m(()=>{Kt();Wi()});function Yt(){}var $i=m(()=>{});function Fo(r){return Qi("E",void 0,r)}function Ro(r){return Qi("N",r,void 0)}function Qi(r,e,t){return{kind:r,value:e,error:t}}var ko,_o=m(()=>{ko=function(){return Qi("C",void 0,void 0)}()});function Et(r){if(Ce.useDeprecatedSynchronousErrorHandling){var e=!pt;if(e&&(pt={errorThrown:!1,error:null}),r(),e){var t=pt,i=t.errorThrown,n=t.error;if(pt=null,i)throw n}}else r()}function zo(r){Ce.useDeprecatedSynchronousErrorHandling&&pt&&(pt.errorThrown=!0,pt.error=r)}var pt,Sr=m(()=>{Kt();pt=null});function Ki(r,e){return Su.call(r,e)}function Cr(r){Ce.useDeprecatedSynchronousErrorHandling?zo(r):xr(r)}function Lu(r){throw r}function Yi(r,e){var t=Ce.onStoppedNotification;t&&Lt.setTimeout(function(){return t(r,e)})}var Xt,Su,Cu,Lr,Eu,Xi=m(()=>{Fe();fe();wr();Kt();ji();$i();_o();Wi();Sr();Xt=function(r){rt(e,r);function e(t){var i=r.call(this)||this;return i.isStopped=!1,t?(i.destination=t,Tr(t)&&t.add(i)):i.destination=Eu,i}return e.create=function(t,i,n){return new Lr(t,i,n)},e.prototype.next=function(t){this.isStopped?Yi(Ro(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Yi(Fo(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Yi(ko,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ct),Su=Function.prototype.bind;Cu=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){Cr(i)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){Cr(i)}else Cr(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Cr(t)}},r}(),Lr=function(r){rt(e,r);function e(t,i,n){var o=r.call(this)||this,s;if(C(t)||!t)s={next:t!=null?t:void 0,error:i!=null?i:void 0,complete:n!=null?n:void 0};else{var a;o&&Ce.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&Ki(t.next,a),error:t.error&&Ki(t.error,a),complete:t.complete&&Ki(t.complete,a)}):s=t}return o.destination=new Cu(s),o}return e}(Xt);Eu={closed:!0,next:Yt,error:Lu,complete:Yt}});var Ot,Er=m(()=>{Ot=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}()});function Or(r){return r}var Ji=m(()=>{});function Zi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return en(r)}function en(r){return r.length===0?Or:r.length===1?r[0]:function(t){return r.reduce(function(i,n){return n(i)},t)}}var tn=m(()=>{Ji()});function Vo(r){var e;return(e=r!=null?r:Ce.Promise)!==null&&e!==void 0?e:Promise}function Ou(r){return r&&C(r.next)&&C(r.error)&&C(r.complete)}function Au(r){return r&&r instanceof Xt||Ou(r)&&Tr(r)}var Q,ft=m(()=>{Xi();wr();Er();tn();Kt();fe();Sr();Q=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,i){var n=this,o=Au(e)?e:new Lr(e,t,i);return Et(function(){var s=n,a=s.operator,h=s.source;o.add(a?a.call(o,h):h?n._subscribe(o):n._trySubscribe(o))}),o},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var i=this;return t=Vo(t),new t(function(n,o){var s=new Lr({next:function(a){try{e(a)}catch(h){o(h),s.unsubscribe()}},error:o,complete:n});i.subscribe(s)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[Ot]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return en(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=Vo(e),new e(function(i,n){var o;t.subscribe(function(s){return o=s},function(s){return n(s)},function(){return i(o)})})},r.create=function(e){return new r(e)},r}()});function Du(r){return C(r==null?void 0:r.lift)}function ne(r){return function(e){if(Du(e))return e.lift(function(t){try{return r(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}var Ye=m(()=>{fe()});function ye(r,e,t,i,n){return new Mu(r,e,t,i,n)}var Mu,mt=m(()=>{Fe();Xi();Mu=function(r){rt(e,r);function e(t,i,n,o,s,a){var h=r.call(this,t)||this;return h.onFinalize=s,h.shouldUnsubscribe=a,h._next=i?function(u){try{i(u)}catch(l){t.error(l)}}:r.prototype._next,h._error=o?function(u){try{o(u)}catch(l){t.error(l)}finally{this.unsubscribe()}}:r.prototype._error,h._complete=n?function(){try{n()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,h}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;r.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Xt)});var No,Uo=m(()=>{Gi();No=br(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})});var E,Ho,Go=m(()=>{Fe();ft();wr();Uo();Bi();Sr();E=function(r){rt(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new Ho(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new No},e.prototype.next=function(t){var i=this;Et(function(){var n,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var s=Ke(i.currentObservers),a=s.next();!a.done;a=s.next()){var h=a.value;h.next(t)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}})},e.prototype.error=function(t){var i=this;Et(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var n=i.observers;n.length;)n.shift().error(t)}})},e.prototype.complete=function(){var t=this;Et(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,n=this,o=n.hasError,s=n.isStopped,a=n.observers;return o||s?qi:(this.currentObservers=null,a.push(t),new Ct(function(){i.currentObservers=null,Qt(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,n=i.hasError,o=i.thrownError,s=i.isStopped;n?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Q;return t.source=this,t},e.create=function(t,i){return new Ho(t,i)},e}(Q),Ho=function(r){rt(e,r);function e(t,i){var n=r.call(this)||this;return n.destination=t,n.source=i,n}return e.prototype.next=function(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,t)},e.prototype.error=function(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&n!==void 0?n:qi},e}(E)});var Ar,rn=m(()=>{ft();Ar=new Q(function(r){return r.complete()})});function Bo(r){return r&&C(r.schedule)}var qo=m(()=>{fe()});function Wo(r){return r[r.length-1]}function Dr(r){return Bo(Wo(r))?r.pop():void 0}function Mr(r,e){return typeof Wo(r)=="number"?r.pop():e}var nn=m(()=>{qo()});var Ir,on=m(()=>{Ir=function(r){return r&&typeof r.length=="number"&&typeof r!="function"}});function kr(r){return C(r==null?void 0:r.then)}var sn=m(()=>{fe()});function Fr(r){return C(r[Ot])}var an=m(()=>{Er();fe()});function Rr(r){return Symbol.asyncIterator&&C(r==null?void 0:r[Symbol.asyncIterator])}var hn=m(()=>{fe()});function _r(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var un=m(()=>{});function Iu(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var zr,ln=m(()=>{zr=Iu()});function Vr(r){return C(r==null?void 0:r[zr])}var cn=m(()=>{ln();fe()});function Nr(r){return Ao(this,arguments,function(){var t,i,n,o;return vr(this,function(s){switch(s.label){case 0:t=r.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ct(t.read())];case 3:return i=s.sent(),n=i.value,o=i.done,o?[4,ct(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ct(n)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Ur(r){return C(r==null?void 0:r.getReader)}var Hr=m(()=>{Fe();fe()});function me(r){if(r instanceof Q)return r;if(r!=null){if(Fr(r))return ku(r);if(Ir(r))return Fu(r);if(kr(r))return Ru(r);if(Rr(r))return jo(r);if(Vr(r))return _u(r);if(Ur(r))return zu(r)}throw _r(r)}function ku(r){return new Q(function(e){var t=r[Ot]();if(C(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Fu(r){return new Q(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function Ru(r){return new Q(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,xr)})}function _u(r){return new Q(function(e){var t,i;try{for(var n=Ke(r),o=n.next();!o.done;o=n.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}e.complete()})}function jo(r){return new Q(function(e){Vu(r,e).catch(function(t){return e.error(t)})})}function zu(r){return jo(Nr(r))}function Vu(r,e){var t,i,n,o;return Oo(this,void 0,void 0,function(){var s,a;return vr(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),t=Do(r),h.label=1;case 1:return[4,t.next()];case 2:if(i=h.sent(),!!i.done)return[3,4];if(s=i.value,e.next(s),e.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=h.sent(),n={error:a},[3,11];case 6:return h.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}var it=m(()=>{Fe();on();sn();ft();an();hn();un();cn();Hr();fe();ji();Er()});function Te(r,e,t,i,n){i===void 0&&(i=0),n===void 0&&(n=!1);var o=e.schedule(function(){t(),n?r.add(this.schedule(null,i)):this.unsubscribe()},i);if(r.add(o),!n)return o}var Jt=m(()=>{});function Gr(r,e){return e===void 0&&(e=0),ne(function(t,i){t.subscribe(ye(i,function(n){return Te(i,r,function(){return i.next(n)},e)},function(){return Te(i,r,function(){return i.complete()},e)},function(n){return Te(i,r,function(){return i.error(n)},e)}))})}var pn=m(()=>{Jt();Ye();mt()});function Br(r,e){return e===void 0&&(e=0),ne(function(t,i){i.add(r.schedule(function(){return t.subscribe(i)},e))})}var fn=m(()=>{Ye()});function $o(r,e){return me(r).pipe(Br(e),Gr(e))}var Qo=m(()=>{it();pn();fn()});function Ko(r,e){return me(r).pipe(Br(e),Gr(e))}var Yo=m(()=>{it();pn();fn()});function Xo(r,e){return new Q(function(t){var i=0;return e.schedule(function(){i===r.length?t.complete():(t.next(r[i++]),t.closed||this.schedule())})})}var Jo=m(()=>{ft()});function Zo(r,e){return new Q(function(t){var i;return Te(t,e,function(){i=r[zr](),Te(t,e,function(){var n,o,s;try{n=i.next(),o=n.value,s=n.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return C(i==null?void 0:i.return)&&i.return()}})}var es=m(()=>{ft();ln();fe();Jt()});function qr(r,e){if(!r)throw new Error("Iterable cannot be null");return new Q(function(t){Te(t,e,function(){var i=r[Symbol.asyncIterator]();Te(t,e,function(){i.next().then(function(n){n.done?t.complete():t.next(n.value)})},0,!0)})})}var mn=m(()=>{ft();Jt()});function ts(r,e){return qr(Nr(r),e)}var rs=m(()=>{mn();Hr()});function is(r,e){if(r!=null){if(Fr(r))return $o(r,e);if(Ir(r))return Xo(r,e);if(kr(r))return Ko(r,e);if(Rr(r))return qr(r,e);if(Vr(r))return Zo(r,e);if(Ur(r))return ts(r,e)}throw _r(r)}var ns=m(()=>{Qo();Yo();Jo();es();mn();an();sn();on();cn();hn();un();Hr();rs()});function Wr(r,e){return e?is(r,e):me(r)}var dn=m(()=>{ns();it()});function Re(r,e){return ne(function(t,i){var n=0;t.subscribe(ye(i,function(o){i.next(r.call(e,o,n++))}))})}var jr=m(()=>{Ye();mt()});function os(r,e,t,i,n,o,s,a){var h=[],u=0,l=0,c=!1,p=function(){c&&!h.length&&!u&&e.complete()},f=function(y){return u<i?d(y):h.push(y)},d=function(y){o&&e.next(y),u++;var P=!1;me(t(y,l++)).subscribe(ye(e,function(x){n==null||n(x),o?f(x):e.next(x)},function(){P=!0},void 0,function(){if(P)try{u--;for(var x=function(){var T=h.shift();s?Te(e,s,function(){return d(T)}):d(T)};h.length&&u<i;)x();p()}catch(T){e.error(T)}}))};return r.subscribe(ye(e,f,function(){c=!0,p()})),function(){a==null||a()}}var ss=m(()=>{it();Jt();mt()});function gn(r,e,t){return t===void 0&&(t=1/0),C(e)?gn(function(i,n){return Re(function(o,s){return e(i,o,n,s)})(me(r(i,n)))},t):(typeof e=="number"&&(t=e),ne(function(i,n){return os(i,n,r,t)}))}var as=m(()=>{jr();it();Ye();ss();fe()});function $r(r){return r===void 0&&(r=1/0),gn(Or,r)}var yn=m(()=>{as();Ji()});function vn(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Dr(r),i=Mr(r,1/0),n=r;return n.length?n.length===1?me(n[0]):$r(i)(Wr(n,t)):Ar}var hs=m(()=>{yn();it();rn();nn();dn()});function us(r){return r.length===1&&Nu(r[0])?r[0]:r}var Nu,ls=m(()=>{Nu=Array.isArray});function Z(r,e){return ne(function(t,i){var n=0;t.subscribe(ye(i,function(o){return r.call(e,o,n++)&&i.next(o)}))})}var bn=m(()=>{Ye();mt()});var cs=m(()=>{});function de(r){return r<=0?function(){return Ar}:ne(function(e,t){var i=0;e.subscribe(ye(t,function(n){++i<=r&&(t.next(n),r<=i&&t.complete())}))})}var Pn=m(()=>{rn();Ye();mt()});function ps(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Dr(r),i=Mr(r,1/0);return r=us(r),ne(function(n,o){$r(i)(Wr(ke([n],Ie(r)),t)).subscribe(o)})}var fs=m(()=>{Fe();Ye();ls();yn();nn();dn()});function Tn(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return ps.apply(void 0,ke([],Ie(r)))}var ms=m(()=>{Fe();fs()});function B(r){return ne(function(e,t){me(r).subscribe(ye(t,function(){return t.complete()},Yt)),!t.closed&&e.subscribe(t)})}var wn=m(()=>{Ye();mt();it();$i()});var nt=m(()=>{Go();tn();hs();cs();bn();jr();Pn();wn()});var dt,Qr,Kr=m(()=>{Me();$();$();nt();re();dt=1e3,Qr=class{constructor(e,t){this.id=e;this.movementDirection="none";this._tilePos={position:new g(0,0),layer:void 0};this.movementStarted$=new E;this.movementStopped$=new E;this.directionChanged$=new E;this.positionChangeStarted$=new E;this.positionChangeFinished$=new E;this.tilePositionSet$=new E;this.autoMovementSet$=new E;this.lastMovementImpulse="none";this.facingDirection="down";this.depthChanged$=new E;this.movementProgress=0;var i,n,o;this.tilemap=t.tilemap,this.speed=t.speed,this.collidesWithTilesInternal=t.collidesWithTiles,this._tilePos.layer=t.charLayer,this.ignoreMissingTiles=(i=t.ignoreMissingTiles)!=null?i:!1,this.collisionGroups=new Set(t.collisionGroups||[]),this.labels=new Set(t.labels||[]),this.numberOfDirections=t.numberOfDirections,t.facingDirection&&this.turnTowards(t.facingDirection),this.tileWidth=(n=t.tileWidth)!=null?n:1,this.tileHeight=(o=t.tileHeight)!=null?o:1}getId(){return this.id}getSpeed(){return this.speed}setSpeed(e){this.speed=e}setMovement(e){this.autoMovementSet$.next(e),this.movement=e}getMovement(){return this.movement}collidesWithTiles(){return this.collidesWithTilesInternal}getIgnoreMissingTiles(){return this.ignoreMissingTiles}setTilePosition(e){this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(w({},e)),this.fire(this.positionChangeStarted$,this.tilePos,e),this.fire(this.positionChangeFinished$,this.tilePos,e),this.movementDirection="none",this.lastMovementImpulse="none",this.tilePos=e,this.movementProgress=0}getTilePos(){return this.tilePos}getNextTilePos(){if(!this.isMoving())return this.tilePos;let e=this.tilePos.layer,t=this.tilePosInDirection(this.tilePos.position,this.movementDirection),i=this.tilemap.getTransition(t,this.tilePos.layer);return i&&(e=i),{position:this.tilePosInDirection(this.tilePos.position,this.movementDirection),layer:e}}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}move(e){this.lastMovementImpulse=e,e!="none"&&(this.isMoving()||(this.isBlockingDirection(e)?this.changeFacingDirection(e):this.startMoving(e)))}update(e){var t;(t=this.movement)==null||t.update(e),this.isMoving()&&this.updateCharacterPosition(e),this.lastMovementImpulse="none"}getMovementDirection(){return this.movementDirection}isBlockingDirection(e){if(e=="none")return!1;let t=this.tilePosInDirection(this.getNextTilePos().position,e),i=this.tilemap.getTransition(t,this.getNextTilePos().layer)||this.getNextTilePos().layer;return this.collidesWithTilesInternal&&this.isTileBlocking(e,i)?!0:this.isCharBlocking(e,i)}isTileBlocking(e,t){return this.someCharTile((i,n)=>{let o=this.tilePosInDirection(new g(i,n),e);return this.tilemap.hasBlockingTile(o,t,Eo(e),this.ignoreMissingTiles)})}isCharBlocking(e,t){return this.someCharTile((i,n)=>{let o=this.tilePosInDirection(new g(i,n),e);return this.tilemap.hasBlockingChar(o,t,this.getCollisionGroups(),new Set([this.getId()]))})}isMoving(){return this.movementDirection!="none"}turnTowards(e){this.isMoving()||e!="none"&&this.changeFacingDirection(e)}changeFacingDirection(e){this.facingDirection!==e&&(this.facingDirection=e,this.directionChanged$.next(e))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(Se(this.facingDirection))}addCollisionGroup(e){this.collisionGroups.add(e)}setCollisionGroups(e){this.collisionGroups=new Set(e)}getCollisionGroups(){return Array.from(this.collisionGroups)}hasCollisionGroup(e){return this.collisionGroups.has(e)}removeCollisionGroup(e){this.collisionGroups.delete(e)}removeAllCollisionGroups(){this.collisionGroups.clear()}addLabels(e){for(let t of e)this.labels.add(t)}getLabels(){return[...this.labels.values()]}hasLabel(e){return this.labels.has(e)}clearLabels(){this.labels.clear()}removeLabels(e){for(let t of e)this.labels.delete(t)}getNumberOfDirections(){return this.numberOfDirections}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}depthChanged(){return this.depthChanged$}getMovementProgress(){return this.movementProgress}hasWalkedHalfATile(){return this.movementProgress>dt/2}willCrossTileBorderThisUpdate(e){return this.movementProgress+this.maxProgressForDelta(e)>=dt}updateCharacterPosition(e){let t=this.willCrossTileBorderThisUpdate(e),n=1-(t?dt-this.movementProgress:this.maxProgressForDelta(e))/this.maxProgressForDelta(e);this.movementProgress=Math.min(this.movementProgress+this.maxProgressForDelta(e),dt),t&&(this.movementProgress=0,this.shouldContinueMoving()?(this.fire(this.positionChangeFinished$,this.tilePos,this.getNextTilePos()),this.tilePos=this.getNextTilePos(),this.startMoving(this.lastMovementImpulse),n>0&&this.updateCharacterPosition(e*n)):this.stopMoving())}maxProgressForDelta(e){let i=e/1e3;return Math.floor(i*this.speed*dt)}get tilePos(){return b.clone(this._tilePos)}set tilePos(e){b.copyOver(e,this._tilePos)}startMoving(e){e!=="none"&&(e!=this.movementDirection&&this.movementStarted$.next(e),this.movementDirection=e,this.facingDirection=e,this.fire(this.positionChangeStarted$,this.tilePos,this.getNextTilePos()))}tilePosInDirection(e,t){return e.add(Se(this.tilemap.toMapDirection(t)))}shouldContinueMoving(){return this.lastMovementImpulse!=="none"&&!this.isBlockingDirection(this.lastMovementImpulse)}stopMoving(){if(this.movementDirection==="none")return;let e=this.tilePos,t=this.getNextTilePos(),i=this.movementDirection;this.tilePos=this.getNextTilePos(),this.movementDirection="none",this.movementStopped$.next(i),this.fire(this.positionChangeFinished$,e,t)}fire(e,{position:t,layer:i},{position:n,layer:o}){e.next({exitTile:t,enterTile:n,exitLayer:i,enterLayer:o})}someCharTile(e){let t=this.getNextTilePos().position;for(let i=t.x;i<t.x+this.getTileWidth();i++)for(let n=t.y;n<t.y+this.getTileHeight();n++)if(e(i,n))return!0;return!1}}});var gt,Zt,Yr=m(()=>{$();nt();gt=class gt{constructor(e,t){this.walkingAnimationMapping=e;this.charsInRow=t;this.lastFootLeft=!1;this.directionToFrameRow={down:0,"down-left":1,"down-right":2,left:1,right:2,up:3,"up-left":1,"up-right":2};this._isEnabled=!0;this.frameChange$=new E;this.setWalkingAnimationMapping(e)}frameChange(){return this.frameChange$}setIsEnabled(e){this._isEnabled=e}isEnabled(){return this._isEnabled}updateCharacterFrame(e,t,i){this._isEnabled&&(t?this.setStandingFrameDuringWalk(e,i):this.setWalkingFrame(e))}setStandingFrame(e){this._isEnabled&&this._setStandingFrame(e)}setWalkingAnimationMapping(e){this.walkingAnimationMapping=e,this._isEnabled=this.walkingAnimationMapping!==void 0}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharsInRow(){return this.charsInRow}setStandingFrameDuringWalk(e,t){this.isCurrentFrameStanding(e,t)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(e)}setWalkingFrame(e){let t=this.framesOfDirection(e);t&&this.frameChange$.next(this.lastFootLeft?t.rightFoot:t.leftFoot)}_setStandingFrame(e){let t=this.framesOfDirection(e);t&&this.frameChange$.next(t.standing)}isCurrentFrameStanding(e,t){var i;return t===((i=this.framesOfDirection(e))==null?void 0:i.standing)}framesOfDirection(e){return typeof this.walkingAnimationMapping=="number"?this.getFramesForCharIndex(e,this.walkingAnimationMapping):this.getFramesForAnimationMapping(e)}getFramesForAnimationMapping(e){if(this.walkingAnimationMapping)return this.walkingAnimationMapping[e]||this.walkingAnimationMapping[this.fallbackDirection(e)]}fallbackDirection(e){switch(e){case"down-left":return"left";case"down-right":return"right";case"up-left":return"left";case"up-right":return"right"}return e}getFramesForCharIndex(e,t){var u;let i=Math.floor(t/this.charsInRow),n=t%this.charsInRow,o=this.charsInRow*gt.FRAMES_CHAR_ROW,s=gt.FRAMES_CHAR_ROW*n,a=((u=this.directionToFrameRow[e])!=null?u:0)+i*gt.FRAMES_CHAR_COL,h=s+a*o;return{rightFoot:h,standing:h+1,leftFoot:h+2}}};gt.FRAMES_CHAR_ROW=3,gt.FRAMES_CHAR_COL=4;Zt=gt});var At,xn=m(()=>{At=class{static shiftPad(e,t){let i=Math.floor(e),o=`${i}`.padStart(t,"0").length;return i/Math.pow(10,o)}}});var Dt=m(()=>{bn();jr();ms();Pn();wn()});var Xr,ds=m(()=>{Kr();re();Yr();xn();nt();Dt();$();Xr=class{constructor(e,t,i,n,o){this.charData=e;this.scene=t;this.tilemap=i;this.geHeadless=o;this.customOffset=new g(0,0);this.newSpriteSet$=new E;this.destroy$=new E;this.layerOverlaySprite=n&&e.sprite?this.scene.add.sprite(0,0,e.sprite.texture):void 0,this.walkingAnimationMapping=e.walkingAnimationMapping,this.customOffset=new g(e.offsetX||0,e.offsetY||0),this.sprite=e.sprite,this.container=e.container,this.geHeadless.directionChanged().pipe(Z(({charId:s})=>s===this.charData.id)).subscribe(({direction:s})=>{var a;(a=this.animation)==null||a.setStandingFrame(s)}),this.sprite&&(this.sprite.setOrigin(0,0),this.resetAnimation(this.sprite),this.updateOverlaySprite(),this.updateGridChar())}destroy(){this.destroy$.next(),this.destroy$.complete(),this.newSpriteSet$.complete()}setSprite(e){e?(this.sprite&&(e.x=this.sprite.x,e.y=this.sprite.y),this.sprite=e,this.newSpriteSet$.next(),this.layerOverlaySprite=this.layerOverlaySprite?this.scene.add.sprite(0,0,this.sprite.texture):void 0,this.updateOverlaySprite(),this.resetAnimation(this.sprite),this.updateDepth()):(this.layerOverlaySprite=void 0,this.sprite=void 0)}getSprite(){return this.sprite}getLayerOverlaySprite(){return this.layerOverlaySprite}setContainer(e){this.container=e}getContainer(){return this.container}getOffsetX(){return this.customOffset.x}setOffsetX(e){this.customOffset.x=e}getOffsetY(){return this.customOffset.y}setOffsetY(e){this.customOffset.y=e}getWalkingAnimationMapping(){return this.walkingAnimationMapping}turnTowards(e){var t;this.geHeadless.isMoving(this.charData.id)||e!="none"&&(this.geHeadless.turnTowards(this.charData.id,e),(t=this.animation)==null||t.setStandingFrame(e))}getAnimation(){return this.animation}setAnimation(e){this.animation=e}update(e){this.updateGridChar()}getEngineOffset(){var i,n,o,s;if(!this.sprite)return g.ZERO;let e=this.tilemap.getTileWidth()/2-Math.floor(((n=(i=this.sprite)==null?void 0:i.displayWidth)!=null?n:0)/2),t=-((s=(o=this.sprite)==null?void 0:o.displayHeight)!=null?s:0)+this.tilemap.getTileHeight();return new g(e,t)}updatePixelPos(){let e=new g(this.geHeadless.getPosition(this.charData.id)),t=this.geHeadless.getMovementProgress(this.charData.id)/1e3,n=this.tilemap.tilePosToPixelPos(e).add(this.getEngineOffset()).add(this.customOffset).add(Se(this.geHeadless.getFacingDirection(this.charData.id)).multiply(this.tilemap.getTileDistance(this.geHeadless.getFacingDirection(this.charData.id)).scalarMult(t))),o=this.getGameObj();o&&(o.x=Math.floor(n.x),o.y=Math.floor(n.y))}getGameObj(){return this.container||this.sprite}updateGridChar(){var e;if(this.updatePixelPos(),this.sprite&&this.geHeadless.isMoving(this.charData.id)){let t=this.geHeadless.getMovementProgress(this.charData.id)>dt/2;(e=this.getAnimation())==null||e.updateCharacterFrame(this.geHeadless.getFacingDirection(this.charData.id),t,Number(this.sprite.frame.name))}this.updateDepth()}resetAnimation(e){let t=new Zt(this.walkingAnimationMapping,e.texture.source[0].width/e.width/Zt.FRAMES_CHAR_ROW);this.setAnimation(t),t.frameChange().pipe(B(this.newSpriteSet$)).subscribe(i=>{e==null||e.setFrame(i)}),t.setIsEnabled(this.walkingAnimationMapping!==void 0),t.setStandingFrame(this.geHeadless.getFacingDirection(this.charData.id))}updateOverlaySprite(){if(!this.layerOverlaySprite||!this.sprite)return;this.layerOverlaySprite.scale=this.sprite.scale;let e=this.tilemap.getTileHeight()/this.layerOverlaySprite.scale;this.layerOverlaySprite.setCrop(0,0,this.layerOverlaySprite.displayWidth,this.sprite.height-e),this.layerOverlaySprite.setOrigin(0,0)}updateDepth(){let e=this.getGameObj();if(!e)return;let t=new g(this.geHeadless.getPosition(this.charData.id)),i=this.geHeadless.getCharLayer(this.charData.id);this.setDepth(e,{position:t,layer:i});let n=this.getLayerOverlaySprite();if(n){let o=new g(De(w({},t),{y:t.y-1}));this.setDepth(n,{position:o,layer:i})}}setDepth(e,t){e.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(t))+this.getPaddedPixelDepth(e))}getPaddedPixelDepth(e){return At.shiftPad(e.y+e.displayHeight,7)}getTransitionLayer(e){if(e.layer)return this.geHeadless.getTransition(e.position,e.layer)||e.layer}}});var er,Jr=m(()=>{er=(n=>(n.DONT_BLOCK="DONT_BLOCK",n.BLOCK_TWO_TILES="BLOCK_TWO_TILES",n.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",n.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND",n))(er||{})});var yt,tr=m(()=>{yt=(i=>(i.STOP="STOP",i.CLOSEST_REACHABLE="CLOSEST_REACHABLE",i.RETRY="RETRY",i))(yt||{})});var _,Xe=m(()=>{re();_=class r{static vec2str(e){return`${e.x}#${e.y}`}static equal(e,t){return r.vec2str(e)==r.vec2str(t)}static manhattanDistance(e,t){let i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return i+n}static chebyshevDistance(e,t){let i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return Math.max(i,n)}static scalarMult(e,t){return e.clone().multiply(new g(t,t))}}});var Zr,gs=m(()=>{Xe();$();re();Zr=class{distance(e,t){return _.manhattanDistance(e,t)}direction(e,t){if(_.equal(e,t))return"none";let i=e.clone().subtract(t);return Math.abs(i.x)>Math.abs(i.y)?i.x>0?"left":"right":i.y>0?"up":"down"}neighbors(e){return[new g(e.x,e.y+1),new g(e.x+1,e.y),new g(e.x-1,e.y),new g(e.x,e.y-1)]}getDirections(){return["up","right","down","left"]}}});var ei,ys=m(()=>{Xe();$();re();ei=class{distance(e,t){return _.chebyshevDistance(e,t)}neighbors(e){let t=[new g(e.x,e.y+1),new g(e.x+1,e.y),new g(e.x-1,e.y),new g(e.x,e.y-1)],i=[new g(e.x+1,e.y+1),new g(e.x+1,e.y-1),new g(e.x-1,e.y+1),new g(e.x-1,e.y-1)];return[...t,...i]}direction(e,t){return t.x>e.x?t.y>e.y?"down-right":t.y<e.y?"up-right":"right":t.x<e.x?t.y>e.y?"down-left":t.y<e.y?"up-left":"left":t.y<e.y?"up":t.y>e.y?"down":"none"}getDirections(){return["up","right","down","left","down-left","down-right","up-right","up-left"]}}});var he,vt=m(()=>{gs();$();ys();he=class{static create(e){switch(e){case 4:return new Zr;case 8:return new ei}}}});var rr,vs=m(()=>{rr=class{constructor(e,t,i){this.backoffMs=e;this.maxRetries=t;this.onFinished=i;this.retries=0;this.elapsed=0}retry(e,t){this.shouldRetry()?(this.elapsed+=e,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,t())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}getBackoffMs(){return this.backoffMs}shouldRetry(){return this.maxRetries===-1||this.retries<this.maxRetries}}});var Mt,ti=m(()=>{Mt=(i=>(i.WAIT="WAIT",i.RETRY="RETRY",i.STOP="STOP",i))(Mt||{})});var _e,bt=m(()=>{vt();re();$();Me();Xe();_e=class{constructor(e,{shortestPathAlgorithm:t="BFS",pathWidth:i=1,pathHeight:n=1,numberOfDirections:o=4,isPositionAllowed:s=(P,x)=>!0,collisionGroups:a=[],ignoredChars:h=[],ignoreTiles:u=!1,ignoreMapBounds:l=!1,ignoreBlockedTarget:c=!1,maxPathLength:p=1/0,ignoreLayers:f=!1,considerCosts:d=!1,calculateClosestToTarget:y=!0}={}){this.gridTilemap=e;this.options={shortestPathAlgorithm:t,pathWidth:i,pathHeight:n,numberOfDirections:o,isPositionAllowed:s,collisionGroups:a,ignoredChars:h,ignoreTiles:u,ignoreMapBounds:l,ignoreBlockedTarget:c,maxPathLength:p,ignoreLayers:f,considerCosts:d,calculateClosestToTarget:y}}findShortestPath(e,t){this.options.ignoreLayers&&(this.gridTilemap.fixCacheLayer(e.layer),t.layer=e.layer);let i=this.findShortestPathImpl(e,t);return this.gridTilemap.unfixCacheLayers(),i}getNeighbors(e,t){var s;return he.create((s=this.options.numberOfDirections)!=null?s:4).neighbors(e.position).map(a=>{let h=e.layer;return this.options.ignoreLayers||(h=this.gridTilemap.getTransition(a,e.layer)),{position:a,layer:h||e.layer}}).filter(a=>!this.isBlocking(e,a)||this.options.ignoreBlockedTarget&&b.equal(a,t))}getTransition(e,t){if(!this.options.ignoreLayers)return this.gridTilemap.getTransition(e,t)}getCosts(e,t){if(!this.options.considerCosts)return 1;let i=ie(t.position,e);return this.gridTilemap.getTileCosts(t,i)}isBlocking(e,t){return!(this.options.ignoreMapBounds||this.gridTilemap.isInRange(t.position))||!this.options.isPositionAllowed(t.position,t.layer)||!this.options.ignoreTiles&&this.hasBlockingTileFrom(e,t,this.options.pathWidth,this.options.pathHeight,this.options.ignoreMapBounds,this.gridTilemap)?!0:this.hasBlockingCharFrom(t,this.options.pathWidth,this.options.pathHeight,this.options.collisionGroups,this.options.ignoredChars,this.gridTilemap)}distance(e,t){return(this.options.numberOfDirections===4?_.manhattanDistance:_.chebyshevDistance)(e,t)}getTilePosInDir(e,t){return this.gridTilemap.getTilePosInDirection(e,t)}getReverseNeighbors(e,t){var a;let n=he.create((a=this.options.numberOfDirections)!=null?a:4).neighbors(e.position),o;if(!this.options.ignoreLayers){let h=this.gridTilemap.getReverseTransitions(e.position,e.layer);o=h?[...h]:void 0}return n.map(h=>o?o.map(u=>({position:h,layer:u||e.layer})):[{position:h,layer:e.layer}]).flat().filter(h=>!this.isBlocking(h,e)||this.options.ignoreBlockedTarget&&b.equal(e,t))}hasBlockingCharFrom(e,t,i,n,o,s){for(let a=e.position.x;a<e.position.x+t;a++)for(let h=e.position.y;h<e.position.y+i;h++)if(s.hasBlockingChar(new g(a,h),e.layer,n,new Set(o)))return!0;return!1}hasBlockingTileFrom(e,t,i,n,o,s){for(let a=t.position.x;a<t.position.x+i;a++)for(let h=t.position.y;h<t.position.y+n;h++)if(s.hasBlockingTile(new g(a,h),t.layer,ie(t.position,e.position),o))return!0;return!1}}});var nr=v(ir=>{var Uu=function(r,e){return r<e?-1:r>e?1:0},Hu=function(r,e){return r<e?1:r>e?-1:0};function Gu(r){return function(e,t){return r(t,e)}}function Bu(r){return r===2?function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:e[1]<t[1]?-1:e[1]>t[1]?1:0}:function(e,t){for(var i=0;i<r;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i++}return 0}}ir.DEFAULT_COMPARATOR=Uu;ir.DEFAULT_REVERSE_COMPARATOR=Hu;ir.reverseComparator=Gu;ir.createTupleComparator=Bu});var bs=v(Sn=>{Sn.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer!="undefined";Sn.SYMBOL_SUPPORT=typeof Symbol!="undefined"});var D=v((Mg,Ts)=>{var Ps=bs(),qu=Ps.ARRAY_BUFFER_SUPPORT,Wu=Ps.SYMBOL_SUPPORT;Ts.exports=function(e,t){var i,n,o,s,a;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof t!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||qu&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(o=0,s=e.length;o<s;o++)t(e[o],o);return}if(typeof e.forEach=="function"){e.forEach(t);return}if(Wu&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(i=e,o=0;a=i.next(),a.done!==!0;)t(a.value,o),o++;return}for(n in e)e.hasOwnProperty(n)&&t(e[n],n)}});var ii=v((Ig,Os)=>{var ws=nr(),xs=D(),Ss=ws.DEFAULT_COMPARATOR,ju=ws.reverseComparator;function ue(r){if(this.clear(),this.comparator=r||Ss,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.")}ue.prototype.clear=function(){this.root=null,this.min=null,this.size=0};function $u(r){return{item:r,degree:0}}function Cs(r,e){r.root?(e.right=r.root.right,e.left=r.root,r.root.right.left=e,r.root.right=e):r.root=e}ue.prototype.push=function(r){var e=$u(r);return e.left=e,e.right=e,Cs(this,e),(!this.min||this.comparator(e.item,this.min.item)<=0)&&(this.min=e),++this.size};ue.prototype.peek=function(){return this.min?this.min.item:void 0};function Ls(r){for(var e=[],t=r,i=!1;!(t===r&&i);)t===r&&(i=!0),e.push(t),t=t.right;return e}function Es(r,e){r.root===e&&(r.root=e.right),e.left.right=e.right,e.right.left=e.left}function Qu(r,e){r.child?(e.right=r.child.right,e.left=r.child,r.child.right.left=e,r.child.right=e):r.child=e}function Ku(r,e,t){Es(r,e),e.left=e,e.right=e,Qu(t,e),t.degree++,e.parent=t}function Yu(r){var e=new Array(r.size),t=Ls(r.root),i,n,o,s,a,h;for(i=0,n=t.length;i<n;i++){for(o=t[i],a=o.degree;e[a];)s=e[a],r.comparator(o.item,s.item)>0&&(h=o,o=s,s=h),Ku(r,s,o),e[a]=null,a++;e[a]=o}for(i=0;i<r.size;i++)e[i]&&r.comparator(e[i].item,r.min.item)<=0&&(r.min=e[i])}ue.prototype.pop=function(){if(this.size){var r=this.min;if(r.child){var e=Ls(r.child),t,i,n;for(i=0,n=e.length;i<n;i++)t=e[i],Cs(this,t),delete t.parent}return Es(this,r),r===r.right?(this.min=null,this.root=null):(this.min=r.right,Yu(this)),this.size--,r.item}};ue.prototype.inspect=function(){var r={size:this.size};return this.min&&"item"in this.min&&(r.top=this.min.item),Object.defineProperty(r,"constructor",{value:ue,enumerable:!1}),r};typeof Symbol!="undefined"&&(ue.prototype[Symbol.for("nodejs.util.inspect.custom")]=ue.prototype.inspect);function ri(r){if(this.clear(),this.comparator=r||Ss,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.");this.comparator=ju(this.comparator)}ri.prototype=ue.prototype;ue.from=function(r,e){var t=new ue(e);return xs(r,function(i){t.push(i)}),t};ri.from=function(r,e){var t=new ri(e);return xs(r,function(i){t.push(i)}),t};ue.MinFibonacciHeap=ue;ue.MaxFibonacciHeap=ri;Os.exports=ue});function or(r,e){var t;return(t=r.get(b.toString(e)))!=null?t:Number.MAX_VALUE}function As(r,e){return _.equal(r.position,e.position)?r.layer===e.layer:!1}var Ds,ni,Ms=m(()=>{bt();Xe();Ds=So(ii());Me();ni=class extends _e{findShortestPathImpl(e,t){let i=this.shortestPathBfs(e,t);return{path:this.returnPath(i.previous,e,t),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"A_STAR"}}shortestPathBfs(e,t){let i=new Map,n=new Map,o=new Map,s=new Ds.MinFibonacciHeap((l,c)=>or(o,l)-or(o,c)),a=e,h=this.distance(e.position,t.position),u=0;for(s.push(e),n.set(b.toString(e),0),o.set(b.toString(e),this.distance(e.position,t.position));s.size>0;){let l=s.pop();if(!l)break;u++;let c=this.distance(l.position,t.position);if(c<h&&(h=c,a=l),As(l,t))return{previous:i,closestToTarget:a,steps:u,maxPathLengthReached:!1};if(or(n,l)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:a,steps:u,maxPathLengthReached:!0};for(let p of this.getNeighbors(l,t)){let f=or(n,l)+this.getCosts(l.position,p),d=b.toString(p);(!n.has(d)||f<or(n,p))&&(i.set(d,l),n.set(d,f),o.set(d,f+this.distance(p.position,t.position)),s.push(p))}}return{previous:i,closestToTarget:a,steps:u,maxPathLengthReached:!1}}returnPath(e,t,i){let n=[],o=i;for(n.push(o);!As(o,t);){if(o=e.get(b.toString(o)),!o)return[];n.push(o)}return n.reverse()}}});var oi,Je,si=m(()=>{oi=class{constructor(e){this.data=e}},Je=class{constructor(){this.sizeInternal=0}dequeue(){if(this.tail===void 0)return;this.sizeInternal--;let e=this.tail.data;return this.tail.prev===void 0?(this.tail=void 0,this.head=void 0,e):(this.tail.prev.next=void 0,this.tail=this.tail.prev,e)}enqueue(e){if(this.sizeInternal++,this.head===void 0){this.head=new oi(e),this.tail=this.head;return}let t=new oi(e);t.next=this.head,this.head.prev=t,this.head=t}peek(){return this.tail?this.tail.data:void 0}peekAll(){let e=[],t=this.tail;for(;t;)e.push(t.data),t=t.prev;return e}clear(){this.head=void 0,this.tail=void 0,this.sizeInternal=0}peekEnd(){var e;return(e=this.head)==null?void 0:e.data}size(){return this.sizeInternal}}});var It,Cn=m(()=>{bt();Xe();si();Me();It=class extends _e{findShortestPathImpl(e,t){let i=this.shortestPathBfs(e,t);return{path:this.returnPath(i.previous,e,t),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BFS"}}equal(e,t){return _.equal(e.position,t.position)?e.layer===t.layer:!1}shortestPathBfs(e,t){let i=new Map,n=new Set,o=new Je,s=e,a=this.distance(e.position,t.position),h=0;for(o.enqueue({node:e,dist:0}),n.add(b.toString(e));o.size()>0;){let u=o.dequeue();if(h++,!u)break;let{node:l,dist:c}=u;if(c>this.options.maxPathLength)return{previous:new Map,closestToTarget:s,steps:h,maxPathLengthReached:!0};let p=this.distance(l.position,t.position);if(p<a&&(a=p,s=l),this.equal(l,t))return{previous:i,closestToTarget:s,steps:h,maxPathLengthReached:!1};for(let f of this.getNeighbors(l,t))n.has(b.toString(f))||(i.set(b.toString(f),l),o.enqueue({node:f,dist:c+1}),n.add(b.toString(f)))}return{previous:i,closestToTarget:s,steps:h,maxPathLengthReached:!1}}returnPath(e,t,i){let n=[],o=i;for(n.push(o);!this.equal(o,t);){if(o=e.get(b.toString(o)),!o)return[];n.push(o)}return n.reverse()}}});var ai,hi,Is=m(()=>{Me();bt();Xe();si();ai=class{constructor(){this.previous=new Map;this.visited=new Map;this.queue=new Je;this.minMatching=1/0;this.lastDist=0}isNewFrontier(){let e=this.queue.peek();return!!(e&&e.dist>this.lastDist)}step(e,t,i){var n;this.lastDist=i;for(let o of e){let s=b.toString(o);if(!this.visited.has(s)){this.previous.set(s,t),this.queue.enqueue({node:o,dist:i+1}),this.visited.set(s,i+1);let a=(n=this.otherBfs)==null?void 0:n.visited.get(s);a!==void 0&&a<this.minMatching&&(this.minMatching=a,this.minMatchingNode=o)}}}},hi=class extends _e{findShortestPathImpl(e,t){let i=this.shortestPathBfs(e,t);return{path:this.returnPath(i.previous,i.previous2,i.matchingPos,e,t),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BIDIRECTIONAL_SEARCH"}}equal(e,t){return _.equal(e.position,t.position)?e.layer===t.layer:!1}shortestPathBfs(e,t){var h;if(b.equal(e,t))return{previous:new Map,previous2:new Map,closestToTarget:e,steps:0,maxPathLengthReached:!1};let i=new ai,n=new ai,o=0;i.otherBfs=n,n.otherBfs=i;let s=e,a=this.distance(e.position,t.position);for(i.queue.enqueue({node:e,dist:0}),n.queue.enqueue({node:t,dist:0}),i.visited.set(b.toString(e),0),n.visited.set(b.toString(t),0);this.shouldStop(i.queue.size()>0,n.queue.size()>0);){let u=i.queue.dequeue();if(!u)break;let{node:l,dist:c}=u;if(c+1+(((h=n.queue.peek())==null?void 0:h.dist)||0)>this.options.maxPathLength)return{previous:i.previous,previous2:n.previous,closestToTarget:this.maybeClosestToTarget(s),steps:o,maxPathLengthReached:!0};let p=this.distance(l.position,t.position);if(p<a&&(a=p,s=l),o++,i.step(this.getNeighbors(l,t),l,c),i.isNewFrontier()&&i.minMatchingNode)return{previous:i.previous,previous2:n.previous,closestToTarget:this.maybeClosestToTarget(t),matchingPos:i.minMatchingNode,steps:o,maxPathLengthReached:!1};let f=n.queue.dequeue();if(!f)continue;let{node:d,dist:y}=f;if(o++,n.step(this.getReverseNeighbors(d,t),d,y),n.isNewFrontier()&&n.minMatchingNode)return{previous:i.previous,previous2:n.previous,closestToTarget:this.maybeClosestToTarget(t),matchingPos:n.minMatchingNode,steps:o,maxPathLengthReached:!1}}return{previous:i.previous,previous2:n.previous,closestToTarget:this.maybeClosestToTarget(s),steps:o,maxPathLengthReached:!1}}shouldStop(e,t){return this.options.calculateClosestToTarget?e||t:e&&t}maybeClosestToTarget(e){return this.options.calculateClosestToTarget?e:void 0}returnPath(e,t,i,n,o){if(i){let s=this.getPathFromPrev(e,n,i).reverse(),a=this.getPathFromPrev(t,o,i);return s.pop(),[...s,...a]}else return this.getPathFromPrev(e,n,o).reverse()}getPathFromPrev(e,t,i){let n=[],o=i;for(n.push(o);!this.equal(o,t);){if(o=e.get(b.toString(o)),!o)return[];n.push(o)}return n}}});var le=v(ze=>{var Xu=Math.pow(2,8)-1,Ju=Math.pow(2,16)-1,Zu=Math.pow(2,32)-1,el=Math.pow(2,7)-1,tl=Math.pow(2,15)-1,rl=Math.pow(2,31)-1;ze.getPointerArray=function(r){var e=r-1;if(e<=Xu)return Uint8Array;if(e<=Ju)return Uint16Array;if(e<=Zu)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};ze.getSignedPointerArray=function(r){var e=r-1;return e<=el?Int8Array:e<=tl?Int16Array:e<=rl?Int32Array:Float64Array};ze.getNumberType=function(r){return r===(r|0)?Math.sign(r)===-1?r<=127&&r>=-128?Int8Array:r<=32767&&r>=-32768?Int16Array:Int32Array:r<=255?Uint8Array:r<=65535?Uint16Array:Uint32Array:Float64Array};var il={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};ze.getMinimalRepresentation=function(r,e){var t=null,i=0,n,o,s,a,h;for(a=0,h=r.length;a<h;a++)s=e?e(r[a]):r[a],o=ze.getNumberType(s),n=il[o.name],n>i&&(i=n,t=o);return t};ze.isTypedArray=function(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView(r)};ze.concat=function(){var r=0,e,t,i;for(e=0,i=arguments.length;e<i;e++)r+=arguments[e].length;var n=new arguments[0].constructor(r);for(e=0,t=0;e<i;e++)n.set(arguments[e],t),t+=arguments[e].length;return n};ze.indices=function(r){for(var e=ze.getPointerArray(r),t=new e(r),i=0;i<r;i++)t[i]=i;return t}});var ge=v(sr=>{var ks=D(),Fs=le();function nl(r){return Array.isArray(r)||Fs.isTypedArray(r)}function Ln(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function ol(r){var e=Ln(r),t=typeof e=="number"?new Array(e):[],i=0;return ks(r,function(n){t[i++]=n}),t}function sl(r){var e=Ln(r),t=typeof e=="number"?Fs.getPointerArray(e):Array,i=typeof e=="number"?new Array(e):[],n=typeof e=="number"?new t(e):[],o=0;return ks(r,function(s){i[o]=s,n[o]=o++}),[i,n]}sr.isArrayLike=nl;sr.guessLength=Ln;sr.toArray=ol;sr.toArrayWithIndices=sl});var pi=v((ry,Vs)=>{var ui=D(),Rs=nr(),Ve=ge(),ci=Rs.DEFAULT_COMPARATOR,En=Rs.reverseComparator;function On(r,e,t,i){for(var n=e[i],o,s;i>t;){if(o=i-1>>1,s=e[o],r(n,s)<0){e[i]=s,i=o;continue}break}e[i]=n}function ar(r,e,t){for(var i=e.length,n=t,o=e[t],s=2*t+1,a;s<i;)a=s+1,a<i&&r(e[s],e[a])>=0&&(s=a),e[t]=e[s],t=s,s=2*t+1;e[t]=o,On(r,e,n,t)}function _s(r,e,t){e.push(t),On(r,e,0,e.length-1)}function An(r,e){var t=e.pop();if(e.length!==0){var i=e[0];return e[0]=t,ar(r,e,0),i}return t}function kt(r,e,t){if(e.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var i=e[0];return e[0]=t,ar(r,e,0),i}function zs(r,e,t){var i;return e.length!==0&&r(e[0],t)<0&&(i=e[0],e[0]=t,t=i,ar(r,e,0)),t}function Pt(r,e){for(var t=e.length,i=t>>1,n=i;--n>=0;)ar(r,e,n)}function Dn(r,e){for(var t=e.length,i=0,n=new Array(t);i<t;)n[i++]=An(r,e);return n}function al(r,e,t){arguments.length===2&&(t=e,e=r,r=ci);var i=En(r),n,o,s,a=1/0,h;if(e===1){if(Ve.isArrayLike(t)){for(n=0,o=t.length;n<o;n++)s=t[n],(a===1/0||r(s,a)<0)&&(a=s);return h=new t.constructor(1),h[0]=a,h}return ui(t,function(l){(a===1/0||r(l,a)<0)&&(a=l)}),[a]}if(Ve.isArrayLike(t)){if(e>=t.length)return t.slice().sort(r);for(h=t.slice(0,e),Pt(i,h),n=e,o=t.length;n<o;n++)i(t[n],h[0])>0&&kt(i,h,t[n]);return h.sort(r)}var u=Ve.guessLength(t);return u!==null&&u<e&&(e=u),h=new Array(e),n=0,ui(t,function(l){n<e?h[n]=l:(n===e&&Pt(i,h),i(l,h[0])>0&&kt(i,h,l)),n++}),h.length>n&&(h.length=n),h.sort(r)}function hl(r,e,t){arguments.length===2&&(t=e,e=r,r=ci);var i=En(r),n,o,s,a=-1/0,h;if(e===1){if(Ve.isArrayLike(t)){for(n=0,o=t.length;n<o;n++)s=t[n],(a===-1/0||r(s,a)>0)&&(a=s);return h=new t.constructor(1),h[0]=a,h}return ui(t,function(l){(a===-1/0||r(l,a)>0)&&(a=l)}),[a]}if(Ve.isArrayLike(t)){if(e>=t.length)return t.slice().sort(i);for(h=t.slice(0,e),Pt(r,h),n=e,o=t.length;n<o;n++)r(t[n],h[0])>0&&kt(r,h,t[n]);return h.sort(i)}var u=Ve.guessLength(t);return u!==null&&u<e&&(e=u),h=new Array(e),n=0,ui(t,function(l){n<e?h[n]=l:(n===e&&Pt(r,h),r(l,h[0])>0&&kt(r,h,l)),n++}),h.length>n&&(h.length=n),h.sort(i)}function O(r){if(this.clear(),this.comparator=r||ci,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}O.prototype.clear=function(){this.items=[],this.size=0};O.prototype.push=function(r){return _s(this.comparator,this.items,r),++this.size};O.prototype.peek=function(){return this.items[0]};O.prototype.pop=function(){return this.size!==0&&this.size--,An(this.comparator,this.items)};O.prototype.replace=function(r){return kt(this.comparator,this.items,r)};O.prototype.pushpop=function(r){return zs(this.comparator,this.items,r)};O.prototype.consume=function(){return this.size=0,Dn(this.comparator,this.items)};O.prototype.toArray=function(){return Dn(this.comparator,this.items.slice())};O.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:O,enumerable:!1}),r};typeof Symbol!="undefined"&&(O.prototype[Symbol.for("nodejs.util.inspect.custom")]=O.prototype.inspect);function li(r){if(this.clear(),this.comparator=r||ci,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=En(this.comparator)}li.prototype=O.prototype;O.from=function(r,e){var t=new O(e),i;return Ve.isArrayLike(r)?i=r.slice():i=Ve.toArray(r),Pt(t.comparator,i),t.items=i,t.size=i.length,t};li.from=function(r,e){var t=new li(e),i;return Ve.isArrayLike(r)?i=r.slice():i=Ve.toArray(r),Pt(t.comparator,i),t.items=i,t.size=i.length,t};O.siftUp=ar;O.siftDown=On;O.push=_s;O.pop=An;O.replace=kt;O.pushpop=zs;O.heapify=Pt;O.consume=Dn;O.nsmallest=al;O.nlargest=hl;O.MinHeap=O;O.MaxHeap=li;Vs.exports=O});var Bs=v((iy,Gs)=>{var Ns="";function Us(r,e,t){for(var i=e.length,n=[],o=i,s=-1,a,h=0,u;o--;)s=Math.max(r[e[o]+t],s);for(u=s>>24&&32||s>>16&&24||s>>8&&16||8;h<u;h+=4){for(o=16;o--;)n[o]=[];for(o=i;o--;)n[r[e[o]+t]>>h&15].push(e[o]);for(a=0;a<16;a++)for(s=n[a].length;s--;)e[++o]=n[a][s]}}function ul(r,e,t,i){return r[t]-r[i]||(t%3===2?r[t+1]-r[i+1]||e[t+2]-e[i+2]:e[t+1]-e[i+1])}function Mn(r,e){var t=[],i=[],n=2*e/3|0,o=e-n,s=n+1>>1,a=n,h=0,u,l=[],c=[];if(e===1)return[0];for(;a--;)t[a]=(a*3>>1)+1;for(a=3;a--;)Us(r,t,a);for(h=i[(t[0]/3|0)+(t[0]%3===1?0:s)]=1,a=1;a<n;a++)(r[t[a]]!==r[t[a-1]]||r[t[a]+1]!==r[t[a-1]+1]||r[t[a]+2]!==r[t[a-1]+2])&&h++,i[(t[a]/3|0)+(t[a]%3===1?0:s)]=h;if(h<n)for(i=Mn(i,n),a=n;a--;)t[a]=i[a]<s?i[a]*3+1:(i[a]-s)*3+2;for(a=n;a--;)l[t[a]]=a;for(l[e]=-1,l[e+1]=-2,i=e%3===1?[e-1]:[],a=0;a<n;a++)t[a]%3===1&&i.push(t[a]-1);for(Us(r,i,0),a=0,h=0,u=0;a<n&&h<o;)c[u++]=ul(r,l,t[a],i[h])<0?t[a++]:i[h++];for(;a<n;)c[u++]=t[a++];for(;h<o;)c[u++]=i[h++];return c}function Hs(r){var e=r.length,t=e%3,i=new Array(e+t),n,o;if(typeof r!="string"){var s=Object.create(null);for(o=0;o<e;o++)s[r[o]]||(s[r[o]]=!0);var a=Object.create(null),h=Object.keys(s).sort();for(o=0,n=h.length;o<n;o++)a[h[o]]=o+1;for(o=0;o<e;o++)i[o]=a[r[o]]}else for(o=0;o<e;o++)i[o]=r.charCodeAt(o);for(o=e;o<e+t;o++)i[o]=0;return i}function ot(r){this.hasArbitrarySequence=typeof r!="string",this.string=r,this.length=r.length,this.array=Mn(Hs(r),this.length)}ot.prototype.toString=function(){return this.array.join(",")};ot.prototype.toJSON=function(){return this.array};ot.prototype.inspect=function(){for(var r=new Array(this.length),e=0;e<this.length;e++)r[e]=this.string.slice(this.array[e]);return Object.defineProperty(r,"constructor",{value:ot,enumerable:!1}),r};typeof Symbol!="undefined"&&(ot.prototype[Symbol.for("nodejs.util.inspect.custom")]=ot.prototype.inspect);function st(r){if(this.hasArbitrarySequence=typeof r[0]!="string",this.size=r.length,this.hasArbitrarySequence){this.text=[];for(var e=0,t=this.size;e<t;e++)this.text.push.apply(this.text,r[e]),e<t-1&&this.text.push(Ns)}else this.text=r.join(Ns);this.firstLength=r[0].length,this.length=this.text.length,this.array=Mn(Hs(this.text),this.length)}st.prototype.longestCommonSubsequence=function(){var r=this.hasArbitrarySequence?[]:"",e,t,i,n,o;for(t=1;t<this.length;t++)if(n=this.array[t],o=this.array[t-1],!(n<this.firstLength&&o<this.firstLength)&&!(n>this.firstLength&&o>this.firstLength)){for(e=Math.min(this.length-n,this.length-o),i=0;i<e;i++)if(this.text[n+i]!==this.text[o+i]){e=i;break}e>r.length&&(r=this.text.slice(n,n+e))}return r};st.prototype.toString=function(){return this.array.join(",")};st.prototype.toJSON=function(){return this.array};st.prototype.inspect=function(){for(var r=new Array(this.length),e=0;e<this.length;e++)r[e]=this.text.slice(this.array[e]);return Object.defineProperty(r,"constructor",{value:st,enumerable:!1}),r};typeof Symbol!="undefined"&&(st.prototype[Symbol.for("nodejs.util.inspect.custom")]=st.prototype.inspect);ot.GeneralizedSuffixArray=st;Gs.exports=ot});var Qs=v((ny,$s)=>{var ll=D();function Le(r){this.size=0,this.items=new Map,this.inverse=r}function ve(){this.size=0,this.items=new Map,this.inverse=new Le(this)}function qs(){this.size=0,this.items.clear(),this.inverse.items.clear()}ve.prototype.clear=qs;Le.prototype.clear=qs;function Ws(r,e){if(this.items.has(r)){var t=this.items.get(r);if(t===e)return this;this.inverse.items.delete(t)}if(this.inverse.items.has(e)){var i=this.inverse.items.get(e);if(i===r)return this;this.items.delete(i)}return this.items.set(r,e),this.inverse.items.set(e,r),this.size=this.items.size,this.inverse.size=this.inverse.items.size,this}ve.prototype.set=Ws;Le.prototype.set=Ws;function js(r){if(this.items.has(r)){var e=this.items.get(r);return this.items.delete(r),this.inverse.items.delete(e),this.size=this.items.size,this.inverse.size=this.inverse.items.size,!0}return!1}ve.prototype.delete=js;Le.prototype.delete=js;var cl=["has","get","forEach","keys","values","entries"];cl.forEach(function(r){ve.prototype[r]=Le.prototype[r]=function(){return Map.prototype[r].apply(this.items,arguments)}});typeof Symbol!="undefined"&&(ve.prototype[Symbol.iterator]=ve.prototype.entries,Le.prototype[Symbol.iterator]=Le.prototype.entries);ve.prototype.inspect=function(){var r={left:this.items,right:this.inverse.items};return Object.defineProperty(r,"constructor",{value:ve,enumerable:!1}),r};typeof Symbol!="undefined"&&(ve.prototype[Symbol.for("nodejs.util.inspect.custom")]=ve.prototype.inspect);Le.prototype.inspect=function(){var r={left:this.inverse.items,right:this.items};return Object.defineProperty(r,"constructor",{value:Le,enumerable:!1}),r};typeof Symbol!="undefined"&&(Le.prototype[Symbol.for("nodejs.util.inspect.custom")]=Le.prototype.inspect);ve.from=function(r){var e=new ve;return ll(r,function(t,i){e.set(i,t)}),e};$s.exports=ve});var K=v((oy,Ks)=>{function Ne(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol!="undefined"&&(Ne.prototype[Symbol.iterator]=function(){return this});Ne.of=function(){var r=arguments,e=r.length,t=0;return new Ne(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};Ne.empty=function(){var r=new Ne(function(){return{done:!0}});return r};Ne.fromSequence=function(r){var e=0,t=r.length;return new Ne(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};Ne.is=function(r){return r instanceof Ne?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};Ks.exports=Ne});var kn=v(Ee=>{function Xs(r){return r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r&~(r>>1)}Ee.msb32=Xs;function In(r){return r|=r>>1,r|=r>>2,r|=r>>4,r&~(r>>1)}Ee.msb8=In;Ee.test=function(r,e){return r>>e&1};Ee.criticalBit8=function(r,e){return In(r^e)};Ee.criticalBit8Mask=function(r,e){return~In(r^e)>>>0&255};Ee.testCriticalBit8=function(r,e){return 1+(r|e)>>8};Ee.criticalBit32Mask=function(r,e){return~Xs(r^e)>>>0&4294967295};Ee.popcount=function(r){return r-=r>>1&1431655765,r=(r&858993459)+(r>>2&858993459),r=r+(r>>4)&252645135,r+=r>>8,r+=r>>16,r&127};var Ft=new Uint8Array(Math.pow(2,8));for(hr=0,Ys=Ft.length;hr<Ys;hr++)Ft[hr]=Ee.popcount(hr);var hr,Ys;Ee.table8Popcount=function(r){return Ft[r&255]+Ft[r>>8&255]+Ft[r>>16&255]+Ft[r>>24&255]}});var ta=v((ay,ea)=>{var Zs=K(),Js=kn();function q(r){this.length=r,this.clear()}q.prototype.clear=function(){this.size=0,this.array=new Uint32Array(Math.ceil(this.length/32))};q.prototype.set=function(r,e){var t=r>>5,i=r&31,n=this.array[t],o;return e===0||e===!1?o=this.array[t]&=~(1<<i):o=this.array[t]|=1<<i,o=o>>>0,o>n?this.size++:o<n&&this.size--,this};q.prototype.reset=function(r){var e=r>>5,t=r&31,i=this.array[e],n;return n=this.array[e]&=~(1<<t),n<i&&this.size--,this};q.prototype.flip=function(r){var e=r>>5,t=r&31,i=this.array[e],n=this.array[e]^=1<<t;return n=n>>>0,n>i?this.size++:n<i&&this.size--,this};q.prototype.get=function(r){var e=r>>5,t=r&31;return this.array[e]>>t&1};q.prototype.test=function(r){return!!this.get(r)};q.prototype.rank=function(r){if(this.size===0)return 0;for(var e=r>>5,t=r&31,i=0,n=0;n<e;n++)i+=Js.table8Popcount(this.array[n]);var o=this.array[e]&(1<<t)-1;return i+=Js.table8Popcount(o),i};q.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var e,t=32,i=0,n=0,o=0,s=this.array.length;o<s;o++)if(e=this.array[o],e!==0){o===s-1&&(t=this.length%32||32);for(var a=0;a<t;a++,i++)if(n+=e>>a&1,n===r)return i}};q.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=this.length,i,n,o=32,s=0,a=this.array.length;s<a;s++){i=this.array[s],s===a-1&&(o=t%32||32);for(var h=0;h<o;h++)n=i>>h&1,r.call(e,n,s*32+h)}};q.prototype.values=function(){var r=this.length,e=!1,t,i,n=this.array,o=n.length,s=0,a=-1,h=32;return new Zs(function u(){if(!e){if(s>=o)return{done:!0};s===o-1&&(h=r%32||32),t=n[s++],e=!0,a=-1}return a++,a>=h?(e=!1,u()):(i=t>>a&1,{value:i})})};q.prototype.entries=function(){var r=this.length,e=!1,t,i,n=this.array,o,s=n.length,a=0,h=-1,u=32;return new Zs(function l(){if(!e){if(a>=s)return{done:!0};a===s-1&&(u=r%32||32),t=n[a++],e=!0,h=-1}return h++,o=~-a*32+h,h>=u?(e=!1,l()):(i=t>>h&1,{value:[o,i]})})};typeof Symbol!="undefined"&&(q.prototype[Symbol.iterator]=q.prototype.values);q.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(e,t){r[t]=e}),Object.defineProperty(r,"constructor",{value:q,enumerable:!1}),r};typeof Symbol!="undefined"&&(q.prototype[Symbol.for("nodejs.util.inspect.custom")]=q.prototype.inspect);q.prototype.toJSON=function(){return Array.from(this.array)};ea.exports=q});var oa=v((hy,na)=>{var ia=K(),ra=kn(),pl=function(r){return Math.max(1,Math.ceil(r*1.5))};function fl(r){return new Uint32Array(Math.ceil(r/32))}function M(r){var e=r||0,t=pl;typeof r=="object"&&(e=r.initialLength||r.initialCapacity||0,t=r.policy||t),this.size=0,this.length=e,this.capacity=Math.ceil(this.length/32)*32,this.policy=t,this.array=fl(this.capacity)}M.prototype.set=function(r,e){if(this.length<r)throw new Error("BitVector.set: index out of bounds.");var t=r>>5,i=r&31,n=this.array[t],o;return e===0||e===!1?o=this.array[t]&=~(1<<i):o=this.array[t]|=1<<i,o=o>>>0,o>n?this.size++:o<n&&this.size--,this};M.prototype.reset=function(r){var e=r>>5,t=r&31,i=this.array[e],n;return n=this.array[e]&=~(1<<t),n<i&&this.size--,this};M.prototype.flip=function(r){var e=r>>5,t=r&31,i=this.array[e],n=this.array[e]^=1<<t;return n=n>>>0,n>i?this.size++:n<i&&this.size--,this};M.prototype.applyPolicy=function(r){var e=this.policy(r||this.capacity);if(typeof e!="number"||e<0)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(e<=this.capacity)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned a less or equal capacity to allocate.");return Math.ceil(e/32)*32};M.prototype.reallocate=function(r){var e=r;if(r=Math.ceil(r/32)*32,e<this.length&&(this.length=e),r===this.capacity)return this;var t=this.array,i=r/32;return i===this.array.length?this:(i>this.array.length?(this.array=new Uint32Array(i),this.array.set(t,0)):this.array=t.slice(0,i),this.capacity=r,this)};M.prototype.grow=function(r){var e;if(typeof r=="number"){if(this.capacity>=r)return this;for(e=this.capacity;e<r;)e=this.applyPolicy(e);return this.reallocate(e),this}return e=this.applyPolicy(),this.reallocate(e),this};M.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};M.prototype.push=function(r){if(this.capacity===this.length&&this.grow(),r===0||r===!1)return++this.length;this.size++;var e=this.length++,t=e>>5,i=e&31;return this.array[t]|=1<<i,this.length};M.prototype.pop=function(){if(this.length!==0){var r=--this.length,e=r>>5,t=r&31;return this.array[e]>>t&1}};M.prototype.get=function(r){if(!(this.length<r)){var e=r>>5,t=r&31;return this.array[e]>>t&1}};M.prototype.test=function(r){return this.length<r?!1:!!this.get(r)};M.prototype.rank=function(r){if(this.size===0)return 0;for(var e=r>>5,t=r&31,i=0,n=0;n<e;n++)i+=ra.table8Popcount(this.array[n]);var o=this.array[e]&(1<<t)-1;return i+=ra.table8Popcount(o),i};M.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var e,t=32,i=0,n=0,o=0,s=this.array.length;o<s;o++)if(e=this.array[o],e!==0){o===s-1&&(t=this.length%32||32);for(var a=0;a<t;a++,i++)if(n+=e>>a&1,n===r)return i}};M.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=this.length,i,n,o=32,s=0,a=this.array.length;s<a;s++){i=this.array[s],s===a-1&&(o=t%32||32);for(var h=0;h<o;h++)n=i>>h&1,r.call(e,n,s*32+h)}};M.prototype.values=function(){var r=this.length,e=!1,t,i,n=this.array,o=n.length,s=0,a=-1,h=32;return new ia(function u(){if(!e){if(s>=o)return{done:!0};s===o-1&&(h=r%32||32),t=n[s++],e=!0,a=-1}return a++,a>=h?(e=!1,u()):(i=t>>a&1,{value:i})})};M.prototype.entries=function(){var r=this.length,e=!1,t,i,n=this.array,o,s=n.length,a=0,h=-1,u=32;return new ia(function l(){if(!e){if(a>=s)return{done:!0};a===s-1&&(u=r%32||32),t=n[a++],e=!0,h=-1}return h++,o=~-a*32+h,h>=u?(e=!1,l()):(i=t>>h&1,{value:[o,i]})})};typeof Symbol!="undefined"&&(M.prototype[Symbol.iterator]=M.prototype.values);M.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(e,t){r[t]=e}),Object.defineProperty(r,"constructor",{value:M,enumerable:!1}),r};typeof Symbol!="undefined"&&(M.prototype[Symbol.for("nodejs.util.inspect.custom")]=M.prototype.inspect);M.prototype.toJSON=function(){return Array.from(this.array.slice(0,(this.length>>5)+1))};na.exports=M});var aa=v((uy,sa)=>{function Tt(r,e){return(r&65535)*e+(((r>>>16)*e&65535)<<16)&4294967295}function ml(r,e){return(r&65535)+(e>>>16)+(((r>>>16)+e&65535)<<16)&4294967295}function Fn(r,e){return r<<e|r>>>32-e}sa.exports=function(e,t){var i=3432918353,n=461845907,o=15,s=13,a=5,h=1801774676,u=e,l,c,p;for(c=0,p=t.length-4;c<=p;c+=4)l=t[c]|t[c+1]<<8|t[c+2]<<16|t[c+3]<<24,l=Tt(l,i),l=Fn(l,o),l=Tt(l,n),u^=l,u=Fn(u,s),u=Tt(u,a),u=ml(u,h);switch(l=0,t.length&3){case 3:l^=t[c+2]<<16;case 2:l^=t[c+1]<<8;case 1:l^=t[c],l=Tt(l,i),l=Fn(l,o),l=Tt(l,n),u^=l;default:}return u^=t.length,u^=u>>>16,u=Tt(u,2246822507),u^=u>>>13,u=Tt(u,3266489909),u^=u>>>16,u>>>0}});var ca=v((ly,la)=>{var dl=aa(),gl=D(),yl=Math.LN2*Math.LN2,vl={errorRate:.005};function ha(r){var e=new Uint16Array(r.length),t,i;for(t=0,i=r.length;t<i;t++)e[t]=r.charCodeAt(t);return e}function ua(r,e,t){var i=dl(e*4221880213&4294967295,t);return i%(r*8)}function wt(r){var e={};if(!r)throw new Error("mnemonist/BloomFilter.constructor: a BloomFilter must be created with a capacity.");if(typeof r=="object"?e=r:e.capacity=r,typeof e.capacity!="number"||e.capacity<=0)throw new Error("mnemonist/BloomFilter.constructor: `capacity` option should be a positive integer.");if(this.capacity=e.capacity,this.errorRate=e.errorRate||vl.errorRate,typeof this.errorRate!="number"||e.errorRate<=0)throw new Error("mnemonist/BloomFilter.constructor: `errorRate` option should be a positive float.");this.clear()}wt.prototype.clear=function(){var r=-1/yl*this.capacity*Math.log(this.errorRate),e=r/8|0;this.hashFunctions=e*8/this.capacity*Math.LN2|0,this.data=new Uint8Array(e)};wt.prototype.add=function(r){for(var e=ha(r),t=0,i=this.hashFunctions;t<i;t++){var n=ua(this.data.length,t,e),o=1<<(7&n);this.data[n>>3]|=o}return this};wt.prototype.test=function(r){for(var e=ha(r),t=0,i=this.hashFunctions;t<i;t++){var n=ua(this.data.length,t,e);if(!(this.data[n>>3]&1<<(7&n)))return!1}return!0};wt.prototype.toJSON=function(){return this.data};wt.from=function(r,e){if(!e&&(e=r.length||r.size,typeof e!="number"))throw new Error("BloomFilter.from: could not infer the filter's capacity. Try passing it as second argument.");var t=new wt(e);return gl(r,function(i){t.add(i)}),t};la.exports=wt});var fa=v((cy,pa)=>{var bl=D();function Oe(r){if(typeof r!="function")throw new Error("mnemonist/BKTree.constructor: given `distance` should be a function.");this.distance=r,this.clear()}Oe.prototype.add=function(r){if(!this.root)return this.root={item:r,children:{}},this.size++,this;for(var e=this.root,t;t=this.distance(r,e.item),!!e.children[t];)e=e.children[t];return e.children[t]={item:r,children:{}},this.size++,this};Oe.prototype.search=function(r,e){if(!this.root)return[];for(var t=[],i=[this.root],n,o,s,a,h;i.length;)for(n=i.pop(),s=this.distance(e,n.item),s<=r&&t.push({item:n.item,distance:s}),a=s-r,h=s+r+1;a<h;a++)o=n.children[a],o&&i.push(o);return t};Oe.prototype.clear=function(){this.size=0,this.root=null};Oe.prototype.toJSON=function(){return this.root};Oe.prototype.inspect=function(){for(var r=[],e=[this.root],t,i;e.length;)if(t=e.pop(),!!t){r.push(t.item);for(i in t.children)e.push(t.children[i])}return Object.defineProperty(r,"constructor",{value:Oe,enumerable:!1}),r};typeof Symbol!="undefined"&&(Oe.prototype[Symbol.for("nodejs.util.inspect.custom")]=Oe.prototype.inspect);Oe.from=function(r,e){var t=new Oe(e);return bl(r,function(i){t.add(i)}),t};pa.exports=Oe});var _n=v((py,da)=>{var Rn=ge(),ma=K();function z(r,e){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof e!="number"||e<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=e,this.items=new r(this.capacity),this.clear()}z.prototype.clear=function(){this.start=0,this.size=0};z.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var e=(this.start+this.size)%this.capacity;return this.items[e]=r,++this.size};z.prototype.unshift=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var e=this.start-1;return this.start===0&&(e=this.capacity-1),this.items[e]=r,this.start=e,++this.size};z.prototype.pop=function(){if(this.size===0)return;let r=(this.start+this.size-1)%this.capacity;return this.size--,this.items[r]};z.prototype.shift=function(){if(this.size!==0){var r=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[r]}};z.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};z.prototype.peekLast=function(){if(this.size!==0){var r=this.start+this.size-1;return r>this.capacity&&(r-=this.capacity),this.items[r]}};z.prototype.get=function(r){if(this.size!==0)return r=this.start+r,r>this.capacity&&(r-=this.capacity),this.items[r]};z.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=this.capacity,i=this.size,n=this.start,o=0;o<i;)r.call(e,this.items[n],o,this),n++,o++,n===t&&(n=0)};z.prototype.toArray=function(){var r=this.start+this.size;if(r<this.capacity)return this.items.slice(this.start,r);for(var e=new this.ArrayClass(this.size),t=this.capacity,i=this.size,n=this.start,o=0;o<i;)e[o]=this.items[n],n++,o++,n===t&&(n=0);return e};z.prototype.values=function(){var r=this.items,e=this.capacity,t=this.size,i=this.start,n=0;return new ma(function(){if(n>=t)return{done:!0};var o=r[i];return i++,n++,i===e&&(i=0),{value:o,done:!1}})};z.prototype.entries=function(){var r=this.items,e=this.capacity,t=this.size,i=this.start,n=0;return new ma(function(){if(n>=t)return{done:!0};var o=r[i];return i++,i===e&&(i=0),{value:[n++,o],done:!1}})};typeof Symbol!="undefined"&&(z.prototype[Symbol.iterator]=z.prototype.values);z.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:z,enumerable:!1}),r};typeof Symbol!="undefined"&&(z.prototype[Symbol.for("nodejs.util.inspect.custom")]=z.prototype.inspect);z.from=function(r,e,t){if(arguments.length<3&&(t=Rn.guessLength(r),typeof t!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new z(e,t);if(Rn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return Rn.forEach(r,function(s){i.push(s)}),i};da.exports=z});var va=v((fy,ya)=>{var zn=ge(),Vn=_n();function Rt(r,e){if(arguments.length<2)throw new Error("mnemonist/circular-buffer: expecting an Array class and a capacity.");if(typeof e!="number"||e<=0)throw new Error("mnemonist/circular-buffer: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=e,this.items=new r(this.capacity),this.clear()}function ga(r){Rt.prototype[r]=Vn.prototype[r]}Object.keys(Vn.prototype).forEach(ga);typeof Symbol!="undefined"&&Object.getOwnPropertySymbols(Vn.prototype).forEach(ga);Rt.prototype.push=function(r){var e=(this.start+this.size)%this.capacity;return this.items[e]=r,this.size===this.capacity?(this.start=(e+1)%this.capacity,this.size):++this.size};Rt.prototype.unshift=function(r){var e=this.start-1;return this.start===0&&(e=this.capacity-1),this.items[e]=r,this.size===this.capacity?(this.start=e,this.size):(this.start=e,++this.size)};Rt.from=function(r,e,t){if(arguments.length<3&&(t=zn.guessLength(r),typeof t!="number"))throw new Error("mnemonist/circular-buffer.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new Rt(e,t);if(zn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return zn.forEach(r,function(s){i.push(s)}),i};ya.exports=Rt});var Pa=v((my,ba)=>{function ee(r){if(typeof r!="function")throw new Error("mnemonist/DefaultMap.constructor: expecting a function.");this.items=new Map,this.factory=r,this.size=0}ee.prototype.clear=function(){this.items.clear(),this.size=0};ee.prototype.get=function(r){var e=this.items.get(r);return typeof e=="undefined"&&(e=this.factory(r,this.size),this.items.set(r,e),this.size++),e};ee.prototype.peek=function(r){return this.items.get(r)};ee.prototype.set=function(r,e){return this.items.set(r,e),this.size=this.items.size,this};ee.prototype.has=function(r){return this.items.has(r)};ee.prototype.delete=function(r){var e=this.items.delete(r);return this.size=this.items.size,e};ee.prototype.forEach=function(r,e){e=arguments.length>1?e:this,this.items.forEach(r,e)};ee.prototype.entries=function(){return this.items.entries()};ee.prototype.keys=function(){return this.items.keys()};ee.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(ee.prototype[Symbol.iterator]=ee.prototype.entries);ee.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(ee.prototype[Symbol.for("nodejs.util.inspect.custom")]=ee.prototype.inspect);ee.autoIncrement=function(){var r=0;return function(){return r++}};ba.exports=ee});var wa=v((dy,Ta)=>{function Ue(r){if(typeof r!="function")throw new Error("mnemonist/DefaultWeakMap.constructor: expecting a function.");this.items=new WeakMap,this.factory=r}Ue.prototype.clear=function(){this.items=new WeakMap};Ue.prototype.get=function(r){var e=this.items.get(r);return typeof e=="undefined"&&(e=this.factory(r),this.items.set(r,e)),e};Ue.prototype.peek=function(r){return this.items.get(r)};Ue.prototype.set=function(r,e){return this.items.set(r,e),this};Ue.prototype.has=function(r){return this.items.has(r)};Ue.prototype.delete=function(r){return this.items.delete(r)};Ue.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(Ue.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ue.prototype.inspect);Ta.exports=Ue});var Sa=v((gy,xa)=>{var Nn=le();function He(r){var e=Nn.getPointerArray(r),t=Nn.getPointerArray(Math.log2(r));this.size=r,this.dimension=r,this.parents=new e(r),this.ranks=new t(r);for(var i=0;i<r;i++)this.parents[i]=i}He.prototype.find=function(r){for(var e=r,t,i;t=this.parents[e],e!==t;)e=t;for(;i=this.parents[r],i!==e;)this.parents[r]=e,r=i;return e};He.prototype.union=function(r,e){var t=this.find(r),i=this.find(e);if(t===i)return this;this.dimension--;var n=this.ranks[r],o=this.ranks[e];return n<o?this.parents[t]=i:n>o?this.parents[i]=t:(this.parents[i]=t,this.ranks[t]++),this};He.prototype.connected=function(r,e){var t=this.find(r);return t===this.find(e)};He.prototype.mapping=function(){for(var r=Nn.getPointerArray(this.dimension),e={},t=new r(this.size),i=0,n,o=0,s=this.parents.length;o<s;o++)n=this.find(o),typeof e[n]=="undefined"?(t[o]=i,e[n]=i++):t[o]=e[n];return t};He.prototype.compile=function(){for(var r={},e=new Array(this.dimension),t=0,i,n=0,o=this.parents.length;n<o;n++)i=this.find(n),typeof r[i]=="undefined"?(e[t]=[n],r[i]=t++):e[r[i]].push(n);return e};He.prototype.inspect=function(){var r=this.compile();return Object.defineProperty(r,"constructor",{value:He,enumerable:!1}),r};typeof Symbol!="undefined"&&(He.prototype[Symbol.for("nodejs.util.inspect.custom")]=He.prototype.inspect);xa.exports=He});var fi=v((yy,Ea)=>{var Ca=nr(),Un=pi(),Pl=Ca.DEFAULT_COMPARATOR,Tl=Ca.reverseComparator;function wl(r,e,t,i){for(var n=t,o=i,s=e[i],a=2*i+1,h;a<n;)h=a+1,h<n&&r(e[a],e[h])>=0&&(a=h),e[i]=e[a],i=a,a=2*i+1;e[i]=s,Un.siftDown(r,e,o,i)}function La(r,e,t,i){for(var n=i,o=n,s=new r(i),a,h;o>0;)a=t[--o],o!==0&&(h=t[0],t[0]=a,wl(e,t,--i,0),a=h),s[o]=a;return s}function Ge(r,e,t){if(arguments.length===2&&(t=e,e=null),this.ArrayClass=r,this.capacity=t,this.items=new r(t),this.clear(),this.comparator=e||Pl,typeof t!="number"&&t<=0)throw new Error("mnemonist/FixedReverseHeap.constructor: capacity should be a number > 0.");if(typeof this.comparator!="function")throw new Error("mnemonist/FixedReverseHeap.constructor: given comparator should be a function.");this.comparator=Tl(this.comparator)}Ge.prototype.clear=function(){this.size=0};Ge.prototype.push=function(r){return this.size<this.capacity?(this.items[this.size]=r,Un.siftDown(this.comparator,this.items,0,this.size),this.size++):this.comparator(r,this.items[0])>0&&Un.replace(this.comparator,this.items,r),this.size};Ge.prototype.peek=function(){return this.items[0]};Ge.prototype.consume=function(){var r=La(this.ArrayClass,this.comparator,this.items,this.size);return this.size=0,r};Ge.prototype.toArray=function(){return La(this.ArrayClass,this.comparator,this.items.slice(0,this.size),this.size)};Ge.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:Ge,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ge.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ge.prototype.inspect);Ea.exports=Ge});var Da=v((vy,Aa)=>{var xl=D(),Oa=function(r){return r};function oe(r){if(this.items=new Map,this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=Oa),this.readHashFunction||(this.readHashFunction=Oa),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.")}oe.prototype.clear=function(){this.items.clear(),this.size=0};oe.prototype.add=function(r){var e=this.writeHashFunction(r);return this.items.set(e,r),this.size=this.items.size,this};oe.prototype.set=function(r,e){return r=this.writeHashFunction(r),this.items.set(r,e),this.size=this.items.size,this};oe.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};oe.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};oe.prototype.forEach=function(r,e){e=arguments.length>1?e:this,this.items.forEach(function(t){r.call(e,t,t)})};oe.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(oe.prototype[Symbol.iterator]=oe.prototype.values);oe.prototype.inspect=function(){var r=Array.from(this.items.values());return Object.defineProperty(r,"constructor",{value:oe,enumerable:!1}),r};typeof Symbol!="undefined"&&(oe.prototype[Symbol.for("nodejs.util.inspect.custom")]=oe.prototype.inspect);oe.from=function(r,e,t){var i=new oe(e);return xl(r,function(n,o){t?i.set(o,n):i.add(n)}),i};Aa.exports=oe});var Hn=v((by,Ma)=>{var mi=K(),Sl=D();function A(r){this.Container=r||Array,this.items=new Map,this.clear(),Object.defineProperty(this.items,"constructor",{value:A,enumerable:!1})}A.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};A.prototype.set=function(r,e){var t=this.items.get(r),i;return t||(this.dimension++,t=new this.Container,this.items.set(r,t)),this.Container===Set?(i=t.size,t.add(e),i<t.size&&this.size++):(t.push(e),this.size++),this};A.prototype.delete=function(r){var e=this.items.get(r);return e?(this.size-=this.Container===Set?e.size:e.length,this.dimension--,this.items.delete(r),!0):!1};A.prototype.remove=function(r,e){var t=this.items.get(r),i,n;return t?this.Container===Set?(i=t.delete(e),i&&this.size--,t.size===0&&(this.items.delete(r),this.dimension--),i):(n=t.indexOf(e),n===-1?!1:(this.size--,t.length===1?(this.items.delete(r),this.dimension--,!0):(t.splice(n,1),!0))):!1};A.prototype.has=function(r){return this.items.has(r)};A.prototype.get=function(r){return this.items.get(r)};A.prototype.multiplicity=function(r){var e=this.items.get(r);return typeof e=="undefined"?0:this.Container===Set?e.size:e.length};A.prototype.count=A.prototype.multiplicity;A.prototype.forEach=function(r,e){e=arguments.length>1?e:this;var t;function i(n){r.call(e,n,t)}this.items.forEach(function(n,o){t=o,n.forEach(i)})};A.prototype.forEachAssociation=function(r,e){e=arguments.length>1?e:this,this.items.forEach(r,e)};A.prototype.keys=function(){return this.items.keys()};A.prototype.values=function(){var r=this.items.values(),e=!1,t,i,n,o;return this.Container===Set?new mi(function s(){if(!e){if(i=r.next(),i.done)return{done:!0};e=!0,t=i.value.values()}return i=t.next(),i.done?(e=!1,s()):{done:!1,value:i.value}}):new mi(function s(){if(!e){if(i=r.next(),i.done)return{done:!0};e=!0,t=i.value,n=0,o=t.length}return n>=o?(e=!1,s()):{done:!1,value:t[n++]}})};A.prototype.entries=function(){var r=this.items.entries(),e=!1,t,i,n,o,s;return this.Container===Set?new mi(function a(){if(!e){if(i=r.next(),i.done)return{done:!0};e=!0,n=i.value[0],t=i.value[1].values()}return i=t.next(),i.done?(e=!1,a()):{done:!1,value:[n,i.value]}}):new mi(function a(){if(!e){if(i=r.next(),i.done)return{done:!0};e=!0,n=i.value[0],t=i.value[1],o=0,s=t.length}return o>=s?(e=!1,a()):{done:!1,value:[n,t[o++]]}})};A.prototype.containers=function(){return this.items.values()};A.prototype.associations=function(){return this.items.entries()};typeof Symbol!="undefined"&&(A.prototype[Symbol.iterator]=A.prototype.entries);A.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(A.prototype[Symbol.for("nodejs.util.inspect.custom")]=A.prototype.inspect);A.prototype.toJSON=function(){return this.items};A.from=function(r,e){var t=new A(e);return Sl(r,function(i,n){t.set(n,i)}),t};Ma.exports=A});var Fa=v((Py,ka)=>{var Cl=Hn(),Ll=D(),Ia=function(r){return r};function se(r,e){if(this.items=new Cl(e),this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=Ia),this.readHashFunction||(this.readHashFunction=Ia),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.")}se.prototype.clear=function(){this.items.clear(),this.size=0,this.dimension=0};se.prototype.add=function(r){var e=this.writeHashFunction(r);return this.items.set(e,r),this.size=this.items.size,this.dimension=this.items.dimension,this};se.prototype.set=function(r,e){return r=this.writeHashFunction(r),this.items.set(r,e),this.size=this.items.size,this.dimension=this.items.dimension,this};se.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};se.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};se.prototype.forEach=function(r,e){e=arguments.length>1?e:this,this.items.forEach(function(t){r.call(e,t,t)})};se.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(se.prototype[Symbol.iterator]=se.prototype.values);se.prototype.inspect=function(){var r=Array.from(this);return Object.defineProperty(r,"constructor",{value:se,enumerable:!1}),r};typeof Symbol!="undefined"&&(se.prototype[Symbol.for("nodejs.util.inspect.custom")]=se.prototype.inspect);se.from=function(r,e,t,i){arguments.length===3&&typeof t=="boolean"&&(i=t,t=Array);var n=new se(e,t);return Ll(r,function(o,s){i?n.set(s,o):n.add(o)}),n};ka.exports=se});var za=v((Ty,_a)=>{var Ra=1024;function El(r){return(r&r-1)===0}function Ae(r,e){if(arguments.length<1)throw new Error("mnemonist/hashed-array-tree: expecting at least a byte array constructor.");var t=e||0,i=Ra,n=0;if(typeof e=="object"&&(t=e.initialCapacity||0,n=e.initialLength||0,i=e.blockSize||Ra),!i||!El(i))throw new Error("mnemonist/hashed-array-tree: block size should be a power of two.");var o=Math.max(n,t),s=Math.ceil(o/i);this.ArrayClass=r,this.length=n,this.capacity=s*i,this.blockSize=i,this.offsetMask=i-1,this.blockMask=Math.log2(i),this.blocks=new Array(s);for(var a=0;a<s;a++)this.blocks[a]=new this.ArrayClass(this.blockSize)}Ae.prototype.set=function(r,e){if(this.length<r)throw new Error("HashedArrayTree("+this.ArrayClass.name+").set: index out of bounds.");var t=r>>this.blockMask,i=r&this.offsetMask;return this.blocks[t][i]=e,this};Ae.prototype.get=function(r){if(!(this.length<r)){var e=r>>this.blockMask,t=r&this.offsetMask;return this.blocks[e][t]}};Ae.prototype.grow=function(r){if(typeof r!="number"&&(r=this.capacity+this.blockSize),this.capacity>=r)return this;for(;this.capacity<r;)this.blocks.push(new this.ArrayClass(this.blockSize)),this.capacity+=this.blockSize;return this};Ae.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.grow(r),this)};Ae.prototype.push=function(r){this.capacity===this.length&&this.grow();var e=this.length,t=e>>this.blockMask,i=e&this.offsetMask;return this.blocks[t][i]=r,++this.length};Ae.prototype.pop=function(){if(this.length!==0){var r=this.blocks[this.blocks.length-1],e=--this.length&this.offsetMask;return r[e]}};Ae.prototype.inspect=function(){for(var r=new this.ArrayClass(this.length),e,t=0,i=this.length;t<i;t++)e=t>>this.blockMask,r[t]=this.blocks[e][t&this.offsetMask];return r.type=this.ArrayClass.name,r.items=this.length,r.capacity=this.capacity,r.blockSize=this.blockSize,Object.defineProperty(r,"constructor",{value:Ae,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ae.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ae.prototype.inspect);_a.exports=Ae});var Bn=v((wy,Na)=>{var Va=K(),Gn=ge();function W(r,e){if(arguments.length<2)throw new Error("mnemonist/fixed-stack: expecting an Array class and a capacity.");if(typeof e!="number"||e<=0)throw new Error("mnemonist/fixed-stack: `capacity` should be a positive number.");this.capacity=e,this.ArrayClass=r,this.items=new this.ArrayClass(this.capacity),this.clear()}W.prototype.clear=function(){this.size=0};W.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-stack.push: stack capacity ("+this.capacity+") exceeded!");return this.items[this.size++]=r,this.size};W.prototype.pop=function(){if(this.size!==0)return this.items[--this.size]};W.prototype.peek=function(){return this.items[this.size-1]};W.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,i=this.items.length;t<i;t++)r.call(e,this.items[i-t-1],t,this)};W.prototype.toArray=function(){for(var r=new this.ArrayClass(this.size),e=this.size-1,t=this.size;t--;)r[t]=this.items[e-t];return r};W.prototype.values=function(){var r=this.items,e=this.size,t=0;return new Va(function(){if(t>=e)return{done:!0};var i=r[e-t-1];return t++,{value:i,done:!1}})};W.prototype.entries=function(){var r=this.items,e=this.size,t=0;return new Va(function(){if(t>=e)return{done:!0};var i=r[e-t-1];return{value:[t++,i],done:!1}})};typeof Symbol!="undefined"&&(W.prototype[Symbol.iterator]=W.prototype.values);W.prototype.toString=function(){return this.toArray().join(",")};W.prototype.toJSON=function(){return this.toArray()};W.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:W,enumerable:!1}),r};typeof Symbol!="undefined"&&(W.prototype[Symbol.for("nodejs.util.inspect.custom")]=W.prototype.inspect);W.from=function(r,e,t){if(arguments.length<3&&(t=Gn.guessLength(r),typeof t!="number"))throw new Error("mnemonist/fixed-stack.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new W(e,t);if(Gn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return Gn.forEach(r,function(s){i.push(s)}),i};Na.exports=W});var Ha=v((xy,Ua)=>{var Ol=ge(),Al=le(),Dl=Bn();function qn(r,e,t,i,n,o,s,a){var h=s+(a-s)/2|0,u=~-h,l=-~h,c=t[h];i[o]=c+1;var p=e?e(r[c]):r[c][1],f=o*2+1,d=o*2+2,y=-1/0,P=-1/0;s<=u&&(y=qn(r,e,t,i,n,f,s,u)),l<=a&&(P=qn(r,e,t,i,n,d,l,a));var x=Math.max(p,y,P),T=c;return x===y?T=n[i[f]-1]:x===P&&(T=n[i[d]-1]),n[c]=T,x}function Be(r,e){this.size=r.length,this.intervals=r;var t=null,i=null;Array.isArray(e)&&(t=e[0],i=e[1]);var n=r.length,o=Al.getPointerArray(n+1),s=new o(n),a;for(a=1;a<n;a++)s[a]=a;s.sort(function(p,f){return p=r[p],f=r[f],t?(p=t(p),f=t(f)):(p=p[0],f=f[0]),p<f?-1:p>f?1:0});var h=Math.ceil(Math.log2(n+1)),u=Math.pow(2,h)-1,l=new o(u),c=new o(n);qn(r,i,s,l,c,0,0,n-1),s=null,this.height=h,this.tree=l,this.augmentations=c,this.startGetter=t,this.endGetter=i,this.stack=new Dl(o,this.height)}Be.prototype.intervalsContainingPoint=function(r){var e=[],t=this.stack;t.clear(),t.push(0);for(var i=this.tree.length,n,o,s,a,h,u,l,c,p;t.size;)n=t.pop(),o=this.tree[n]-1,s=this.intervals[o],a=this.intervals[this.augmentations[o]],l=this.endGetter?this.endGetter(a):a[1],!(r>l)&&(c=n*2+1,c<i&&this.tree[c]!==0&&t.push(c),h=this.startGetter?this.startGetter(s):s[0],u=this.endGetter?this.endGetter(s):s[1],r>=h&&r<=u&&e.push(s),!(r<h)&&(p=n*2+2,p<i&&this.tree[p]!==0&&t.push(p)));return e};Be.prototype.intervalsOverlappingInterval=function(r){var e=this.startGetter?this.startGetter(r):r[0],t=this.endGetter?this.endGetter(r):r[1],i=[],n=this.stack;n.clear(),n.push(0);for(var o=this.tree.length,s,a,h,u,l,c,p,f,d;n.size;)s=n.pop(),a=this.tree[s]-1,h=this.intervals[a],u=this.intervals[this.augmentations[a]],p=this.endGetter?this.endGetter(u):u[1],!(e>p)&&(f=s*2+1,f<o&&this.tree[f]!==0&&n.push(f),l=this.startGetter?this.startGetter(h):h[0],c=this.endGetter?this.endGetter(h):h[1],t>=l&&e<=c&&i.push(h),!(t<l)&&(d=s*2+2,d<o&&this.tree[d]!==0&&n.push(d)));return i};Be.prototype.inspect=function(){var r=this.intervals.slice();return Object.defineProperty(r,"constructor",{value:Be,enumerable:!1}),r};typeof Symbol!="undefined"&&(Be.prototype[Symbol.for("nodejs.util.inspect.custom")]=Be.prototype.inspect);Be.from=function(r,e){return Ol.isArrayLike(r)?new Be(r,e):new Be(Array.from(r),e)};Ua.exports=Be});var Wn=v(at=>{at.search=function(r,e,t,i){var n=0;t=typeof t!="undefined"?t:0,i=typeof i!="undefined"?i:r.length,i--;for(var o;t<=i;)if(n=t+i>>>1,o=r[n],o>e)i=~-n;else if(o<e)t=-~n;else return n;return-1};at.searchWithComparator=function(r,e,t){for(var i=0,n=0,o=~-e.length,s;n<=o;)if(i=n+o>>>1,s=r(e[i],t),s>0)o=~-i;else if(s<0)n=-~i;else return i;return-1};at.lowerBound=function(r,e,t,i){var n=0;for(t=typeof t!="undefined"?t:0,i=typeof i!="undefined"?i:r.length;t<i;)n=t+i>>>1,e<=r[n]?i=n:t=-~n;return t};at.lowerBoundWithComparator=function(r,e,t){for(var i=0,n=0,o=e.length;n<o;)i=n+o>>>1,r(t,e[i])<=0?o=i:n=-~i;return n};at.lowerBoundIndices=function(r,e,t,i,n){var o=0;for(i=typeof i!="undefined"?i:0,n=typeof n!="undefined"?n:r.length;i<n;)o=i+n>>>1,t<=r[e[o]]?n=o:i=-~o;return i};at.upperBound=function(r,e,t,i){var n=0;for(t=typeof t!="undefined"?t:0,i=typeof i!="undefined"?i:r.length;t<i;)n=t+i>>>1,e>=r[n]?t=-~n:i=n;return t};at.upperBoundWithComparator=function(r,e,t){for(var i=0,n=0,o=e.length;n<o;)i=n+o>>>1,r(t,e[i])>=0?n=-~i:o=i;return n}});var Wa=v(ht=>{var _t=le(),zt=ge().isArrayLike,xt=Wn(),Ga=ii();function Ba(r,e){if(r.length===0)return e.slice();if(e.length===0)return r.slice();var t;r[0]>e[0]&&(t=r,r=e,e=t);var i=r[r.length-1],n=e[0];if(i<=n)return _t.isTypedArray(r)?_t.concat(r,e):r.concat(e);var o=new r.constructor(r.length+e.length),s,a,h;for(s=0,a=r.length;s<a&&(h=r[s],h<=n);s++)o[s]=h;for(var u=s,l=r.length,c=0,p=e.length,f,d;u<l&&c<p;)f=r[u],d=e[c],f<=d?(o[s++]=f,u++):(o[s++]=d,c++);for(;u<l;)o[s++]=r[u++];for(;c<p;)o[s++]=e[c++];return o}function qa(r,e){if(r.length===0)return e.slice();if(e.length===0)return r.slice();var t;r[0]>e[0]&&(t=r,r=e,e=t);var i=r[r.length-1],n=e[0];if(i<n)return _t.isTypedArray(r)?_t.concat(r,e):r.concat(e);var o=new r.constructor,s,a,h;for(s=0,a=r.length;s<a&&(h=r[s],h<n);s++)o.push(h);for(var u=s,l=r.length,c=0,p=e.length,f,d;u<l&&c<p;)f=r[u],d=e[c],f<=d?((o.length===0||o[o.length-1]!==f)&&o.push(f),u++):((o.length===0||o[o.length-1]!==d)&&o.push(d),c++);for(;u<l;)f=r[u++],(o.length===0||o[o.length-1]!==f)&&o.push(f);for(;c<p;)d=e[c++],(o.length===0||o[o.length-1]!==d)&&o.push(d);return o}ht.intersectionUniqueArrays=function(r,e){if(r.length===0||e.length===0)return new r.constructor(0);var t;r[0]>e[0]&&(t=r,r=e,e=t);var i=r[r.length-1],n=e[0];if(i<n)return new r.constructor(0);for(var o=new r.constructor,s=xt.lowerBound(r,n),a=r.length,h=0,u=xt.upperBound(e,i),l,c;s<a&&h<u;)l=r[s],c=e[h],l<c?s=xt.lowerBound(r,c,s+1):l>c?h=xt.lowerBound(e,l,h+1):(o.push(l),s++,h++);return o};function Ml(r){var e=0,t=-1/0,i,n,o,s=[];for(n=0,o=r.length;n<o;n++)i=r[n].length,i!==0&&(s.push(r[n]),e+=i,i>t&&(t=i));if(s.length===0)return new r[0].constructor(0);if(s.length===1)return s[0].slice();if(s.length===2)return Ba(s[0],s[1]);r=s;var a=new r[0].constructor(e),h=_t.getPointerArray(t),u=new h(r.length),l=new Ga(function(f,d){return f=r[f][u[f]],d=r[d][u[d]],f<d?-1:f>d?1:0});for(n=0;n<o;n++)l.push(n);n=0;for(var c,p;l.size;)c=l.pop(),p=r[c][u[c]++],a[n++]=p,u[c]<r[c].length&&l.push(c);return a}function Il(r){var e=-1/0,t,i,n,o=[];for(i=0,n=r.length;i<n;i++)t=r[i].length,t!==0&&(o.push(r[i]),t>e&&(e=t));if(o.length===0)return new r[0].constructor(0);if(o.length===1)return o[0].slice();if(o.length===2)return qa(o[0],o[1]);r=o;var s=new r[0].constructor,a=_t.getPointerArray(e),h=new a(r.length),u=new Ga(function(p,f){return p=r[p][h[p]],f=r[f][h[f]],p<f?-1:p>f?1:0});for(i=0;i<n;i++)u.push(i);for(var l,c;u.size;)l=u.pop(),c=r[l][h[l]++],(s.length===0||s[s.length-1]!==c)&&s.push(c),h[l]<r[l].length&&u.push(l);return s}ht.kWayIntersectionUniqueArrays=function(r){var e=-1/0,t=-1/0,i=1/0,n,o,s,a,h;for(a=0,h=r.length;a<h;a++){if(s=r[a].length,s===0)return[];s>e&&(e=s),n=r[a][0],o=r[a][s-1],n>t&&(t=n),o<i&&(i=o)}if(t>i)return[];if(t===i)return[t];var u,l,c=r[0],p,f,d,y,P,x,T=t;for(a=1;a<h;a++){for(u=c,l=r[a],c=new Array,p=0,f=xt.lowerBound(l,T),d=u.length,y=l.length;p<d&&f<y;)P=u[p],x=l[f],P<x?p=xt.lowerBound(u,x,p+1):P>x?f=xt.lowerBound(l,P,f+1):(c.push(P),p++,f++);if(c.length===0)return c;T=c[0]}return c};ht.merge=function(){if(arguments.length===2){if(zt(arguments[0]))return Ba(arguments[0],arguments[1])}else if(zt(arguments[0]))return Ml(arguments);return null};ht.unionUnique=function(){if(arguments.length===2){if(zt(arguments[0]))return qa(arguments[0],arguments[1])}else if(zt(arguments[0]))return Il(arguments);return null};ht.intersectionUnique=function(){if(arguments.length===2){if(zt(arguments[0]))return ht.intersectionUniqueArrays(arguments[0],arguments[1])}else if(zt(arguments[0]))return ht.kWayIntersectionUniqueArrays(arguments);return null}});var Qa=v((Ly,$a)=>{var kl=K(),Fl=D(),Rl=Wa();function ja(r){return r}function ce(r){if(this.clear(),Array.isArray(r)?(this.documentTokenizer=r[0],this.queryTokenizer=r[1]):(this.documentTokenizer=r,this.queryTokenizer=r),this.documentTokenizer||(this.documentTokenizer=ja),this.queryTokenizer||(this.queryTokenizer=ja),typeof this.documentTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: document tokenizer is not a function.");if(typeof this.queryTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: query tokenizer is not a function.")}ce.prototype.clear=function(){this.items=[],this.mapping=new Map,this.size=0,this.dimension=0};ce.prototype.add=function(r){this.size++;var e=this.items.length;this.items.push(r);var t=this.documentTokenizer(r);if(!Array.isArray(t))throw new Error("mnemonist/InvertedIndex.add: tokenizer function should return an array of tokens.");for(var i=new Set,n,o,s=0,a=t.length;s<a;s++)n=t[s],!i.has(n)&&(i.add(n),o=this.mapping.get(n),o||(o=[],this.mapping.set(n,o)),o.push(e));return this.dimension=this.mapping.size,this};ce.prototype.get=function(r){if(!this.size)return[];var e=this.queryTokenizer(r);if(!Array.isArray(e))throw new Error("mnemonist/InvertedIndex.query: tokenizer function should return an array of tokens.");if(!e.length)return[];var t=this.mapping.get(e[0]),i,n,o;if(typeof t=="undefined"||t.length===0)return[];if(e.length>1)for(n=1,o=e.length;n<o;n++){if(i=this.mapping.get(e[n]),typeof i=="undefined"||i.length===0)return[];t=Rl.intersectionUniqueArrays(t,i)}var s=new Array(t.length);for(n=0,o=s.length;n<o;n++)s[n]=this.items[t[n]];return s};ce.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,i=this.documents.length;t<i;t++)r.call(e,this.documents[t],t,this)};ce.prototype.documents=function(){var r=this.items,e=r.length,t=0;return new kl(function(){if(t>=e)return{done:!0};var i=r[t++];return{value:i,done:!1}})};ce.prototype.tokens=function(){return this.mapping.keys()};typeof Symbol!="undefined"&&(ce.prototype[Symbol.iterator]=ce.prototype.documents);ce.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:ce,enumerable:!1}),r};typeof Symbol!="undefined"&&(ce.prototype[Symbol.for("nodejs.util.inspect.custom")]=ce.prototype.inspect);ce.from=function(r,e){var t=new ce(e);return Fl(r,function(i){t.add(i)}),t};$a.exports=ce});var $n=v(jn=>{var Y=new Float64Array(64),F=new Float64Array(64);function _l(r,e,t){var i,n,o,s,a;for(Y[0]=e,F[0]=t,n=0;n>=0;)if(o=Y[n],s=F[n]-1,o<s){for(i=r[o];o<s;){for(;r[s]>=i&&o<s;)s--;for(o<s&&(r[o++]=r[s]);r[o]<=i&&o<s;)o++;o<s&&(r[s--]=r[o])}r[o]=i,Y[n+1]=o+1,F[n+1]=F[n],F[n++]=o,F[n]-Y[n]>F[n-1]-Y[n-1]&&(a=Y[n],Y[n]=Y[n-1],Y[n-1]=a,a=F[n],F[n]=F[n-1],F[n-1]=a)}else n--;return r}jn.inplaceQuickSort=_l;function zl(r,e,t,i){var n,o,s,a,h,u;for(Y[0]=t,F[0]=i,o=0;o>=0;)if(s=Y[o],a=F[o]-1,s<a){for(h=e[s],n=r[h];s<a;){for(;r[e[a]]>=n&&s<a;)a--;for(s<a&&(e[s++]=e[a]);r[e[s]]<=n&&s<a;)s++;s<a&&(e[a--]=e[s])}e[s]=h,Y[o+1]=s+1,F[o+1]=F[o],F[o++]=s,F[o]-Y[o]>F[o-1]-Y[o-1]&&(u=Y[o],Y[o]=Y[o-1],Y[o-1]=u,u=F[o],F[o]=F[o-1],F[o-1]=u)}else o--;return e}jn.inplaceQuickSortIndices=zl});var Za=v((Oy,Ja)=>{var Vl=ge(),di=le(),Ka=nr().createTupleComparator,Ya=fi(),Nl=$n().inplaceQuickSortIndices;function Qn(r,e,t,i){var n,o=0,s;for(n=0;n<r;n++)s=e[n][t]-i[n],o+=s*s;return o}function Ul(r,e){var t=e.length,i=new Array(r),n=new Array(t),o,s=di.getPointerArray(t),a=new s(t),h,u,l,c=!0;for(h=0;h<r;h++){for(o=new Float64Array(t),u=0;u<t;u++)l=e[u],o[u]=l[1][h],c&&(n[u]=l[0],a[u]=u);c=!1,i[h]=o}return{axes:i,ids:a,labels:n}}function Xa(r,e,t,i){for(var n=i.length,o=di.getPointerArray(n+1),s=new o(n),a=new o(n),h=new o(n),u=[[0,0,t.length,-1,0]],l,c,p,f,d,y,P,x,T=0;u.length!==0;)l=u.pop(),x=l[0],y=l[1],P=l[2],c=l[3],p=l[4],Nl(e[x],t,y,P),n=P-y,f=y+(n>>>1),d=t[f],s[T]=d,c>-1&&(p===0?a[c]=T+1:h[c]=T+1),x=(x+1)%r,f!==y&&f!==P-1&&u.push([x,f+1,P,T,1]),f!==y&&u.push([x,y,f,T,0]),T++;return{axes:e,labels:i,pivots:s,lefts:a,rights:h}}function we(r,e){this.dimensions=r,this.visited=0,this.axes=e.axes,this.labels=e.labels,this.pivots=e.pivots,this.lefts=e.lefts,this.rights=e.rights,this.size=this.labels.length}we.prototype.nearestNeighbor=function(r){var e=1/0,t=null,i=this.dimensions,n=this.axes,o=this.pivots,s=this.lefts,a=this.rights,h=0;function u(l,c){h++;var p=s[c],f=a[c],d=o[c],y=Qn(i,n,d,r);if(!(y<e&&(t=d,e=y,y===0))){var P=n[l][d]-r[l];l=(l+1)%i,P>0?p!==0&&u(l,p-1):f!==0&&u(l,f-1),P*P<e&&(P>0?f!==0&&u(l,f-1):p!==0&&u(l,p-1))}}return u(0,0),this.visited=h,this.labels[t]};var Hl=Ka(3),Gl=Ka(2);we.prototype.kNearestNeighbors=function(r,e){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");if(r=Math.min(r,this.size),r===1)return[this.nearestNeighbor(e)];var t=new Ya(Array,Hl,r),i=this.dimensions,n=this.axes,o=this.pivots,s=this.lefts,a=this.rights,h=0;function u(p,f){var d=s[f],y=a[f],P=o[f],x=Qn(i,n,P,e);t.push([x,h++,P]);var T=e[p],R=n[p][P],G=T-R;p=(p+1)%i,T<R?d!==0&&u(p,d-1):y!==0&&u(p,y-1),(G*G<t.peek()[0]||t.size<r)&&(T<R?y!==0&&u(p,y-1):d!==0&&u(p,d-1))}u(0,0),this.visited=h;for(var l=t.consume(),c=0;c<l.length;c++)l[c]=this.labels[l[c][2]];return l};we.prototype.linearKNearestNeighbors=function(r,e){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");r=Math.min(r,this.size);var t=new Ya(Array,Gl,r),i,n,o;for(i=0,n=this.size;i<n;i++)o=Qn(this.dimensions,this.axes,this.pivots[i],e),t.push([o,i]);var s=t.consume();for(i=0;i<s.length;i++)s[i]=this.labels[this.pivots[s[i][1]]];return s};we.prototype.inspect=function(){var r=new Map;r.dimensions=this.dimensions,Object.defineProperty(r,"constructor",{value:we,enumerable:!1});var e,t,i;for(e=0;e<this.size;e++){for(i=new Array(this.dimensions),t=0;t<this.dimensions;t++)i[t]=this.axes[t][e];r.set(this.labels[e],i)}return r};typeof Symbol!="undefined"&&(we.prototype[Symbol.for("nodejs.util.inspect.custom")]=we.prototype.inspect);we.from=function(r,e){var t=Vl.toArray(r),i=Ul(e,t),n=Xa(e,i.axes,i.ids,i.labels);return new we(e,n)};we.fromAxes=function(r,e){e||(e=di.indices(r[0].length));var t=r.length,i=Xa(r.length,r,di.indices(e.length),e);return new we(t,i)};Ja.exports=we});var rh=v((Ay,th)=>{var eh=K(),Bl=D();function I(){this.clear()}I.prototype.clear=function(){this.head=null,this.tail=null,this.size=0};I.prototype.first=function(){return this.head?this.head.item:void 0};I.prototype.peek=I.prototype.first;I.prototype.last=function(){return this.tail?this.tail.item:void 0};I.prototype.push=function(r){var e={item:r,next:null};return this.head?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),this.size++,this.size};I.prototype.unshift=function(r){var e={item:r,next:null};return this.head?(this.head.next||(this.tail=this.head),e.next=this.head,this.head=e):(this.head=e,this.tail=e),this.size++,this.size};I.prototype.shift=function(){if(this.size){var r=this.head;return this.head=r.next,this.size--,r.item}};I.prototype.forEach=function(r,e){if(this.size){e=arguments.length>1?e:this;for(var t=this.head,i=0;t;)r.call(e,t.item,i,this),t=t.next,i++}};I.prototype.toArray=function(){if(!this.size)return[];for(var r=new Array(this.size),e=0,t=this.size,i=this.head;e<t;e++)r[e]=i.item,i=i.next;return r};I.prototype.values=function(){var r=this.head;return new eh(function(){if(!r)return{done:!0};var e=r.item;return r=r.next,{value:e,done:!1}})};I.prototype.entries=function(){var r=this.head,e=0;return new eh(function(){if(!r)return{done:!0};var t=r.item;return r=r.next,e++,{value:[e-1,t],done:!1}})};typeof Symbol!="undefined"&&(I.prototype[Symbol.iterator]=I.prototype.values);I.prototype.toString=function(){return this.toArray().join(",")};I.prototype.toJSON=function(){return this.toArray()};I.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:I,enumerable:!1}),r};typeof Symbol!="undefined"&&(I.prototype[Symbol.for("nodejs.util.inspect.custom")]=I.prototype.inspect);I.from=function(r){var e=new I;return Bl(r,function(t){e.push(t)}),e};th.exports=I});var gi=v((Dy,ih)=>{var Kn=K(),ql=D(),Wl=le(),jl=ge();function H(r,e,t){if(arguments.length<2&&(t=r,r=null,e=null),this.capacity=t,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=Wl.getPointerArray(t);this.forward=new i(t),this.backward=new i(t),this.K=typeof r=="function"?new r(t):new Array(t),this.V=typeof e=="function"?new e(t):new Array(t),this.size=0,this.head=0,this.tail=0,this.items={}}H.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};H.prototype.splayOnTop=function(r){var e=this.head;if(this.head===r)return this;var t=this.backward[r],i=this.forward[r];return this.tail===r?this.tail=t:this.backward[i]=t,this.forward[t]=i,this.backward[e]=r,this.head=r,this.forward[r]=e,this};H.prototype.set=function(r,e){var t=this.items[r];if(typeof t!="undefined"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?t=this.size++:(t=this.tail,this.tail=this.backward[t],delete this.items[this.K[t]]),this.items[r]=t,this.K[t]=r,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};H.prototype.setpop=function(r,e){var t=null,i=null,n=this.items[r];return typeof n!="undefined"?(this.splayOnTop(n),t=this.V[n],this.V[n]=e,{evicted:!1,key:r,value:t}):(this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],t=this.V[n],i=this.K[n],delete this.items[this.K[n]]),this.items[r]=n,this.K[n]=r,this.V[n]=e,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:t}:null)};H.prototype.has=function(r){return r in this.items};H.prototype.get=function(r){var e=this.items[r];if(typeof e!="undefined")return this.splayOnTop(e),this.V[e]};H.prototype.peek=function(r){var e=this.items[r];if(typeof e!="undefined")return this.V[e]};H.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,i=this.size,n=this.head,o=this.K,s=this.V,a=this.forward;t<i;)r.call(e,s[n],o[n],this),n=a[n],t++};H.prototype.keys=function(){var r=0,e=this.size,t=this.head,i=this.K,n=this.forward;return new Kn(function(){if(r>=e)return{done:!0};var o=i[t];return r++,r<e&&(t=n[t]),{done:!1,value:o}})};H.prototype.values=function(){var r=0,e=this.size,t=this.head,i=this.V,n=this.forward;return new Kn(function(){if(r>=e)return{done:!0};var o=i[t];return r++,r<e&&(t=n[t]),{done:!1,value:o}})};H.prototype.entries=function(){var r=0,e=this.size,t=this.head,i=this.K,n=this.V,o=this.forward;return new Kn(function(){if(r>=e)return{done:!0};var s=i[t],a=n[t];return r++,r<e&&(t=o[t]),{done:!1,value:[s,a]}})};typeof Symbol!="undefined"&&(H.prototype[Symbol.iterator]=H.prototype.entries);H.prototype.inspect=function(){for(var r=new Map,e=this.entries(),t;t=e.next(),!t.done;)r.set(t.value[0],t.value[1]);return Object.defineProperty(r,"constructor",{value:H,enumerable:!1}),r};typeof Symbol!="undefined"&&(H.prototype[Symbol.for("nodejs.util.inspect.custom")]=H.prototype.inspect);H.from=function(r,e,t,i){if(arguments.length<2){if(i=jl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var n=new H(e,t,i);return ql(r,function(o,s){n.set(s,o)}),n};ih.exports=H});var oh=v((My,nh)=>{var Vt=gi(),$l=D(),Ql=le(),Kl=ge();function qe(r,e,t){arguments.length<2?Vt.call(this,r):Vt.call(this,r,e,t);var i=Ql.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(Yn in Vt.prototype)qe.prototype[Yn]=Vt.prototype[Yn];var Yn;typeof Symbol!="undefined"&&(qe.prototype[Symbol.iterator]=Vt.prototype[Symbol.iterator]);qe.prototype.clear=function(){Vt.prototype.clear.call(this),this.deletedSize=0};qe.prototype.set=function(r,e){var t=this.items[r];if(typeof t!="undefined"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?(this.deletedSize>0?t=this.deleted[--this.deletedSize]:t=this.size,this.size++):(t=this.tail,this.tail=this.backward[t],delete this.items[this.K[t]]),this.items[r]=t,this.K[t]=r,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};qe.prototype.setpop=function(r,e){var t=null,i=null,n=this.items[r];return typeof n!="undefined"?(this.splayOnTop(n),t=this.V[n],this.V[n]=e,{evicted:!1,key:r,value:t}):(this.size<this.capacity?(this.deletedSize>0?n=this.deleted[--this.deletedSize]:n=this.size,this.size++):(n=this.tail,this.tail=this.backward[n],t=this.V[n],i=this.K[n],delete this.items[this.K[n]]),this.items[r]=n,this.K[n]=r,this.V[n]=e,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:t}:null)};qe.prototype.delete=function(r){var e=this.items[r];if(typeof e=="undefined")return!1;if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var t=this.backward[e],i=this.forward[e];return this.head===e&&(this.head=i),this.tail===e&&(this.tail=t),this.forward[t]=i,this.backward[i]=t,this.size--,this.deleted[this.deletedSize++]=e,!0};qe.prototype.remove=function(r,e=void 0){var t=this.items[r];if(typeof t=="undefined")return e;var i=this.V[t];if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var n=this.backward[t],o=this.forward[t];return this.head===t&&(this.head=o),this.tail===t&&(this.tail=n),this.forward[n]=o,this.backward[o]=n,this.size--,this.deleted[this.deletedSize++]=t,i};qe.from=function(r,e,t,i){if(arguments.length<2){if(i=Kl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var n=new qe(e,t,i);return $l(r,function(o,s){n.set(s,o)}),n};nh.exports=qe});var Xn=v((Iy,sh)=>{var Nt=gi(),Yl=D(),Xl=le(),Jl=ge();function te(r,e,t){if(arguments.length<2&&(t=r,r=null,e=null),this.capacity=t,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-map: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-map: capacity should be a finite positive integer.");var i=Xl.getPointerArray(t);this.forward=new i(t),this.backward=new i(t),this.K=typeof r=="function"?new r(t):new Array(t),this.V=typeof e=="function"?new e(t):new Array(t),this.size=0,this.head=0,this.tail=0,this.items=new Map}te.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items.clear()};te.prototype.set=function(r,e){var t=this.items.get(r);if(typeof t!="undefined"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?t=this.size++:(t=this.tail,this.tail=this.backward[t],this.items.delete(this.K[t])),this.items.set(r,t),this.K[t]=r,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};te.prototype.setpop=function(r,e){var t=null,i=null,n=this.items.get(r);return typeof n!="undefined"?(this.splayOnTop(n),t=this.V[n],this.V[n]=e,{evicted:!1,key:r,value:t}):(this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],t=this.V[n],i=this.K[n],this.items.delete(this.K[n])),this.items.set(r,n),this.K[n]=r,this.V[n]=e,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:t}:null)};te.prototype.has=function(r){return this.items.has(r)};te.prototype.get=function(r){var e=this.items.get(r);if(typeof e!="undefined")return this.splayOnTop(e),this.V[e]};te.prototype.peek=function(r){var e=this.items.get(r);if(typeof e!="undefined")return this.V[e]};te.prototype.splayOnTop=Nt.prototype.splayOnTop;te.prototype.forEach=Nt.prototype.forEach;te.prototype.keys=Nt.prototype.keys;te.prototype.values=Nt.prototype.values;te.prototype.entries=Nt.prototype.entries;typeof Symbol!="undefined"&&(te.prototype[Symbol.iterator]=te.prototype.entries);te.prototype.inspect=Nt.prototype.inspect;te.from=function(r,e,t,i){if(arguments.length<2){if(i=Jl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var n=new te(e,t,i);return Yl(r,function(o,s){n.set(s,o)}),n};sh.exports=te});var hh=v((ky,ah)=>{var Ut=Xn(),Zl=D(),ec=le(),tc=ge();function We(r,e,t){arguments.length<2?Ut.call(this,r):Ut.call(this,r,e,t);var i=ec.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(Jn in Ut.prototype)We.prototype[Jn]=Ut.prototype[Jn];var Jn;typeof Symbol!="undefined"&&(We.prototype[Symbol.iterator]=Ut.prototype[Symbol.iterator]);We.prototype.clear=function(){Ut.prototype.clear.call(this),this.deletedSize=0};We.prototype.set=function(r,e){var t=this.items.get(r);if(typeof t!="undefined"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?(this.deletedSize>0?t=this.deleted[--this.deletedSize]:t=this.size,this.size++):(t=this.tail,this.tail=this.backward[t],this.items.delete(this.K[t])),this.items.set(r,t),this.K[t]=r,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};We.prototype.setpop=function(r,e){var t=null,i=null,n=this.items.get(r);return typeof n!="undefined"?(this.splayOnTop(n),t=this.V[n],this.V[n]=e,{evicted:!1,key:r,value:t}):(this.size<this.capacity?(this.deletedSize>0?n=this.deleted[--this.deletedSize]:n=this.size,this.size++):(n=this.tail,this.tail=this.backward[n],t=this.V[n],i=this.K[n],this.items.delete(this.K[n])),this.items.set(r,n),this.K[n]=r,this.V[n]=e,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:t}:null)};We.prototype.delete=function(r){var e=this.items.get(r);if(typeof e=="undefined")return!1;if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var t=this.backward[e],i=this.forward[e];return this.head===e&&(this.head=i),this.tail===e&&(this.tail=t),this.forward[t]=i,this.backward[i]=t,this.size--,this.deleted[this.deletedSize++]=e,!0};We.prototype.remove=function(r,e=void 0){var t=this.items.get(r);if(typeof t=="undefined")return e;var i=this.V[t];if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var n=this.backward[t],o=this.forward[t];return this.head===t&&(this.head=o),this.tail===t&&(this.tail=n),this.forward[n]=o,this.backward[o]=n,this.size--,this.deleted[this.deletedSize++]=t,i};We.from=function(r,e,t,i){if(arguments.length<2){if(i=tc.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-map.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var n=new We(e,t,i);return Zl(r,function(o,s){n.set(s,o)}),n};ah.exports=We});var lh=v((Fy,uh)=>{var rc=K(),ic=D(),nc=fi(),oc=function(r,e){return r[1]>e[1]?-1:r[1]<e[1]?1:0};function L(){this.items=new Map,Object.defineProperty(this.items,"constructor",{value:L,enumerable:!1}),this.clear()}L.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};L.prototype.add=function(r,e){if(e===0)return this;if(e<0)return this.remove(r,-e);if(e=e||1,typeof e!="number")throw new Error("mnemonist/multi-set.add: given count should be a number.");this.size+=e;let t=this.items.get(r);return t===void 0?this.dimension++:e+=t,this.items.set(r,e),this};L.prototype.set=function(r,e){var t;if(typeof e!="number")throw new Error("mnemonist/multi-set.set: given count should be a number.");return e<=0?(t=this.items.get(r),typeof t!="undefined"&&(this.size-=t,this.dimension--),this.items.delete(r),this):(e=e||1,t=this.items.get(r),typeof t=="number"?this.items.set(r,t+e):(this.dimension++,this.items.set(r,e)),this.size+=e,this)};L.prototype.has=function(r){return this.items.has(r)};L.prototype.delete=function(r){var e=this.items.get(r);return e===0?!1:(this.size-=e,this.dimension--,this.items.delete(r),!0)};L.prototype.remove=function(r,e){if(e!==0){if(e<0)return this.add(r,-e);if(e=e||1,typeof e!="number")throw new Error("mnemonist/multi-set.remove: given count should be a number.");var t=this.items.get(r);if(typeof t!="undefined"){var i=Math.max(0,t-e);i===0?(this.items.delete(r),this.size-=t,this.dimension--):(this.items.set(r,i),this.size-=e)}}};L.prototype.edit=function(r,e){var t=this.multiplicity(r);if(t!==0){var i=this.multiplicity(e);return this.items.set(e,t+i),this.items.delete(r),this}};L.prototype.multiplicity=function(r){var e=this.items.get(r);return typeof e=="undefined"?0:e};L.prototype.get=L.prototype.multiplicity;L.prototype.count=L.prototype.multiplicity;L.prototype.frequency=function(r){if(this.size===0)return 0;var e=this.multiplicity(r);return e/this.size};L.prototype.top=function(r){if(typeof r!="number"||r<=0)throw new Error("mnemonist/multi-set.top: n must be a number > 0.");for(var e=new nc(Array,oc,r),t=this.items.entries(),i;i=t.next(),!i.done;)e.push(i.value);return e.consume()};L.prototype.forEach=function(r,e){e=arguments.length>1?e:this;var t;this.items.forEach(function(i,n){for(t=0;t<i;t++)r.call(e,n,n)})};L.prototype.forEachMultiplicity=function(r,e){e=arguments.length>1?e:this,this.items.forEach(r,e)};L.prototype.keys=function(){return this.items.keys()};L.prototype.values=function(){var r=this.items.entries(),e=!1,t,i,n,o;return new rc(function s(){if(!e){if(t=r.next(),t.done)return{done:!0};e=!0,i=t.value[0],n=t.value[1],o=0}return o>=n?(e=!1,s()):(o++,{done:!1,value:i})})};L.prototype.multiplicities=function(){return this.items.entries()};typeof Symbol!="undefined"&&(L.prototype[Symbol.iterator]=L.prototype.values);L.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(L.prototype[Symbol.for("nodejs.util.inspect.custom")]=L.prototype.inspect);L.prototype.toJSON=function(){return this.items};L.from=function(r){var e=new L;return ic(r,function(t){e.add(t)}),e};L.isSubset=function(r,e){var t=r.multiplicities(),i,n,o;if(r===e)return!0;if(r.dimension>e.dimension)return!1;for(;i=t.next(),!i.done;)if(n=i.value[0],o=i.value[1],e.multiplicity(n)<o)return!1;return!0};L.isSuperset=function(r,e){return L.isSubset(e,r)};uh.exports=L});var gh=v((Ry,dh)=>{var sc=K(),ac=D();function hc(r,e,t){return((Math.pow(r,2)-Math.pow(Math.abs(e-t),2))/2|0)+r+1}function uc(r,e){for(var t=0,i=0,n=e+1;i<n;i++)t+=hc(r,e,i);return t}function lc(r,e){return r.length>e.length?-1:r.length<e.length?1:r<e?-1:r>e?1:0}function ch(r,e){var t=r+1,i=e/t|0,n=i+1,o,s,a=e-i*t,h=t-a,u=new Array(r+1);for(o=0;o<h;o++)u[o]=[o*i,i];var l=(o-1)*i+i;for(s=0;s<a;s++)u[o+s]=[l+s*n,n];return u}function ph(r,e){var t=e.length,i=r+1,n=t/i|0,o=n+1,s,a,h,u=t-n*i,l=i-u,c=new Array(r+1);for(a=0;a<l;a++)s=a*n,c[a]=e.slice(s,s+n);var p=(a-1)*n+n;for(h=0;h<u;h++)s=p+h*o,c[a+h]=e.slice(s,s+o);return c}function cc(r,e,t){if(e===0)return 0;var i=t.length,n=r+1,o=i/n|0,s=o+1,a=i-o*n,h=n-a;if(e<=h-1)return e*o;var u=e-h;return h*o+u*s}function fh(r,e,t,i,n,o){var s=n-t,a=n+t,h=r-t,u=n+e-h,l=n+e+h,c=i-o;return[Math.max(0,s,u),Math.min(a,l,c)]}function mh(r,e,t,i,n,o){var s=e.length,a=s-t,h=fh(r,a,i,s,n,o),u=h[0],l=h[1],c="",p=[],f,d,y;for(d=u,y=l+1;d<y;d++)f=e.slice(d,d+o),f!==c&&(p.push(f),c=f);return p}function V(r,e){if(typeof r!="function")throw new Error("mnemonist/passjoin-index: `levenshtein` should be a function returning edit distance between two strings.");if(typeof e!="number"||e<1)throw new Error("mnemonist/passjoin-index: `k` should be a number > 0");this.levenshtein=r,this.k=e,this.clear()}V.prototype.clear=function(){this.size=0,this.strings=[],this.invertedIndices={}};V.prototype.add=function(r){var e=r.length,t=this.size;this.strings.push(r),this.size++;var i=ph(this.k,r),n=this.invertedIndices[e];typeof n=="undefined"&&(n={},this.invertedIndices[e]=n);var o,s,a,h,u;for(h=0,u=i.length;h<u;h++)o=i[h],a=o+h,s=n[a],typeof s=="undefined"?(s=[t],n[a]=s):s.push(t);return this};V.prototype.search=function(r){var e=r.length,t=this.k,i=new Set,n,o,s,a,h,u,l,c,p,f,d,y,P,x,T;for(c=Math.max(0,e-t),p=e+t+1;c<p;c++){var R=this.invertedIndices[c];if(typeof R!="undefined"){for(l=ch(t,c),f=0,d=l.length;f<d;f++)for(s=l[f][0],a=l[f][1],u=mh(t,r,c,f,s,a),u.length||(u=[""]),y=0,P=u.length;y<P;y++)if(h=u[y]+f,n=R[h],typeof n!="undefined")for(x=0,T=n.length;x<T;x++)o=this.strings[n[x]],(e<=t&&c<=t||!i.has(o)&&this.levenshtein(r,o)<=t)&&i.add(o)}}return i};V.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,i=this.strings.length;t<i;t++)r.call(e,this.strings[t],t,this)};V.prototype.values=function(){var r=this.strings,e=r.length,t=0;return new sc(function(){if(t>=e)return{done:!0};var i=r[t];return t++,{value:i,done:!1}})};typeof Symbol!="undefined"&&(V.prototype[Symbol.iterator]=V.prototype.values);V.prototype.inspect=function(){var r=this.strings.slice();return Object.defineProperty(r,"constructor",{value:V,enumerable:!1}),r};typeof Symbol!="undefined"&&(V.prototype[Symbol.for("nodejs.util.inspect.custom")]=V.prototype.inspect);V.from=function(r,e,t){var i=new V(e,t);return ac(r,function(n){i.add(n)}),i};V.countKeys=uc;V.comparator=lc;V.partition=ch;V.segments=ph;V.segmentPos=cc;V.multiMatchAwareInterval=fh;V.multiMatchAwareSubstrings=mh;dh.exports=V});var bh=v((_y,vh)=>{var yh=K(),pc=D();function N(){this.clear()}N.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};N.prototype.enqueue=function(r){return this.items.push(r),++this.size};N.prototype.dequeue=function(){if(this.size){var r=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,r}};N.prototype.peek=function(){if(this.size)return this.items[this.offset]};N.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=this.offset,i=0,n=this.items.length;t<n;t++,i++)r.call(e,this.items[t],i,this)};N.prototype.toArray=function(){return this.items.slice(this.offset)};N.prototype.values=function(){var r=this.items,e=this.offset;return new yh(function(){if(e>=r.length)return{done:!0};var t=r[e];return e++,{value:t,done:!1}})};N.prototype.entries=function(){var r=this.items,e=this.offset,t=0;return new yh(function(){if(e>=r.length)return{done:!0};var i=r[e];return e++,{value:[t++,i],done:!1}})};typeof Symbol!="undefined"&&(N.prototype[Symbol.iterator]=N.prototype.values);N.prototype.toString=function(){return this.toArray().join(",")};N.prototype.toJSON=function(){return this.toArray()};N.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:N,enumerable:!1}),r};typeof Symbol!="undefined"&&(N.prototype[Symbol.for("nodejs.util.inspect.custom")]=N.prototype.inspect);N.from=function(r){var e=new N;return pc(r,function(t){e.enqueue(t)}),e};N.of=function(){return N.from(arguments)};vh.exports=N});var wh=v((zy,Th)=>{var Ph=K(),fc=D();function U(){this.clear()}U.prototype.clear=function(){this.items=[],this.size=0};U.prototype.push=function(r){return this.items.push(r),++this.size};U.prototype.pop=function(){if(this.size!==0)return this.size--,this.items.pop()};U.prototype.peek=function(){return this.items[this.size-1]};U.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,i=this.items.length;t<i;t++)r.call(e,this.items[i-t-1],t,this)};U.prototype.toArray=function(){for(var r=new Array(this.size),e=this.size-1,t=this.size;t--;)r[t]=this.items[e-t];return r};U.prototype.values=function(){var r=this.items,e=r.length,t=0;return new Ph(function(){if(t>=e)return{done:!0};var i=r[e-t-1];return t++,{value:i,done:!1}})};U.prototype.entries=function(){var r=this.items,e=r.length,t=0;return new Ph(function(){if(t>=e)return{done:!0};var i=r[e-t-1];return{value:[t++,i],done:!1}})};typeof Symbol!="undefined"&&(U.prototype[Symbol.iterator]=U.prototype.values);U.prototype.toString=function(){return this.toArray().join(",")};U.prototype.toJSON=function(){return this.toArray()};U.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:U,enumerable:!1}),r};typeof Symbol!="undefined"&&(U.prototype[Symbol.for("nodejs.util.inspect.custom")]=U.prototype.inspect);U.from=function(r){var e=new U;return fc(r,function(t){e.push(t)}),e};U.of=function(){return U.from(arguments)};Th.exports=U});var xh=v(j=>{j.intersection=function(){if(arguments.length<2)throw new Error("mnemonist/Set.intersection: needs at least two arguments.");var r=new Set,e=1/0,t=null,i,n,o=arguments.length;for(n=0;n<o;n++){if(i=arguments[n],i.size===0)return r;i.size<e&&(e=i.size,t=i)}for(var s=t.values(),a,h,u,l;a=s.next(),!a.done;){for(h=a.value,u=!0,n=0;n<o;n++)if(l=arguments[n],l!==t&&!l.has(h)){u=!1;break}u&&r.add(h)}return r};j.union=function(){if(arguments.length<2)throw new Error("mnemonist/Set.union: needs at least two arguments.");var r=new Set,e,t=arguments.length,i,n;for(e=0;e<t;e++)for(i=arguments[e].values();n=i.next(),!n.done;)r.add(n.value);return r};j.difference=function(r,e){if(!r.size)return new Set;if(!e.size)return new Set(r);for(var t=new Set,i=r.values(),n;n=i.next(),!n.done;)e.has(n.value)||t.add(n.value);return t};j.symmetricDifference=function(r,e){for(var t=new Set,i=r.values(),n;n=i.next(),!n.done;)e.has(n.value)||t.add(n.value);for(i=e.values();n=i.next(),!n.done;)r.has(n.value)||t.add(n.value);return t};j.isSubset=function(r,e){var t=r.values(),i;if(r===e)return!0;if(r.size>e.size)return!1;for(;i=t.next(),!i.done;)if(!e.has(i.value))return!1;return!0};j.isSuperset=function(r,e){return j.isSubset(e,r)};j.add=function(r,e){for(var t=e.values(),i;i=t.next(),!i.done;)r.add(i.value)};j.subtract=function(r,e){for(var t=e.values(),i;i=t.next(),!i.done;)r.delete(i.value)};j.intersect=function(r,e){for(var t=r.values(),i;i=t.next(),!i.done;)e.has(i.value)||r.delete(i.value)};j.disjunct=function(r,e){for(var t=r.values(),i,n=[];i=t.next(),!i.done;)e.has(i.value)&&n.push(i.value);for(t=e.values();i=t.next(),!i.done;)r.has(i.value)||r.add(i.value);for(var o=0,s=n.length;o<s;o++)r.delete(n[o])};j.intersectionSize=function(r,e){var t;if(r.size>e.size&&(t=r,r=e,e=t),r.size===0)return 0;if(r===e)return r.size;for(var i=r.values(),n,o=0;n=i.next(),!n.done;)e.has(n.value)&&o++;return o};j.unionSize=function(r,e){var t=j.intersectionSize(r,e);return r.size+e.size-t};j.jaccard=function(r,e){var t=j.intersectionSize(r,e);if(t===0)return 0;var i=r.size+e.size-t;return t/i};j.overlap=function(r,e){var t=j.intersectionSize(r,e);return t===0?0:t/Math.min(r.size,e.size)}});var Ch=v((Ny,Sh)=>{var mc=K(),dc=le().getPointerArray;function be(r){var e=dc(r);this.start=0,this.size=0,this.capacity=r,this.dense=new e(r),this.sparse=new e(r)}be.prototype.clear=function(){this.start=0,this.size=0};be.prototype.has=function(r){if(this.size===0)return!1;var e=this.sparse[r],t=e<this.capacity&&e>=this.start&&e<this.start+this.size||e<(this.start+this.size)%this.capacity;return t&&this.dense[e]===r};be.prototype.enqueue=function(r){var e=this.sparse[r];if(this.size!==0){var t=e<this.capacity&&e>=this.start&&e<this.start+this.size||e<(this.start+this.size)%this.capacity;if(t&&this.dense[e]===r)return this}return e=(this.start+this.size)%this.capacity,this.dense[e]=r,this.sparse[r]=e,this.size++,this};be.prototype.dequeue=function(){if(this.size!==0){var r=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var e=this.dense[r];return this.sparse[e]=this.capacity,e}};be.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=this.capacity,i=this.size,n=this.start,o=0;o<i;)r.call(e,this.dense[n],o,this),n++,o++,n===t&&(n=0)};be.prototype.values=function(){var r=this.dense,e=this.capacity,t=this.size,i=this.start,n=0;return new mc(function(){if(n>=t)return{done:!0};var o=r[i];return i++,n++,i===e&&(i=0),{value:o,done:!1}})};typeof Symbol!="undefined"&&(be.prototype[Symbol.iterator]=be.prototype.values);be.prototype.inspect=function(){var r=[];return this.forEach(function(e){r.push(e)}),Object.defineProperty(r,"constructor",{value:be,enumerable:!1}),r.capacity=this.capacity,r};typeof Symbol!="undefined"&&(be.prototype[Symbol.for("nodejs.util.inspect.custom")]=be.prototype.inspect);Sh.exports=be});var Eh=v((Uy,Lh)=>{var Zn=K(),gc=le().getPointerArray;function ae(r,e){arguments.length<2&&(e=r,r=Array);var t=gc(e);this.size=0,this.length=e,this.dense=new t(e),this.sparse=new t(e),this.vals=new r(e)}ae.prototype.clear=function(){this.size=0};ae.prototype.has=function(r){var e=this.sparse[r];return e<this.size&&this.dense[e]===r};ae.prototype.get=function(r){var e=this.sparse[r];if(e<this.size&&this.dense[e]===r)return this.vals[e]};ae.prototype.set=function(r,e){var t=this.sparse[r];return t<this.size&&this.dense[t]===r?(this.vals[t]=e,this):(this.dense[this.size]=r,this.sparse[r]=this.size,this.vals[this.size]=e,this.size++,this)};ae.prototype.delete=function(r){var e=this.sparse[r];return e>=this.size||this.dense[e]!==r?!1:(e=this.dense[this.size-1],this.dense[this.sparse[r]]=e,this.sparse[e]=this.sparse[r],this.size--,!0)};ae.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0;t<this.size;t++)r.call(e,this.vals[t],this.dense[t])};ae.prototype.keys=function(){var r=this.size,e=this.dense,t=0;return new Zn(function(){if(t<r){var i=e[t];return t++,{value:i}}return{done:!0}})};ae.prototype.values=function(){var r=this.size,e=this.vals,t=0;return new Zn(function(){if(t<r){var i=e[t];return t++,{value:i}}return{done:!0}})};ae.prototype.entries=function(){var r=this.size,e=this.dense,t=this.vals,i=0;return new Zn(function(){if(i<r){var n=[e[i],t[i]];return i++,{value:n}}return{done:!0}})};typeof Symbol!="undefined"&&(ae.prototype[Symbol.iterator]=ae.prototype.entries);ae.prototype.inspect=function(){for(var r=new Map,e=0;e<this.size;e++)r.set(this.dense[e],this.vals[e]);return Object.defineProperty(r,"constructor",{value:ae,enumerable:!1}),r.length=this.length,this.vals.constructor!==Array&&(r.type=this.vals.constructor.name),r};typeof Symbol!="undefined"&&(ae.prototype[Symbol.for("nodejs.util.inspect.custom")]=ae.prototype.inspect);Lh.exports=ae});var Ah=v((Hy,Oh)=>{var yc=K(),vc=le().getPointerArray;function Pe(r){var e=vc(r);this.size=0,this.length=r,this.dense=new e(r),this.sparse=new e(r)}Pe.prototype.clear=function(){this.size=0};Pe.prototype.has=function(r){var e=this.sparse[r];return e<this.size&&this.dense[e]===r};Pe.prototype.add=function(r){var e=this.sparse[r];return e<this.size&&this.dense[e]===r?this:(this.dense[this.size]=r,this.sparse[r]=this.size,this.size++,this)};Pe.prototype.delete=function(r){var e=this.sparse[r];return e>=this.size||this.dense[e]!==r?!1:(e=this.dense[this.size-1],this.dense[this.sparse[r]]=e,this.sparse[e]=this.sparse[r],this.size--,!0)};Pe.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t,i=0;i<this.size;i++)t=this.dense[i],r.call(e,t,t)};Pe.prototype.values=function(){var r=this.size,e=this.dense,t=0;return new yc(function(){if(t<r){var i=e[t];return t++,{value:i}}return{done:!0}})};typeof Symbol!="undefined"&&(Pe.prototype[Symbol.iterator]=Pe.prototype.values);Pe.prototype.inspect=function(){for(var r=new Set,e=0;e<this.size;e++)r.add(this.dense[e]);return Object.defineProperty(r,"constructor",{value:Pe,enumerable:!1}),r.length=this.length,r};typeof Symbol!="undefined"&&(Pe.prototype[Symbol.for("nodejs.util.inspect.custom")]=Pe.prototype.inspect);Oh.exports=Pe});var Fh=v((Gy,kh)=>{var bc=D(),Pc=2,Tc=2,wc=new Set([0,1,2]),xc={0:"Returns only the top suggestion",1:"Returns suggestions with the smallest edit distance",2:"Returns every suggestion (no early termination)"};function yi(r){var e=new Set;return typeof r=="number"&&e.add(r),{suggestions:e,count:0}}function Dh(r,e,t){return{term:r||"",distance:e||0,count:t||0}}function Ih(r,e,t,i){i=i||new Set,e++;var n,o=r.length,s;if(o>1)for(s=0;s<o;s++)n=r.substring(0,s)+r.substring(s+1),i.has(n)||(i.add(n),e<t&&Ih(n,e,t,i));return i}function Sc(r,e,t,i,n,o){var s=t.suggestions.values().next().value;e<2&&t.suggestions.size>0&&r[s].length-o.length>i.length-o.length&&(t.suggestions=new Set,t.count=0),(e===2||!t.suggestions.size||r[s].length-o.length>=i.length-o.length)&&t.suggestions.add(n)}function Mh(r,e){var t=r.length,i=e.length,n=[[]],o=t+i,s=new Map,a,h,u;for(n[0][0]=o,a=0;a<=t;a++)n[a+1]||(n[a+1]=[]),n[a+1][1]=a,n[a+1][0]=o;for(u=0;u<=i;u++)n[1][u+1]=u,n[0][u+1]=o;var l=r+e,c;for(a=0,h=l.length;a<h;a++)c=l[a],s.has(c)||s.set(c,0);for(a=1;a<=t;a++){var p=0;for(u=1;u<=i;u++){var f=s.get(e[u-1]),d=p;r[a-1]===e[u-1]?(n[a+1][u+1]=n[a][u],p=u):n[a+1][u+1]=Math.min(n[a][u],n[a+1][u],n[a][u+1])+1,n[a+1][u+1]=Math.min(n[a+1][u+1],n[f][d]+(a-f-1)+1+(u-d-1))}s.set(r[a-1],a)}return n[t+1][i+1]}function Cc(r,e,t,i,n,o){var s=o.length;if(s-i>n)return[];for(var a=[o],h=new Set,u=new Set,l=[],c,p;a.length>0&&(c=a.shift(),!(t<2&&l.length>0&&s-c.length>l[0].distance));){if(p=r[c],p!==void 0){if(typeof p=="number"&&(p=yi(p)),p.count>0&&!u.has(c)){u.add(c);var f=Dh(c,s-c.length,p.count);if(l.push(f),t<2&&s-c.length===0)break}p.suggestions.forEach(x=>{var T=e[x];if(!u.has(T)){u.add(T);var R=0;if(o!==T)if(T.length===c.length)R=s-c.length;else if(s===c.length)R=T.length-c.length;else{for(var G=0,et=0,dr=T.length;G<dr&&G<s&&T[G]===o[G];)G++;for(;et<dr-G&&et<s&&T[dr-et-1]===o[s-et-1];)et++;G>0||et>0?R=Mh(T.substr(G,dr-G-et),o.substr(G,s-G-et)):R=Mh(T,o)}if(t<2&&l.length>0&&l[0].distance>R&&(l=[]),!(t<2&&l.length>0&&R>l[0].distance)&&R<=i){var Po=r[T];Po!==void 0&&l.push(Dh(T,R,Po.count))}}})}if(s-c.length<i){if(t<2&&l.length>0&&s-c.length>=l[0].distance)continue;for(var d=0,y=c.length;d<y;d++){var P=c.substring(0,d)+c.substring(d+1);h.has(P)||(h.add(P),a.push(P))}}}return t===0?l.slice(0,1):l}function je(r){if(r=r||{},this.clear(),this.maxDistance=typeof r.maxDistance=="number"?r.maxDistance:Pc,this.verbosity=typeof r.verbosity=="number"?r.verbosity:Tc,typeof this.maxDistance!="number"||this.maxDistance<=0)throw Error("mnemonist/SymSpell.constructor: invalid `maxDistance` option. Should be a integer greater than 0.");if(!wc.has(this.verbosity))throw Error("mnemonist/SymSpell.constructor: invalid `verbosity` option. Should be either 0, 1 or 2.")}je.prototype.clear=function(){this.size=0,this.dictionary=Object.create(null),this.maxLength=0,this.words=[]};je.prototype.add=function(r){var e=this.dictionary[r];if(e!==void 0?(typeof e=="number"&&(e=yi(e),this.dictionary[r]=e),e.count++):(e=yi(),e.count++,this.dictionary[r]=e,r.length>this.maxLength&&(this.maxLength=r.length)),e.count===1){var t=this.words.length;this.words.push(r);var i=Ih(r,0,this.maxDistance);i.forEach(n=>{var o=this.dictionary[n];o!==void 0?(typeof o=="number"&&(o=yi(o),this.dictionary[n]=o),o.suggestions.has(t)||Sc(this.words,this.verbosity,o,r,t,n)):this.dictionary[n]=t})}return this.size++,this};je.prototype.search=function(r){return Cc(this.dictionary,this.words,this.verbosity,this.maxDistance,this.maxLength,r)};je.prototype.inspect=function(){var r=[];r.size=this.size,r.maxDistance=this.maxDistance,r.verbosity=this.verbosity,r.behavior=xc[this.verbosity];for(var e in this.dictionary)typeof this.dictionary[e]=="object"&&this.dictionary[e].count&&r.push([e,this.dictionary[e].count]);return Object.defineProperty(r,"constructor",{value:je,enumerable:!1}),r};typeof Symbol!="undefined"&&(je.prototype[Symbol.for("nodejs.util.inspect.custom")]=je.prototype.inspect);je.from=function(r,e){var t=new je(e);return bc(r,function(i){t.add(i)}),t};kh.exports=je});var eo=v((By,Rh)=>{var Lc=D(),Ht=K(),X=String.fromCharCode(0);function k(r){this.mode=r===Array?"array":"string",this.clear()}k.prototype.clear=function(){this.root={},this.size=0};k.prototype.set=function(r,e){for(var t=this.root,i,n=0,o=r.length;n<o;n++)i=r[n],t=t[i]||(t[i]={});return X in t||this.size++,t[X]=e,this};k.prototype.update=function(r,e){for(var t=this.root,i,n=0,o=r.length;n<o;n++)i=r[n],t=t[i]||(t[i]={});return X in t||this.size++,t[X]=e(t[X]),this};k.prototype.get=function(r){var e=this.root,t,i,n;for(i=0,n=r.length;i<n;i++)if(t=r[i],e=e[t],typeof e=="undefined")return;if(X in e)return e[X]};k.prototype.delete=function(r){var e=this.root,t=null,i=null,n,o,s,a;for(s=0,a=r.length;s<a;s++){if(o=r[s],n=e,e=e[o],typeof e=="undefined")return!1;t!==null?Object.keys(e).length>1&&(t=null,i=null):Object.keys(e).length<2&&(t=n,i=o)}return X in e?(this.size--,t?delete t[i]:delete e[X],!0):!1};k.prototype.has=function(r){for(var e=this.root,t,i=0,n=r.length;i<n;i++)if(t=r[i],e=e[t],typeof e=="undefined")return!1;return X in e};k.prototype.find=function(r){var e=typeof r=="string",t=this.root,i=[],n,o,s;for(o=0,s=r.length;o<s;o++)if(n=r[o],t=t[n],typeof t=="undefined")return i;for(var a=[t],h=[r],u;a.length;){r=h.pop(),t=a.pop();for(u in t){if(u===X){i.push([r,t[X]]);continue}a.push(t[u]),h.push(e?r+u:r.concat(u))}}return i};k.prototype.values=function(r){var e=this.root,t=[],i,n,o;if(r){for(n=0,o=r.length;n<o;n++)if(i=r[n],e=e[i],typeof e=="undefined")return Ht.empty()}return t.push(e),new Ht(function(){for(var s,a=!1,h;t.length;){s=t.pop();for(h in s){if(h===X){a=!0;continue}t.push(s[h])}if(a)return{done:!1,value:s[X]}}return{done:!0}})};k.prototype.prefixes=function(r){var e=this.root,t=[],i=[],n,o,s,a=this.mode==="string";if(r){for(o=0,s=r.length;o<s;o++)if(n=r[o],e=e[n],typeof e=="undefined")return Ht.empty()}else r=a?"":[];return t.push(e),i.push(r),new Ht(function(){for(var h,u,l=!1,c;t.length;){h=t.pop(),u=i.pop();for(c in h){if(c===X){l=!0;continue}t.push(h[c]),i.push(a?u+c:u.concat(c))}if(l)return{done:!1,value:u}}return{done:!0}})};k.prototype.keys=k.prototype.prefixes;k.prototype.entries=function(r){var e=this.root,t=[],i=[],n,o,s,a=this.mode==="string";if(r){for(o=0,s=r.length;o<s;o++)if(n=r[o],e=e[n],typeof e=="undefined")return Ht.empty()}else r=a?"":[];return t.push(e),i.push(r),new Ht(function(){for(var h,u,l=!1,c;t.length;){h=t.pop(),u=i.pop();for(c in h){if(c===X){l=!0;continue}t.push(h[c]),i.push(a?u+c:u.concat(c))}if(l)return{done:!1,value:[u,h[X]]}}return{done:!0}})};typeof Symbol!="undefined"&&(k.prototype[Symbol.iterator]=k.prototype.entries);k.prototype.inspect=function(){for(var r=new Array(this.size),e=this.entries(),t,i=0;t=e.next(),!t.done;)r[i++]=t.value;return Object.defineProperty(r,"constructor",{value:k,enumerable:!1}),r};typeof Symbol!="undefined"&&(k.prototype[Symbol.for("nodejs.util.inspect.custom")]=k.prototype.inspect);k.prototype.toJSON=function(){return this.root};k.from=function(r){var e=new k;return Lc(r,function(t,i){e.set(i,t)}),e};k.SENTINEL=X;Rh.exports=k});var Vh=v((qy,zh)=>{var Ec=D(),_h=eo(),vi=String.fromCharCode(0);function J(r){this.mode=r===Array?"array":"string",this.clear()}for(to in _h.prototype)J.prototype[to]=_h.prototype[to];var to;delete J.prototype.set;delete J.prototype.get;delete J.prototype.values;delete J.prototype.entries;J.prototype.add=function(r){for(var e=this.root,t,i=0,n=r.length;i<n;i++)t=r[i],e=e[t]||(e[t]={});return vi in e||this.size++,e[vi]=!0,this};J.prototype.find=function(r){var e=typeof r=="string",t=this.root,i=[],n,o,s;for(o=0,s=r.length;o<s;o++)if(n=r[o],t=t[n],typeof t=="undefined")return i;for(var a=[t],h=[r],u;a.length;){r=h.pop(),t=a.pop();for(u in t){if(u===vi){i.push(r);continue}a.push(t[u]),h.push(e?r+u:r.concat(u))}}return i};typeof Symbol!="undefined"&&(J.prototype[Symbol.iterator]=J.prototype.keys);J.prototype.inspect=function(){for(var r=new Set,e=this.keys(),t;t=e.next(),!t.done;)r.add(t.value);return Object.defineProperty(r,"constructor",{value:J,enumerable:!1}),r};typeof Symbol!="undefined"&&(J.prototype[Symbol.for("nodejs.util.inspect.custom")]=J.prototype.inspect);J.prototype.toJSON=function(){return this.root};J.from=function(r){var e=new J;return Ec(r,function(t){e.add(t)}),e};J.SENTINEL=vi;zh.exports=J});var Gh=v((Wy,Hh)=>{var Nh=K(),Oc=D(),Ac=ge(),Uh=le(),Dc=function(r){return Math.max(1,Math.ceil(r*1.5))},Mc=function(r){var e=Uh.getPointerArray(r);return new e(r)};function S(r,e){if(arguments.length<1)throw new Error("mnemonist/vector: expecting at least a byte array constructor.");var t=e||0,i=Dc,n=0,o=!1;typeof e=="object"&&(t=e.initialCapacity||0,n=e.initialLength||0,i=e.policy||i,o=e.factory===!0),this.factory=o?r:null,this.ArrayClass=r,this.length=n,this.capacity=Math.max(n,t),this.policy=i,this.array=new r(this.capacity)}S.prototype.set=function(r,e){if(this.length<r)throw new Error("Vector("+this.ArrayClass.name+").set: index out of bounds.");return this.array[r]=e,this};S.prototype.get=function(r){if(!(this.length<r))return this.array[r]};S.prototype.applyPolicy=function(r){var e=this.policy(r||this.capacity);if(typeof e!="number"||e<0)throw new Error("mnemonist/vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(e<=this.capacity)throw new Error("mnemonist/vector.applyPolicy: policy returned a less or equal capacity to allocate.");return e};S.prototype.reallocate=function(r){if(r===this.capacity)return this;var e=this.array;if(r<this.length&&(this.length=r),r>this.capacity)if(this.factory===null?this.array=new this.ArrayClass(r):this.array=this.factory(r),Uh.isTypedArray(this.array))this.array.set(e,0);else for(var t=0,i=this.length;t<i;t++)this.array[t]=e[t];else this.array=e.slice(0,r);return this.capacity=r,this};S.prototype.grow=function(r){var e;if(typeof r=="number"){if(this.capacity>=r)return this;for(e=this.capacity;e<r;)e=this.applyPolicy(e);return this.reallocate(e),this}return e=this.applyPolicy(),this.reallocate(e),this};S.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};S.prototype.push=function(r){return this.capacity===this.length&&this.grow(),this.array[this.length++]=r,this.length};S.prototype.pop=function(){if(this.length!==0)return this.array[--this.length]};S.prototype.values=function(){var r=this.array,e=this.length,t=0;return new Nh(function(){if(t>=e)return{done:!0};var i=r[t];return t++,{value:i,done:!1}})};S.prototype.entries=function(){var r=this.array,e=this.length,t=0;return new Nh(function(){if(t>=e)return{done:!0};var i=r[t];return{value:[t++,i],done:!1}})};typeof Symbol!="undefined"&&(S.prototype[Symbol.iterator]=S.prototype.values);S.prototype.inspect=function(){var r=this.array.slice(0,this.length);return r.type=this.array.constructor.name,r.items=this.length,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:S,enumerable:!1}),r};typeof Symbol!="undefined"&&(S.prototype[Symbol.for("nodejs.util.inspect.custom")]=S.prototype.inspect);S.from=function(r,e,t){if(arguments.length<3&&(t=Ac.guessLength(r),typeof t!="number"))throw new Error("mnemonist/vector.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new S(e,t);return Oc(r,function(n){i.push(n)}),i};function $e(r){var e=function(i){S.call(this,r,i)};for(var t in S.prototype)S.prototype.hasOwnProperty(t)&&(e.prototype[t]=S.prototype[t]);return e.from=function(i,n){return S.from(i,r,n)},typeof Symbol!="undefined"&&(e.prototype[Symbol.iterator]=e.prototype.values),e}S.Int8Vector=$e(Int8Array);S.Uint8Vector=$e(Uint8Array);S.Uint8ClampedVector=$e(Uint8ClampedArray);S.Int16Vector=$e(Int16Array);S.Uint16Vector=$e(Uint16Array);S.Int32Vector=$e(Int32Array);S.Uint32Vector=$e(Uint32Array);S.Float32Vector=$e(Float32Array);S.Float64Vector=$e(Float64Array);S.PointerVector=$e(Mc);Hh.exports=S});var qh=v((jy,Bh)=>{var Ic=ge(),kc=le(),Fc=$n().inplaceQuickSortIndices,Rc=Wn().lowerBoundIndices,_c=pi(),zc=kc.getPointerArray;function Vc(r,e){return r.distance<e.distance?1:r.distance>e.distance?-1:0}function Nc(r,e,t){for(var i=t.length,n=zc(i),o=0,s=new n(i),a=new n(i),h=new n(i),u=new Float64Array(i),l=[0,0,i],c=new Float64Array(i),p,f,d,y,P,x,T,R,G;l.length;)if(P=l.pop(),y=l.pop(),p=l.pop(),f=t[P-1],P--,G=P-y,s[p]=f,G!==0){if(G===1){T=r(e[f],e[t[y]]),u[p]=T,o++,h[p]=o,s[o]=t[y];continue}for(R=y;R<P;R++)c[t[R]]=r(e[f],e[t[R]]);Fc(c,t,y,P),d=y+G/2-1,d===(d|0)?T=(c[t[d]]+c[t[d+1]])/2:T=c[t[Math.ceil(d)]],u[p]=T,x=Rc(c,t,T,y,P),P-x>0&&(o++,h[p]=o,l.push(o,x,P)),x-y>0&&(o++,a[p]=o,l.push(o,y,x))}return{nodes:s,lefts:a,rights:h,mus:u}}function Ze(r,e){if(typeof r!="function")throw new Error("mnemonist/VPTree.constructor: given `distance` must be a function.");if(!e)throw new Error("mnemonist/VPTree.constructor: you must provide items to the tree. A VPTree cannot be updated after its creation.");this.distance=r,this.heap=new _c(Vc),this.D=0;var t=Ic.toArrayWithIndices(e);this.items=t[0];var i=t[1];this.size=i.length;var n=Nc(r,this.items,i);this.nodes=n.nodes,this.lefts=n.lefts,this.rights=n.rights,this.mus=n.mus}Ze.prototype.nearestNeighbors=function(r,e){var t=this.heap,i=[0],n=1/0,o,s,a,h,u,l,c;for(this.D=0;i.length;)o=i.pop(),s=this.nodes[o],a=this.items[s],c=this.distance(a,e),this.D++,c<n&&(t.push({distance:c,item:a}),t.size>r&&t.pop(),t.size>=r&&(n=t.peek().distance)),h=this.lefts[o],u=this.rights[o],!(!h&&!u)&&(l=this.mus[o],c<l?(h&&c<l+n&&i.push(h),u&&c>=l-n&&i.push(u)):(u&&c>=l-n&&i.push(u),h&&c<l+n&&i.push(h)));for(var p=new Array(t.size),f=t.size-1;f>=0;f--)p[f]=t.pop();return p};Ze.prototype.neighbors=function(r,e){var t=[],i=[0],n,o,s,a,h,u,l;for(this.D=0;i.length;)n=i.pop(),o=this.nodes[n],s=this.items[o],l=this.distance(s,e),this.D++,l<=r&&t.push({distance:l,item:s}),a=this.lefts[n],h=this.rights[n],!(!a&&!h)&&(u=this.mus[n],l<u?(a&&l<u+r&&i.push(a),h&&l>=u-r&&i.push(h)):(h&&l>=u-r&&i.push(h),a&&l<u+r&&i.push(a)));return t};Ze.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:Ze,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ze.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ze.prototype.inspect);Ze.from=function(r,e){return new Ze(e,r)};Bh.exports=Ze});var $h=v(($y,jh)=>{var ro=pi(),io=ii(),Wh=Bs();jh.exports={BiMap:Qs(),BitSet:ta(),BitVector:oa(),BloomFilter:ca(),BKTree:fa(),CircularBuffer:va(),DefaultMap:Pa(),DefaultWeakMap:wa(),FixedDeque:_n(),StaticDisjointSet:Sa(),FibonacciHeap:io,MinFibonacciHeap:io.MinFibonacciHeap,MaxFibonacciHeap:io.MaxFibonacciHeap,FixedReverseHeap:fi(),FuzzyMap:Da(),FuzzyMultiMap:Fa(),HashedArrayTree:za(),Heap:ro,MinHeap:ro.MinHeap,MaxHeap:ro.MaxHeap,StaticIntervalTree:Ha(),InvertedIndex:Qa(),KDTree:Za(),LinkedList:rh(),LRUCache:gi(),LRUCacheWithDelete:oh(),LRUMap:Xn(),LRUMapWithDelete:hh(),MultiMap:Hn(),MultiSet:lh(),PassjoinIndex:gh(),Queue:bh(),FixedStack:Bn(),Stack:wh(),SuffixArray:Wh,GeneralizedSuffixArray:Wh.GeneralizedSuffixArray,Set:xh(),SparseQueueSet:Ch(),SparseMap:Eh(),SparseSet:Ah(),SymSpell:Fh(),Trie:Vh(),TrieMap:eo(),Vector:Gh(),VPTree:qh()}});function ur(r,e){var t;return(t=r.get(b.toString(e)))!=null?t:Number.MAX_VALUE}function Uc(){let r=["right","down-right","down","down-left","left","up-left","up","up-right"],e=new Map;for(let t=0;t<r.length;t++){let i=new Map,n=r[t];i.set(0,n);for(let o=1;o<=7;o++)n=yr(n),i.set(o,n);e.set(r[t],i)}return e}var no,Gt,oo=m(()=>{bt();no=So($h());$();re();Me();vt();Xe();Gt=class extends _e{constructor(t,i={}){super(t,i);this.openSet=new no.MinFibonacciHeap;this.g=new Map;this.f=new Map;this.closestToTarget={position:new g(0,0),layer:void 0};this.smallestDistToTarget=0;this.steps=0;this.maxFrontierSize=0;this.maxJumpSize=0;this.turnOrder={right:0,"down-right":1,down:2,"down-left":3,left:4,"up-left":5,up:6,"up-right":7};this.turnTimes=Uc();this.distanceUtils=he.create(4)}findShortestPathImpl(t,i){this.maxJumpSize=this.distance(t.position,i.position);let n=this.shortestPath(t,i);return{path:this.returnPath(n.previous,t,i),closestToTarget:n.closestToTarget,steps:n.steps,maxPathLengthReached:n.maxPathLengthReached,algorithmUsed:"JPS"}}shortestPath(t,i){this.steps=0;let n=new Map;this.g=new Map,this.f=new Map,this.closestToTarget=t,this.smallestDistToTarget=this.distance(t.position,i.position),this.openSet=new no.MinFibonacciHeap((s,a)=>ur(this.f,s)-ur(this.f,a)),this.openSet.push(t);let o=b.toString(t);for(this.g.set(o,0),this.f.set(o,this.distance(t.position,i.position)),this.maxFrontierSize=Math.max(this.maxFrontierSize,this.openSet.size);this.openSet.size>0;){let s=this.openSet.pop();if(!s)break;if(this.steps++,b.equal(s,i))return{previous:n,closestToTarget:i,steps:this.steps,maxPathLengthReached:!1};if(ur(this.g,s)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!0};this.updateClosestToTarget(s,i);for(let a of this.getNeighborsInternal(s,n.get(b.toString(s)),i)){let h=b.toString(a.p),u=ur(this.g,s)+a.dist;(!this.g.has(h)||u<ur(this.g,a.p))&&(n.set(h,s),this.g.set(h,u),this.f.set(h,u+this.distance(a.p.position,i.position)),this.openSet.push(a.p))}}return{previous:n,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!1}}updateClosestToTarget(t,i){let n=this.distance(t.position,i.position);n<this.smallestDistToTarget&&(this.smallestDistToTarget=n,this.closestToTarget=t)}getNeighborsInternal(t,i,n){if(!i||t.layer!==i.layer)return this.getNeighbors(t,n).map(a=>({p:a,dist:1}));let o=this.prune(i,t).map(a=>{let h=this.getTransition(a.position,t.layer);return{position:a.position,layer:h||t.layer}}),s=[];for(let a of o){let h=this.jump(t,a,n,1);h&&s.push(h)}return s}jump(t,i,n,o){let s=this.distanceUtils.direction(t.position,i.position);if(!(this.isBlocking(t,i)&&!(b.equal(i,n)&&this.options.ignoreBlockedTarget)))return b.equal(i,n)?{p:i,dist:o}:o>=this.maxJumpSize?{p:i,dist:o}:this.getTransition(i.position,t.layer)!==void 0?{p:i,dist:o}:Ui(s)?{p:i,dist:o}:this.getForced(t,i).length>0?{p:i,dist:o}:(this.updateClosestToTarget(i,n),this.jump(i,this.getTilePosInDir(i,ie(t.position,i.position)),n,o+1))}getForced(t,i){let n=[],o=this.posInDir(i,this.distanceUtils.direction(i.position,t.position)),{topLeft:s,downLeft:a,top:h,bottom:u}=this.normalizedPositions(o,i),l=(p,f)=>this.isBlocking(p,f)||this.getTransition(f.position,f.layer)!==void 0,c=this.distanceUtils.direction(t.position,i.position);return Co(c)&&((l(o,a)||l(a,u))&&!this.isBlocking(i,u)&&n.push(u),(l(o,s)||l(s,h))&&!this.isBlocking(i,h)&&n.push(h)),n}prune(t,i){let{right:n,top:o,bottom:s}=this.normalizedPositions(t,i),a=this.getForced(t,i),h=ie(t.position,i.position);return Ui(h)?[n,o,s]:[n,...a]}normalizedPositions(t,i){var o,s,a,h,u,l,c;let n=ie(t.position,i.position);return{topLeft:this.posInDir(i,((o=this.turnTimes.get("up-left"))==null?void 0:o.get(this.turnOrder[n]))||"up-left"),downLeft:this.posInDir(i,((s=this.turnTimes.get("down-left"))==null?void 0:s.get(this.turnOrder[n]))||"down-left"),downRight:this.posInDir(i,((a=this.turnTimes.get("down-right"))==null?void 0:a.get(this.turnOrder[n]))||"down-right"),topRight:this.posInDir(i,((h=this.turnTimes.get("up-right"))==null?void 0:h.get(this.turnOrder[n]))||"up-right"),top:this.posInDir(i,((u=this.turnTimes.get("up"))==null?void 0:u.get(this.turnOrder[n]))||"up"),bottom:this.posInDir(i,((l=this.turnTimes.get("down"))==null?void 0:l.get(this.turnOrder[n]))||"down"),right:this.posInDir(i,((c=this.turnTimes.get("right"))==null?void 0:c.get(this.turnOrder[n]))||"right")}}posInDir(t,i){return{position:t.position.add(Se(i)),layer:t.layer}}returnPath(t,i,n){let o=[],s=n;for(o.push(s);!b.equal(s,i);){let a=t.get(b.toString(s));if(!a)return[];this.distance(a.position,s.position)>1?this.fillPath(s,a,o):o.push(a),s=a}return o.reverse()}fillPath(t,i,n){let o=t;do{let s=ie(o.position,i.position);o=this.getTilePosInDir(o,s),n.push(o)}while(!_.equal(o.position,i.position))}}});var bi,Qh=m(()=>{Dt();Pi();re();tr();bi=class{constructor(e,t,i,n={}){this.character=e;this.gridTilemap=t;this.charToFollow=i;let o={distance:0,noPathFoundStrategy:"STOP",maxPathLength:1/0,shortestPathAlgorithm:"BIDIRECTIONAL_SEARCH",ignoreLayers:!1,considerCosts:n.considerCosts||!1};this.options=w(w({},o),n),this.options.considerCosts&&this.options.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.options.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.character=e,this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(B(this.character.autoMovementSet().pipe(Z(s=>s!==this),de(1)))).subscribe(({enterTile:s,enterLayer:a})=>{this.updateTarget(s,a)})}update(e){var t;(t=this.targetMovement)==null||t.update(e)}getInfo(){return{type:"Follow",config:{charToFollow:this.charToFollow.getId(),distance:this.options.distance,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers}}}updateTarget(e,t){this.targetMovement=new Bt(this.character,this.gridTilemap,{position:new g(e),layer:t},{distance:this.options.distance+1,config:{algorithm:this.options.shortestPathAlgorithm,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,considerCosts:this.options.considerCosts},ignoreBlockedTarget:!0})}}});var lr,Kh=m(()=>{lr=class{static getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}}});var Ti,Yh=m(()=>{Kh();vt();$();Dt();re();Ti=class{constructor(e,t=0,i=-1){this.character=e;this.delay=t;this.radius=i;this.stepSize=0;this.delayLeft=this.delay,this.initialRow=e.getNextTilePos().position.y,this.initialCol=e.getNextTilePos().position.x,this.randomizeStepSize(),this.stepsWalked=0,this.currentMovementDirection="none",this.character.positionChangeStarted().pipe(B(this.character.autoMovementSet().pipe(Z(n=>n!==this),de(1)))).subscribe(()=>{this.stepsWalked++}),this.distanceUtils=he.create(e.getNumberOfDirections())}update(e){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=e,this.delayLeft<=0){this.delayLeft=this.delay;let t=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(t),this.currentMovementDirection=t,this.randomizeStepSize()}}getInfo(){return{type:"Random",config:{delay:this.delay,radius:this.radius}}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!=="none"&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return this.distanceUtils.getDirections().filter(t=>!this.character.isBlockingDirection(t)).filter(t=>this.isWithinRadius(t))}isWithinRadius(e){return this.radius==-1?!0:this.getDist(e)<=this.radius}getDist(e){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(Se(e)),new g(this.initialCol,this.initialRow))}getFreeRandomDirection(){let e=this.getFreeDirections();return e.length==0?"none":e[lr.getRandomInt(e.length)]}randomizeStepSize(){this.stepSize=lr.getRandomInt(this.radius)+1}}});function Xh(r,e){return r.filter(t=>{var i,n,o,s,a,h;return(i=e.labels)!=null&&i.withAllLabels?(n=e.labels)==null?void 0:n.withAllLabels.every(u=>t.hasLabel(u)):(o=e.labels)!=null&&o.withOneOfLabels?(s=e.labels)==null?void 0:s.withOneOfLabels.some(u=>t.hasLabel(u)):(a=e.labels)!=null&&a.withNoneLabels?!((h=e.labels)!=null&&h.withNoneLabels.some(u=>t.hasLabel(u))):!0})}var so=m(()=>{});var wi,ao=m(()=>{wi="2.33.0"});var xi,Jh=m(()=>{nt();re();Jr();xi=class{constructor(e){this.collistionStrategy=e;this.tilePosToCharacters=new Map;this.charRemoved$=new E}isCharBlockingAt(e,t,i,n=new Set){if(i.length===0)return!1;let o=this.posToString(e,t),s=this.tilePosToCharacters.get(o);return!!(s&&s.size>0&&[...s].filter(a=>!n.has(a.getId())).some(a=>a.getCollisionGroups().some(h=>i.includes(h))))}getCharactersAt(e,t){let i=this.posToString(e,t),n=this.tilePosToCharacters.get(i);return new Set(n)}addCharacter(e){this.addTilePositions(e.getTilePos(),e),this.addTilePositions(e.getNextTilePos(),e),this.addPositionChangeSub(e),this.addPositionChangeFinishedSub(e),this.addTilePosSetSub(e)}removeCharacter(e){let t=e.getId();this.charRemoved$.next(t),this.deleteTilePositions(e.getTilePos(),e),this.deleteTilePositions(e.getNextTilePos(),e)}add(e,t){var i;this.tilePosToCharacters.has(e)||this.tilePosToCharacters.set(e,new Set),(i=this.tilePosToCharacters.get(e))==null||i.add(t)}addTilePosSetSub(e){e.tilePositionSet().pipe(B(this.charRemoved(e.getId()))).subscribe(t=>{this.deleteTilePositions(e.getNextTilePos(),e),this.addTilePositions(t,e)})}charRemoved(e){var t;return(t=this.charRemoved$)==null?void 0:t.pipe(de(1),Z(i=>i==e))}addPositionChangeSub(e){e.positionChangeStarted().pipe(B(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(t=>{this.collistionStrategy==="BLOCK_ONE_TILE_AHEAD"&&this.deleteTilePositions(t.exit,e),this.addTilePositions(t.enter,e)})}addPositionChangeFinishedSub(e){e.positionChangeFinished().pipe(B(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(t=>{this.deleteTilePositions(t.exit,e),this.addTilePositions(t.enter,e)})}addTilePositions(e,t){this.forEachCharTile(e,t,(i,n)=>{this.add(this.posToString(new g(i,n),e.layer),t)})}deleteTilePositions(e,t){this.forEachCharTile(e,t,(i,n)=>{var o;(o=this.tilePosToCharacters.get(this.posToString(new g(i,n),e.layer)))==null||o.delete(t)})}forEachCharTile(e,t,i){let n=e.position;for(let o=n.x;o<n.x+t.getTileWidth();o++)for(let s=n.y;s<n.y+t.getTileHeight();s++)i(o,s)}posChangeToLayerPos(){return Zi(Re(e=>({enter:{position:new g(e.enterTile),layer:e.enterLayer},exit:{position:new g(e.exitTile),layer:e.exitLayer}})))}posToString(e,t){return`${e.x}#${e.y}#${t}`}}});var ut,Si=m(()=>{ut=class{constructor(e,t,i,n){this.x=e;this.y=t;this.width=i;this.height=n}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}}});var cr,Ci=m(()=>{cr="ge_charLayer"});function uo(r,e){return r|1<<e}function Li(r,e){return(r>>e&1)==1}var Zh,Gc,ho,Ei,eu=m(()=>{$();re();Si();Zh=0,Gc=1,ho={none:1,left:2,"up-left":3,up:4,"up-right":5,right:6,"down-right":7,down:8,"down-left":9},Ei=class{constructor(e,t){this.tilemap=e;this.gridTilemap=t;this.tileCollisionCache=new Map}fixLayer(e){this.fixedLayer=this.tileCollisionCache.get(e)}unfixLayers(){this.fixedLayer=void 0}rebuild(e){e||(e=new ut(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()));let t=this.tilemap.getLayers().filter(i=>i.isCharLayer());for(let i of[...t,void 0]){let n=this.tileCollisionCache.get(i==null?void 0:i.getName());if(n===void 0){n=new Array(this.tilemap.getWidth());for(let o=0;o<this.tilemap.getWidth();o++)n[o]=new Array(this.tilemap.getHeight());this.tileCollisionCache.set(i==null?void 0:i.getName(),n)}for(let o=e.getY();o<e.getY()+e.getHeight();o++)for(let s=e.getX();s<e.getX()+e.getWidth();s++){let a=0;!this.gridTilemap.hasNoTileUncached(new g(s,o),i==null?void 0:i.getName())&&(a=uo(a,0));for(let l of $t())this.gridTilemap.hasBlockingTileUncached(new g(s,o),i==null?void 0:i.getName(),l,!0)&&(a=uo(a,ho[l]));this.gridTilemap.hasBlockingTileUncached(new g(s,o),i==null?void 0:i.getName(),void 0,!0)&&(a=uo(a,ho[1])),n[s][o]=a}}}hasTileAt(e,t,i){var s;let n=this.fixedLayer||this.tileCollisionCache.get(i),o=(s=n==null?void 0:n[e])==null?void 0:s[t];if(o!==void 0)return Li(o,Zh)}isBlockingFrom(e,t,i,n,o){var h;let s=this.fixedLayer||this.tileCollisionCache.get(i),a=(h=s==null?void 0:s[e])==null?void 0:h[t];if(a!==void 0)return!o&&!Li(a,Zh)?!0:n===void 0?Li(a,Gc):Li(a,ho[n])}}});var tu,Ai,Oi,ru=m(()=>{$();Jh();Si();Ci();eu();tu="ge_cost",Ai=class Ai{constructor(e,t,i,n=!1){this.tilemap=e;this.collisionTilePropertyName=t;this.useTileCollisionCache=n;this.characters=new Map;this.transitions=new Map;this.reverseTransitions=new Map;this.collidesPropNames=new Map;this.tileCostPropNames=new Map;this.collisionRelevantLayersFrameCache=new Map;this.charBlockCache=new xi(i);for(let o of $t())this.collidesPropNames.set(o,Ai.ONE_WAY_COLLIDE_PROP_PREFIX+o),this.tileCostPropNames.set(o,`${tu}_${o}`);this.useTileCollisionCache&&(this.tileCollisionCache=new Ei(e,this),this.tileCollisionCache.rebuild())}fixCacheLayer(e){var t;(t=this.tileCollisionCache)==null||t.fixLayer(e)}unfixCacheLayers(){var e;(e=this.tileCollisionCache)==null||e.unfixLayers()}addCharacter(e){this.characters.set(e.getId(),e),e.getNextTilePos().layer===void 0&&e.setTilePosition(De(w({},e.getNextTilePos()),{layer:this.getLowestCharLayer()})),this.charBlockCache.addCharacter(e)}removeCharacter(e){let t=this.characters.get(e);t&&(this.charBlockCache.removeCharacter(t),this.characters.delete(e))}getCharacters(){return[...this.characters.values()]}getCharactersAt(e,t){return this.charBlockCache.getCharactersAt(e,t)}rebuildTileCollisionCache(e){var t;(t=this.tileCollisionCache)==null||t.rebuild(e)}hasBlockingTileUncached(e,t,i,n){if(!n&&this.hasNoTileUncached(e,t))return!0;let o=this.getCollisionRelevantLayers(t);for(let s of o)if(this.isLayerBlockingAt(s.getName(),e,i))return!0;return!1}hasBlockingTile(e,t,i,n){var s;let o=(s=this.tileCollisionCache)==null?void 0:s.isBlockingFrom(e.x,e.y,t,i,n);return o!==void 0?o:this.hasBlockingTileUncached(e,t,i,n)}getTransition(e,t){let i=this.transitions.get(e.toString());if(i)return i.get(t)}getReverseTransitions(e,t){let i=this.reverseTransitions.get(e.toString());if(i)return i.get(t)}setTransition(e,t,i){var n,o,s,a,h;this.transitions.has(e.toString())||this.transitions.set(e.toString(),new Map),this.reverseTransitions.has(e.toString())||this.reverseTransitions.set(e.toString(),new Map),(n=this.transitions.get(e.toString()))==null||n.set(t,i),(o=this.reverseTransitions.get(e.toString()))!=null&&o.has(i)||(s=this.reverseTransitions.get(e.toString()))==null||s.set(i,new Set),(h=(a=this.reverseTransitions.get(e.toString()))==null?void 0:a.get(i))==null||h.add(t)}getTransitions(){return new Map([...this.transitions].map(([e,t])=>[e,new Map(t)]))}getTileCosts(e,t){let i=this.getCollisionRelevantLayers(e.layer),n=1;for(let o of i)n=Math.max(n,this.getTileCostsForLayer(De(w({},e),{layer:o.getName()}),t));return n}getTileCostsForLayer(e,t){let i=this.tilemap.getTileAt(e.position.x,e.position.y,e.layer);return t&&(i==null?void 0:i.getProperty(this.tileCostPropNames.get(t)||""))||(i==null?void 0:i.getProperty(tu))||1}hasNoTileUncached(e,t){return!this.getCollisionRelevantLayers(t).some(n=>this.tilemap.hasTileAt(e.x,e.y,n.getName()))}hasNoTile(e,t){var n;let i=(n=this.tileCollisionCache)==null?void 0:n.hasTileAt(e.x,e.y,t);return i!==void 0?i:this.hasNoTileUncached(e,t)}hasBlockingChar(e,t,i,n=new Set){return this.charBlockCache.isCharBlockingAt(e,t,i,n)}isInRange(e){return new ut(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()).isInRange(e)}toMapDirection(e){return this.isIsometric()?Lo(e):e}fromMapDirection(e){return this.isIsometric()?yr(e):e}isIsometric(){return this.tilemap.getOrientation()==="isometric"}getTilePosInDirection(e,t){let i=e.position.add(Se(this.toMapDirection(t))),n=this.getTransition(i,e.layer)||e.layer;return{position:i,layer:n}}invalidateFrameCache(){this.collisionRelevantLayersFrameCache.clear()}isLayerBlockingAt(e,t,i){let n=this.tilemap.getTileAt(t.x,t.y,e);return n?!!(n.getProperty(this.collisionTilePropertyName)||i&&n.getProperty(this.collidesPropNames.get(i)||"")):!1}getCharLayerIndexes(){return this.tilemap.getLayers().map((e,t)=>({layer:e,index:t})).filter(({layer:e})=>e.isCharLayer()).map(({index:e})=>e)}findPrevAndCharLayer(e){let t=this.getCharLayerIndexes(),i=this.tilemap.getLayers(),n=t.findIndex(o=>i[o].getProperty(cr)==e);return n==0?{prevIndex:-1,charLayerIndex:t[n]}:{prevIndex:t[n-1],charLayerIndex:t[n]}}getCollisionRelevantLayers(e){if(!e)return this.tilemap.getLayers();let t=this.collisionRelevantLayersFrameCache.get(e);if(t)return t;let{prevIndex:i,charLayerIndex:n}=this.findPrevAndCharLayer(e),o=this.tilemap.getLayers().slice(i+1,n+1);return this.collisionRelevantLayersFrameCache.set(e,o),o}getLowestCharLayer(){for(let e of this.tilemap.getLayers())if(e.isCharLayer())return e.getProperty(cr)}};Ai.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_";Oi=Ai});var Di,lo=m(()=>{Di=(t=>(t.REMOVED="REMOVED",t.ADDED="ADDED",t))(Di||{})});var co,Mi,po=m(()=>{si();$();nt();Dt();vt();co=(i=>(i.WAIT="WAIT",i.SKIP="SKIP",i.STOP="STOP",i))(co||{}),Mi=class{constructor(e,t){this.character=e;this.tilemap=t;this.queue=new Je;this.finished$=new E;this.pathBlockedWaitElapsed=0;this.distanceUtils=he.create(e.getNumberOfDirections()),this.character.autoMovementSet().pipe(Z(i=>i!==this),de(1)).subscribe(()=>{this.queue.size()>0&&this.finishMovementTerminated(),this.finished$.complete()})}update(e){(!this.character.isMoving()||this.character.willCrossTileBorderThisUpdate(e))&&this.queue.size()>0&&this.moveCharOnPath(e)}getInfo(){return{type:"Queue"}}enqueue(e,t={}){var n,o,s;let i={pathBlockedStrategy:(n=t.pathBlockedStrategy)!=null?n:"STOP",pathBlockedWaitTimeoutMs:(t==null?void 0:t.pathBlockedWaitTimeoutMs)||-1,ignoreInvalidPositions:(o=t.ignoreInvalidPositions)!=null?o:!1,skipInvalidPositions:(s=t.skipInvalidPositions)!=null?s:!1};for(let a of e){let h={command:a,config:i};if(tt(a)){this.queue.enqueue(h);continue}let u=this.queue.peekEnd(),l=u==null?void 0:u.command;if(l||(l=this.character.getNextTilePos()),tt(l)){this.queue.enqueue(h);continue}let c=this.distanceUtils.distance(l.position,a.position)===1;(!t.ignoreInvalidPositions||c)&&this.queue.enqueue(h)}}peekAll(){return this.queue.peekAll()}size(){return this.queue.size()}finished(){return this.finished$}clear(){this.queue.clear()}moveCharOnPath(e){let t=this.queue.peek();if(!t)return;let i=t.command,n=t.config;if(tt(i)&&(i=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),i)),n.skipInvalidPositions){if(i=this.getNextValidPosition(),!i){this.finishInvalidNextPos(i);return}}else if(!this.isNeighborPos(i)){this.finishInvalidNextPos(i);return}if(this.character.isBlockingDirection(ie(this.character.getNextTilePos().position,i.position))){if(n.pathBlockedStrategy==="STOP")this.finishPathBlocked(i);else if(n.pathBlockedStrategy==="SKIP"){this.queue.dequeue(),this.moveCharOnPath(e);return}else n.pathBlockedStrategy==="WAIT"&&n.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=n.pathBlockedWaitTimeoutMs&&this.finishBlockedWaitTimeout(i,n.pathBlockedWaitTimeoutMs));return}this.pathBlockedWaitElapsed=0,this.queue.dequeue(),this.character.move(this.getDir(this.character.getNextTilePos().position,i.position)),this.isLastMovement()&&this.finish("SUCCESS","",i)}getNextValidPosition(){var e;for(;this.queue.size()>0;){let t=(e=this.queue.peek())==null?void 0:e.command;if(tt(t)&&(t=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),t)),t&&this.isNeighborPos(t))return t;this.queue.dequeue()}}isLastMovement(){return this.queue.size()===0}isNeighborPos(e){let t=this.distanceUtils.distance(this.character.getNextTilePos().position,e.position)===1,i=this.tilemap.getTransition(e.position,this.character.getNextTilePos().layer);if(this.character.getNextTilePos().layer!==e.layer)return t&&i===e.layer;let n=i!==void 0&&i!==e.layer;return t&&!n}finishMovementTerminated(){this.finish("MOVEMENT_TERMINATED","New automatic movement has been set to character.")}finishInvalidNextPos(e){e?this.finish("INVALID_NEXT_POS",`Position ${this.posToStr(e)} is not reachable from ${this.posToStr(this.character.getNextTilePos())}.`):this.finish("INVALID_NEXT_POS",`No enqueued position is reachable from ${this.posToStr(this.character.getNextTilePos())}.`)}finishPathBlocked(e){this.finish("PATH_BLOCKED",`Position ${this.posToStr(e)} is blocked.`)}finishBlockedWaitTimeout(e,t){this.finish("PATH_BLOCKED_WAIT_TIMEOUT",`Position ${this.posToStr(e)} is blocked and the wait timeout of ${t} ms has been exceeded.`)}finish(e,t="",i=this.character.getNextTilePos()){this.queue=new Je,this.finished$.next({position:i.position,result:e,description:t,layer:i.layer})}getDir(e,t){return this.tilemap.fromMapDirection(ie(e,t))}posToStr(e){return`(${e.position.x}, ${e.position.y}, ${e.layer})`}}});var pr,fo=m(()=>{Jr();Qh();Pi();Kr();$();Yh();nt();Dt();re();tr();ti();Yr();so();ao();Ii();Me();bt();ru();lo();Si();po();pr=class{constructor(e=!0){this.isCreatedInternal=!1;e&&console.log(`Using GridEngine v${wi}`)}getCharLayer(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getTilePos().layer}getTransition(e,t){var i;return this.initGuard(),(i=this.gridTilemap)==null?void 0:i.getTransition(new g(e),t)}setTransition(e,t,i){var n;return this.initGuard(),(n=this.gridTilemap)==null?void 0:n.setTransition(new g(e),t,i)}create(e,t){this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(t);this.config=i,this.movementStopped$=new E,this.movementStarted$=new E,this.directionChanged$=new E,this.positionChangeStarted$=new E,this.positionChangeFinished$=new E,this.queueMovementFinished$=new E,this.charRemoved$=new E,this.charAdded$=new E,this.gridTilemap=new Oi(e,this.config.collisionTilePropertyName,this.config.characterCollisionStrategy,this.config.cacheTileCollisions),this.addCharacters()}getPosition(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getTilePos().position}move(e,t){this.moveChar(e,t)}moveRandomly(e,t=0,i=-1){var s;this.initGuard();let n=(s=this.gridCharacters)==null?void 0:s.get(e);if(!n)throw this.createCharUnknownErr(e);let o=new Ti(n,t,i);n.setMovement(o)}getMovement(e){var n;this.initGuard();let t=(n=this.gridCharacters)==null?void 0:n.get(e);if(!t)throw this.createCharUnknownErr(e);let i=t.getMovement();return i?i.getInfo():{type:"None"}}moveTo(e,t,i){var a;let n=this.assembleMoveToConfig(i);this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let s=new Bt(o,this.gridTilemap,{position:new g(t),layer:(i==null?void 0:i.targetLayer)||o.getNextTilePos().layer},{distance:0,config:n});return o.setMovement(s),s.finishedObs().pipe(Re(h=>({charId:e,position:h.position,result:h.result,description:h.description,layer:h.layer})))}stopMovement(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);t.setMovement(void 0)}setSpeed(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.setSpeed(t)}getSpeed(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getSpeed()}collidesWithTiles(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.collidesWithTiles()}update(e,t){var i;if(this.isCreatedInternal&&this.gridCharacters)for(let[n,o]of this.gridCharacters)o.update(t);(i=this.gridTilemap)==null||i.invalidateFrameCache()}addCharacter(e){var o,s,a,h,u;if(!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let t={speed:e.speed||4,tilemap:this.gridTilemap,collidesWithTiles:!0,collisionGroups:["geDefault"],charLayer:e.charLayer,facingDirection:e.facingDirection,labels:e.labels,numberOfDirections:(o=e.numberOfDirections)!=null?o:this.config.numberOfDirections,tileWidth:e.tileWidth,tileHeight:e.tileHeight};typeof e.collides=="boolean"?e.collides===!1&&(t.collidesWithTiles=!1,t.collisionGroups=[]):e.collides!==void 0&&(e.collides.collidesWithTiles===!1&&(t.collidesWithTiles=!1),e.collides.collisionGroups&&(t.collisionGroups=e.collides.collisionGroups),t.ignoreMissingTiles=(a=(s=e.collides)==null?void 0:s.ignoreMissingTiles)!=null?a:!1);let i=new Qr(e.id,t);e.startPosition&&i.setTilePosition({position:new g(e.startPosition),layer:i.getTilePos().layer}),(h=this.gridCharacters)==null||h.set(e.id,i),this.gridTilemap.addCharacter(i);let n=i.getId();i.movementStopped().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.movementStopped$)==null||c.next({charId:n,direction:l})}),i.movementStarted().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.movementStarted$)==null||c.next({charId:n,direction:l})}),i.directionChanged().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.directionChanged$)==null||c.next({charId:n,direction:l})}),i.positionChangeStarted().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.positionChangeStarted$)==null||c.next(w({charId:n},l))}),i.positionChangeFinished().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.positionChangeFinished$)==null||c.next(w({charId:n},l))}),(u=this.charAdded$)==null||u.next(n)}hasCharacter(e){var t;return this.initGuard(),!!((t=this.gridCharacters)!=null&&t.has(e))}removeCharacter(e){var i,n,o,s;if(this.initGuard(),!((i=this.gridCharacters)==null?void 0:i.get(e)))throw this.createCharUnknownErr(e);(n=this.gridTilemap)==null||n.removeCharacter(e),(o=this.gridCharacters)==null||o.delete(e),(s=this.charRemoved$)==null||s.next(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters)for(let e of this.gridCharacters.keys())this.removeCharacter(e)}getAllCharacters(e){if(this.initGuard(),!this.gridCharacters)return[];let t=[...this.gridCharacters.values()];return(e?Xh(t,e):t).map(n=>n.getId())}getLabels(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getLabels()}addLabels(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.addLabels(t)}removeLabels(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.removeLabels(t)}clearLabels(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);t.clearLabels()}follow(e,t,i,n){var u,l,c,p;let o;i===void 0?o={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(o={distance:i,closestPointIfBlocked:!1},n&&(o.closestPointIfBlocked=!0)):o=i,this.initGuard();let s=(u=this.gridCharacters)==null?void 0:u.get(e),a=(l=this.gridCharacters)==null?void 0:l.get(t);if(!s)throw this.createCharUnknownErr(e);if(!a)throw this.createCharUnknownErr(t);if(!this.gridTilemap)throw this.createUninitializedErr();let h=new bi(s,this.gridTilemap,a,{distance:o.distance,noPathFoundStrategy:o.closestPointIfBlocked?"CLOSEST_REACHABLE":"STOP",maxPathLength:(c=o.maxPathLength)!=null?c:1/0,shortestPathAlgorithm:(p=o.algorithm)!=null?p:"BIDIRECTIONAL_SEARCH",ignoreLayers:!!o.ignoreLayers});s.setMovement(h)}isMoving(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.isMoving()}getFacingDirection(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getFacingDirection()}getFacingPosition(e){var n;this.initGuard();let t=(n=this.gridCharacters)==null?void 0:n.get(e);if(!t)throw this.createCharUnknownErr(e);let i=t.getFacingPosition();return{x:i.x,y:i.y}}turnTowards(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);return i.turnTowards(t)}getCharactersAt(e,t){if(this.initGuard(),!this.gridTilemap)return[];let i=this.gridTilemap.getCharactersAt(new g(e),t);return Array.from(i).map(n=>n.getId())}setPosition(e,t,i){var o;this.initGuard();let n=(o=this.gridCharacters)==null?void 0:o.get(e);if(!n)throw this.createCharUnknownErr(e);i||n.setTilePosition({position:new g(t),layer:n.getTilePos().layer}),n.setTilePosition({position:new g(t),layer:i})}isBlocked(e,t,i=["geDefault"]){var o,s;this.initGuard();let n=new g(e);return!!((o=this.gridTilemap)!=null&&o.hasBlockingTile(n,t)||(s=this.gridTilemap)!=null&&s.hasBlockingChar(n,t,i))}isTileBlocked(e,t){var i;return this.initGuard(),!!((i=this.gridTilemap)!=null&&i.hasBlockingTile(new g(e),t))}getCollisionGroups(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getCollisionGroups()||[]}setCollisionGroups(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.setCollisionGroups(t)}getTilePosInDirection(e,t,i){if(!this.gridTilemap)throw this.createUninitializedErr();let n=this.gridTilemap.getTilePosInDirection({position:new g(e),layer:t},i);return{position:n.position.toPosition(),charLayer:n.layer}}findShortestPath(e,t,i={}){if(!this.gridTilemap)throw this.createUninitializedErr();let n=i.shortestPathAlgorithm||"BFS";i.considerCosts&&n!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${n}'. It can only be used with A* algorithm.`);let s=new qt(this.gridTilemap).findShortestPath(b.toInternal(e),b.toInternal(t),De(w({},i),{shortestPathAlgorithm:n}));return{path:s.path.map(b.fromInternal),closestToTarget:s.closestToTarget?b.fromInternal(s.closestToTarget):void 0,reachedMaxPathLength:!1,steps:s.steps}}steppedOn(e,t,i){return this.positionChangeFinished().pipe(Z(n=>e.includes(n.charId)&&t.some(o=>o.x===n.enterTile.x&&o.y===n.enterTile.y)&&(i===void 0||i.includes(n.enterLayer))))}characterShifted(){if(!this.charAdded$||!this.charRemoved$)throw this.createUninitializedErr();return this.charAdded$.pipe(Re(e=>({charId:e,action:"ADDED"})),Tn(this.charRemoved$.pipe(Re(e=>({charId:e,action:"REMOVED"})))))}movementStarted(){if(!this.movementStarted$)throw this.createUninitializedErr();return this.movementStarted$}movementStopped(){if(!this.movementStopped$)throw this.createUninitializedErr();return this.movementStopped$}directionChanged(){if(!this.directionChanged$)throw this.createUninitializedErr();return this.directionChanged$}positionChangeStarted(){if(!this.positionChangeStarted$)throw this.createUninitializedErr();return this.positionChangeStarted$}positionChangeFinished(){if(!this.positionChangeFinished$)throw this.createUninitializedErr();return this.positionChangeFinished$}getMovementProgress(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getMovementProgress()}rebuildTileCollisionCache(e,t,i,n){var o;(o=this.gridTilemap)==null||o.rebuildTileCollisionCache(new ut(e,t,i,n))}addQueueMovements(e,t,i){var s,a;this.initGuard();let n=(s=this.gridCharacters)==null?void 0:s.get(e);if(!n)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let o;((a=n==null?void 0:n.getMovement())==null?void 0:a.getInfo().type)==="Queue"?o=n.getMovement():(o=new Mi(n,this.gridTilemap),n.setMovement(o),o.finished().pipe(B(vn(this.charRemoved(e),n.autoMovementSet()))).subscribe(h=>{var u;(u=this.queueMovementFinished$)==null||u.next(w({charId:e},h))})),o.enqueue(t.map(h=>tt(h)?h:{position:new g(h.position),layer:h.charLayer}),i)}queueMovementFinished(){if(!this.queueMovementFinished$)throw this.createUninitializedErr();return this.queueMovementFinished$}getEnqueuedMovements(e){var i,n;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return((n=t.getMovement())==null?void 0:n.getInfo().type)==="Queue"?t.getMovement().peekAll().map(s=>({command:tt(s.command)?s.command:b.fromInternal(s.command),config:s.config})):[]}clearEnqueuedMovements(e){var i,n;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);((n=t.getMovement())==null?void 0:n.getInfo().type)==="Queue"&&t.getMovement().clear()}getTileCost(e,t,i){var n,o;return this.initGuard(),(o=(n=this.gridTilemap)==null?void 0:n.getTileCosts({position:new g(e),layer:t},i))!=null?o:1}charRemoved(e){var t;if(!this.charRemoved$)throw this.createUninitializedErr();return(t=this.charRemoved$)==null?void 0:t.pipe(de(1),Z(i=>i==e))}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(t=>this.addCharacter(t))}moveChar(e,t){var n,o,s;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);if(i.getNumberOfDirections()===4){if(!((o=this.gridTilemap)!=null&&o.isIsometric())&&St(t)){console.warn(`GridEngine: Character '${e}' can't be moved '${t}' in 4 direction mode.`);return}else if((s=this.gridTilemap)!=null&&s.isIsometric()&&!St(t)){console.warn(`GridEngine: Character '${e}' can't be moved '${t}' in 4 direction isometric mode.`);return}}i.move(t)}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}assembleMoveToConfig(e={}){let t=De(w({},e),{noPathFoundStrategy:"STOP",pathBlockedStrategy:"WAIT"});return e!=null&&e.noPathFoundStrategy&&(Object.values(yt).includes(e.noPathFoundStrategy)?t.noPathFoundStrategy=e.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${e.noPathFoundStrategy}'. Falling back to '${"STOP"}'`)),e!=null&&e.pathBlockedStrategy&&(Object.values(Mt).includes(e.pathBlockedStrategy)?t.pathBlockedStrategy=e.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${e.pathBlockedStrategy}'. Falling back to '${"WAIT"}'`)),t}setConfigDefaults(e){return w({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",cacheTileCollisions:!1},e)}}});var Fi,iu=m(()=>{$();fo();vt();Me();oo();Fi=class extends Gt{constructor(e,t={}){super(e,t),this.distanceUtils=he.create(8)}getForced(e,t){let i=[],n=this.posInDir(t,this.distanceUtils.direction(t.position,e.position)),{topLeft:o,downLeft:s,top:a,bottom:h,topRight:u,downRight:l}=this.normalizedPositions(n,t),c=this.distanceUtils.direction(e.position,t.position),p=(f,d)=>this.isBlocking(f,d)||this.getTransition(d.position,d.layer)!==void 0;return St(c)?(p(e,o)&&!this.isBlocking(t,a)&&i.push(a),p(e,o)&&(p(e,s)||p(s,o))&&!this.isBlocking(t,o)&&i.push(o),p(e,s)&&!this.isBlocking(t,h)&&i.push(h),p(e,s)&&(p(e,o)||p(o,s))&&!this.isBlocking(t,s)&&i.push(s)):(p(e,a)&&(p(e,o)||p(o,a))&&(this.isBlocking(t,o)||i.push(o),this.isBlocking(t,a)||i.push(a)),p(e,a)&&(p(e,o)||p(o,a)||p(a,u))&&!this.isBlocking(t,u)&&i.push(u),p(e,h)&&(p(e,s)||p(s,a))&&(this.isBlocking(t,s)||i.push(s),this.isBlocking(t,h)||i.push(h)),p(e,h)&&(p(e,s)||p(o,h)||p(a,l))&&!this.isBlocking(t,l)&&i.push(l)),i}prune(e,t){let{right:i,topRight:n,downRight:o}=this.normalizedPositions(e,t),s=this.getForced(e,t),a=ie(e.position,t.position);return St(a)?[i,n,o,...s]:[i,...s]}jump(e,t,i,n){let o=this.distanceUtils.direction(e.position,t.position);if(!(this.isBlocking(e,t)&&!(b.equal(t,i)&&this.options.ignoreBlockedTarget))){if(b.equal(t,i))return{p:t,dist:n};if(n>=this.maxJumpSize)return{p:t,dist:n};if(this.getTransition(t.position,e.layer)!==void 0)return{p:t,dist:n};if(this.getForced(e,t).length>0)return{p:t,dist:n};if(this.updateClosestToTarget(t,i),o==="up-left"){if(this.jump(t,this.getTilePosInDir(t,"up"),i,n+1)!==void 0)return{p:t,dist:n};if(this.jump(t,this.getTilePosInDir(t,"left"),i,n+1)!==void 0)return{p:t,dist:n}}else if(o==="down-left"){if(this.jump(t,this.getTilePosInDir(t,"down"),i,n+1)!==void 0)return{p:t,dist:n};if(this.jump(t,this.getTilePosInDir(t,"left"),i,n+1)!==void 0)return{p:t,dist:n}}else if(o==="up-right"){if(this.jump(t,this.getTilePosInDir(t,"up"),i,n+1)!==void 0)return{p:t,dist:n};if(this.jump(t,this.getTilePosInDir(t,"right"),i,n+1)!==void 0)return{p:t,dist:n}}else if(o==="down-right"){if(this.jump(t,this.getTilePosInDir(t,"down"),i,n+1)!==void 0)return{p:t,dist:n};if(this.jump(t,this.getTilePosInDir(t,"right"),i,n+1)!==void 0)return{p:t,dist:n}}return this.jump(t,this.getTilePosInDir(t,ie(e.position,t.position)),i,n+1)}}}});function Bc(r,e,t){switch(r){case"BIDIRECTIONAL_SEARCH":return new hi(e,t);case"A_STAR":return new ni(e,t);case"JPS":return t.numberOfDirections===8?new Fi(e,t):new Gt(e,t)}return new It(e,t)}var qt,Ii=m(()=>{$();Ms();Cn();Is();oo();iu();qt=class{constructor(e){this.gridTilemap=e}findShortestPath(e,t,i={}){return Bc(i.shortestPathAlgorithm||"BIDIRECTIONAL_SEARCH",this.gridTilemap,i).findShortestPath(e,t)}}});var ki,Bt,Pi=m(()=>{tr();vt();vs();ti();nt();Ii();Cn();Me();ki=(h=>(h.SUCCESS="SUCCESS",h.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",h.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",h.PATH_BLOCKED="PATH_BLOCKED",h.NO_PATH_FOUND="NO_PATH_FOUND",h.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",h.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED",h.MAX_PATH_LENGTH_REACHED="MAX_PATH_LENGTH_REACHED",h))(ki||{}),Bt=class{constructor(e,t,i,{config:n,ignoreBlockedTarget:o=!1,distance:s=0}={}){this.character=e;this.tilemap=t;this.targetPos=i;this.shortestPath=[];this.distOffset=0;this.posOnPath=0;this.stopped=!1;this.pathBlockedWaitElapsed=0;this.isPositionAllowed=()=>!0;this.shortestPathAlgorithm="BIDIRECTIONAL_SEARCH";this.maxPathLength=1/0;this.considerCosts=!1;this.isBlocking=(e,t)=>e?new It(this.tilemap,this.getPathfindingOptions()).isBlocking(this.character.getTilePos(),{position:e,layer:t}):!0;var a;this.shortestPathAlgorithm=(a=n==null?void 0:n.algorithm)!=null?a:this.shortestPathAlgorithm,this.ignoreBlockedTarget=o,this.distance=s,this.noPathFoundStrategy=(n==null?void 0:n.noPathFoundStrategy)||"STOP",this.pathBlockedStrategy=(n==null?void 0:n.pathBlockedStrategy)||"WAIT",this.noPathFoundRetryable=new rr((n==null?void 0:n.noPathFoundRetryBackoffMs)||200,(n==null?void 0:n.noPathFoundMaxRetries)||-1,()=>{this.stop("NO_PATH_FOUND_MAX_RETRIES_EXCEEDED")}),this.pathBlockedRetryable=new rr((n==null?void 0:n.pathBlockedRetryBackoffMs)||200,(n==null?void 0:n.pathBlockedMaxRetries)||-1,()=>{this.stop("PATH_BLOCKED_MAX_RETRIES_EXCEEDED")}),n!=null&&n.isPositionAllowedFn&&(this.isPositionAllowed=n.isPositionAllowedFn),n!=null&&n.maxPathLength&&(this.maxPathLength=n.maxPathLength),n!=null&&n.considerCosts&&this.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.considerCosts=(n==null?void 0:n.considerCosts)||!1,this.ignoreLayers=!!(n!=null&&n.ignoreLayers),this.distanceUtils=he.create(e.getNumberOfDirections()),this.pathBlockedWaitTimeoutMs=(n==null?void 0:n.pathBlockedWaitTimeoutMs)||-1,this.finished$=new E,this.setCharacter(e)}setPathBlockedStrategy(e){this.pathBlockedStrategy=e}getPathBlockedStrategy(){return this.pathBlockedStrategy}setCharacter(e){this.character=e,this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(Z(t=>t!==this),de(1)).subscribe(()=>{this.stop("MOVEMENT_TERMINATED")})}getPathfindingOptions(){return{shortestPathAlgorithm:this.shortestPathAlgorithm,pathWidth:this.character.getTileWidth(),pathHeight:this.character.getTileHeight(),numberOfDirections:this.character.getNumberOfDirections(),isPositionAllowed:this.isPositionAllowed,collisionGroups:this.character.getCollisionGroups(),ignoredChars:[this.character.getId()],ignoreTiles:!this.character.collidesWithTiles(),ignoreMapBounds:this.character.getIgnoreMissingTiles(),ignoreBlockedTarget:this.ignoreBlockedTarget,maxPathLength:this.maxPathLength,ignoreLayers:this.ignoreLayers,considerCosts:this.considerCosts,calculateClosestToTarget:!0}}update(e){var t,i,n,o;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy==="RETRY"?this.noPathFoundRetryable.retry(e,()=>this.calcShortestPath()):this.noPathFoundStrategy==="STOP"&&this.stop("NO_PATH_FOUND")),this.updatePosOnPath(),this.isBlocking((t=this.nextTileOnPath())==null?void 0:t.position,(i=this.character)==null?void 0:i.getNextTilePos().layer)?this.applyPathBlockedStrategy(e):this.pathBlockedWaitElapsed=0,this.hasArrived()?(this.stop("SUCCESS"),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking((n=this.nextTileOnPath())==null?void 0:n.position,(o=this.character)==null?void 0:o.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}getInfo(){return{type:"Target",state:{pathAhead:this.shortestPath.slice(this.posOnPath).map(e=>b.fromInternal(e))},config:{algorithm:this.shortestPathAlgorithm,ignoreBlockedTarget:this.ignoreBlockedTarget,distance:this.distance,targetPos:b.fromInternal(this.targetPos),noPathFoundStrategy:this.noPathFoundStrategy,pathBlockedStrategy:this.pathBlockedStrategy,noPathFoundRetryBackoffMs:this.noPathFoundRetryable.getBackoffMs(),noPathFoundMaxRetries:this.noPathFoundRetryable.getMaxRetries()}}}resultToReason(e){switch(e){case"SUCCESS":return"Successfully arrived.";case"MOVEMENT_TERMINATED":return"Movement of character has been replaced before destination was reached.";case"PATH_BLOCKED":return"PathBlockedStrategy STOP: Path blocked.";case"NO_PATH_FOUND_MAX_RETRIES_EXCEEDED":return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case"NO_PATH_FOUND":return"NoPathFoundStrategy STOP: No path found.";case"PATH_BLOCKED_MAX_RETRIES_EXCEEDED":return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case"PATH_BLOCKED_WAIT_TIMEOUT":return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(e){this.pathBlockedStrategy==="RETRY"?this.pathBlockedRetryable.retry(e,()=>{let t=this.getShortestPath();t.path.length>0&&this.calcShortestPath(t)}):this.pathBlockedStrategy==="STOP"?this.stop("PATH_BLOCKED"):this.pathBlockedStrategy==="WAIT"&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop("PATH_BLOCKED_WAIT_TIMEOUT"))}moveCharOnPath(){let e=this.nextTileOnPath();if(!e)return;let t=this.getDir(this.character.getNextTilePos().position,e.position);this.character.move(t)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(e){this.finished$.next({position:this.character.getTilePos().position,result:e,description:this.resultToReason(e),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let e=this.shortestPath[this.posOnPath+1],t=this.getDir(this.character.getNextTilePos().position,e.position);this.character.turnTowards(t)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let e=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=e.position.x||this.character.getNextTilePos().position.y!=e.position.y);)this.posOnPath++,e=this.shortestPath[this.posOnPath]}noPathFound(){return this.shortestPath.length===0}calcShortestPath(e){e=e!=null?e:this.getShortestPath(),this.posOnPath=0,this.shortestPath=e.path,this.distOffset=e.distOffset}getShortestPath(){let e=new qt(this.tilemap),{path:t,closestToTarget:i}=e.findShortestPath(this.character.getNextTilePos(),this.targetPos,this.getPathfindingOptions());if(t.length==0&&this.noPathFoundStrategy==="CLOSEST_REACHABLE"){if(!i)throw Error("ClosestToTarget should never be undefined in TargetMovement.");let o=e.findShortestPath(this.character.getNextTilePos(),i,this.getPathfindingOptions()).path,s=this.distanceUtils.distance(i.position,this.targetPos.position);return{path:o,distOffset:s}}return{path:t,distOffset:0}}getDir(e,t){return this.tilemap.fromMapDirection(this.distanceUtils.direction(e,t))}}});var xe,Ri,nu=m(()=>{mo();xn();re();Xe();xe=class xe{constructor(e){this.tilemap=e;this.charLayerDepths=new Map;this.setLayerDepths()}getTileWidth(){var t,i;let e=(i=(t=this.tilemap.layers[0])==null?void 0:t.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileWidth*e}getTileHeight(){var t,i;let e=(i=(t=this.tilemap.layers[0])==null?void 0:t.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileHeight*e}getDepthOfCharLayer(e){var t;return(t=this.charLayerDepths.get(e))!=null?t:0}tilePosToPixelPos(e){return this.isIsometric()?_.scalarMult(this.getTileSize(),.5).multiply(new g(e.x-e.y,e.x+e.y)):e.clone().multiply(this.getTileSize())}getTileDistance(e){if(this.isIsometric())switch(e){case"down-left":case"down-right":case"up-left":case"up-right":return _.scalarMult(this.getTileSize(),.5);default:return this.getTileSize()}return this.getTileSize()}getTileSize(){return new g(this.getTileWidth(),this.getTileHeight())}isIsometric(){return this.tilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()}isLayerAlwaysOnTop(e){return this.hasLayerProp(e,xe.ALWAYS_TOP_PROP_NAME)}isCharLayer(e){return this.hasLayerProp(e,xe.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let e=[],t=-1,i=this.tilemap.layers.filter(o=>this.isLayerAlwaysOnTop(o));this.tilemap.layers.filter(o=>!this.isLayerAlwaysOnTop(o)).forEach(o=>{this.hasLayerProp(o,xe.HEIGHT_SHIFT_PROP_NAME)?(this.createHeightShiftLayers(o,t),e.push(o.tilemapLayer)):this.setDepth(o,++t)}),this.charLayerDepths.set(void 0,t),i.forEach((o,s)=>{o.tilemapLayer.setDepth(s+1+t)}),e.forEach(o=>o.destroy())}setDepth(e,t){e.tilemapLayer.setDepth(t),this.isCharLayer(e)&&this.charLayerDepths.set(this.getLayerProp(e,xe.CHAR_LAYER_PROP_NAME),t)}createHeightShiftLayers(e,t){let i=this.getLayerProp(e,xe.HEIGHT_SHIFT_PROP_NAME);isNaN(i)&&(i=0);let n=1;for(let o=0;o<e.height;o++){let s=this.copyLayer(e,o);s&&(s.scale=e.tilemapLayer.scale,s.setDepth(t+At.shiftPad((o+i)*this.getTileHeight()+n,xe.Z_INDEX_PADDING)))}}getLayerProp(e,t){let n=e.properties.find(o=>o.name==t);return n==null?void 0:n.value}hasLayerProp(e,t){return this.getLayerProp(e,t)!=null}copyLayer(e,t){let i=`${e.name}#${t}`,n=this.tilemap.createBlankLayer(i,e.tilemapLayer.tileset);if(n){n.name=i;for(let o=0;o<e.width;o++)n.putTileAt(e.data[t][o],o,t);return n}}};xe.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",xe.CHAR_LAYER_PROP_NAME="ge_charLayer",xe.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",xe.Z_INDEX_PADDING=7;Ri=xe});function zi(r,e){return Object.entries(r).reduce((t,[i,n])=>typeof n!="object"?e[i]instanceof Set?w({[i]:new Set(n.split(","))},t):w({[i]:n},t):i.startsWith(_i)?w({[i.replace(_i,"")]:zi(n,e)},t):w(w({},zi(n,e)),t),{})}function jc(r){let e=new Map(r.propertyTypes.filter(n=>n.type==="enum").map(n=>[n.name,new Set(n.values)])),t=new Map(r.propertyTypes.filter(n=>n.type==="class").map(n=>[n.name,n.members])),i=new Wc(t,e);return t.forEach((n,o)=>{i.flattenMembers(o,n)}),new qc(i)}var qc,_i,Wc,ou,su=m(()=>{qc=class{constructor(r){this.flattener=r}flattenPropertiesOnObject(r){var e,t,i,n;return De(w(w({},this.flattener.memoisedFlattenedProperties.get((e=r.class)!=null?e:r.type)),(t=r.properties)==null?void 0:t.reduce((o,s)=>w(w({},o),this.flattener.flattenMemberProperty(s)),{})),{name:r.name,id:r.id,class:(n=(i=r.class)!=null?i:r.type)!=null?n:null,x:r.x,y:r.y})}getCustomTypesMap(){return new Map([...this.flattener.memoisedFlattenedProperties.entries()].map(([r,e])=>[r,w({},e)]))}getEnums(){return new Map([...this.flattener.enumNameToValuesMap.entries()].map(([r,e])=>[r,new Set(e)]))}},_i="@composite:",Wc=class{constructor(r,e){this.tiledClassToMembersMap=r,this.enumNameToValuesMap=e,this.memoiser=new Map}flattenMembers(r,e){return this.memoiser.has(r)?{[r]:this.memoiser.get(r)}:(this.memoiser.set(r,e.reduce((t,i)=>w(w({},t),this.flattenMemberProperty(i)),{})),{[r]:this.memoiser.get(r)})}flattenMemberProperty(r){var t;let e=(t=r.propertyType)!=null?t:r.propertytype;if(r.type==="class"){if(!this.memoiser.has(e)){let n=this.tiledClassToMembersMap.get(e).reduce((o,s)=>w(w({},this.flattenMemberProperty(s)),o),{});this.memoiser.set(e,n)}let i=this.memoiser.get(e);return r.name.startsWith(_i)?{[r.name.replace(_i,"")]:w(w({},i),zi(r.value,i))}:w(w({},i),zi(r.value,i))}else return this.enumNameToValuesMap.has(e)?{[r.name]:new Set(r.value.split(","))}:{[r.name]:r.value}}get memoisedFlattenedProperties(){return this.memoiser}};ou={parse:jc}});var lt,Vi=m(()=>{su();lt=class{constructor(e,t){this.phaserTile=e;this.tiledProject=t}getProperty(e){var n,o;let t={};if(this.tiledProject){let s=ou.parse(this.tiledProject),a=this.getType();if(a){let h=(n=s.getCustomTypesMap())==null?void 0:n.get(a);if(h)for(let[u,l]of Object.entries(h))t[u]=l}}return(o=this.phaserTile.properties[e])!=null?o:t[e]}hasProperty(e){return this.getProperty(e)!=null}getType(){var e,t;return(t=(e=this.phaserTile.tileset)==null?void 0:e.tileData[this.phaserTile.index-1])==null?void 0:t.type}}});var Wt,go=m(()=>{Ci();Vi();Wt=class{constructor(e,t){this.phaserTilemapLayer=e;this.tiledProject=t}getName(){return this.phaserTilemapLayer.layer.name}getProperty(e){let t=this.phaserTilemapLayer.layer.properties,i=t==null?void 0:t.find(n=>n.name==e);return i==null?void 0:i.value}hasProperty(e){return this.getProperty(e)!=null}isCharLayer(){return this.hasProperty(cr)}getData(){return this.phaserTilemapLayer.layer.data.map(e=>e.map(t=>new lt(t,this.tiledProject)))}}});var fr,au=m(()=>{Vi();go();fr=class{constructor(e,t){this.phaserTilemap=e;this.tiledProject=t}getTileWidth(){return this.phaserTilemap.tileWidth}getTileHeight(){return this.phaserTilemap.tileHeight}getWidth(){return this.phaserTilemap.width}getHeight(){return this.phaserTilemap.height}getOrientation(){return this.phaserTilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()?"isometric":"orthogonal"}getLayers(){return this.phaserTilemap.layers.map(e=>new Wt(e.tilemapLayer,this.tiledProject))}hasTileAt(e,t,i){return!!this.phaserTilemap.hasTileAt(e,t,i)}getTileAt(e,t,i){let n=this.phaserTilemap.getTileAt(e,t,!1,i);if(n)return new lt(n,this.tiledProject)}}});var Ni,yo,vo,hu=m(()=>{Ni=class{constructor(e,t="orthogonal",i="ge_collide"){this.map=e;this.orientation=t;this.layerMap=new Map;this.layers=[];let n=-1,o=-1;Object.entries(e).map(([s,a])=>{var p;let h=(p=a.data[0])==null?void 0:p.length,u=a.data.length;if(n!==-1&&n!==h||o!==-1&&o!==u)throw new Error("All tilemap layers must have the same dimensions.");n=h,o=u;let l=[];for(let f=0;f<a.data.length;f++){let d=[];for(let y=0;y<a.data[f].length;y++){let P=new vo(a.data[f][y]===1,i);d.push(P)}l.push(d)}let c=new yo(s,l,a.isCharLayer);this.layers.push(c),this.layerMap.set(s,c)})}getWidth(){var e,t;return((t=(e=Object.values(this.map)[0])==null?void 0:e.data[0])==null?void 0:t.length)||0}getHeight(){var e;return((e=Object.values(this.map)[0])==null?void 0:e.data.length)||0}getOrientation(){return this.orientation}getLayers(){return this.layers}hasTileAt(e,t,i){return!i||!this.layerMap.get(i)?!1:e>=0&&e<this.getWidth()&&t>=0&&t<this.getHeight()}getTileAt(e,t,i){if(!i)return;let n=this.layerMap.get(i);if(n)return n.getData()[t][e]}},yo=class{constructor(e,t,i=!1){this.name=e;this.tiles=t;this.isCharLayerInternal=i}getName(){return this.name}getProperty(e){}hasProperty(e){return!1}getData(){return this.tiles}isCharLayer(){return this.isCharLayerInternal}},vo=class{constructor(e,t){this.isBlocking=e;this.collisionPropertyName=t}getProperty(e){return e===this.collisionPropertyName?this.isBlocking:!1}hasProperty(e){return e===this.collisionPropertyName}}});var bo={};yu(bo,{ArrayTilemap:()=>Ni,CharacterShiftAction:()=>Di,CollisionStrategy:()=>er,Direction:()=>pe,GridEngine:()=>jt,GridEngineHeadless:()=>pr,MoveToResult:()=>ki,NoPathFoundStrategy:()=>yt,NumberOfDirections:()=>Qe,PathBlockedStrategy:()=>Mt,PhaserTile:()=>lt,PhaserTileLayer:()=>Wt,PhaserTilemap:()=>fr,QueuedPathBlockedStrategy:()=>co,directionFromPos:()=>ie});var mr,jt,mo=m(()=>{ds();Jr();Pi();Kr();$();tr();ti();Yr();so();ao();Ii();bt();fo();nu();au();Ci();go();Vi();po();lo();hu();mr=class mr{constructor(e){this.scene=e;this.geHeadless=new pr(!1);this.isCreatedInternal=!1;mr.welcomeMessagePrinted||(console.log(`Using GridEngine Phaser Plugin v${wi}`),mr.welcomeMessagePrinted=!0),this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this)}getCharLayer(e){return this.geHeadless.getCharLayer(e)}getTransition(e,t){return this.geHeadless.getTransition(e,t)}setTransition(e,t,i){this.geHeadless.setTransition(e,t,i)}create(e,t){this.geHeadless.create(new fr(e,t.tiledProject),t),this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(t);this.config=i,this.gridTilemap=new Ri(e),this.addCharacters()}getPosition(e){return this.geHeadless.getPosition(e)}move(e,t){this.geHeadless.move(e,t)}moveRandomly(e,t=0,i=-1){this.geHeadless.moveRandomly(e,t,i)}getMovement(e){return this.geHeadless.getMovement(e)}moveTo(e,t,i){return this.geHeadless.moveTo(e,t,i)}stopMovement(e){this.geHeadless.stopMovement(e)}setSpeed(e,t){this.geHeadless.setSpeed(e,t)}getSpeed(e){return this.geHeadless.getSpeed(e)}getContainer(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getContainer()}getOffsetX(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getOffsetX()}setOffsetX(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.setOffsetX(t)}getOffsetY(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getOffsetY()}setOffsetY(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.setOffsetY(t)}collidesWithTiles(e){return this.geHeadless.collidesWithTiles(e)}getWalkingAnimationMapping(e){var n;this.initGuard();let t=(n=this.gridCharacters)==null?void 0:n.get(e);if(!t)throw this.createCharUnknownErr(e);let i=t.getAnimation();return i==null?void 0:i.getWalkingAnimationMapping()}hasLayerOverlay(){var e;return this.initGuard(),!!((e=this.config)!=null&&e.layerOverlay)}setWalkingAnimationMapping(e,t){var o;this.initGuard();let i=(o=this.gridCharacters)==null?void 0:o.get(e);if(!i)throw this.createCharUnknownErr(e);let n=i.getAnimation();n==null||n.setWalkingAnimationMapping(t)}update(e,t){if(this.isCreatedInternal&&this.gridCharacters)for(let[i,n]of this.gridCharacters)n.update(t);this.geHeadless.update(e,t)}addCharacter(e){this.geHeadless.addCharacter(e),this.addCharacterInternal(e)}hasCharacter(e){return this.geHeadless.hasCharacter(e)}removeCharacter(e){var i,n;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);t.destroy(),(n=this.gridCharacters)==null||n.delete(e),this.geHeadless.removeCharacter(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters){for(let e of this.gridCharacters.keys())this.removeCharacter(e);this.geHeadless.removeAllCharacters()}}getAllCharacters(e){return this.geHeadless.getAllCharacters(e)}getLabels(e){return this.geHeadless.getLabels(e)}addLabels(e,t){this.geHeadless.addLabels(e,t)}removeLabels(e,t){this.geHeadless.removeLabels(e,t)}clearLabels(e){this.geHeadless.clearLabels(e)}follow(e,t,i,n){let o;i===void 0?o={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(o={distance:i,closestPointIfBlocked:!1},n&&(o.closestPointIfBlocked=!0)):o=i,this.geHeadless.follow(e,t,o)}isMoving(e){return this.geHeadless.isMoving(e)}getFacingDirection(e){return this.geHeadless.getFacingDirection(e)}getFacingPosition(e){return this.geHeadless.getFacingPosition(e)}turnTowards(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);i.turnTowards(t),this.geHeadless.turnTowards(e,t)}getCharactersAt(e,t){return this.geHeadless.getCharactersAt(e,t)}setPosition(e,t,i){this.geHeadless.setPosition(e,t,i)}getSprite(e){var i;this.initGuard();let t=(i=this.gridCharacters)==null?void 0:i.get(e);if(!t)throw this.createCharUnknownErr(e);return t.getSprite()}setSprite(e,t){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(e);if(!i)throw this.createCharUnknownErr(e);t.setOrigin(0,0),this.setCharSprite(t,i)}isBlocked(e,t,i=["geDefault"]){return this.geHeadless.isBlocked(e,t,i)}isTileBlocked(e,t){return this.geHeadless.isTileBlocked(e,t)}getCollisionGroups(e){return this.geHeadless.getCollisionGroups(e)}setCollisionGroups(e,t){this.geHeadless.setCollisionGroups(e,t)}getTilePosInDirection(e,t,i){return this.geHeadless.getTilePosInDirection(e,t,i)}findShortestPath(e,t,i={}){return this.geHeadless.findShortestPath(e,t,i)}steppedOn(e,t,i){return this.geHeadless.steppedOn(e,t,i)}characterShifted(){return this.geHeadless.characterShifted()}movementStarted(){return this.geHeadless.movementStarted()}movementStopped(){return this.geHeadless.movementStopped()}directionChanged(){return this.geHeadless.directionChanged()}positionChangeStarted(){return this.geHeadless.positionChangeStarted()}positionChangeFinished(){return this.geHeadless.positionChangeFinished()}getMovementProgress(e){return this.geHeadless.getMovementProgress(e)}rebuildTileCollisionCache(e,t,i,n){this.geHeadless.rebuildTileCollisionCache(e,t,i,n)}addQueueMovements(e,t,i){this.geHeadless.addQueueMovements(e,t,i)}getEnqueuedMovements(e){return this.geHeadless.getEnqueuedMovements(e)}queueMovementFinished(){return this.geHeadless.queueMovementFinished()}clearEnqueuedMovements(e){return this.geHeadless.clearEnqueuedMovements(e)}getTileCost(e,t,i){return this.initGuard(),this.geHeadless.getTileCost(e,t,i)}setConfigDefaults(e){return w({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",layerOverlay:!1,cacheTileCollisions:!1},e)}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(t=>this.addCharacterInternal(t))}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}setCharSprite(e,t){t.setSprite(e)}addCharacterInternal(e){var i;if(this.initGuard(),!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let t=new Xr(e,this.scene,this.gridTilemap,this.config.layerOverlay,this.geHeadless);(i=this.gridCharacters)==null||i.set(e.id,t)}};mr.welcomeMessagePrinted=!1;jt=mr});var $c=v((OT,uu)=>{mo();uu.exports=jt;window.GridEngine=jt;window.GridEngineImports=bo});return $c();})();
