(()=>{var Sb=Object.create;var No=Object.defineProperty,Ob=Object.defineProperties,Eb=Object.getOwnPropertyDescriptor,Db=Object.getOwnPropertyDescriptors,Ib=Object.getOwnPropertyNames,bc=Object.getOwnPropertySymbols,Mb=Object.getPrototypeOf,Tc=Object.prototype.hasOwnProperty,Ab=Object.prototype.propertyIsEnumerable;var Pc=(s,e,r)=>e in s?No(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,K=(s,e)=>{for(var r in e||(e={}))Tc.call(e,r)&&Pc(s,r,e[r]);if(bc)for(var r of bc(e))Ab.call(e,r)&&Pc(s,r,e[r]);return s},Bt=(s,e)=>Ob(s,Db(e));var de=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Rb=(s,e)=>{for(var r in e)No(s,r,{get:e[r],enumerable:!0})},Fb=(s,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Ib(e))!Tc.call(s,a)&&a!==r&&No(s,a,{get:()=>e[a],enumerable:!(o=Eb(e,a))||o.enumerable});return s};var jo=(s,e,r)=>(r=s!=null?Sb(Mb(s)):{},Fb(e||!s||!s.__esModule?No(r,"default",{value:s,enumerable:!0}):r,s));var ba=de(Mi=>{var tP=function(s,e){return s<e?-1:s>e?1:0},eP=function(s,e){return s<e?1:s>e?-1:0};function rP(s){return function(e,r){return s(r,e)}}function iP(s){return s===2?function(e,r){return e[0]<r[0]?-1:e[0]>r[0]?1:e[1]<r[1]?-1:e[1]>r[1]?1:0}:function(e,r){for(var o=0;o<s;){if(e[o]<r[o])return-1;if(e[o]>r[o])return 1;o++}return 0}}Mi.DEFAULT_COMPARATOR=tP;Mi.DEFAULT_REVERSE_COMPARATOR=eP;Mi.reverseComparator=rP;Mi.createTupleComparator=iP});var $c=de(Pa=>{Pa.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer!="undefined";Pa.SYMBOL_SUPPORT=typeof Symbol!="undefined"});var Ai=de((AC,Yc)=>{var qc=$c(),oP=qc.ARRAY_BUFFER_SUPPORT,nP=qc.SYMBOL_SUPPORT;Yc.exports=function(e,r){var o,a,u,h,p;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof r!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||oP&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(u=0,h=e.length;u<h;u++)r(e[u],u);return}if(typeof e.forEach=="function"){e.forEach(r);return}if(nP&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(o=e,u=0;p=o.next(),p.done!==!0;)r(p.value,u),u++;return}for(a in e)e.hasOwnProperty(a)&&r(e[a],a)}});var rh=de((RC,eh)=>{var Xc=ba(),Qc=Ai(),Kc=Xc.DEFAULT_COMPARATOR,sP=Xc.reverseComparator;function Et(s){if(this.clear(),this.comparator=s||Kc,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.")}Et.prototype.clear=function(){this.root=null,this.min=null,this.size=0};function aP(s){return{item:s,degree:0}}function Jc(s,e){s.root?(e.right=s.root.right,e.left=s.root,s.root.right.left=e,s.root.right=e):s.root=e}Et.prototype.push=function(s){var e=aP(s);return e.left=e,e.right=e,Jc(this,e),(!this.min||this.comparator(e.item,this.min.item)<=0)&&(this.min=e),++this.size};Et.prototype.peek=function(){return this.min?this.min.item:void 0};function Zc(s){for(var e=[],r=s,o=!1;!(r===s&&o);)r===s&&(o=!0),e.push(r),r=r.right;return e}function th(s,e){s.root===e&&(s.root=e.right),e.left.right=e.right,e.right.left=e.left}function uP(s,e){s.child?(e.right=s.child.right,e.left=s.child,s.child.right.left=e,s.child.right=e):s.child=e}function lP(s,e,r){th(s,e),e.left=e,e.right=e,uP(r,e),r.degree++,e.parent=r}function cP(s){var e=new Array(s.size),r=Zc(s.root),o,a,u,h,p,g;for(o=0,a=r.length;o<a;o++){for(u=r[o],p=u.degree;e[p];)h=e[p],s.comparator(u.item,h.item)>0&&(g=u,u=h,h=g),lP(s,h,u),e[p]=null,p++;e[p]=u}for(o=0;o<s.size;o++)e[o]&&s.comparator(e[o].item,s.min.item)<=0&&(s.min=e[o])}Et.prototype.pop=function(){if(this.size){var s=this.min;if(s.child){var e=Zc(s.child),r,o,a;for(o=0,a=e.length;o<a;o++)r=e[o],Jc(this,r),delete r.parent}return th(this,s),s===s.right?(this.min=null,this.root=null):(this.min=s.right,cP(this)),this.size--,s.item}};Et.prototype.inspect=function(){var s={size:this.size};return this.min&&"item"in this.min&&(s.top=this.min.item),Object.defineProperty(s,"constructor",{value:Et,enumerable:!1}),s};typeof Symbol!="undefined"&&(Et.prototype[Symbol.for("nodejs.util.inspect.custom")]=Et.prototype.inspect);function vn(s){if(this.clear(),this.comparator=s||Kc,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.");this.comparator=sP(this.comparator)}vn.prototype=Et.prototype;Et.from=function(s,e){var r=new Et(e);return Qc(s,function(o){r.push(o)}),r};vn.from=function(s,e){var r=new vn(e);return Qc(s,function(o){r.push(o)}),r};Et.MinFibonacciHeap=Et;Et.MaxFibonacciHeap=vn;eh.exports=Et});var Ta=de(Te=>{var hP=Math.pow(2,8)-1,fP=Math.pow(2,16)-1,pP=Math.pow(2,32)-1,mP=Math.pow(2,7)-1,gP=Math.pow(2,15)-1,dP=Math.pow(2,31)-1;Te.getPointerArray=function(s){var e=s-1;if(e<=hP)return Uint8Array;if(e<=fP)return Uint16Array;if(e<=pP)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};Te.getSignedPointerArray=function(s){var e=s-1;return e<=mP?Int8Array:e<=gP?Int16Array:e<=dP?Int32Array:Float64Array};Te.getNumberType=function(s){return s===(s|0)?Math.sign(s)===-1?s<=127&&s>=-128?Int8Array:s<=32767&&s>=-32768?Int16Array:Int32Array:s<=255?Uint8Array:s<=65535?Uint16Array:Uint32Array:Float64Array};var yP={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};Te.getMinimalRepresentation=function(s,e){var r=null,o=0,a,u,h,p,g;for(p=0,g=s.length;p<g;p++)h=e?e(s[p]):s[p],u=Te.getNumberType(h),a=yP[u.name],a>o&&(o=a,r=u);return r};Te.isTypedArray=function(s){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView(s)};Te.concat=function(){var s=0,e,r,o;for(e=0,o=arguments.length;e<o;e++)s+=arguments[e].length;var a=new arguments[0].constructor(s);for(e=0,r=0;e<o;e++)a.set(arguments[e],r),r+=arguments[e].length;return a};Te.indices=function(s){for(var e=Te.getPointerArray(s),r=new e(s),o=0;o<s;o++)r[o]=o;return r}});var wa=de(Ri=>{var ih=Ai(),oh=Ta();function vP(s){return Array.isArray(s)||oh.isTypedArray(s)}function xa(s){if(typeof s.length=="number")return s.length;if(typeof s.size=="number")return s.size}function bP(s){var e=xa(s),r=typeof e=="number"?new Array(e):[],o=0;return ih(s,function(a){r[o++]=a}),r}function PP(s){var e=xa(s),r=typeof e=="number"?oh.getPointerArray(e):Array,o=typeof e=="number"?new Array(e):[],a=typeof e=="number"?new r(e):[],u=0;return ih(s,function(h){o[u]=h,a[u]=u++}),[o,a]}Ri.isArrayLike=vP;Ri.guessLength=xa;Ri.toArray=bP;Ri.toArrayWithIndices=PP});var lh=de((VC,uh)=>{var bn=Ai(),nh=ba(),xe=wa(),Tn=nh.DEFAULT_COMPARATOR,Ca=nh.reverseComparator;function _a(s,e,r,o){for(var a=e[o],u,h;o>r;){if(u=o-1>>1,h=e[u],s(a,h)<0){e[o]=h,o=u;continue}break}e[o]=a}function Fi(s,e,r){for(var o=e.length,a=r,u=e[r],h=2*r+1,p;h<o;)p=h+1,p<o&&s(e[h],e[p])>=0&&(h=p),e[r]=e[h],r=h,h=2*r+1;e[r]=u,_a(s,e,a,r)}function sh(s,e,r){e.push(r),_a(s,e,0,e.length-1)}function La(s,e){var r=e.pop();if(e.length!==0){var o=e[0];return e[0]=r,Fi(s,e,0),o}return r}function zr(s,e,r){if(e.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var o=e[0];return e[0]=r,Fi(s,e,0),o}function ah(s,e,r){var o;return e.length!==0&&s(e[0],r)<0&&(o=e[0],e[0]=r,r=o,Fi(s,e,0)),r}function Tr(s,e){for(var r=e.length,o=r>>1,a=o;--a>=0;)Fi(s,e,a)}function Sa(s,e){for(var r=e.length,o=0,a=new Array(r);o<r;)a[o++]=La(s,e);return a}function TP(s,e,r){arguments.length===2&&(r=e,e=s,s=Tn);var o=Ca(s),a,u,h,p=1/0,g;if(e===1){if(xe.isArrayLike(r)){for(a=0,u=r.length;a<u;a++)h=r[a],(p===1/0||s(h,p)<0)&&(p=h);return g=new r.constructor(1),g[0]=p,g}return bn(r,function(L){(p===1/0||s(L,p)<0)&&(p=L)}),[p]}if(xe.isArrayLike(r)){if(e>=r.length)return r.slice().sort(s);for(g=r.slice(0,e),Tr(o,g),a=e,u=r.length;a<u;a++)o(r[a],g[0])>0&&zr(o,g,r[a]);return g.sort(s)}var T=xe.guessLength(r);return T!==null&&T<e&&(e=T),g=new Array(e),a=0,bn(r,function(L){a<e?g[a]=L:(a===e&&Tr(o,g),o(L,g[0])>0&&zr(o,g,L)),a++}),g.length>a&&(g.length=a),g.sort(s)}function xP(s,e,r){arguments.length===2&&(r=e,e=s,s=Tn);var o=Ca(s),a,u,h,p=-1/0,g;if(e===1){if(xe.isArrayLike(r)){for(a=0,u=r.length;a<u;a++)h=r[a],(p===-1/0||s(h,p)>0)&&(p=h);return g=new r.constructor(1),g[0]=p,g}return bn(r,function(L){(p===-1/0||s(L,p)>0)&&(p=L)}),[p]}if(xe.isArrayLike(r)){if(e>=r.length)return r.slice().sort(o);for(g=r.slice(0,e),Tr(s,g),a=e,u=r.length;a<u;a++)s(r[a],g[0])>0&&zr(s,g,r[a]);return g.sort(o)}var T=xe.guessLength(r);return T!==null&&T<e&&(e=T),g=new Array(e),a=0,bn(r,function(L){a<e?g[a]=L:(a===e&&Tr(s,g),s(L,g[0])>0&&zr(s,g,L)),a++}),g.length>a&&(g.length=a),g.sort(o)}function et(s){if(this.clear(),this.comparator=s||Tn,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}et.prototype.clear=function(){this.items=[],this.size=0};et.prototype.push=function(s){return sh(this.comparator,this.items,s),++this.size};et.prototype.peek=function(){return this.items[0]};et.prototype.pop=function(){return this.size!==0&&this.size--,La(this.comparator,this.items)};et.prototype.replace=function(s){return zr(this.comparator,this.items,s)};et.prototype.pushpop=function(s){return ah(this.comparator,this.items,s)};et.prototype.consume=function(){return this.size=0,Sa(this.comparator,this.items)};et.prototype.toArray=function(){return Sa(this.comparator,this.items.slice())};et.prototype.inspect=function(){var s=this.toArray();return Object.defineProperty(s,"constructor",{value:et,enumerable:!1}),s};typeof Symbol!="undefined"&&(et.prototype[Symbol.for("nodejs.util.inspect.custom")]=et.prototype.inspect);function Pn(s){if(this.clear(),this.comparator=s||Tn,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=Ca(this.comparator)}Pn.prototype=et.prototype;et.from=function(s,e){var r=new et(e),o;return xe.isArrayLike(s)?o=s.slice():o=xe.toArray(s),Tr(r.comparator,o),r.items=o,r.size=o.length,r};Pn.from=function(s,e){var r=new Pn(e),o;return xe.isArrayLike(s)?o=s.slice():o=xe.toArray(s),Tr(r.comparator,o),r.items=o,r.size=o.length,r};et.siftUp=Fi;et.siftDown=_a;et.push=sh;et.pop=La;et.replace=zr;et.pushpop=ah;et.heapify=Tr;et.consume=Sa;et.nsmallest=TP;et.nlargest=xP;et.MinHeap=et;et.MaxHeap=Pn;uh.exports=et});var mh=de((GC,ph)=>{var ch="";function hh(s,e,r){for(var o=e.length,a=[],u=o,h=-1,p,g=0,T;u--;)h=Math.max(s[e[u]+r],h);for(T=h>>24&&32||h>>16&&24||h>>8&&16||8;g<T;g+=4){for(u=16;u--;)a[u]=[];for(u=o;u--;)a[s[e[u]+r]>>g&15].push(e[u]);for(p=0;p<16;p++)for(h=a[p].length;h--;)e[++u]=a[p][h]}}function wP(s,e,r,o){return s[r]-s[o]||(r%3===2?s[r+1]-s[o+1]||e[r+2]-e[o+2]:e[r+1]-e[o+1])}function Oa(s,e){var r=[],o=[],a=2*e/3|0,u=e-a,h=a+1>>1,p=a,g=0,T,L=[],D=[];if(e===1)return[0];for(;p--;)r[p]=(p*3>>1)+1;for(p=3;p--;)hh(s,r,p);for(g=o[(r[0]/3|0)+(r[0]%3===1?0:h)]=1,p=1;p<a;p++)(s[r[p]]!==s[r[p-1]]||s[r[p]+1]!==s[r[p-1]+1]||s[r[p]+2]!==s[r[p-1]+2])&&g++,o[(r[p]/3|0)+(r[p]%3===1?0:h)]=g;if(g<a)for(o=Oa(o,a),p=a;p--;)r[p]=o[p]<h?o[p]*3+1:(o[p]-h)*3+2;for(p=a;p--;)L[r[p]]=p;for(L[e]=-1,L[e+1]=-2,o=e%3===1?[e-1]:[],p=0;p<a;p++)r[p]%3===1&&o.push(r[p]-1);for(hh(s,o,0),p=0,g=0,T=0;p<a&&g<u;)D[T++]=wP(s,L,r[p],o[g])<0?r[p++]:o[g++];for(;p<a;)D[T++]=r[p++];for(;g<u;)D[T++]=o[g++];return D}function fh(s){var e=s.length,r=e%3,o=new Array(e+r),a,u;if(typeof s!="string"){var h=Object.create(null);for(u=0;u<e;u++)h[s[u]]||(h[s[u]]=!0);var p=Object.create(null),g=Object.keys(h).sort();for(u=0,a=g.length;u<a;u++)p[g[u]]=u+1;for(u=0;u<e;u++)o[u]=p[s[u]]}else for(u=0;u<e;u++)o[u]=s.charCodeAt(u);for(u=e;u<e+r;u++)o[u]=0;return o}function Je(s){this.hasArbitrarySequence=typeof s!="string",this.string=s,this.length=s.length,this.array=Oa(fh(s),this.length)}Je.prototype.toString=function(){return this.array.join(",")};Je.prototype.toJSON=function(){return this.array};Je.prototype.inspect=function(){for(var s=new Array(this.length),e=0;e<this.length;e++)s[e]=this.string.slice(this.array[e]);return Object.defineProperty(s,"constructor",{value:Je,enumerable:!1}),s};typeof Symbol!="undefined"&&(Je.prototype[Symbol.for("nodejs.util.inspect.custom")]=Je.prototype.inspect);function Ze(s){if(this.hasArbitrarySequence=typeof s[0]!="string",this.size=s.length,this.hasArbitrarySequence){this.text=[];for(var e=0,r=this.size;e<r;e++)this.text.push.apply(this.text,s[e]),e<r-1&&this.text.push(ch)}else this.text=s.join(ch);this.firstLength=s[0].length,this.length=this.text.length,this.array=Oa(fh(this.text),this.length)}Ze.prototype.longestCommonSubsequence=function(){var s=this.hasArbitrarySequence?[]:"",e,r,o,a,u;for(r=1;r<this.length;r++)if(a=this.array[r],u=this.array[r-1],!(a<this.firstLength&&u<this.firstLength)&&!(a>this.firstLength&&u>this.firstLength)){for(e=Math.min(this.length-a,this.length-u),o=0;o<e;o++)if(this.text[a+o]!==this.text[u+o]){e=o;break}e>s.length&&(s=this.text.slice(a,a+e))}return s};Ze.prototype.toString=function(){return this.array.join(",")};Ze.prototype.toJSON=function(){return this.array};Ze.prototype.inspect=function(){for(var s=new Array(this.length),e=0;e<this.length;e++)s[e]=this.text.slice(this.array[e]);return Object.defineProperty(s,"constructor",{value:Ze,enumerable:!1}),s};typeof Symbol!="undefined"&&(Ze.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ze.prototype.inspect);Je.GeneralizedSuffixArray=Ze;ph.exports=Je});var dh=de((NC,gh)=>{function we(s){if(typeof s!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=s}typeof Symbol!="undefined"&&(we.prototype[Symbol.iterator]=function(){return this});we.of=function(){var s=arguments,e=s.length,r=0;return new we(function(){return r>=e?{done:!0}:{done:!1,value:s[r++]}})};we.empty=function(){var s=new we(function(){return{done:!0}});return s};we.fromSequence=function(s){var e=0,r=s.length;return new we(function(){return e>=r?{done:!0}:{done:!1,value:s[e++]}})};we.is=function(s){return s instanceof we?!0:typeof s=="object"&&s!==null&&typeof s.next=="function"};gh.exports=we});var Ph=de((jC,bh)=>{var yh=dh(),CP=Ai(),_P=wa(),vh=Ta(),LP=function(s){return Math.max(1,Math.ceil(s*1.5))},SP=function(s){var e=vh.getPointerArray(s);return new e(s)};function q(s,e){if(arguments.length<1)throw new Error("mnemonist/vector: expecting at least a byte array constructor.");var r=e||0,o=LP,a=0,u=!1;typeof e=="object"&&(r=e.initialCapacity||0,a=e.initialLength||0,o=e.policy||o,u=e.factory===!0),this.factory=u?s:null,this.ArrayClass=s,this.length=a,this.capacity=Math.max(a,r),this.policy=o,this.array=new s(this.capacity)}q.prototype.set=function(s,e){if(this.length<s)throw new Error("Vector("+this.ArrayClass.name+").set: index out of bounds.");return this.array[s]=e,this};q.prototype.get=function(s){if(!(this.length<s))return this.array[s]};q.prototype.applyPolicy=function(s){var e=this.policy(s||this.capacity);if(typeof e!="number"||e<0)throw new Error("mnemonist/vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(e<=this.capacity)throw new Error("mnemonist/vector.applyPolicy: policy returned a less or equal capacity to allocate.");return e};q.prototype.reallocate=function(s){if(s===this.capacity)return this;var e=this.array;if(s<this.length&&(this.length=s),s>this.capacity)if(this.factory===null?this.array=new this.ArrayClass(s):this.array=this.factory(s),vh.isTypedArray(this.array))this.array.set(e,0);else for(var r=0,o=this.length;r<o;r++)this.array[r]=e[r];else this.array=e.slice(0,s);return this.capacity=s,this};q.prototype.grow=function(s){var e;if(typeof s=="number"){if(this.capacity>=s)return this;for(e=this.capacity;e<s;)e=this.applyPolicy(e);return this.reallocate(e),this}return e=this.applyPolicy(),this.reallocate(e),this};q.prototype.resize=function(s){return s===this.length?this:s<this.length?(this.length=s,this):(this.length=s,this.reallocate(s),this)};q.prototype.push=function(s){return this.capacity===this.length&&this.grow(),this.array[this.length++]=s,this.length};q.prototype.pop=function(){if(this.length!==0)return this.array[--this.length]};q.prototype.values=function(){var s=this.array,e=this.length,r=0;return new yh(function(){if(r>=e)return{done:!0};var o=s[r];return r++,{value:o,done:!1}})};q.prototype.entries=function(){var s=this.array,e=this.length,r=0;return new yh(function(){if(r>=e)return{done:!0};var o=s[r];return{value:[r++,o],done:!1}})};typeof Symbol!="undefined"&&(q.prototype[Symbol.iterator]=q.prototype.values);q.prototype.inspect=function(){var s=this.array.slice(0,this.length);return s.type=this.array.constructor.name,s.items=this.length,s.capacity=this.capacity,Object.defineProperty(s,"constructor",{value:q,enumerable:!1}),s};typeof Symbol!="undefined"&&(q.prototype[Symbol.for("nodejs.util.inspect.custom")]=q.prototype.inspect);q.from=function(s,e,r){if(arguments.length<3&&(r=_P.guessLength(s),typeof r!="number"))throw new Error("mnemonist/vector.from: could not guess iterable length. Please provide desired capacity as last argument.");var o=new q(e,r);return CP(s,function(a){o.push(a)}),o};function Ce(s){var e=function(o){q.call(this,s,o)};for(var r in q.prototype)q.prototype.hasOwnProperty(r)&&(e.prototype[r]=q.prototype[r]);return e.from=function(o,a){return q.from(o,s,a)},typeof Symbol!="undefined"&&(e.prototype[Symbol.iterator]=e.prototype.values),e}q.Int8Vector=Ce(Int8Array);q.Uint8Vector=Ce(Uint8Array);q.Uint8ClampedVector=Ce(Uint8ClampedArray);q.Int16Vector=Ce(Int16Array);q.Uint16Vector=Ce(Uint16Array);q.Int32Vector=Ce(Int32Array);q.Uint32Vector=Ce(Uint32Array);q.Float32Vector=Ce(Float32Array);q.Float64Vector=Ce(Float64Array);q.PointerVector=Ce(SP);bh.exports=q});var ja={};Rb(ja,{ArrayTilemap:()=>Nn,CharacterShiftAction:()=>Rn,CollisionStrategy:()=>Di,Direction:()=>Ot,GridEngine:()=>Wi,GridEngineHeadless:()=>ji,MoveToResult:()=>kn,NoPathFoundStrategy:()=>Pr,NumberOfDirections:()=>mr,PathBlockedStrategy:()=>Wr,PhaserTile:()=>er,PhaserTileLayer:()=>Kr,PhaserTilemap:()=>Bi,QueuedPathBlockedStrategy:()=>Ra,TiledLayer:()=>Zr,TiledTile:()=>Jr,TiledTilemap:()=>jn,directionFromPos:()=>vt});var P=class s{static get ZERO(){return new s(0,0)}static get ONE(){return new s(1,1)}static get UP(){return new s(0,-1)}static get DOWN(){return new s(0,1)}static get LEFT(){return new s(-1,0)}static get RIGHT(){return new s(1,0)}static get UP_LEFT(){return new s(-1,-1)}static get UP_RIGHT(){return new s(1,-1)}static get DOWN_RIGHT(){return new s(1,1)}static get DOWN_LEFT(){return new s(-1,1)}constructor(e,r){typeof e=="number"?(this.x=e,this.y=r||0):(this.x=e.x,this.y=e.y)}clone(){return new s(this.x,this.y)}add(e){return new s(this.x+e.x,this.y+e.y)}multiply(e){return new s(this.x*e.x,this.y*e.y)}divide(e){return new s(this.x/e.x,this.y/e.y)}subtract(e){return new s(this.x-e.x,this.y-e.y)}equals(e){return this.x===e.x&&this.y===e.y}abs(){return new s(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}modulo(e){return new s(this.x%e.x,this.y%e.y)}scalarModulo(e){return new s(this.x%e,this.y%e)}scalarMult(e){return new s(this.x*e,this.y*e)}toPosition(){return{x:this.x,y:this.y}}toString(){return`${this.x}#${this.y}`}};var A=class{static equal(e,r){return e.position.x===r.position.x&&e.position.y===r.position.y&&e.layer===r.layer}static copyOver(e,r){r.position.x=e.position.x,r.position.y=e.position.y,r.layer=e.layer}static clone(e){return{position:e.position.clone(),layer:e.layer}}static toString(e){return`${e.position.toString()}#${e.layer}`}static toInternal(e){return{position:new P(e.position.x,e.position.y),layer:e.charLayer}}static fromInternal(e){return{position:e.position.toPosition(),charLayer:e.layer}}};var Ot=(T=>(T.NONE="none",T.LEFT="left",T.UP_LEFT="up-left",T.UP="up",T.UP_RIGHT="up-right",T.RIGHT="right",T.DOWN_RIGHT="down-right",T.DOWN="down",T.DOWN_LEFT="down-left",T))(Ot||{}),kb={up:"down",down:"up",left:"right",right:"left",none:"none","up-left":"down-right","up-right":"down-left","down-right":"up-left","down-left":"up-right"},Vb={up:P.UP,down:P.DOWN,left:P.LEFT,right:P.RIGHT,none:P.ZERO,"up-left":P.UP_LEFT,"up-right":P.UP_RIGHT,"down-right":P.DOWN_RIGHT,"down-left":P.DOWN_LEFT},wi={up:0,"up-right":1,right:2,"down-right":3,down:4,"down-left":5,left:6,"up-left":7,none:NaN},xc=["up","up-right","right","down-right","down","down-left","left","up-left"],Gb=["down-left","down-right","up-right","up-left"];function Ci(){return["up","down","left","right","none","up-left","up-right","down-right","down-left"]}function pr(s){return Gb.includes(s)}function wc(s,e=1){return s==="none"?"none":xc[(wi[s]+8-Math.abs(e)%8)%8]}function Uo(s,e=1){return s==="none"?"none":xc[(wi[s]+e)%8]}function Ht(s){return Vb[s]}function _i(s){return kb[s]}function vt(s,e){if(s.x===e.x){if(s.y>e.y)return"up";if(s.y<e.y)return"down"}else if(s.y===e.y){if(s.x>e.x)return"left";if(s.x<e.x)return"right"}else if(s.x>e.x){if(s.y<e.y)return"down-left";if(s.y>e.y)return"up-left"}else if(s.x<e.x){if(s.y<e.y)return"down-right";if(s.y>e.y)return"up-right"}return"none"}var mr=(r=>(r[r.FOUR=4]="FOUR",r[r.EIGHT=8]="EIGHT",r))(mr||{});function Qe(s){return typeof s=="string"&&Ci().includes(s)}var la=function(s,e){return la=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])},la(s,e)};function Ke(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");la(s,e);function r(){this.constructor=s}s.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Cc(s,e,r,o){function a(u){return u instanceof r?u:new r(function(h){h(u)})}return new(r||(r=Promise))(function(u,h){function p(L){try{T(o.next(L))}catch(D){h(D)}}function g(L){try{T(o.throw(L))}catch(D){h(D)}}function T(L){L.done?u(L.value):a(L.value).then(p,g)}T((o=o.apply(s,e||[])).next())})}function Bo(s,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},o,a,u,h=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return h.next=p(0),h.throw=p(1),h.return=p(2),typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(T){return function(L){return g([T,L])}}function g(T){if(o)throw new TypeError("Generator is already executing.");for(;h&&(h=0,T[0]&&(r=0)),r;)try{if(o=1,a&&(u=T[0]&2?a.return:T[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,T[1])).done)return u;switch(a=0,u&&(T=[T[0]&2,u.value]),T[0]){case 0:case 1:u=T;break;case 4:return r.label++,{value:T[1],done:!1};case 5:r.label++,a=T[1],T=[0];continue;case 7:T=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){r=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){r.label=T[1];break}if(T[0]===6&&r.label<u[1]){r.label=u[1],u=T;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(T);break}u[2]&&r.ops.pop(),r.trys.pop();continue}T=e.call(s,r)}catch(L){T=[6,L],a=0}finally{o=u=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}}function ke(s){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&s[e],o=0;if(r)return r.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&o>=s.length&&(s=void 0),{value:s&&s[o++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ye(s,e){var r=typeof Symbol=="function"&&s[Symbol.iterator];if(!r)return s;var o=r.call(s),a,u=[],h;try{for(;(e===void 0||e-- >0)&&!(a=o.next()).done;)u.push(a.value)}catch(p){h={error:p}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(h)throw h.error}}return u}function ve(s,e,r){if(r||arguments.length===2)for(var o=0,a=e.length,u;o<a;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return s.concat(u||Array.prototype.slice.call(e))}function gr(s){return this instanceof gr?(this.v=s,this):new gr(s)}function _c(s,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=r.apply(s,e||[]),a,u=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),p("next"),p("throw"),p("return",h),a[Symbol.asyncIterator]=function(){return this},a;function h(M){return function(H){return Promise.resolve(H).then(M,D)}}function p(M,H){o[M]&&(a[M]=function(B){return new Promise(function(st,ft){u.push([M,B,st,ft])>1||g(M,B)})},H&&(a[M]=H(a[M])))}function g(M,H){try{T(o[M](H))}catch(B){Y(u[0][3],B)}}function T(M){M.value instanceof gr?Promise.resolve(M.value.v).then(L,D):Y(u[0][2],M)}function L(M){g("next",M)}function D(M){g("throw",M)}function Y(M,H){M(H),u.shift(),u.length&&g(u[0][0],u[0][1])}}function Lc(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],r;return e?e.call(s):(s=typeof ke=="function"?ke(s):s[Symbol.iterator](),r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r);function o(u){r[u]=s[u]&&function(h){return new Promise(function(p,g){h=s[u](h),a(p,g,h.done,h.value)})}}function a(u,h,p,g){Promise.resolve(g).then(function(T){u({value:T,done:p})},h)}}function X(s){return typeof s=="function"}function Ho(s){var e=function(o){Error.call(o),o.stack=new Error().stack},r=s(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Wo=Ho(function(s){return function(r){s(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(o,a){return a+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Li(s,e){if(s){var r=s.indexOf(e);0<=r&&s.splice(r,1)}}var jr=(function(){function s(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return s.prototype.unsubscribe=function(){var e,r,o,a,u;if(!this.closed){this.closed=!0;var h=this._parentage;if(h)if(this._parentage=null,Array.isArray(h))try{for(var p=ke(h),g=p.next();!g.done;g=p.next()){var T=g.value;T.remove(this)}}catch(B){e={error:B}}finally{try{g&&!g.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}else h.remove(this);var L=this.initialTeardown;if(X(L))try{L()}catch(B){u=B instanceof Wo?B.errors:[B]}var D=this._finalizers;if(D){this._finalizers=null;try{for(var Y=ke(D),M=Y.next();!M.done;M=Y.next()){var H=M.value;try{Sc(H)}catch(B){u=u!=null?u:[],B instanceof Wo?u=ve(ve([],ye(u)),ye(B.errors)):u.push(B)}}}catch(B){o={error:B}}finally{try{M&&!M.done&&(a=Y.return)&&a.call(Y)}finally{if(o)throw o.error}}}if(u)throw new Wo(u)}},s.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)Sc(e);else{if(e instanceof s){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},s.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},s.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},s.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&Li(r,e)},s.prototype.remove=function(e){var r=this._finalizers;r&&Li(r,e),e instanceof s&&e._removeParent(this)},s.EMPTY=(function(){var e=new s;return e.closed=!0,e})(),s})();var ca=jr.EMPTY;function zo(s){return s instanceof jr||s&&"closed"in s&&X(s.remove)&&X(s.add)&&X(s.unsubscribe)}function Sc(s){X(s)?s():s.unsubscribe()}var ae={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ur={setTimeout:function(s,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var a=Ur.delegate;return a!=null&&a.setTimeout?a.setTimeout.apply(a,ve([s,e],ye(r))):setTimeout.apply(void 0,ve([s,e],ye(r)))},clearTimeout:function(s){var e=Ur.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(s)},delegate:void 0};function $o(s){Ur.setTimeout(function(){var e=ae.onUnhandledError;if(e)e(s);else throw s})}function Si(){}var Oc=(function(){return ha("C",void 0,void 0)})();function Ec(s){return ha("E",void 0,s)}function Dc(s){return ha("N",s,void 0)}function ha(s,e,r){return{kind:s,value:e,error:r}}var dr=null;function Br(s){if(ae.useDeprecatedSynchronousErrorHandling){var e=!dr;if(e&&(dr={errorThrown:!1,error:null}),s(),e){var r=dr,o=r.errorThrown,a=r.error;if(dr=null,o)throw a}}else s()}function Ic(s){ae.useDeprecatedSynchronousErrorHandling&&dr&&(dr.errorThrown=!0,dr.error=s)}var Oi=(function(s){Ke(e,s);function e(r){var o=s.call(this)||this;return o.isStopped=!1,r?(o.destination=r,zo(r)&&r.add(o)):o.destination=Bb,o}return e.create=function(r,o,a){return new Yo(r,o,a)},e.prototype.next=function(r){this.isStopped?pa(Dc(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?pa(Ec(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?pa(Oc,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,s.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(jr);var Nb=Function.prototype.bind;function fa(s,e){return Nb.call(s,e)}var jb=(function(){function s(e){this.partialObserver=e}return s.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(o){qo(o)}},s.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(o){qo(o)}else qo(e)},s.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){qo(r)}},s})(),Yo=(function(s){Ke(e,s);function e(r,o,a){var u=s.call(this)||this,h;if(X(r)||!r)h={next:r!=null?r:void 0,error:o!=null?o:void 0,complete:a!=null?a:void 0};else{var p;u&&ae.useDeprecatedNextContext?(p=Object.create(r),p.unsubscribe=function(){return u.unsubscribe()},h={next:r.next&&fa(r.next,p),error:r.error&&fa(r.error,p),complete:r.complete&&fa(r.complete,p)}):h=r}return u.destination=new jb(h),u}return e})(Oi);function qo(s){ae.useDeprecatedSynchronousErrorHandling?Ic(s):$o(s)}function Ub(s){throw s}function pa(s,e){var r=ae.onStoppedNotification;r&&Ur.setTimeout(function(){return r(s,e)})}var Bb={closed:!0,next:Si,error:Ub,complete:Si};var Hr=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Xo(s){return s}function ma(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return ga(s)}function ga(s){return s.length===0?Xo:s.length===1?s[0]:function(r){return s.reduce(function(o,a){return a(o)},r)}}var bt=(function(){function s(e){e&&(this._subscribe=e)}return s.prototype.lift=function(e){var r=new s;return r.source=this,r.operator=e,r},s.prototype.subscribe=function(e,r,o){var a=this,u=Wb(e)?e:new Yo(e,r,o);return Br(function(){var h=a,p=h.operator,g=h.source;u.add(p?p.call(u,g):g?a._subscribe(u):a._trySubscribe(u))}),u},s.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},s.prototype.forEach=function(e,r){var o=this;return r=Mc(r),new r(function(a,u){var h=new Yo({next:function(p){try{e(p)}catch(g){u(g),h.unsubscribe()}},error:u,complete:a});o.subscribe(h)})},s.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},s.prototype[Hr]=function(){return this},s.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return ga(e)(this)},s.prototype.toPromise=function(e){var r=this;return e=Mc(e),new e(function(o,a){var u;r.subscribe(function(h){return u=h},function(h){return a(h)},function(){return o(u)})})},s.create=function(e){return new s(e)},s})();function Mc(s){var e;return(e=s!=null?s:ae.Promise)!==null&&e!==void 0?e:Promise}function Hb(s){return s&&X(s.next)&&X(s.error)&&X(s.complete)}function Wb(s){return s&&s instanceof Oi||Hb(s)&&zo(s)}function zb(s){return X(s==null?void 0:s.lift)}function Ct(s){return function(e){if(zb(e))return e.lift(function(r){try{return s(r,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Wt(s,e,r,o,a){return new $b(s,e,r,o,a)}var $b=(function(s){Ke(e,s);function e(r,o,a,u,h,p){var g=s.call(this,r)||this;return g.onFinalize=h,g.shouldUnsubscribe=p,g._next=o?function(T){try{o(T)}catch(L){r.error(L)}}:s.prototype._next,g._error=u?function(T){try{u(T)}catch(L){r.error(L)}finally{this.unsubscribe()}}:s.prototype._error,g._complete=a?function(){try{a()}catch(T){r.error(T)}finally{this.unsubscribe()}}:s.prototype._complete,g}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;s.prototype.unsubscribe.call(this),!o&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e})(Oi);var Ac=Ho(function(s){return function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var J=(function(s){Ke(e,s);function e(){var r=s.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var o=new Rc(this,this);return o.operator=r,o},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ac},e.prototype.next=function(r){var o=this;Br(function(){var a,u;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var h=ke(o.currentObservers),p=h.next();!p.done;p=h.next()){var g=p.value;g.next(r)}}catch(T){a={error:T}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(a)throw a.error}}}})},e.prototype.error=function(r){var o=this;Br(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=r;for(var a=o.observers;a.length;)a.shift().error(r)}})},e.prototype.complete=function(){var r=this;Br(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var o=r.observers;o.length;)o.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),s.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var o=this,a=this,u=a.hasError,h=a.isStopped,p=a.observers;return u||h?ca:(this.currentObservers=null,p.push(r),new jr(function(){o.currentObservers=null,Li(p,r)}))},e.prototype._checkFinalizedStatuses=function(r){var o=this,a=o.hasError,u=o.thrownError,h=o.isStopped;a?r.error(u):h&&r.complete()},e.prototype.asObservable=function(){var r=new bt;return r.source=this,r},e.create=function(r,o){return new Rc(r,o)},e})(bt);var Rc=(function(s){Ke(e,s);function e(r,o){var a=s.call(this)||this;return a.destination=r,a.source=o,a}return e.prototype.next=function(r){var o,a;(a=(o=this.destination)===null||o===void 0?void 0:o.next)===null||a===void 0||a.call(o,r)},e.prototype.error=function(r){var o,a;(a=(o=this.destination)===null||o===void 0?void 0:o.error)===null||a===void 0||a.call(o,r)},e.prototype.complete=function(){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||o===void 0||o.call(r)},e.prototype._subscribe=function(r){var o,a;return(a=(o=this.source)===null||o===void 0?void 0:o.subscribe(r))!==null&&a!==void 0?a:ca},e})(J);var Qo=new bt(function(s){return s.complete()});function Fc(s){return s&&X(s.schedule)}function kc(s){return s[s.length-1]}function Ko(s){return Fc(kc(s))?s.pop():void 0}function Jo(s,e){return typeof kc(s)=="number"?s.pop():e}var Zo=(function(s){return s&&typeof s.length=="number"&&typeof s!="function"});function tn(s){return X(s==null?void 0:s.then)}function en(s){return X(s[Hr])}function rn(s){return Symbol.asyncIterator&&X(s==null?void 0:s[Symbol.asyncIterator])}function on(s){return new TypeError("You provided "+(s!==null&&typeof s=="object"?"an invalid object":"'"+s+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function qb(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var nn=qb();function sn(s){return X(s==null?void 0:s[nn])}function an(s){return _c(this,arguments,function(){var r,o,a,u;return Bo(this,function(h){switch(h.label){case 0:r=s.getReader(),h.label=1;case 1:h.trys.push([1,,9,10]),h.label=2;case 2:return[4,gr(r.read())];case 3:return o=h.sent(),a=o.value,u=o.done,u?[4,gr(void 0)]:[3,5];case 4:return[2,h.sent()];case 5:return[4,gr(a)];case 6:return[4,h.sent()];case 7:return h.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function un(s){return X(s==null?void 0:s.getReader)}function Rt(s){if(s instanceof bt)return s;if(s!=null){if(en(s))return Yb(s);if(Zo(s))return Xb(s);if(tn(s))return Qb(s);if(rn(s))return Vc(s);if(sn(s))return Kb(s);if(un(s))return Jb(s)}throw on(s)}function Yb(s){return new bt(function(e){var r=s[Hr]();if(X(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Xb(s){return new bt(function(e){for(var r=0;r<s.length&&!e.closed;r++)e.next(s[r]);e.complete()})}function Qb(s){return new bt(function(e){s.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,$o)})}function Kb(s){return new bt(function(e){var r,o;try{for(var a=ke(s),u=a.next();!u.done;u=a.next()){var h=u.value;if(e.next(h),e.closed)return}}catch(p){r={error:p}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}e.complete()})}function Vc(s){return new bt(function(e){Zb(s,e).catch(function(r){return e.error(r)})})}function Jb(s){return Vc(an(s))}function Zb(s,e){var r,o,a,u;return Cc(this,void 0,void 0,function(){var h,p;return Bo(this,function(g){switch(g.label){case 0:g.trys.push([0,5,6,11]),r=Lc(s),g.label=1;case 1:return[4,r.next()];case 2:if(o=g.sent(),!!o.done)return[3,4];if(h=o.value,e.next(h),e.closed)return[2];g.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return p=g.sent(),a={error:p},[3,11];case 6:return g.trys.push([6,,9,10]),o&&!o.done&&(u=r.return)?[4,u.call(r)]:[3,8];case 7:g.sent(),g.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Zt(s,e,r,o,a){o===void 0&&(o=0),a===void 0&&(a=!1);var u=e.schedule(function(){r(),a?s.add(this.schedule(null,o)):this.unsubscribe()},o);if(s.add(u),!a)return u}function ln(s,e){return e===void 0&&(e=0),Ct(function(r,o){r.subscribe(Wt(o,function(a){return Zt(o,s,function(){return o.next(a)},e)},function(){return Zt(o,s,function(){return o.complete()},e)},function(a){return Zt(o,s,function(){return o.error(a)},e)}))})}function cn(s,e){return e===void 0&&(e=0),Ct(function(r,o){o.add(s.schedule(function(){return r.subscribe(o)},e))})}function Gc(s,e){return Rt(s).pipe(cn(e),ln(e))}function Nc(s,e){return Rt(s).pipe(cn(e),ln(e))}function jc(s,e){return new bt(function(r){var o=0;return e.schedule(function(){o===s.length?r.complete():(r.next(s[o++]),r.closed||this.schedule())})})}function Uc(s,e){return new bt(function(r){var o;return Zt(r,e,function(){o=s[nn](),Zt(r,e,function(){var a,u,h;try{a=o.next(),u=a.value,h=a.done}catch(p){r.error(p);return}h?r.complete():r.next(u)},0,!0)}),function(){return X(o==null?void 0:o.return)&&o.return()}})}function hn(s,e){if(!s)throw new Error("Iterable cannot be null");return new bt(function(r){Zt(r,e,function(){var o=s[Symbol.asyncIterator]();Zt(r,e,function(){o.next().then(function(a){a.done?r.complete():r.next(a.value)})},0,!0)})})}function Bc(s,e){return hn(an(s),e)}function Hc(s,e){if(s!=null){if(en(s))return Gc(s,e);if(Zo(s))return jc(s,e);if(tn(s))return Nc(s,e);if(rn(s))return hn(s,e);if(sn(s))return Uc(s,e);if(un(s))return Bc(s,e)}throw on(s)}function fn(s,e){return e?Hc(s,e):Rt(s)}function be(s,e){return Ct(function(r,o){var a=0;r.subscribe(Wt(o,function(u){o.next(s.call(e,u,a++))}))})}function Wc(s,e,r,o,a,u,h,p){var g=[],T=0,L=0,D=!1,Y=function(){D&&!g.length&&!T&&e.complete()},M=function(B){return T<o?H(B):g.push(B)},H=function(B){u&&e.next(B),T++;var st=!1;Rt(r(B,L++)).subscribe(Wt(e,function(ft){a==null||a(ft),u?M(ft):e.next(ft)},function(){st=!0},void 0,function(){if(st)try{T--;for(var ft=function(){var rr=g.shift();h?Zt(e,h,function(){return H(rr)}):H(rr)};g.length&&T<o;)ft();Y()}catch(rr){e.error(rr)}}))};return s.subscribe(Wt(e,M,function(){D=!0,Y()})),function(){p==null||p()}}function da(s,e,r){return r===void 0&&(r=1/0),X(e)?da(function(o,a){return be(function(u,h){return e(o,u,a,h)})(Rt(s(o,a)))},r):(typeof e=="number"&&(r=e),Ct(function(o,a){return Wc(o,a,s,r)}))}function pn(s){return s===void 0&&(s=1/0),da(Xo,s)}function ya(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var r=Ko(s),o=Jo(s,1/0),a=s;return a.length?a.length===1?Rt(a[0]):pn(o)(fn(a,r)):Qo}function Tt(s,e){return Ct(function(r,o){var a=0;r.subscribe(Wt(o,function(u){return s.call(e,u,a++)&&o.next(u)}))})}function Ft(s){return s<=0?function(){return Qo}:Ct(function(e,r){var o=0;e.subscribe(Wt(r,function(a){++o<=s&&(r.next(a),s<=o&&r.complete())}))})}function zc(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var r=Ko(s),o=Jo(s,1/0);return Ct(function(a,u){pn(o)(fn(ve([a],ye(s)),r)).subscribe(u)})}function va(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return zc.apply(void 0,ve([],ye(s)))}function gt(s){return Ct(function(e,r){Rt(s).subscribe(Wt(r,function(){return r.complete()},Si)),!r.closed&&e.subscribe(r)})}var Ve=1e3,mn=class{constructor(e,r){this.id=e;this.movementDirection="none";this._tilePos={position:new P(0,0),layer:void 0};this.movementStarted$=new J;this.movementStopped$=new J;this.directionChanged$=new J;this.positionChangeStarted$=new J;this.positionChangeFinished$=new J;this.tilePositionSet$=new J;this.autoMovementSet$=new J;this.lastMovementImpulse="none";this.facingDirection="down";this.depthChanged$=new J;this.movementProgress=0;this.currentMovementReverted=!1;var o,a,u;this.tilemap=r.tilemap,this.speed=r.speed,this.collidesWithTilesInternal=r.collidesWithTiles,this._tilePos.layer=r.charLayer,this.ignoreMissingTiles=(o=r.ignoreMissingTiles)!=null?o:!1,this.collisionGroups=new Set(r.collisionGroups||[]),this.ignoreCollisionGroups=new Set(r.ignoreCollisionGroups||[]),this.labels=new Set(r.labels||[]),this.numberOfDirections=r.numberOfDirections,r.facingDirection&&this.turnTowards(r.facingDirection),this.tileWidth=(a=r.tileWidth)!=null?a:1,this.tileHeight=(u=r.tileHeight)!=null?u:1}getId(){return this.id}getSpeed(){return this.speed}setSpeed(e){this.speed=e}setMovement(e){this.autoMovementSet$.next(e),this.movement=e}getMovement(){return this.movement}collidesWithTiles(){return this.collidesWithTilesInternal}setCollidesWithTiles(e){this.collidesWithTilesInternal=e}getIgnoreMissingTiles(){return this.ignoreMissingTiles}setIgnoreMissingTiles(e){this.ignoreMissingTiles=e}setTilePosition(e){this.currentMovementReverted=!1,this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(K({},e)),this.fire(this.positionChangeStarted$,this.tilePos,e),this.fire(this.positionChangeFinished$,this.tilePos,e),this.movementDirection="none",this.lastMovementImpulse="none",this.tilePos=e,this.movementProgress=0}getTilePos(){return this.tilePos}getNextTilePos(){if(!this.isMoving())return this.tilePos;if(this.currentMovementReverted)return this.tilePos;let e=this.tilePos.layer,r=this.tilePosInDirection(this.tilePos.position,this.movementDirection),o=this.tilemap.getTransition(r,this.tilePos.layer);return o&&(e=o),{position:this.tilePosInDirection(this.tilePos.position,this.movementDirection),layer:e}}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}move(e){this.lastMovementImpulse=e,e!="none"&&(this.isMoving()||(this.isBlockingDirection(e)?this.changeFacingDirection(e):this.startMoving(e)))}update(e){var r;(r=this.movement)==null||r.update(e),this.isMoving()&&this.updateCharacterPosition(e),this.lastMovementImpulse="none"}getMovementDirection(){return this.movementDirection}isBlockingDirection(e){if(e=="none")return!1;let r=this.tilePosInDirection(this.getNextTilePos().position,e),o=this.tilemap.getTransition(r,this.getNextTilePos().layer)||this.getNextTilePos().layer;return this.collidesWithTilesInternal&&this.isTileBlocking(e,o)?!0:this.isCharBlocking(e,o)}isTileBlocking(e,r){return this.someCharTile((o,a)=>{let u=this.tilePosInDirection(new P(o,a),e);return this.tilemap.hasBlockingTile(u,r,_i(e),this.ignoreMissingTiles)})}revertCurrentMovement(){this.isMoving()&&(this.currentMovementReverted=!0,this.movementDirection=_i(this.movementDirection),this.movementStopped$.next(this.facingDirection),this.facingDirection=this.movementDirection,this.movementProgress=Ve-this.movementProgress,this.movementStarted$.next(this.facingDirection))}isCurrentMovementReverted(){return this.currentMovementReverted}isCharBlocking(e,r){return this.someCharTile((o,a)=>{let u=this.tilePosInDirection(new P(o,a),e);return this.tilemap.hasBlockingChar(u,r,this.getCollisionGroups(),new Set([this.getId()]),this.ignoreCollisionGroups)})}isMoving(){return this.movementDirection!="none"}turnTowards(e){this.isMoving()||e!="none"&&this.changeFacingDirection(e)}changeFacingDirection(e){this.facingDirection!==e&&(this.facingDirection=e,this.directionChanged$.next(e))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(Ht(this.facingDirection))}addCollisionGroup(e){this.collisionGroups.add(e)}setCollisionGroups(e){this.collisionGroups=new Set(e)}setIgnoreCollisionGroups(e){this.ignoreCollisionGroups=new Set(e)}getCollisionGroups(){return Array.from(this.collisionGroups)}getIgnoreCollisionGroups(){return Array.from(this.ignoreCollisionGroups)}hasCollisionGroup(e){return this.collisionGroups.has(e)}removeCollisionGroup(e){this.collisionGroups.delete(e)}removeAllCollisionGroups(){this.collisionGroups.clear()}addLabels(e){for(let r of e)this.labels.add(r)}getLabels(){return[...this.labels.values()]}hasLabel(e){return this.labels.has(e)}clearLabels(){this.labels.clear()}removeLabels(e){for(let r of e)this.labels.delete(r)}getNumberOfDirections(){return this.numberOfDirections}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}depthChanged(){return this.depthChanged$}getMovementProgress(){return this.movementProgress}setMovementProgress(e){let r=Math.max(0,Math.min(Ve,e));this.movementProgress=r}hasWalkedHalfATile(){return this.movementProgress>Ve/2}willCrossTileBorderThisUpdate(e){return this.movementProgress+this.maxProgressForDelta(e)>=Ve}updateCharacterPosition(e){let r=this.willCrossTileBorderThisUpdate(e),a=1-(r?Ve-this.movementProgress:this.maxProgressForDelta(e))/this.maxProgressForDelta(e);this.movementProgress=Math.min(this.movementProgress+this.maxProgressForDelta(e),Ve),r&&(this.movementProgress=0,this.shouldContinueMoving()?(this.fire(this.positionChangeFinished$,this.tilePos,this.getNextTilePos()),this.tilePos=this.getNextTilePos(),this.startMoving(this.lastMovementImpulse),a>0&&this.updateCharacterPosition(e*a)):this.stopMoving())}maxProgressForDelta(e){let o=e/1e3;return Math.floor(o*this.speed*Ve)}get tilePos(){return A.clone(this._tilePos)}set tilePos(e){A.copyOver(e,this._tilePos)}startMoving(e){e!=="none"&&(this.currentMovementReverted=!1,e!=this.movementDirection&&this.movementStarted$.next(e),this.movementDirection=e,this.facingDirection=e,this.fire(this.positionChangeStarted$,this.tilePos,this.getNextTilePos()))}tilePosInDirection(e,r){return e.add(Ht(this.tilemap.toMapDirection(r)))}shouldContinueMoving(){return this.lastMovementImpulse!=="none"&&!this.isBlockingDirection(this.lastMovementImpulse)}stopMoving(){if(this.movementDirection==="none")return;let e=this.tilePos,r=this.getNextTilePos(),o=this.movementDirection;this.tilePos=this.getNextTilePos(),this.movementDirection="none",this.movementStopped$.next(o),this.currentMovementReverted=!1,this.fire(this.positionChangeFinished$,e,r)}fire(e,{position:r,layer:o},{position:a,layer:u}){e.next({exitTile:r,enterTile:a,exitLayer:o,enterLayer:u})}someCharTile(e){let r=this.getNextTilePos().position;for(let o=r.x;o<r.x+this.getTileWidth();o++)for(let a=r.y;a<r.y+this.getTileHeight();a++)if(e(o,a))return!0;return!1}};var yr=class yr{constructor(e,r){this.walkingAnimationMapping=e;this.charsInRow=r;this.lastFootLeft=!1;this.directionToFrameRow={down:0,"down-left":1,"down-right":2,left:1,right:2,up:3,"up-left":1,"up-right":2};this._isEnabled=!0;this.frameChange$=new J;this.setWalkingAnimationMapping(e)}frameChange(){return this.frameChange$}setIsEnabled(e){this._isEnabled=e}isEnabled(){return this._isEnabled}updateCharacterFrame(e,r,o){this._isEnabled&&(r?this.setStandingFrameDuringWalk(e,o):this.setWalkingFrame(e))}setStandingFrame(e){this._isEnabled&&this._setStandingFrame(e)}setWalkingAnimationMapping(e){this.walkingAnimationMapping=e,this._isEnabled=this.walkingAnimationMapping!==void 0}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharsInRow(){return this.charsInRow}setStandingFrameDuringWalk(e,r){this.isCurrentFrameStanding(e,r)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(e)}setWalkingFrame(e){let r=this.framesOfDirection(e);r&&this.frameChange$.next(this.lastFootLeft?r.rightFoot:r.leftFoot)}_setStandingFrame(e){let r=this.framesOfDirection(e);r&&this.frameChange$.next(r.standing)}isCurrentFrameStanding(e,r){var o;return r===((o=this.framesOfDirection(e))==null?void 0:o.standing)}framesOfDirection(e){return typeof this.walkingAnimationMapping=="number"?this.getFramesForCharIndex(e,this.walkingAnimationMapping):this.getFramesForAnimationMapping(e)}getFramesForAnimationMapping(e){if(this.walkingAnimationMapping)return this.walkingAnimationMapping[e]||this.walkingAnimationMapping[this.fallbackDirection(e)]}fallbackDirection(e){switch(e){case"down-left":return"left";case"down-right":return"right";case"up-left":return"left";case"up-right":return"right"}return e}getFramesForCharIndex(e,r){var T;let o=Math.floor(r/this.charsInRow),a=r%this.charsInRow,u=this.charsInRow*yr.FRAMES_CHAR_ROW,h=yr.FRAMES_CHAR_ROW*a,p=((T=this.directionToFrameRow[e])!=null?T:0)+o*yr.FRAMES_CHAR_COL,g=h+p*u;return{rightFoot:g,standing:g+1,leftFoot:g+2}}};yr.FRAMES_CHAR_ROW=3,yr.FRAMES_CHAR_COL=4;var Ei=yr;var vr=class{static shiftPad(e,r){let o=Math.floor(e),u=`${o}`.padStart(r,"0").length;return o/Math.pow(10,u)}};var ht=class s{static vec2str(e){return`${e.x}#${e.y}`}static equal(e,r){return s.vec2str(e)==s.vec2str(r)}static manhattanDistance(e,r){let o=Math.abs(e.x-r.x),a=Math.abs(e.y-r.y);return o+a}static chebyshevDistance(e,r){let o=Math.abs(e.x-r.x),a=Math.abs(e.y-r.y);return Math.max(o,a)}static scalarMult(e,r){return e.clone().multiply(new P(r,r))}};var te=class te{constructor(e){this.tilemap=e;this.charLayerDepths=new Map;this.setLayerDepths()}getTileWidth(){var r,o;let e=(o=(r=this.tilemap.layers[0])==null?void 0:r.tilemapLayer.scale)!=null?o:1;return this.tilemap.tileWidth*e}getTileHeight(){var r,o;let e=(o=(r=this.tilemap.layers[0])==null?void 0:r.tilemapLayer.scale)!=null?o:1;return this.tilemap.tileHeight*e}getDepthOfCharLayer(e){var r;return(r=this.charLayerDepths.get(e))!=null?r:0}tilePosToPixelPos(e){return this.isIsometric()?ht.scalarMult(this.getTileSize(),.5).multiply(new P(e.x-e.y,e.x+e.y)):e.clone().multiply(this.getTileSize())}getTileDistance(e){if(this.isIsometric())switch(e){case"down-left":case"down-right":case"up-left":case"up-right":return ht.scalarMult(this.getTileSize(),.5);default:return this.getTileSize()}return this.getTileSize()}getTileSize(){return new P(this.getTileWidth(),this.getTileHeight())}isIsometric(){return this.tilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()}isLayerAlwaysOnTop(e){return this.hasLayerProp(e,te.ALWAYS_TOP_PROP_NAME)}isCharLayer(e){return this.hasLayerProp(e,te.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let e=[],r=-1,o=this.tilemap.layers.filter(u=>this.isLayerAlwaysOnTop(u));this.tilemap.layers.filter(u=>!this.isLayerAlwaysOnTop(u)).forEach(u=>{this.hasLayerProp(u,te.HEIGHT_SHIFT_PROP_NAME)?(this.createHeightShiftLayers(u,r),e.push(u.tilemapLayer)):this.setDepth(u,++r)}),this.charLayerDepths.set(void 0,r),o.forEach((u,h)=>{u.tilemapLayer.setDepth(h+1+r)}),e.forEach(u=>u.destroy())}setDepth(e,r){e.tilemapLayer.setDepth(r),this.isCharLayer(e)&&this.charLayerDepths.set(this.getLayerProp(e,te.CHAR_LAYER_PROP_NAME),r)}createHeightShiftLayers(e,r){let o=this.getLayerProp(e,te.HEIGHT_SHIFT_PROP_NAME);isNaN(o)&&(o=0);let a=1;for(let u=0;u<e.height;u++){let h=this.copyLayer(e,u);if(h){h.scale=e.tilemapLayer.scale;let p=this.isIsometric()?this.getTileHeight()/2:this.getTileHeight();h.setDepth(r+vr.shiftPad((u+o)*p+a,te.Z_INDEX_PADDING))}}}getLayerProp(e,r){let a=e.properties.find(u=>u.name==r);return a==null?void 0:a.value}hasLayerProp(e,r){return this.getLayerProp(e,r)!=null}copyLayer(e,r){let o=`${e.name}#${r}`,a=this.tilemap.createBlankLayer(o,e.tilemapLayer.tileset);if(a){if(a.name=o,this.isIsometric())for(let u=r;u>=0;u--){let h=r-u;a.putTileAt(e.data[u][h],h,u)}else for(let u=0;u<e.width;u++)a.putTileAt(e.data[r][u],u,r);return a}}};te.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",te.CHAR_LAYER_PROP_NAME="ge_charLayer",te.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",te.Z_INDEX_PADDING=7;var br=te;var gn=class{constructor(e,r,o,a,u){this.charData=e;this.scene=r;this.tilemap=o;this.geHeadless=u;this.customOffset=new P(0,0);this.depthOffset=0;this.newSpriteSet$=new J;this.destroy$=new J;var h,p;this.layerOverlaySprite=a&&e.sprite?this.scene.add.sprite(0,0,e.sprite.texture):void 0,this.walkingAnimationMapping=e.walkingAnimationMapping,this.customOffset=new P(e.offsetX||0,e.offsetY||0),this.depthOffset=(h=e.depthOffset)!=null?h:0,this.sprite=e.sprite,this.container=e.container,this.cachedContainerBounds=(p=e.container)==null?void 0:p.getBounds(),this.geHeadless.directionChanged().pipe(Tt(({charId:g})=>g===this.charData.id)).subscribe(({direction:g})=>{var T;(T=this.animation)==null||T.setStandingFrame(g)}),this.sprite&&(this.sprite.setOrigin(0,0),this.resetAnimation(this.sprite),this.updateOverlaySprite(),this.updateGridChar())}destroy(){this.destroy$.next(),this.destroy$.complete(),this.newSpriteSet$.complete()}setSprite(e){e?(this.sprite&&(e.x=this.sprite.x,e.y=this.sprite.y),this.sprite=e,this.newSpriteSet$.next(),this.layerOverlaySprite=this.layerOverlaySprite?this.scene.add.sprite(0,0,this.sprite.texture):void 0,this.updateOverlaySprite(),this.resetAnimation(this.sprite),this.updateDepth()):(this.layerOverlaySprite=void 0,this.sprite=void 0)}getSprite(){return this.sprite}getLayerOverlaySprite(){return this.layerOverlaySprite}setContainer(e){this.container=e,this.cachedContainerBounds=e==null?void 0:e.getBounds()}getContainer(){return this.container}getOffsetX(){return this.customOffset.x}setOffsetX(e){this.customOffset.x=e}getOffsetY(){return this.customOffset.y}setOffsetY(e){this.customOffset.y=e}getWalkingAnimationMapping(){return this.walkingAnimationMapping}turnTowards(e){var r;this.geHeadless.isMoving(this.charData.id)||e!="none"&&(this.geHeadless.turnTowards(this.charData.id,e),(r=this.animation)==null||r.setStandingFrame(e))}getAnimation(){return this.animation}setAnimation(e){this.animation=e}update(e){this.updateGridChar()}getDepthOffset(){return this.depthOffset}getEngineOffset(){var o,a,u,h;if(!this.sprite)return P.ZERO;let e=this.tilemap.getTileWidth()/2-Math.floor(((a=(o=this.sprite)==null?void 0:o.displayWidth)!=null?a:0)/2),r=-((h=(u=this.sprite)==null?void 0:u.displayHeight)!=null?h:0)+this.tilemap.getTileHeight();return new P(e,r)}updatePixelPos(){let e=new P(this.geHeadless.getPosition(this.charData.id));this.geHeadless.isCurrentMovementReverted(this.charData.id)&&(e=new P(this.geHeadless.getTilePosInDirection(this.geHeadless.getPosition(this.charData.id),this.geHeadless.getCharLayer(this.charData.id),_i(this.geHeadless.getFacingDirection(this.charData.id))).position));let r=this.geHeadless.getMovementProgress(this.charData.id)/1e3,a=this.tilemap.tilePosToPixelPos(e).add(this.getEngineOffset()).add(this.customOffset).add(Ht(this.geHeadless.getFacingDirection(this.charData.id)).multiply(this.tilemap.getTileDistance(this.geHeadless.getFacingDirection(this.charData.id)).scalarMult(r))),u=this.getGameObj();u&&(u.x=Math.floor(a.x),u.y=Math.floor(a.y))}getGameObj(){return this.container||this.sprite}updateGridChar(){var e;if(this.updatePixelPos(),this.sprite&&this.geHeadless.isMoving(this.charData.id)){let r=this.geHeadless.getMovementProgress(this.charData.id)>Ve/2;(e=this.getAnimation())==null||e.updateCharacterFrame(this.geHeadless.getFacingDirection(this.charData.id),r,Number(this.sprite.frame.name))}this.updateDepth()}resetAnimation(e){let r=new Ei(this.walkingAnimationMapping,e.texture.source[0].width/e.width/Ei.FRAMES_CHAR_ROW);this.setAnimation(r),r.frameChange().pipe(gt(this.newSpriteSet$)).subscribe(o=>{e==null||e.setFrame(o)}),r.setIsEnabled(this.walkingAnimationMapping!==void 0),r.setStandingFrame(this.geHeadless.getFacingDirection(this.charData.id))}updateOverlaySprite(){if(!this.layerOverlaySprite||!this.sprite)return;this.layerOverlaySprite.scale=this.sprite.scale;let e=this.tilemap.getTileHeight()/this.layerOverlaySprite.scale;this.layerOverlaySprite.setCrop(0,0,this.layerOverlaySprite.displayWidth,this.sprite.height-e),this.layerOverlaySprite.setOrigin(0,0)}updateDepth(){if(!this.getGameObj())return;let r=new P(this.geHeadless.getPosition(this.charData.id)),o=this.geHeadless.getCharLayer(this.charData.id);this.container?this.setContainerDepth(this.container,{position:r,layer:o}):this.sprite&&this.setSpriteDepth(this.sprite,{position:r,layer:o});let a=this.getLayerOverlaySprite();if(a){let u=new P(Bt(K({},r),{y:r.y-1}));this.setSpriteDepth(a,{position:u,layer:o})}}setSpriteDepth(e,r){e.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(r))+this.getPaddedPixelDepthSprite(e))}setContainerDepth(e,r){e.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(r))+this.getPaddedPixelDepthContainer(e))}getPaddedPixelDepthContainer(e){var r,o,a,u;return vr.shiftPad(e.y+((o=(r=this.cachedContainerBounds)==null?void 0:r.y)!=null?o:0)+((u=(a=this.cachedContainerBounds)==null?void 0:a.height)!=null?u:0)+this.depthOffset,br.Z_INDEX_PADDING)}getPaddedPixelDepthSprite(e){return vr.shiftPad(e.y+e.displayHeight+this.depthOffset,br.Z_INDEX_PADDING)}getTransitionLayer(e){if(e.layer)return this.geHeadless.getTransition(e.position,e.layer)||e.layer}};var Di=(a=>(a.DONT_BLOCK="DONT_BLOCK",a.BLOCK_TWO_TILES="BLOCK_TWO_TILES",a.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",a.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND",a))(Di||{});var Pr=(a=>(a.STOP="STOP",a.CLOSEST_REACHABLE="CLOSEST_REACHABLE",a.RETRY="RETRY",a.ALTERNATIVE_TARGETS="ALTERNATIVE_TARGETS",a))(Pr||{});var dn=class{distance(e,r){return ht.manhattanDistance(e,r)}direction(e,r){if(ht.equal(e,r))return"none";let o=e.clone().subtract(r);return Math.abs(o.x)>Math.abs(o.y)?o.x>0?"left":"right":o.y>0?"up":"down"}neighbors(e){return[new P(e.x,e.y+1),new P(e.x+1,e.y),new P(e.x-1,e.y),new P(e.x,e.y-1)]}getDirections(){return["up","right","down","left"]}};var yn=class{distance(e,r){return ht.chebyshevDistance(e,r)}neighbors(e){let r=[new P(e.x,e.y+1),new P(e.x+1,e.y),new P(e.x-1,e.y),new P(e.x,e.y-1)],o=[new P(e.x+1,e.y+1),new P(e.x+1,e.y-1),new P(e.x-1,e.y+1),new P(e.x-1,e.y-1)];return[...r,...o]}direction(e,r){return r.x>e.x?r.y>e.y?"down-right":r.y<e.y?"up-right":"right":r.x<e.x?r.y>e.y?"down-left":r.y<e.y?"up-left":"left":r.y<e.y?"up":r.y>e.y?"down":"none"}getDirections(){return["up","right","down","left","down-left","down-right","up-right","up-left"]}};var ue=class{static create(e){switch(e){case 4:return new dn;case 8:return new yn}}};var Ii=class{constructor(e,r,o){this.backoffMs=e;this.maxRetries=r;this.onFinished=o;this.retries=0;this.elapsed=0}retry(e,r){this.shouldRetry()?(this.elapsed+=e,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,r())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}getBackoffMs(){return this.backoffMs}shouldRetry(){return this.maxRetries===-1||this.retries<this.maxRetries}};var Wr=(o=>(o.WAIT="WAIT",o.RETRY="RETRY",o.STOP="STOP",o))(Wr||{});var Pe=class{constructor(e,{shortestPathAlgorithm:r="BFS",pathWidth:o=1,pathHeight:a=1,numberOfDirections:u=4,isPositionAllowed:h=(st,ft)=>!0,collisionGroups:p=[],ignoredChars:g=[],ignoreTiles:T=!1,ignoreMapBounds:L=!1,ignoreBlockedTarget:D=!1,maxPathLength:Y=1/0,ignoreLayers:M=!1,considerCosts:H=!1,calculateClosestToTarget:B=!0}={}){this.gridTilemap=e;this.options={shortestPathAlgorithm:r,pathWidth:o,pathHeight:a,numberOfDirections:u,isPositionAllowed:h,collisionGroups:p,ignoredChars:g,ignoreTiles:T,ignoreMapBounds:L,ignoreBlockedTarget:D,maxPathLength:Y,ignoreLayers:M,considerCosts:H,calculateClosestToTarget:B},this.ignoredCharsSet=new Set(g)}findShortestPath(e,r){this.options.ignoreLayers&&(this.gridTilemap.fixCacheLayer(e.layer),r.layer=e.layer);let o=this.findShortestPathImpl(e,r);return this.gridTilemap.unfixCacheLayers(),o}getNeighbors(e,r){var h;return ue.create((h=this.options.numberOfDirections)!=null?h:4).neighbors(e.position).map(p=>{let g=e.layer;return this.options.ignoreLayers||(g=this.gridTilemap.getTransition(p,e.layer)),{position:p,layer:g||e.layer}}).filter(p=>!this.isBlocking(e,p)||this.options.ignoreBlockedTarget&&A.equal(p,r))}getTransition(e,r){if(!this.options.ignoreLayers)return this.gridTilemap.getTransition(e,r)}getCosts(e,r){if(!this.options.considerCosts)return 1;let o=vt(r.position,e);return this.gridTilemap.getTileCosts(r,o)}isBlocking(e,r){return!(this.options.ignoreMapBounds||this.gridTilemap.isInRange(r.position))||!this.options.isPositionAllowed(r.position,r.layer)||!this.options.ignoreTiles&&this.hasBlockingTileFrom(e,r,this.options.pathWidth,this.options.pathHeight,this.options.ignoreMapBounds,this.gridTilemap)?!0:this.hasBlockingCharFrom(e,r,this.options.pathWidth,this.options.pathHeight,this.options.collisionGroups,this.ignoredCharsSet,this.gridTilemap)}distance(e,r){return(this.options.numberOfDirections===4?ht.manhattanDistance:ht.chebyshevDistance)(e,r)}getTilePosInDir(e,r){return this.options.ignoreLayers?{position:e.position.add(Ht(this.gridTilemap.toMapDirection(r))),layer:e.layer}:this.gridTilemap.getTilePosInDirection(e,r)}getReverseNeighbors(e,r){var p;let a=ue.create((p=this.options.numberOfDirections)!=null?p:4).neighbors(e.position),u;if(!this.options.ignoreLayers){let g=this.gridTilemap.getReverseTransitions(e.position,e.layer);u=g?[...g]:void 0}return a.map(g=>u?u.map(T=>({position:g,layer:T||e.layer})):[{position:g,layer:e.layer}]).flat().filter(g=>!this.isBlocking(g,e)||this.options.ignoreBlockedTarget&&A.equal(e,r))}hasBlockingCharFrom(e,r,o,a,u,h,p){if(o===1&&a===1)return p.hasBlockingChar(r.position,r.layer,u,h);let g=L=>p.hasBlockingChar(L,r.layer,u,h),T=vt(e.position,r.position);return this.isBlockingMultiTile(e,T,o,a,g)}hasBlockingTileFrom(e,r,o,a,u,h){if(o===1&&a===1)return h.hasBlockingTile(r.position,r.layer,vt(r.position,e.position),u);let p=vt(e.position,r.position),g=T=>h.hasBlockingTile(T,r.layer,p,u);return this.isBlockingMultiTile(e,p,o,a,g)}isBlockingMultiTile(e,r,o,a,u){let h={src:new P(e.position.x+o,e.position.y),dest:new P(e.position.x+o,e.position.y+a-1)},p={src:new P(e.position.x-1,e.position.y),dest:new P(e.position.x-1,e.position.y+a-1)},g={src:new P(e.position.x,e.position.y-1),dest:new P(e.position.x+o-1,e.position.y-1)},T={src:new P(e.position.x,e.position.y+a),dest:new P(e.position.x+o-1,e.position.y+a)};switch(r){case"right":return this.checkLine(h,u);case"left":return this.checkLine(p,u);case"up":return this.checkLine(g,u);case"down":return this.checkLine(T,u);case"up-left":return this.checkLine({src:g.src,dest:new P(g.dest.x-1,g.dest.y)},u)||this.checkLine({src:new P(p.src.x,p.src.y-1),dest:new P(p.dest.x,p.dest.y-1)},u);case"up-right":return this.checkLine({src:new P(g.src.x+1,g.src.y),dest:g.dest},u)||this.checkLine({src:new P(h.src.x,h.src.y-1),dest:new P(h.dest.x,h.dest.y-1)},u);case"down-left":return this.checkLine({src:new P(p.src.x,p.src.y+1),dest:new P(p.dest.x,p.dest.y+1)},u)||this.checkLine({src:T.src,dest:new P(T.dest.x-1,T.dest.y)},u);case"down-right":return this.checkLine({src:new P(T.src.x+1,T.src.y),dest:T.dest},u)||this.checkLine({src:new P(h.src.x,h.src.y+1),dest:new P(h.dest.x,h.dest.y+1)},u)}return!1}checkLine(e,r){for(let o=e.src.x;o<=e.dest.x;o++)for(let a=e.src.y;a<=e.dest.y;a++)if(r(new P(o,a)))return!0;return!1}};var Ea=jo(rh(),1),Da=jo(lh(),1),Th=jo(mh(),1),le=jo(Ph(),1);var ki=Ea.default.MinFibonacciHeap,UC=Ea.default.MaxFibonacciHeap,BC=Da.default.MinHeap,HC=Da.default.MaxHeap,WC=Th.default.GeneralizedSuffixArray,zC=le.default.Uint8Vector,$C=le.default.Uint8ClampedVector,qC=le.default.Int8Vector,YC=le.default.Uint16Vector,XC=le.default.Int16Vector,QC=le.default.Uint32Vector,KC=le.default.Int32Vector,JC=le.default.Float32Vector,ZC=le.default.Float64Vector,t_=le.default.PointerVector;var xn=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"A_STAR"}}shortestPathBfs(e,r){let o=new Map,a=new Map,u=new Map,h=new ki((L,D)=>Vi(u,L)-Vi(u,D)),p=e,g=this.distance(e.position,r.position),T=0;for(h.push(e),a.set(A.toString(e),0),u.set(A.toString(e),this.distance(e.position,r.position));h.size>0;){let L=h.pop();if(!L)break;T++;let D=this.distance(L.position,r.position);if(D<g&&(g=D,p=L),xh(L,r))return{previous:o,closestToTarget:p,steps:T,maxPathLengthReached:!1};if(Vi(a,L)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:p,steps:T,maxPathLengthReached:!0};for(let Y of this.getNeighbors(L,r)){let M=Vi(a,L)+this.getCosts(L.position,Y),H=A.toString(Y);(!a.has(H)||M<Vi(a,Y))&&(o.set(H,L),a.set(H,M),u.set(H,M+this.distance(Y.position,r.position)),h.push(Y))}}return{previous:o,closestToTarget:p,steps:T,maxPathLengthReached:!1}}returnPath(e,r,o){let a=[],u=o;for(a.push(u);!xh(u,r);){if(u=e.get(A.toString(u)),!u)return[];a.push(u)}return a.reverse()}};function Vi(s,e){var r;return(r=s.get(A.toString(e)))!=null?r:Number.MAX_VALUE}function xh(s,e){return ht.equal(s.position,e.position)?s.layer===e.layer:!1}var wn=class{constructor(e){this.data=e}},Ge=class{constructor(){this.sizeInternal=0}dequeue(){if(this.tail===void 0)return;this.sizeInternal--;let e=this.tail.data;return this.tail.prev===void 0?(this.tail=void 0,this.head=void 0,e):(this.tail.prev.next=void 0,this.tail=this.tail.prev,e)}enqueue(e){if(this.sizeInternal++,this.head===void 0){this.head=new wn(e),this.tail=this.head;return}let r=new wn(e);r.next=this.head,this.head.prev=r,this.head=r}peek(){return this.tail?this.tail.data:void 0}peekAll(){let e=[],r=this.tail;for(;r;)e.push(r.data),r=r.prev;return e}clear(){this.head=void 0,this.tail=void 0,this.sizeInternal=0}peekEnd(){var e;return(e=this.head)==null?void 0:e.data}size(){return this.sizeInternal}};var $r=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"BFS"}}equal(e,r){return ht.equal(e.position,r.position)?e.layer===r.layer:!1}shortestPathBfs(e,r){let o=new Map,a=new Set,u=new Ge,h=e,p=this.distance(e.position,r.position),g=0;for(u.enqueue({node:e,dist:0}),a.add(A.toString(e));u.size()>0;){let T=u.dequeue();if(g++,!T)break;let{node:L,dist:D}=T;if(D>this.options.maxPathLength)return{previous:new Map,closestToTarget:h,steps:g,maxPathLengthReached:!0};let Y=this.distance(L.position,r.position);if(Y<p&&(p=Y,h=L),this.equal(L,r))return{previous:o,closestToTarget:h,steps:g,maxPathLengthReached:!1};for(let M of this.getNeighbors(L,r))a.has(A.toString(M))||(o.set(A.toString(M),L),u.enqueue({node:M,dist:D+1}),a.add(A.toString(M)))}return{previous:o,closestToTarget:h,steps:g,maxPathLengthReached:!1}}returnPath(e,r,o){let a=[],u=o;for(a.push(u);!this.equal(u,r);){if(u=e.get(A.toString(u)),!u)return[];a.push(u)}return a.reverse()}};var Cn=class{constructor(){this.previous=new Map;this.visited=new Map;this.queue=new Ge;this.minMatching=1/0;this.lastDist=0}isNewFrontier(){let e=this.queue.peek();return!!(e&&e.dist>this.lastDist)}step(e,r,o){var a;this.lastDist=o;for(let u of e){let h=A.toString(u);if(!this.visited.has(h)){this.previous.set(h,r),this.queue.enqueue({node:u,dist:o+1}),this.visited.set(h,o+1);let p=(a=this.otherBfs)==null?void 0:a.visited.get(h);p!==void 0&&p<this.minMatching&&(this.minMatching=p,this.minMatchingNode=u)}}}},_n=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,o.previous2,o.matchingPos,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"BIDIRECTIONAL_SEARCH"}}equal(e,r){return ht.equal(e.position,r.position)?e.layer===r.layer:!1}shortestPathBfs(e,r){var g;if(A.equal(e,r))return{previous:new Map,previous2:new Map,closestToTarget:e,steps:0,maxPathLengthReached:!1};let o=new Cn,a=new Cn,u=0;o.otherBfs=a,a.otherBfs=o;let h=e,p=this.distance(e.position,r.position);for(o.queue.enqueue({node:e,dist:0}),a.queue.enqueue({node:r,dist:0}),o.visited.set(A.toString(e),0),a.visited.set(A.toString(r),0);this.shouldStop(o.queue.size()>0,a.queue.size()>0);){let T=o.queue.dequeue();if(!T)break;let{node:L,dist:D}=T;if(D+1+(((g=a.queue.peek())==null?void 0:g.dist)||0)>this.options.maxPathLength)return{previous:o.previous,previous2:a.previous,closestToTarget:this.maybeClosestToTarget(h),steps:u,maxPathLengthReached:!0};let Y=this.distance(L.position,r.position);if(Y<p&&(p=Y,h=L),u++,o.step(this.getNeighbors(L,r),L,D),o.isNewFrontier()&&o.minMatchingNode)return{previous:o.previous,previous2:a.previous,closestToTarget:this.maybeClosestToTarget(r),matchingPos:o.minMatchingNode,steps:u,maxPathLengthReached:!1};let M=a.queue.dequeue();if(!M)continue;let{node:H,dist:B}=M;if(u++,a.step(this.getReverseNeighbors(H,r),H,B),a.isNewFrontier()&&a.minMatchingNode)return{previous:o.previous,previous2:a.previous,closestToTarget:this.maybeClosestToTarget(r),matchingPos:a.minMatchingNode,steps:u,maxPathLengthReached:!1}}return{previous:o.previous,previous2:a.previous,closestToTarget:this.maybeClosestToTarget(h),steps:u,maxPathLengthReached:!1}}shouldStop(e,r){return this.options.calculateClosestToTarget?e||r:e&&r}maybeClosestToTarget(e){return this.options.calculateClosestToTarget?e:void 0}returnPath(e,r,o,a,u){if(o){let h=this.getPathFromPrev(e,a,o).reverse(),p=this.getPathFromPrev(r,u,o);return h.pop(),[...h,...p]}else return this.getPathFromPrev(e,a,u).reverse()}getPathFromPrev(e,r,o){let a=[],u=o;for(a.push(u);!this.equal(u,r);){if(u=e.get(A.toString(u)),!u)return[];a.push(u)}return a}};var qr=class extends Pe{constructor(r,o={}){super(r,o);this.openSet=new ki;this.g=new Map;this.f=new Map;this.closestToTarget={position:new P(0,0),layer:void 0};this.smallestDistToTarget=0;this.steps=0;this.visits=[];this.maxFrontierSize=0;this.maxJumpSize=0}findShortestPathImpl(r,o){this.maxJumpSize=this.distance(r.position,o.position);let a=this.shortestPath(r,o);return{path:this.returnPath(a.previous,r,o),closestToTarget:a.closestToTarget,steps:a.steps,maxPathLengthReached:a.maxPathLengthReached,algorithmUsed:"JPS"}}shortestPath(r,o){this.steps=0;let a=new Map;this.g=new Map,this.f=new Map,this.closestToTarget=r,this.smallestDistToTarget=this.distance(r.position,o.position),this.openSet=new ki((h,p)=>Gi(this.f,h)-Gi(this.f,p)),this.openSet.push(r);let u=A.toString(r);for(this.g.set(u,0),this.f.set(u,this.distance(r.position,o.position)),this.maxFrontierSize=Math.max(this.maxFrontierSize,this.openSet.size);this.openSet.size>0;){let h=this.openSet.pop();if(!h)break;if(this.steps++,A.equal(h,o))return{previous:a,closestToTarget:o,steps:this.steps,maxPathLengthReached:!1};if(Gi(this.g,h)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!0};this.updateClosestToTarget(h,o);for(let p of this.getNeighborsInternal(h,a.get(A.toString(h)),o)){let g=A.toString(p.p),T=Gi(this.g,h)+p.dist;(!this.g.has(g)||T<Gi(this.g,p.p))&&(a.set(g,h),this.g.set(g,T),this.f.set(g,T+this.distance(p.p.position,o.position)),this.openSet.push(p.p))}}return{previous:a,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!1}}updateClosestToTarget(r,o){let a=this.distance(r.position,o.position);a<this.smallestDistToTarget&&(this.smallestDistToTarget=a,this.closestToTarget=r)}addIfNotBlocked(r,o,a){this.blockOrTrans(o,a)||r.push(a)}blockOrTrans(r,o){return this.isBlocking(r,o)||this.getTransition(o.position,o.layer)!==void 0}getNeighborsInternal(r,o,a){if(!o||r.layer!==o.layer)return this.getNeighbors(r,a).map(p=>({p,dist:1}));let u=this.prune(o,r).filter(p=>!this.isBlockingIgnoreTarget(r,p,a)).map(p=>{let g=this.getTransition(p.position,r.layer);return{position:p.position,layer:g||r.layer}}),h=[];for(let p of u)if(this.isHorizontal(r.position,p.position))h.push({p,dist:1});else{let g=this.jump(r,p,a,1,vt(r.position,p.position));g&&h.push(g)}return h}isBlockingIgnoreTarget(r,o,a){return this.isBlocking(r,o)&&!(this.options.ignoreBlockedTarget&&A.equal(o,a))}jump(r,o,a,u,h){if(!this.isBlockingIgnoreTarget(r,o,a))return A.equal(o,a)?{p:o,dist:u}:u>=this.maxJumpSize?{p:o,dist:u}:this.getTransition(o.position,r.layer)!==void 0?{p:o,dist:u}:this.hasForced(r,o)?{p:o,dist:u}:(this.updateClosestToTarget(o,a),this.jump(o,this.getTilePosInDir(o,h),a,u+1,h))}isHorizontal(r,o){return r.y===o.y}getForced(r,o,a,u,h,p){let g=[],T=r;return(this.blockOrTrans(T,a)||this.blockOrTrans(a,u))&&this.addIfNotBlocked(g,o,u),(this.blockOrTrans(T,h)||this.blockOrTrans(h,p))&&this.addIfNotBlocked(g,o,p),g}hasForced(r,o){let{topLeft:a,downLeft:u,top:h,bottom:p}=this.normalizedPositions(r,o);return!!((this.blockOrTrans(r,u)||this.blockOrTrans(u,p))&&!this.blockOrTrans(o,p)||(this.blockOrTrans(r,a)||this.blockOrTrans(a,h))&&!this.blockOrTrans(o,h))}prune(r,o){let{right:a,top:u,bottom:h,downLeft:p,topLeft:g}=this.normalizedPositions(r,o);return this.isHorizontal(r.position,o.position)?[a,u,h]:[a,...this.getForced(r,o,p,h,g,u)]}normalizedPositions(r,o){return r.position.x<o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y),layer:o.layer}}:r.position.x>o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y),layer:o.layer}}:r.position.y<o.position.y?{topLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y+1),layer:o.layer}}:{topLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y-1),layer:o.layer}}}posInDir(r,o){return{position:r.position.add(Ht(o)),layer:r.layer}}returnPath(r,o,a){let u=[],h=a;for(u.push(h);!A.equal(h,o);){let p=r.get(A.toString(h));if(!p)return[];this.distance(p.position,h.position)>1?this.fillPath(h,p,u):u.push(p),h=p}return u.reverse()}fillPath(r,o,a){let u=r;do{let h=vt(u.position,o.position);u=this.getTilePosInDir(u,h),a.push(u)}while(!ht.equal(u.position,o.position))}};function Gi(s,e){var r;return(r=s.get(A.toString(e)))!=null?r:Number.MAX_VALUE}var Ln=class{constructor(e,r,o,a={}){this.character=e;this.gridTilemap=r;this.charToFollow=o;let u={distance:0,noPathFoundStrategy:"STOP",maxPathLength:1/0,shortestPathAlgorithm:"BIDIRECTIONAL_SEARCH",ignoreLayers:!1,considerCosts:a.considerCosts||!1,facingDirection:"none",isPositionAllowedFn:()=>!0,ignoredChars:[]};this.options=K(K({},u),a),this.options.considerCosts&&this.options.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.options.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.options.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1")}init(){this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(gt(this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)))).subscribe(({enterTile:e,enterLayer:r})=>{this.updateTarget(e,r)})}update(e){var r;(r=this.targetMovement)==null||r.update(e)}getInfo(){return{type:"Follow",config:{charToFollow:this.charToFollow.getId(),distance:this.options.distance,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,facingDirection:this.options.facingDirection,shortestPathAlgorithm:this.options.shortestPathAlgorithm,considerCosts:this.options.considerCosts,isPositionAllowedFn:this.options.isPositionAllowedFn,ignoredChars:this.options.ignoredChars}}}getFacingPos(){let e=wi[this.options.facingDirection]+wi[this.charToFollow.getFacingDirection()],r=Uo("up",e),o={x:this.charToFollow.getTilePos().position.x,y:this.charToFollow.getTilePos().position.y};return r==="right"?o.x+=this.charToFollow.getTileWidth()-1:r==="down"?o.y+=this.charToFollow.getTileWidth()-1:r==="down-left"?o.y+=this.charToFollow.getTileWidth()-1:r==="down-right"?(o.y+=this.charToFollow.getTileWidth()-1,o.x+=this.charToFollow.getTileWidth()-1):r==="up-right"&&(o.x+=this.charToFollow.getTileWidth()-1),this.gridTilemap.getTilePosInDirection({position:new P(o),layer:this.charToFollow.getTilePos().layer},r).position}updateTarget(e,r){let o=this.options.facingDirection!=="none"&&this.options.distance===0;o&&(e=this.getFacingPos()),this.targetMovement=new Yr(this.character,this.gridTilemap,{position:new P(e),layer:r},{distance:o?0:this.options.distance+1,config:{algorithm:this.options.shortestPathAlgorithm,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,considerCosts:this.options.considerCosts,ignoredChars:[this.charToFollow.getId(),...this.options.ignoredChars],isPositionAllowedFn:this.options.isPositionAllowedFn}}),this.targetMovement.init()}};var Ni=class{static getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}};var Sn=class{constructor(e,r=0,o=-1){this.character=e;this.delay=r;this.radius=o;this.stepSize=0;this.delayLeft=this.delay,this.initialRow=e.getNextTilePos().position.y,this.initialCol=e.getNextTilePos().position.x,this.randomizeStepSize(),this.stepsWalked=0,this.currentMovementDirection="none",this.character.positionChangeStarted().pipe(gt(this.character.autoMovementSet().pipe(Tt(a=>a!==this),Ft(1)))).subscribe(()=>{this.stepsWalked++}),this.distanceUtils=ue.create(e.getNumberOfDirections())}init(){}update(e){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=e,this.delayLeft<=0){this.delayLeft=this.delay;let r=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(r),this.currentMovementDirection=r,this.randomizeStepSize()}}getInfo(){return{type:"Random",config:{delay:this.delay,radius:this.radius}}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!=="none"&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return this.distanceUtils.getDirections().filter(r=>!this.character.isBlockingDirection(r)).filter(r=>this.isWithinRadius(r))}isWithinRadius(e){return this.radius==-1?!0:this.getDist(e)<=this.radius}getDist(e){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(Ht(e)),new P(this.initialCol,this.initialRow))}getFreeRandomDirection(){let e=this.getFreeDirections();return e.length==0?"none":e[Ni.getRandomInt(e.length)]}randomizeStepSize(){this.stepSize=Ni.getRandomInt(this.radius)+1}};function wh(s,e){return s.filter(r=>{var o,a,u,h,p,g;return(o=e.labels)!=null&&o.withAllLabels?(a=e.labels)==null?void 0:a.withAllLabels.every(T=>r.hasLabel(T)):(u=e.labels)!=null&&u.withOneOfLabels?(h=e.labels)==null?void 0:h.withOneOfLabels.some(T=>r.hasLabel(T)):(p=e.labels)!=null&&p.withNoneLabels?!((g=e.labels)!=null&&g.withNoneLabels.some(T=>r.hasLabel(T))):!0})}var On="2.48.1";var En=class{constructor(e,r){this.collistionStrategy=e;this.collisionGroupRelation=r;this.tilePosToCharacters=new Ia;this.charRemoved$=new J}isCharBlockingAt(e,r,o,a=new Set,u=new Set){if(o.length===0)return!1;let h=this.tilePosToCharacters.get(e,r);return!!(h&&h.size>0&&[...h].filter(p=>!a.has(p.getId())).filter(p=>!this.doIntersect(p.getCollisionGroups(),u)).some(p=>o.some(g=>p.getCollisionGroups().some(T=>this.collidesWith(g,T)))))}doIntersect(e,r){for(let o of e)if(r.has(o))return!0;return!1}collidesWith(e,r){return this.collisionGroupRelation?(this.collisionGroupRelation.get(e)||new Set).has(r):e===r}getCharactersAt(e,r){return this.tilePosToCharacters.get(e,r)||new Set}addCharacter(e){this.addTilePositions(e.getTilePos(),e),this.addTilePositions(e.getNextTilePos(),e),this.addPositionChangeSub(e),this.addPositionChangeFinishedSub(e),this.addTilePosSetSub(e)}removeCharacter(e){let r=e.getId();this.charRemoved$.next(r),this.deleteTilePositions(e.getTilePos(),e),this.deleteTilePositions(e.getNextTilePos(),e)}add(e,r,o){let a=this.tilePosToCharacters.get(e,r);a||this.tilePosToCharacters.set(e,r,new Set([o])),a==null||a.add(o)}addTilePosSetSub(e){e.tilePositionSet().pipe(gt(this.charRemoved(e.getId()))).subscribe(r=>{this.deleteTilePositions(e.getNextTilePos(),e),this.addTilePositions(r,e)})}charRemoved(e){var r;return(r=this.charRemoved$)==null?void 0:r.pipe(Ft(1),Tt(o=>o==e))}addPositionChangeSub(e){e.positionChangeStarted().pipe(gt(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(r=>{this.collistionStrategy==="BLOCK_ONE_TILE_AHEAD"&&this.deleteTilePositions(r.exit,e),this.addTilePositions(r.enter,e)})}addPositionChangeFinishedSub(e){e.positionChangeFinished().pipe(gt(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(r=>{this.deleteTilePositions(r.exit,e),this.addTilePositions(r.enter,e)})}addTilePositions(e,r){this.forEachCharTile(e,r,(o,a)=>{this.add(new P(o,a),e.layer,r)})}deleteTilePositions(e,r){this.forEachCharTile(e,r,(o,a)=>{var u;(u=this.tilePosToCharacters.get(new P(o,a),e.layer))==null||u.delete(r)})}forEachCharTile(e,r,o){let a=e.position;for(let u=a.x;u<a.x+r.getTileWidth();u++)for(let h=a.y;h<a.y+r.getTileHeight();h++)o(u,h)}posChangeToLayerPos(){return ma(be(e=>({enter:{position:new P(e.enterTile),layer:e.enterLayer},exit:{position:new P(e.exitTile),layer:e.exitLayer}})))}posToString(e,r){return`${e.x}#${e.y}#${r}`}},Ia=class{constructor(){this.memo=new Map}set(e,r,o){let a=this.memo.get(e.x);a||(a=new Map,this.memo.set(e.x,a));let u=a.get(e.y);u||(u=new Map,a.set(e.y,u)),u.set(r,o)}get(e,r){let o=this.memo.get(e.x);if(!o)return;let a=o.get(e.y);if(a)return a.get(r)}};var tr=class{constructor(e,r,o,a){this.x=e;this.y=r;this.width=o;this.height=a}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}};var Xr="ge_charLayer";var Ch=0,EP=1,Ma={none:1,left:2,"up-left":3,up:4,"up-right":5,right:6,"down-right":7,down:8,"down-left":9},In=class{constructor(e,r){this.tilemap=e;this.gridTilemap=r;this.tileCollisionCache=new Map}fixLayer(e){this.fixedLayer=this.tileCollisionCache.get(e)}unfixLayers(){this.fixedLayer=void 0}rebuild(e){e||(e=new tr(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()));let r=this.tilemap.getLayers().filter(o=>o.isCharLayer());for(let o of[...r,void 0]){let a=this.tileCollisionCache.get(o==null?void 0:o.getName());if(a===void 0){a=new Array(this.tilemap.getWidth());for(let u=0;u<this.tilemap.getWidth();u++)a[u]=new Array(this.tilemap.getHeight());this.tileCollisionCache.set(o==null?void 0:o.getName(),a)}for(let u=e.getY();u<e.getY()+e.getHeight();u++)for(let h=e.getX();h<e.getX()+e.getWidth();h++){let p=0;!this.gridTilemap.hasNoTileUncached(new P(h,u),o==null?void 0:o.getName())&&(p=Aa(p,0));for(let L of Ci())this.gridTilemap.hasBlockingTileUncached(new P(h,u),o==null?void 0:o.getName(),L,!0)&&(p=Aa(p,Ma[L]));this.gridTilemap.hasBlockingTileUncached(new P(h,u),o==null?void 0:o.getName(),void 0,!0)&&(p=Aa(p,Ma[1])),a[h][u]=p}}}hasTileAt(e,r,o){var h;let a=this.fixedLayer||this.tileCollisionCache.get(o),u=(h=a==null?void 0:a[e])==null?void 0:h[r];if(u!==void 0)return Dn(u,Ch)}isBlockingFrom(e,r,o,a,u){var g;let h=this.fixedLayer||this.tileCollisionCache.get(o),p=(g=h==null?void 0:h[e])==null?void 0:g[r];if(p!==void 0)return!u&&!Dn(p,Ch)?!0:a===void 0?Dn(p,EP):Dn(p,Ma[a])}};function Aa(s,e){return s|1<<e}function Dn(s,e){return(s>>e&1)==1}var _h="ge_cost",An=class An{constructor(e,r,o,a=void 0,u=!1){this.tilemap=e;this.collisionTilePropertyName=r;this.useTileCollisionCache=u;this.characters=new Map;this.transitions=new Map;this.reverseTransitions=new Map;this.collidesPropNames=new Map;this.tileCostPropNames=new Map;this.collisionRelevantLayersFrameCache=new Map;this.charBlockCache=new En(o,a);for(let h of Ci())this.collidesPropNames.set(h,An.ONE_WAY_COLLIDE_PROP_PREFIX+h),this.tileCostPropNames.set(h,`${_h}_${h}`);this.useTileCollisionCache&&(this.tileCollisionCache=new In(e,this),this.tileCollisionCache.rebuild())}fixCacheLayer(e){var r;(r=this.tileCollisionCache)==null||r.fixLayer(e)}unfixCacheLayers(){var e;(e=this.tileCollisionCache)==null||e.unfixLayers()}addCharacter(e){this.characters.set(e.getId(),e);let r=e.getNextTilePos().layer;r===void 0?e.setTilePosition(Bt(K({},e.getNextTilePos()),{layer:this.getLowestCharLayer()})):this.getCharLayerNames().includes(r)||console.warn(`Char layer '${r}' of character '${e.getId()}' is unknown.`),this.charBlockCache.addCharacter(e)}removeCharacter(e){let r=this.characters.get(e);r&&(this.charBlockCache.removeCharacter(r),this.characters.delete(e))}getCharacters(){return[...this.characters.values()]}getCharactersAt(e,r){return this.charBlockCache.getCharactersAt(e,r)}rebuildTileCollisionCache(e){var r;(r=this.tileCollisionCache)==null||r.rebuild(e)}hasBlockingTileUncached(e,r,o,a){if(!a&&this.hasNoTileUncached(e,r))return!0;let u=this.getCollisionRelevantLayers(r);for(let h of u)if(this.isLayerBlockingAt(h.getName(),e,o))return!0;return!1}hasBlockingTile(e,r,o,a){var h;let u=(h=this.tileCollisionCache)==null?void 0:h.isBlockingFrom(e.x,e.y,r,o,a);return u!==void 0?u:this.hasBlockingTileUncached(e,r,o,a)}getTransition(e,r){let o=this.transitions.get(e.toString());if(o)return o.get(r)}getReverseTransitions(e,r){let o=this.reverseTransitions.get(e.toString());if(o)return o.get(r)}setTransition(e,r,o){var a,u,h,p,g;this.transitions.has(e.toString())||this.transitions.set(e.toString(),new Map),this.reverseTransitions.has(e.toString())||this.reverseTransitions.set(e.toString(),new Map),(a=this.transitions.get(e.toString()))==null||a.set(r,o),(u=this.reverseTransitions.get(e.toString()))!=null&&u.has(o)||(h=this.reverseTransitions.get(e.toString()))==null||h.set(o,new Set),(g=(p=this.reverseTransitions.get(e.toString()))==null?void 0:p.get(o))==null||g.add(r)}getTransitions(){return new Map([...this.transitions].map(([e,r])=>[e,new Map(r)]))}getTileCosts(e,r){let o=this.getCollisionRelevantLayers(e.layer),a=1;for(let u of o)a=Math.max(a,this.getTileCostsForLayer(Bt(K({},e),{layer:u.getName()}),r));return a}getTileCostsForLayer(e,r){let o=this.tilemap.getTileAt(e.position.x,e.position.y,e.layer);return r&&(o==null?void 0:o.getProperty(this.tileCostPropNames.get(r)||""))||(o==null?void 0:o.getProperty(_h))||1}hasNoTileUncached(e,r){return!this.getCollisionRelevantLayers(r).some(a=>this.tilemap.hasTileAt(e.x,e.y,a.getName()))}hasNoTile(e,r){var a;let o=(a=this.tileCollisionCache)==null?void 0:a.hasTileAt(e.x,e.y,r);return o!==void 0?o:this.hasNoTileUncached(e,r)}hasBlockingChar(e,r,o,a=new Set,u=new Set){return this.charBlockCache.isCharBlockingAt(e,r,o,a,u)}isInRange(e){return new tr(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()).isInRange(e)}toMapDirection(e){return this.isIsometric()?wc(e):e}fromMapDirection(e){return this.isIsometric()?Uo(e):e}isIsometric(){return this.tilemap.getOrientation()==="isometric"}getTilePosInDirection(e,r){let o=e.position.add(Ht(this.toMapDirection(r))),a=this.getTransition(o,e.layer)||e.layer;return{position:o,layer:a}}invalidateFrameCache(){this.collisionRelevantLayersFrameCache.clear()}isLayerBlockingAt(e,r,o){let a=this.tilemap.getTileAt(r.x,r.y,e);return a?!!(a.getProperty(this.collisionTilePropertyName)||o&&a.getProperty(this.collidesPropNames.get(o)||"")):!1}getCharLayerIndexes(){return this.tilemap.getLayers().map((e,r)=>({layer:e,index:r})).filter(({layer:e})=>e.isCharLayer()).map(({index:e})=>e)}findPrevAndCharLayer(e){let r=this.getCharLayerIndexes(),o=this.tilemap.getLayers(),a=r.findIndex(u=>o[u].getProperty(Xr)==e);return a==0?{prevIndex:-1,charLayerIndex:r[a]}:{prevIndex:r[a-1],charLayerIndex:r[a]}}getCollisionRelevantLayers(e){if(!e)return this.tilemap.getLayers();let r=this.collisionRelevantLayersFrameCache.get(e);if(r)return r;let{prevIndex:o,charLayerIndex:a}=this.findPrevAndCharLayer(e),u=this.tilemap.getLayers().slice(o+1,a+1);return this.collisionRelevantLayersFrameCache.set(e,u),u}getLowestCharLayer(){for(let e of this.tilemap.getLayers())if(e.isCharLayer())return e.getProperty(Xr)}getCharLayerNames(){return this.tilemap.getLayers().filter(e=>e.isCharLayer()).map(e=>e.getProperty(Xr)).filter(DP)}};An.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_";var Mn=An;function DP(s){return s!=null}var Rn=(r=>(r.REMOVED="REMOVED",r.ADDED="ADDED",r))(Rn||{});var Ra=(o=>(o.WAIT="WAIT",o.SKIP="SKIP",o.STOP="STOP",o))(Ra||{}),Fn=class{constructor(e,r){this.character=e;this.tilemap=r;this.queue=new Ge;this.finished$=new J;this.pathBlockedWaitElapsed=0;this.distanceUtils=ue.create(e.getNumberOfDirections())}init(){this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)).subscribe(()=>{this.queue.size()>0&&this.finishMovementTerminated(),this.finished$.complete()})}update(e){(!this.character.isMoving()||this.character.willCrossTileBorderThisUpdate(e))&&this.queue.size()>0&&this.moveCharOnPath(e)}getInfo(){return{type:"Queue"}}enqueue(e,r={}){var a,u,h;let o={pathBlockedStrategy:(a=r.pathBlockedStrategy)!=null?a:"STOP",pathBlockedWaitTimeoutMs:(r==null?void 0:r.pathBlockedWaitTimeoutMs)||-1,ignoreInvalidPositions:(u=r.ignoreInvalidPositions)!=null?u:!1,skipInvalidPositions:(h=r.skipInvalidPositions)!=null?h:!1};for(let p of e){let g={command:p,config:o};if(Qe(p)){this.queue.enqueue(g);continue}let T=this.queue.peekEnd(),L=T==null?void 0:T.command;if(L||(L=this.character.getNextTilePos()),Qe(L)){this.queue.enqueue(g);continue}let D=this.distanceUtils.distance(L.position,p.position)===1;(!r.ignoreInvalidPositions||D)&&this.queue.enqueue(g)}}peekAll(){return this.queue.peekAll()}size(){return this.queue.size()}finished(){return this.finished$}clear(){this.queue.clear()}moveCharOnPath(e){let r=this.queue.peek();if(!r)return;let o=r.command,a=r.config;if(Qe(o)&&(o=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),o)),a.skipInvalidPositions){if(o=this.getNextValidPosition(),!o){this.finishInvalidNextPos(o);return}}else if(!this.isNeighborPos(o)){this.finishInvalidNextPos(o);return}if(this.character.isBlockingDirection(vt(this.character.getNextTilePos().position,o.position))){if(a.pathBlockedStrategy==="STOP")this.finishPathBlocked(o);else if(a.pathBlockedStrategy==="SKIP"){this.queue.dequeue(),this.moveCharOnPath(e);return}else a.pathBlockedStrategy==="WAIT"&&a.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=a.pathBlockedWaitTimeoutMs&&this.finishBlockedWaitTimeout(o,a.pathBlockedWaitTimeoutMs));return}this.pathBlockedWaitElapsed=0,this.queue.dequeue(),this.character.move(this.getDir(this.character.getNextTilePos().position,o.position)),this.isLastMovement()&&this.finish("SUCCESS","",o)}getNextValidPosition(){var e;for(;this.queue.size()>0;){let r=(e=this.queue.peek())==null?void 0:e.command;if(Qe(r)&&(r=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),r)),r&&this.isNeighborPos(r))return r;this.queue.dequeue()}}isLastMovement(){return this.queue.size()===0}isNeighborPos(e){let r=this.distanceUtils.distance(this.character.getNextTilePos().position,e.position)===1,o=this.tilemap.getTransition(e.position,this.character.getNextTilePos().layer);if(this.character.getNextTilePos().layer!==e.layer)return r&&o===e.layer;let a=o!==void 0&&o!==e.layer;return r&&!a}finishMovementTerminated(){this.finish("MOVEMENT_TERMINATED","New automatic movement has been set to character.")}finishInvalidNextPos(e){e?this.finish("INVALID_NEXT_POS",`Position ${this.posToStr(e)} is not reachable from ${this.posToStr(this.character.getNextTilePos())}.`):this.finish("INVALID_NEXT_POS",`No enqueued position is reachable from ${this.posToStr(this.character.getNextTilePos())}.`)}finishPathBlocked(e){this.finish("PATH_BLOCKED",`Position ${this.posToStr(e)} is blocked.`)}finishBlockedWaitTimeout(e,r){this.finish("PATH_BLOCKED_WAIT_TIMEOUT",`Position ${this.posToStr(e)} is blocked and the wait timeout of ${r} ms has been exceeded.`)}finish(e,r="",o=this.character.getNextTilePos()){this.queue=new Ge,this.finished$.next({position:o.position,result:e,description:r,layer:o.layer})}getDir(e,r){return this.tilemap.fromMapDirection(vt(e,r))}posToStr(e){return`(${e.position.x}, ${e.position.y}, ${e.layer})`}};var ji=class{constructor(e=!0){this.isCreatedInternal=!1;e&&console.log(`Using GridEngine v${On}`)}getCharLayer(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getTilePos().layer}getTransition(e,r){var o;return this.initGuard(),(o=this.gridTilemap)==null?void 0:o.getTransition(new P(e),r)}setTransition(e,r,o){var a;return this.initGuard(),(a=this.gridTilemap)==null?void 0:a.setTransition(new P(e),r,o)}create(e,r){this.isCreatedInternal=!0,this.gridCharacters=new Map;let o=this.setConfigDefaults(r);this.config=o,this.movementStopped$=new J,this.movementStarted$=new J,this.directionChanged$=new J,this.positionChangeStarted$=new J,this.positionChangeFinished$=new J,this.queueMovementFinished$=new J,this.charRemoved$=new J,this.charAdded$=new J,this.gridTilemap=new Mn(e,this.config.collisionTilePropertyName,this.config.characterCollisionStrategy,this.recordToMap(this.config.collisionGroupRelation),this.config.cacheTileCollisions),this.addCharacters()}recordToMap(e){return e?new Map(Object.entries(e).map(([o,a])=>[o,new Set(a)])):void 0}getPosition(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getTilePos().position}move(e,r){this.moveChar(e,r)}moveRandomly(e,r=0,o=-1){var h;this.initGuard();let a=(h=this.gridCharacters)==null?void 0:h.get(e);if(!a)throw this.createCharUnknownErr(e);let u=new Sn(a,r,o);a.setMovement(u)}getMovement(e){var a;this.initGuard();let r=(a=this.gridCharacters)==null?void 0:a.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getMovement();return o?o.getInfo():{type:"None"}}moveTo(e,r,o){var p;let a=this.assembleMoveToConfig(o);this.initGuard();let u=(p=this.gridCharacters)==null?void 0:p.get(e);if(!u)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let h=new Yr(u,this.gridTilemap,{position:new P(r),layer:(o==null?void 0:o.targetLayer)||u.getNextTilePos().layer},{distance:0,config:a});return u.setMovement(h),h.init(),h.finishedObs().pipe(be(g=>({charId:e,position:g.position,result:g.result,description:g.description,layer:g.layer})))}stopMovement(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.setMovement(void 0)}setSpeed(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setSpeed(r)}getSpeed(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getSpeed()}collidesWithTiles(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.collidesWithTiles()}update(e,r){var o;if(this.isCreatedInternal&&this.gridCharacters)for(let[a,u]of this.gridCharacters)u.update(r);(o=this.gridTilemap)==null||o.invalidateFrameCache()}addCharacter(e){var u,h,p,g,T;if(!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let r={speed:e.speed||4,tilemap:this.gridTilemap,collidesWithTiles:!0,collisionGroups:["geDefault"],ignoreCollisionGroups:[],charLayer:e.charLayer,facingDirection:e.facingDirection,labels:e.labels,numberOfDirections:(u=e.numberOfDirections)!=null?u:this.config.numberOfDirections,tileWidth:e.tileWidth,tileHeight:e.tileHeight};typeof e.collides=="boolean"?e.collides===!1&&(r.collidesWithTiles=!1,r.collisionGroups=[]):e.collides!==void 0&&(e.collides.collidesWithTiles===!1&&(r.collidesWithTiles=!1),e.collides.collisionGroups&&(r.collisionGroups=e.collides.collisionGroups),e.collides.ignoreCollisionGroups&&(r.ignoreCollisionGroups=e.collides.ignoreCollisionGroups),r.ignoreMissingTiles=(p=(h=e.collides)==null?void 0:h.ignoreMissingTiles)!=null?p:!1);let o=new mn(e.id,r);e.startPosition&&o.setTilePosition({position:new P(e.startPosition),layer:o.getTilePos().layer}),(g=this.gridCharacters)==null||g.set(e.id,o),this.gridTilemap.addCharacter(o);let a=o.getId();o.movementStopped().pipe(gt(this.charRemoved(a))).subscribe(L=>{var D;(D=this.movementStopped$)==null||D.next({charId:a,direction:L})}),o.movementStarted().pipe(gt(this.charRemoved(a))).subscribe(L=>{var D;(D=this.movementStarted$)==null||D.next({charId:a,direction:L})}),o.directionChanged().pipe(gt(this.charRemoved(a))).subscribe(L=>{var D;(D=this.directionChanged$)==null||D.next({charId:a,direction:L})}),o.positionChangeStarted().pipe(gt(this.charRemoved(a))).subscribe(L=>{var D;(D=this.positionChangeStarted$)==null||D.next(K({charId:a},L))}),o.positionChangeFinished().pipe(gt(this.charRemoved(a))).subscribe(L=>{var D;(D=this.positionChangeFinished$)==null||D.next(K({charId:a},L))}),(T=this.charAdded$)==null||T.next(a)}hasCharacter(e){var r;return this.initGuard(),!!((r=this.gridCharacters)!=null&&r.has(e))}removeCharacter(e){var o,a,u,h;if(this.initGuard(),!((o=this.gridCharacters)==null?void 0:o.get(e)))throw this.createCharUnknownErr(e);(a=this.gridTilemap)==null||a.removeCharacter(e),(u=this.gridCharacters)==null||u.delete(e),(h=this.charRemoved$)==null||h.next(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters)for(let e of this.gridCharacters.keys())this.removeCharacter(e)}getAllCharacters(e){if(this.initGuard(),!this.gridCharacters)return[];let r=[...this.gridCharacters.values()];return(e?wh(r,e):r).map(a=>a.getId())}getLabels(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getLabels()}addLabels(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.addLabels(r)}removeLabels(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.removeLabels(r)}clearLabels(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.clearLabels()}follow(e,r,o,a){var T,L,D,Y,M,H,B,st,ft;let u;o===void 0?u={distance:0,closestPointIfBlocked:!1}:typeof o=="number"?(u={distance:o,closestPointIfBlocked:!1},a&&(u.closestPointIfBlocked=!0)):u=o,this.initGuard();let h=(T=this.gridCharacters)==null?void 0:T.get(e),p=(L=this.gridCharacters)==null?void 0:L.get(r);if(!h)throw this.createCharUnknownErr(e);if(!p)throw this.createCharUnknownErr(r);if(!this.gridTilemap)throw this.createUninitializedErr();let g=new Ln(h,this.gridTilemap,p,{distance:(D=u.distance)!=null?D:0,noPathFoundStrategy:u.closestPointIfBlocked?"CLOSEST_REACHABLE":"STOP",maxPathLength:(Y=u.maxPathLength)!=null?Y:1/0,shortestPathAlgorithm:(M=u.algorithm)!=null?M:"BIDIRECTIONAL_SEARCH",ignoreLayers:!!u.ignoreLayers,facingDirection:(H=u.facingDirection)!=null?H:"none",considerCosts:(B=u.considerCosts)!=null?B:!1,isPositionAllowedFn:(st=u.isPositionAllowedFn)!=null?st:(()=>!0),ignoredChars:(ft=u.ignoredChars)!=null?ft:[]});h.setMovement(g),g.init()}isMoving(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.isMoving()}getFacingDirection(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getFacingDirection()}getFacingPosition(e){var a;this.initGuard();let r=(a=this.gridCharacters)==null?void 0:a.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getFacingPosition();return{x:o.x,y:o.y}}turnTowards(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);return o.turnTowards(r)}getCharactersAt(e,r){if(this.initGuard(),!this.gridTilemap)return[];let o=this.gridTilemap.getCharactersAt(new P(e),r);return Array.from(o).map(a=>a.getId())}setPosition(e,r,o){var u;this.initGuard();let a=(u=this.gridCharacters)==null?void 0:u.get(e);if(!a)throw this.createCharUnknownErr(e);o||a.setTilePosition({position:new P(r),layer:a.getTilePos().layer}),a.setTilePosition({position:new P(r),layer:o})}isBlocked(e,r,o=["geDefault"]){var u,h;this.initGuard();let a=new P(e);return!!((u=this.gridTilemap)!=null&&u.hasBlockingTile(a,r)||(h=this.gridTilemap)!=null&&h.hasBlockingChar(a,r,o))}isTileBlocked(e,r){var o;return this.initGuard(),!!((o=this.gridTilemap)!=null&&o.hasBlockingTile(new P(e),r))}getCollisionGroups(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getCollisionGroups()||[]}setCollisionGroups(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setCollisionGroups(r)}getIgnoreCollisionGroups(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getIgnoreCollisionGroups()||[]}setIgnoreCollisionGroups(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setIgnoreCollisionGroups(r)}getTilePosInDirection(e,r,o){if(!this.gridTilemap)throw this.createUninitializedErr();let a=this.gridTilemap.getTilePosInDirection({position:new P(e),layer:r},o);return{position:a.position.toPosition(),charLayer:a.layer}}findShortestPath(e,r,o={}){if(!this.gridTilemap)throw this.createUninitializedErr();let a=o.shortestPathAlgorithm||"BFS";o.considerCosts&&a!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${a}'. It can only be used with A* algorithm.`);let u=o.pathWidth!==void 0&&o.pathWidth!==1,h=o.pathHeight!==void 0&&o.pathHeight!==1;(u||h)&&a==="JPS"&&console.warn("GridEngine: Pathfinding options 'pathWidth' and 'pathHeight' > 1 cannot be used with algorithm 'JPS'.");let g=new Qr(this.gridTilemap).findShortestPath(A.toInternal(e),A.toInternal(r),Bt(K({},o),{shortestPathAlgorithm:a}));return{path:g.path.map(A.fromInternal),closestToTarget:g.closestToTarget?A.fromInternal(g.closestToTarget):void 0,reachedMaxPathLength:!1,steps:g.steps}}steppedOn(e,r,o){return this.positionChangeFinished().pipe(Tt(a=>e.includes(a.charId)&&r.some(u=>u.x===a.enterTile.x&&u.y===a.enterTile.y)&&(o===void 0||o.includes(a.enterLayer))))}characterShifted(){if(!this.charAdded$||!this.charRemoved$)throw this.createUninitializedErr();return this.charAdded$.pipe(be(e=>({charId:e,action:"ADDED"})),va(this.charRemoved$.pipe(be(e=>({charId:e,action:"REMOVED"})))))}movementStarted(){if(!this.movementStarted$)throw this.createUninitializedErr();return this.movementStarted$}movementStopped(){if(!this.movementStopped$)throw this.createUninitializedErr();return this.movementStopped$}directionChanged(){if(!this.directionChanged$)throw this.createUninitializedErr();return this.directionChanged$}positionChangeStarted(){if(!this.positionChangeStarted$)throw this.createUninitializedErr();return this.positionChangeStarted$}positionChangeFinished(){if(!this.positionChangeFinished$)throw this.createUninitializedErr();return this.positionChangeFinished$}getMovementProgress(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getMovementProgress()}rebuildTileCollisionCache(e,r,o,a){var u;(u=this.gridTilemap)==null||u.rebuildTileCollisionCache(new tr(e,r,o,a))}addQueueMovements(e,r,o){var h,p;this.initGuard();let a=(h=this.gridCharacters)==null?void 0:h.get(e);if(!a)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let u;((p=a==null?void 0:a.getMovement())==null?void 0:p.getInfo().type)==="Queue"?u=a.getMovement():(u=new Fn(a,this.gridTilemap),a.setMovement(u),u.init(),u.finished().pipe(gt(ya(this.charRemoved(e),a.autoMovementSet()))).subscribe(g=>{var T;(T=this.queueMovementFinished$)==null||T.next(K({charId:e},g))})),u.enqueue(r.map(g=>Qe(g)?g:{position:new P(g.position),layer:g.charLayer}),o)}queueMovementFinished(){if(!this.queueMovementFinished$)throw this.createUninitializedErr();return this.queueMovementFinished$}getEnqueuedMovements(e){var o,a;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return((a=r.getMovement())==null?void 0:a.getInfo().type)==="Queue"?r.getMovement().peekAll().map(h=>({command:Qe(h.command)?h.command:A.fromInternal(h.command),config:h.config})):[]}clearEnqueuedMovements(e){var o,a;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);((a=r.getMovement())==null?void 0:a.getInfo().type)==="Queue"&&r.getMovement().clear()}getTileCost(e,r,o){var a,u;return this.initGuard(),(u=(a=this.gridTilemap)==null?void 0:a.getTileCosts({position:new P(e),layer:r},o))!=null?u:1}getState(){let e=[];if(this.gridCharacters)for(let[r,o]of this.gridCharacters.entries())e.push({id:r,position:A.fromInternal(o.getTilePos()),facingDirection:o.getFacingDirection(),speed:o.getSpeed(),labels:o.getLabels(),movementProgress:o.getMovementProgress(),collisionConfig:{collisionGroups:o.getCollisionGroups(),ignoreCollisionGroups:o.getIgnoreCollisionGroups(),collidesWithTiles:o.collidesWithTiles(),ignoreMissingTiles:o.getIgnoreMissingTiles()}});return{characters:e}}setState(e){if(this.gridCharacters)for(let r of e.characters){let o=this.gridCharacters.get(r.id);if(o){let a=o.getTilePos();A.equal(a,A.toInternal(r.position))||o.setTilePosition(A.toInternal(r.position)),o.setSpeed(r.speed),o.turnTowards(r.facingDirection),r.collisionConfig.collisionGroups&&o.setCollisionGroups(r.collisionConfig.collisionGroups),r.collisionConfig.collidesWithTiles!==void 0&&o.setCollidesWithTiles(r.collisionConfig.collidesWithTiles),r.collisionConfig.ignoreMissingTiles!==void 0&&o.setIgnoreMissingTiles(r.collisionConfig.ignoreMissingTiles),o.setMovementProgress(r.movementProgress),o.clearLabels(),o.addLabels(r.labels)}}}revertCurrentMovement(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.revertCurrentMovement()}isCurrentMovementReverted(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.isCurrentMovementReverted()}charRemoved(e){var r;if(!this.charRemoved$)throw this.createUninitializedErr();return(r=this.charRemoved$)==null?void 0:r.pipe(Ft(1),Tt(o=>o==e))}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(r=>this.addCharacter(r))}moveChar(e,r){var a,u,h;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);if(o.getNumberOfDirections()===4){if(!((u=this.gridTilemap)!=null&&u.isIsometric())&&pr(r)){console.warn(`GridEngine: Character '${e}' can't be moved '${r}' in 4 direction mode.`);return}else if((h=this.gridTilemap)!=null&&h.isIsometric()&&!pr(r)){console.warn(`GridEngine: Character '${e}' can't be moved '${r}' in 4 direction isometric mode.`);return}}o.move(r)}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}assembleMoveToConfig(e={}){let r=Bt(K({},e),{noPathFoundStrategy:"STOP",pathBlockedStrategy:"WAIT"});return e!=null&&e.noPathFoundStrategy&&(Object.values(Pr).includes(e.noPathFoundStrategy)?r.noPathFoundStrategy=e.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${e.noPathFoundStrategy}'. Falling back to 'STOP'`)),e!=null&&e.pathBlockedStrategy&&(Object.values(Wr).includes(e.pathBlockedStrategy)?r.pathBlockedStrategy=e.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${e.pathBlockedStrategy}'. Falling back to 'WAIT'`)),r}setConfigDefaults(e){return K({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",cacheTileCollisions:!1},e)}};var Vn=class extends qr{constructor(r,o={}){super(r,o);this.jumpCache=new Gn}findShortestPathImpl(r,o){return this.jumpCache=new Gn,super.findShortestPathImpl(r,o)}getNeighborsInternal(r,o,a){if(!o||r.layer!==o.layer)return this.getNeighbors(r,a).map(p=>({p,dist:1}));let u=this.prune(o,r).map(p=>{let g=this.getTransition(p.position,r.layer);return{position:p.position,layer:g||r.layer}}),h=[];for(let p of u){let g=this.jump(r,p,a,1,vt(r.position,p.position));g&&(g.dist=this.distance(r.position,g.p.position),h.push(g))}return h}getForced(r,o){let a=[],{topLeft:u,downLeft:h,top:p,bottom:g,topRight:T,downRight:L}=this.normalizedPositions(r,o),D=vt(r.position,o.position);return pr(D)?(this.blockOrTrans(r,u)&&(this.addIfNotBlocked(a,o,p),this.addIfNotBlocked(a,o,T),this.blockOrTrans(h,u)&&this.addIfNotBlocked(a,o,u)),this.blockOrTrans(r,h)&&(this.addIfNotBlocked(a,o,g),this.addIfNotBlocked(a,o,L),this.blockOrTrans(u,h)&&this.addIfNotBlocked(a,o,h)),this.blockOrTrans(u,p)&&this.addIfNotBlocked(a,o,p),this.blockOrTrans(h,g)&&this.addIfNotBlocked(a,o,g),this.blockOrTrans(u,T)&&this.addIfNotBlocked(a,o,T),this.blockOrTrans(h,L)&&this.addIfNotBlocked(a,o,L)):((this.blockOrTrans(r,p)||this.blockOrTrans(p,T))&&this.addIfNotBlocked(a,o,T),(this.blockOrTrans(r,g)||this.blockOrTrans(g,L))&&this.addIfNotBlocked(a,o,L),this.blockOrTrans(r,u)&&this.blockOrTrans(r,p)&&(this.addIfNotBlocked(a,o,p),this.addIfNotBlocked(a,o,u)),this.blockOrTrans(r,h)&&this.blockOrTrans(r,g)&&(this.addIfNotBlocked(a,o,g),this.addIfNotBlocked(a,o,h)),this.blockOrTrans(u,p)&&this.blockOrTrans(r,p)&&this.addIfNotBlocked(a,o,p),this.blockOrTrans(h,g)&&this.blockOrTrans(r,g)&&this.addIfNotBlocked(a,o,g)),a}hasForced(r,o){let{topLeft:a,downLeft:u,top:h,bottom:p,topRight:g,downRight:T}=this.normalizedPositions(r,o),L=vt(r.position,o.position);if(pr(L)){if(this.blockOrTrans(r,a)&&(!this.blockOrTrans(o,h)||!this.blockOrTrans(o,g)||this.blockOrTrans(u,a)&&!this.blockOrTrans(o,a))||this.blockOrTrans(r,u)&&(!this.blockOrTrans(o,p)||!this.blockOrTrans(o,T)||this.blockOrTrans(a,u)&&!this.blockOrTrans(o,u))||this.blockOrTrans(a,h)&&!this.blockOrTrans(o,h)||this.blockOrTrans(u,p)&&!this.blockOrTrans(o,p)||this.blockOrTrans(a,g)&&!this.blockOrTrans(o,g)||this.blockOrTrans(u,T)&&!this.blockOrTrans(o,T))return!0}else if((this.blockOrTrans(r,h)||this.blockOrTrans(h,g))&&!this.blockOrTrans(o,g)||(this.blockOrTrans(r,p)||this.blockOrTrans(p,T))&&!this.blockOrTrans(o,T)||this.blockOrTrans(r,a)&&this.blockOrTrans(r,h)&&(!this.blockOrTrans(o,h)||!this.blockOrTrans(o,a))||this.blockOrTrans(r,u)&&this.blockOrTrans(r,p)&&(!this.blockOrTrans(o,p)||!this.blockOrTrans(o,u))||this.blockOrTrans(a,h)&&this.blockOrTrans(r,h)&&!this.blockOrTrans(o,h)||this.blockOrTrans(u,p)&&this.blockOrTrans(r,p)&&!this.blockOrTrans(o,p))return!0;return!1}prune(r,o){let{top:a,right:u,topRight:h,downRight:p,bottom:g}=this.normalizedPositions(r,o),T=this.getForced(r,o),L=vt(r.position,o.position);return pr(L)?[a,u,h,p,g,...T]:[u,...T]}jump(r,o,a,u,h){let p=this.jumpCache.get(r,o);if(p!==null)return p;if(this.isBlocking(r,o)&&!(A.equal(o,a)&&this.options.ignoreBlockedTarget)){this.jumpCache.set(r,o,void 0);return}if(A.equal(o,a))return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(u>=this.maxJumpSize)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.getTransition(o.position,r.layer)!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.hasForced(r,o))return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.updateClosestToTarget(o,a),h==="up-left"){if(this.jump(o,this.getTilePosInDir(o,"up"),a,u+1,"up")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"left"),a,u+1,"left")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="down-left"){if(this.jump(o,this.getTilePosInDir(o,"down"),a,u+1,"down")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"left"),a,u+1,"left")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="up-right"){if(this.jump(o,this.getTilePosInDir(o,"up"),a,u+1,"up")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"right"),a,u+1,"right")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="down-right"){if(this.jump(o,this.getTilePosInDir(o,"down"),a,u+1,"down")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"right"),a,u+1,"right")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}let g=this.jump(o,this.getTilePosInDir(o,h),a,u+1,h);return this.jumpCache.set(r,o,g),g}normalizedPositions(r,o){return r.position.x<o.position.x&&r.position.y===o.position.y?{topLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer}}:r.position.x>o.position.x&&r.position.y===o.position.y?{topLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x===o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer}}:r.position.y>o.position.y&&r.position.x===o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x<o.position.x?{topLeft:{position:new P(o.position.x,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y),layer:o.layer},downRight:{position:new P(o.position.x,o.position.y+1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x>o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y),layer:o.layer},downLeft:{position:new P(o.position.x,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y),layer:o.layer}}:r.position.y>o.position.y&&r.position.x<o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y),layer:o.layer},downLeft:{position:new P(o.position.x,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y),layer:o.layer}}:{topLeft:{position:new P(o.position.x,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y),layer:o.layer},downRight:{position:new P(o.position.x,o.position.y-1),layer:o.layer}}}},Gn=class{constructor(){this.memo=new Map}set(e,r,o){let a=this.memo.get(e.position.x);a||(a=new Map,this.memo.set(e.position.x,a));let u=a.get(e.position.y);u||(u=new Map,a.set(e.position.y,u));let h=u.get(e.layer);h||(h=new Map,u.set(e.layer,h));let p=h.get(r.position.x);p||(p=new Map,h.set(r.position.x,p));let g=p.get(r.position.y);g||(g=new Map,p.set(r.position.y,g)),g.get(r.layer)||(o===void 0?g.set(r.layer,null):g.set(r.layer,o))}get(e,r){let o=this.memo.get(e.position.x);if(!o)return null;let a=o.get(e.position.y);if(!a)return null;let u=a.get(e.layer);if(!u)return null;let h=u.get(r.position.x);if(!h)return null;let p=h.get(r.position.y);if(!p)return null;let g=p.get(r.layer);return g===void 0?null:g===null?void 0:g}};var Qr=class{constructor(e){this.gridTilemap=e}findShortestPath(e,r,o={}){return IP(o.shortestPathAlgorithm||"BIDIRECTIONAL_SEARCH",this.gridTilemap,o).findShortestPath(e,r)}};function IP(s,e,r){switch(s){case"BIDIRECTIONAL_SEARCH":return new _n(e,r);case"A_STAR":return new xn(e,r);case"JPS":return r.numberOfDirections===8?new Vn(e,r):new qr(e,r)}return new $r(e,r)}var kn=(g=>(g.SUCCESS="SUCCESS",g.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",g.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",g.PATH_BLOCKED="PATH_BLOCKED",g.NO_PATH_FOUND="NO_PATH_FOUND",g.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",g.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED",g.MAX_PATH_LENGTH_REACHED="MAX_PATH_LENGTH_REACHED",g))(kn||{}),Yr=class{constructor(e,r,o,{config:a,ignoreBlockedTarget:u=!1,distance:h=0}={}){this.character=e;this.tilemap=r;this.targetPos=o;this.shortestPath=[];this.distOffset=0;this.posOnPath=0;this.stopped=!1;this.pathBlockedWaitElapsed=0;this.isPositionAllowed=()=>!0;this.shortestPathAlgorithm="BIDIRECTIONAL_SEARCH";this.maxPathLength=1/0;this.considerCosts=!1;this.ignoredChars=[];this.isBlocking=(e,r)=>e?new $r(this.tilemap,this.getPathfindingOptions()).isBlocking(this.character.getTilePos(),{position:e,layer:r}):!0;var p,g;this.shortestPathAlgorithm=(p=a==null?void 0:a.algorithm)!=null?p:this.shortestPathAlgorithm,this.ignoreBlockedTarget=u,this.distance=h,this.noPathFoundStrategy=(a==null?void 0:a.noPathFoundStrategy)||"STOP",this.pathBlockedStrategy=(a==null?void 0:a.pathBlockedStrategy)||"WAIT",this.noPathFoundRetryable=new Ii((a==null?void 0:a.noPathFoundRetryBackoffMs)||200,(a==null?void 0:a.noPathFoundMaxRetries)||-1,()=>{this.stop("NO_PATH_FOUND_MAX_RETRIES_EXCEEDED")}),this.pathBlockedRetryable=new Ii((a==null?void 0:a.pathBlockedRetryBackoffMs)||200,(a==null?void 0:a.pathBlockedMaxRetries)||-1,()=>{this.stop("PATH_BLOCKED_MAX_RETRIES_EXCEEDED")}),a!=null&&a.isPositionAllowedFn&&(this.isPositionAllowed=a.isPositionAllowedFn),a!=null&&a.maxPathLength&&(this.maxPathLength=a.maxPathLength),this.alternativeTargets=a==null?void 0:a.alternativeTargets,this.noPathFoundAlternativeTargetsFallbackStrategy=a==null?void 0:a.noPathFoundAlternativeTargetsFallbackStrategy,a!=null&&a.considerCosts&&this.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1"),this.considerCosts=(a==null?void 0:a.considerCosts)||!1,this.ignoreLayers=!!(a!=null&&a.ignoreLayers),this.distanceUtils=ue.create(e.getNumberOfDirections()),this.pathBlockedWaitTimeoutMs=(a==null?void 0:a.pathBlockedWaitTimeoutMs)||-1,this.ignoredChars=(g=a==null?void 0:a.ignoredChars)!=null?g:[],this.finished$=new J}init(){this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)).subscribe(()=>{this.stop("MOVEMENT_TERMINATED")})}setPathBlockedStrategy(e){this.pathBlockedStrategy=e}getPathBlockedStrategy(){return this.pathBlockedStrategy}getPathfindingOptions(){return{shortestPathAlgorithm:this.shortestPathAlgorithm,pathWidth:this.character.getTileWidth(),pathHeight:this.character.getTileHeight(),numberOfDirections:this.character.getNumberOfDirections(),isPositionAllowed:this.isPositionAllowed,collisionGroups:this.character.getCollisionGroups(),ignoredChars:[this.character.getId(),...this.ignoredChars],ignoreTiles:!this.character.collidesWithTiles(),ignoreMapBounds:this.character.getIgnoreMissingTiles(),ignoreBlockedTarget:this.ignoreBlockedTarget,maxPathLength:this.maxPathLength,ignoreLayers:this.ignoreLayers,considerCosts:this.considerCosts,calculateClosestToTarget:!0}}update(e){var r,o,a,u;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy==="RETRY"?this.noPathFoundRetryable.retry(e,()=>this.calcShortestPath()):this.noPathFoundStrategy==="STOP"&&this.stop("NO_PATH_FOUND")),this.updatePosOnPath(),this.isBlocking((r=this.nextTileOnPath())==null?void 0:r.position,(o=this.character)==null?void 0:o.getNextTilePos().layer)?this.applyPathBlockedStrategy(e):this.pathBlockedWaitElapsed=0,this.updatePosOnPath(),this.hasArrived()?(this.stop("SUCCESS"),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking((a=this.nextTileOnPath())==null?void 0:a.position,(u=this.character)==null?void 0:u.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}getInfo(){return{type:"Target",state:{pathAhead:this.shortestPath.slice(this.posOnPath).map(e=>A.fromInternal(e))},config:{algorithm:this.shortestPathAlgorithm,ignoreBlockedTarget:this.ignoreBlockedTarget,distance:this.distance,targetPos:A.fromInternal(this.targetPos),noPathFoundStrategy:this.noPathFoundStrategy,pathBlockedStrategy:this.pathBlockedStrategy,noPathFoundRetryBackoffMs:this.noPathFoundRetryable.getBackoffMs(),noPathFoundMaxRetries:this.noPathFoundRetryable.getMaxRetries()}}}resultToReason(e){switch(e){case"SUCCESS":return"Successfully arrived.";case"MOVEMENT_TERMINATED":return"Movement of character has been replaced before destination was reached.";case"PATH_BLOCKED":return"PathBlockedStrategy STOP: Path blocked.";case"NO_PATH_FOUND_MAX_RETRIES_EXCEEDED":return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case"NO_PATH_FOUND":return"NoPathFoundStrategy STOP: No path found.";case"PATH_BLOCKED_MAX_RETRIES_EXCEEDED":return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case"PATH_BLOCKED_WAIT_TIMEOUT":return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(e){this.pathBlockedStrategy==="RETRY"?this.pathBlockedRetryable.retry(e,()=>{let r=this.getShortestPath();r.path.length>0&&this.calcShortestPath(r)}):this.pathBlockedStrategy==="STOP"?this.stop("PATH_BLOCKED"):this.pathBlockedStrategy==="WAIT"&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop("PATH_BLOCKED_WAIT_TIMEOUT"))}moveCharOnPath(){let e=this.nextTileOnPath();if(!e)return;let r=this.getDir(this.character.getNextTilePos().position,e.position);this.character.move(r)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(e){this.finished$.next({position:this.character.getTilePos().position,result:e,description:this.resultToReason(e),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let e=this.shortestPath[this.posOnPath+1],r=this.getDir(this.character.getNextTilePos().position,e.position);this.character.turnTowards(r)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let e=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=e.position.x||this.character.getNextTilePos().position.y!=e.position.y);)this.posOnPath++,e=this.shortestPath[this.posOnPath]}noPathFound(){return this.shortestPath.length===0}calcShortestPath(e){e=e!=null?e:this.getShortestPath(),this.posOnPath=0,this.shortestPath=e.path,this.distOffset=e.distOffset}getShortestPath(){var u;let e=new Qr(this.tilemap),{path:r,closestToTarget:o}=e.findShortestPath(this.character.getNextTilePos(),this.targetPos,this.getPathfindingOptions());if(r.length==0){if(this.noPathFoundStrategy==="CLOSEST_REACHABLE"){if(!o)throw Error("ClosestToTarget should never be undefined in TargetMovement.");return this.pathToAlternativeTarget(o,e)}else if(this.noPathFoundStrategy==="ALTERNATIVE_TARGETS"){for(let h of(u=this.alternativeTargets)!=null?u:[]){let{path:p,distOffset:g}=this.pathToAlternativeTarget(A.toInternal(h),e);if(p.length>0)return{path:p,distOffset:g}}return this.noPathFoundStrategy=this.noPathFoundAlternativeTargetsFallbackStrategy||"STOP",this.getShortestPath()}}return{path:r,distOffset:0}}pathToAlternativeTarget(e,r){let o=r.findShortestPath(this.character.getNextTilePos(),e,this.getPathfindingOptions()).path,a=this.distanceUtils.distance(e.position,this.targetPos.position);return{path:o,distOffset:a}}getDir(e,r){return this.tilemap.fromMapDirection(this.distanceUtils.direction(e,r))}};var MP=Object.create,Sh=Object.defineProperty,AP=Object.getOwnPropertyDescriptor,RP=Object.getOwnPropertyNames,FP=Object.getPrototypeOf,kP=Object.prototype.hasOwnProperty,VP=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),GP=(s,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of RP(e))!kP.call(s,a)&&a!==r&&Sh(s,a,{get:()=>e[a],enumerable:!(o=AP(e,a))||o.enumerable});return s},ka=(s,e,r)=>(r=s!=null?MP(FP(s)):{},GP(e||!s||!s.__esModule?Sh(r,"default",{value:s,enumerable:!0}):r,s)),Va=VP((s,e)=>{(function(){var r,o="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",g="__lodash_hash_undefined__",T=500,L="__lodash_placeholder__",D=1,Y=2,M=4,H=1,B=2,st=1,ft=2,rr=4,ce=8,wr=16,he=32,Cr=64,_e=128,ti=256,Un=512,Ih=30,Mh="...",Ah=800,Rh=16,Ua=1,Fh=2,kh=3,ir=1/0,Ne=9007199254740991,Vh=17976931348623157e292,zi=NaN,fe=4294967295,Gh=fe-1,Nh=fe>>>1,jh=[["ary",_e],["bind",st],["bindKey",ft],["curry",ce],["curryRight",wr],["flip",Un],["partial",he],["partialRight",Cr],["rearg",ti]],_r="[object Arguments]",$i="[object Array]",Uh="[object AsyncFunction]",ei="[object Boolean]",ri="[object Date]",Bh="[object DOMException]",qi="[object Error]",Yi="[object Function]",Ba="[object GeneratorFunction]",ee="[object Map]",ii="[object Number]",Hh="[object Null]",Le="[object Object]",Ha="[object Promise]",Wh="[object Proxy]",oi="[object RegExp]",re="[object Set]",ni="[object String]",Xi="[object Symbol]",zh="[object Undefined]",si="[object WeakMap]",$h="[object WeakSet]",ai="[object ArrayBuffer]",Lr="[object DataView]",Bn="[object Float32Array]",Hn="[object Float64Array]",Wn="[object Int8Array]",zn="[object Int16Array]",$n="[object Int32Array]",qn="[object Uint8Array]",Yn="[object Uint8ClampedArray]",Xn="[object Uint16Array]",Qn="[object Uint32Array]",qh=/\b__p \+= '';/g,Yh=/\b(__p \+=) '' \+/g,Xh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wa=/&(?:amp|lt|gt|quot|#39);/g,za=/[&<>"']/g,Qh=RegExp(Wa.source),Kh=RegExp(za.source),Jh=/<%-([\s\S]+?)%>/g,Zh=/<%([\s\S]+?)%>/g,$a=/<%=([\s\S]+?)%>/g,tf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ef=/^\w*$/,rf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Kn=/[\\^$.*+?()[\]{}|]/g,of=RegExp(Kn.source),Jn=/^\s+/,nf=/\s/,sf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,af=/\{\n\/\* \[wrapped with (.+)\] \*/,uf=/,? & /,lf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,cf=/[()=,{}\[\]\/\s]/,hf=/\\(\\)?/g,ff=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qa=/\w*$/,pf=/^[-+]0x[0-9a-f]+$/i,mf=/^0b[01]+$/i,gf=/^\[object .+?Constructor\]$/,df=/^0o[0-7]+$/i,yf=/^(?:0|[1-9]\d*)$/,vf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qi=/($^)/,bf=/['\n\r\u2028\u2029\\]/g,Ki="\\ud800-\\udfff",Pf="\\u0300-\\u036f",Tf="\\ufe20-\\ufe2f",xf="\\u20d0-\\u20ff",Ya=Pf+Tf+xf,Xa="\\u2700-\\u27bf",Qa="a-z\\xdf-\\xf6\\xf8-\\xff",wf="\\xac\\xb1\\xd7\\xf7",Cf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",_f="\\u2000-\\u206f",Lf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ka="A-Z\\xc0-\\xd6\\xd8-\\xde",Ja="\\ufe0e\\ufe0f",Za=wf+Cf+_f+Lf,Zn="['\u2019]",Sf="["+Ki+"]",tu="["+Za+"]",Ji="["+Ya+"]",eu="\\d+",Of="["+Xa+"]",ru="["+Qa+"]",iu="[^"+Ki+Za+eu+Xa+Qa+Ka+"]",ts="\\ud83c[\\udffb-\\udfff]",Ef="(?:"+Ji+"|"+ts+")",ou="[^"+Ki+"]",es="(?:\\ud83c[\\udde6-\\uddff]){2}",rs="[\\ud800-\\udbff][\\udc00-\\udfff]",Sr="["+Ka+"]",nu="\\u200d",su="(?:"+ru+"|"+iu+")",Df="(?:"+Sr+"|"+iu+")",au="(?:"+Zn+"(?:d|ll|m|re|s|t|ve))?",uu="(?:"+Zn+"(?:D|LL|M|RE|S|T|VE))?",lu=Ef+"?",cu="["+Ja+"]?",If="(?:"+nu+"(?:"+[ou,es,rs].join("|")+")"+cu+lu+")*",Mf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Af="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",hu=cu+lu+If,Rf="(?:"+[Of,es,rs].join("|")+")"+hu,Ff="(?:"+[ou+Ji+"?",Ji,es,rs,Sf].join("|")+")",kf=RegExp(Zn,"g"),Vf=RegExp(Ji,"g"),is=RegExp(ts+"(?="+ts+")|"+Ff+hu,"g"),Gf=RegExp([Sr+"?"+ru+"+"+au+"(?="+[tu,Sr,"$"].join("|")+")",Df+"+"+uu+"(?="+[tu,Sr+su,"$"].join("|")+")",Sr+"?"+su+"+"+au,Sr+"+"+uu,Af,Mf,eu,Rf].join("|"),"g"),Nf=RegExp("["+nu+Ki+Ya+Ja+"]"),jf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Uf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Bf=-1,ot={};ot[Bn]=ot[Hn]=ot[Wn]=ot[zn]=ot[$n]=ot[qn]=ot[Yn]=ot[Xn]=ot[Qn]=!0,ot[_r]=ot[$i]=ot[ai]=ot[ei]=ot[Lr]=ot[ri]=ot[qi]=ot[Yi]=ot[ee]=ot[ii]=ot[Le]=ot[oi]=ot[re]=ot[ni]=ot[si]=!1;var it={};it[_r]=it[$i]=it[ai]=it[Lr]=it[ei]=it[ri]=it[Bn]=it[Hn]=it[Wn]=it[zn]=it[$n]=it[ee]=it[ii]=it[Le]=it[oi]=it[re]=it[ni]=it[Xi]=it[qn]=it[Yn]=it[Xn]=it[Qn]=!0,it[qi]=it[Yi]=it[si]=!1;var Hf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Wf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},$f={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qf=parseFloat,Yf=parseInt,fu=typeof global=="object"&&global&&global.Object===Object&&global,Xf=typeof self=="object"&&self&&self.Object===Object&&self,dt=fu||Xf||Function("return this")(),os=typeof s=="object"&&s&&!s.nodeType&&s,or=os&&typeof e=="object"&&e&&!e.nodeType&&e,pu=or&&or.exports===os,ns=pu&&fu.process,zt=(function(){try{var v=or&&or.require&&or.require("util").types;return v||ns&&ns.binding&&ns.binding("util")}catch(w){}})(),mu=zt&&zt.isArrayBuffer,gu=zt&&zt.isDate,du=zt&&zt.isMap,yu=zt&&zt.isRegExp,vu=zt&&zt.isSet,bu=zt&&zt.isTypedArray;function kt(v,w,x){switch(x.length){case 0:return v.call(w);case 1:return v.call(w,x[0]);case 2:return v.call(w,x[0],x[1]);case 3:return v.call(w,x[0],x[1],x[2])}return v.apply(w,x)}function Qf(v,w,x,E){for(var V=-1,Q=v==null?0:v.length;++V<Q;){var pt=v[V];w(E,pt,x(pt),v)}return E}function $t(v,w){for(var x=-1,E=v==null?0:v.length;++x<E&&w(v[x],x,v)!==!1;);return v}function Kf(v,w){for(var x=v==null?0:v.length;x--&&w(v[x],x,v)!==!1;);return v}function Pu(v,w){for(var x=-1,E=v==null?0:v.length;++x<E;)if(!w(v[x],x,v))return!1;return!0}function je(v,w){for(var x=-1,E=v==null?0:v.length,V=0,Q=[];++x<E;){var pt=v[x];w(pt,x,v)&&(Q[V++]=pt)}return Q}function Zi(v,w){var x=v==null?0:v.length;return!!x&&Or(v,w,0)>-1}function ss(v,w,x){for(var E=-1,V=v==null?0:v.length;++E<V;)if(x(w,v[E]))return!0;return!1}function nt(v,w){for(var x=-1,E=v==null?0:v.length,V=Array(E);++x<E;)V[x]=w(v[x],x,v);return V}function Ue(v,w){for(var x=-1,E=w.length,V=v.length;++x<E;)v[V+x]=w[x];return v}function as(v,w,x,E){var V=-1,Q=v==null?0:v.length;for(E&&Q&&(x=v[++V]);++V<Q;)x=w(x,v[V],V,v);return x}function Jf(v,w,x,E){var V=v==null?0:v.length;for(E&&V&&(x=v[--V]);V--;)x=w(x,v[V],V,v);return x}function us(v,w){for(var x=-1,E=v==null?0:v.length;++x<E;)if(w(v[x],x,v))return!0;return!1}var Zf=ls("length");function tp(v){return v.split("")}function ep(v){return v.match(lf)||[]}function Tu(v,w,x){var E;return x(v,function(V,Q,pt){if(w(V,Q,pt))return E=Q,!1}),E}function to(v,w,x,E){for(var V=v.length,Q=x+(E?1:-1);E?Q--:++Q<V;)if(w(v[Q],Q,v))return Q;return-1}function Or(v,w,x){return w===w?pp(v,w,x):to(v,xu,x)}function rp(v,w,x,E){for(var V=x-1,Q=v.length;++V<Q;)if(E(v[V],w))return V;return-1}function xu(v){return v!==v}function wu(v,w){var x=v==null?0:v.length;return x?hs(v,w)/x:zi}function ls(v){return function(w){return w==null?r:w[v]}}function cs(v){return function(w){return v==null?r:v[w]}}function Cu(v,w,x,E,V){return V(v,function(Q,pt,rt){x=E?(E=!1,Q):w(x,Q,pt,rt)}),x}function ip(v,w){var x=v.length;for(v.sort(w);x--;)v[x]=v[x].value;return v}function hs(v,w){for(var x,E=-1,V=v.length;++E<V;){var Q=w(v[E]);Q!==r&&(x=x===r?Q:x+Q)}return x}function fs(v,w){for(var x=-1,E=Array(v);++x<v;)E[x]=w(x);return E}function op(v,w){return nt(w,function(x){return[x,v[x]]})}function _u(v){return v&&v.slice(0,Eu(v)+1).replace(Jn,"")}function Vt(v){return function(w){return v(w)}}function ps(v,w){return nt(w,function(x){return v[x]})}function ui(v,w){return v.has(w)}function Lu(v,w){for(var x=-1,E=v.length;++x<E&&Or(w,v[x],0)>-1;);return x}function Su(v,w){for(var x=v.length;x--&&Or(w,v[x],0)>-1;);return x}function np(v,w){for(var x=v.length,E=0;x--;)v[x]===w&&++E;return E}var sp=cs(Hf),ap=cs(Wf);function up(v){return"\\"+$f[v]}function lp(v,w){return v==null?r:v[w]}function Er(v){return Nf.test(v)}function cp(v){return jf.test(v)}function hp(v){for(var w,x=[];!(w=v.next()).done;)x.push(w.value);return x}function ms(v){var w=-1,x=Array(v.size);return v.forEach(function(E,V){x[++w]=[V,E]}),x}function Ou(v,w){return function(x){return v(w(x))}}function Be(v,w){for(var x=-1,E=v.length,V=0,Q=[];++x<E;){var pt=v[x];(pt===w||pt===L)&&(v[x]=L,Q[V++]=x)}return Q}function eo(v){var w=-1,x=Array(v.size);return v.forEach(function(E){x[++w]=E}),x}function fp(v){var w=-1,x=Array(v.size);return v.forEach(function(E){x[++w]=[E,E]}),x}function pp(v,w,x){for(var E=x-1,V=v.length;++E<V;)if(v[E]===w)return E;return-1}function mp(v,w,x){for(var E=x+1;E--;)if(v[E]===w)return E;return E}function Dr(v){return Er(v)?dp(v):Zf(v)}function ie(v){return Er(v)?yp(v):tp(v)}function Eu(v){for(var w=v.length;w--&&nf.test(v.charAt(w)););return w}var gp=cs(zf);function dp(v){for(var w=is.lastIndex=0;is.test(v);)++w;return w}function yp(v){return v.match(is)||[]}function vp(v){return v.match(Gf)||[]}var bp=function v(w){w=w==null?dt:He.defaults(dt.Object(),w,He.pick(dt,Uf));var x=w.Array,E=w.Date,V=w.Error,Q=w.Function,pt=w.Math,rt=w.Object,gs=w.RegExp,Pp=w.String,qt=w.TypeError,ro=x.prototype,Tp=Q.prototype,Ir=rt.prototype,io=w["__core-js_shared__"],oo=Tp.toString,tt=Ir.hasOwnProperty,xp=0,Du=(function(){var t=/[^.]+$/.exec(io&&io.keys&&io.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})(),no=Ir.toString,wp=oo.call(rt),Cp=dt._,_p=gs("^"+oo.call(tt).replace(Kn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),so=pu?w.Buffer:r,We=w.Symbol,ao=w.Uint8Array,Iu=so?so.allocUnsafe:r,uo=Ou(rt.getPrototypeOf,rt),Mu=rt.create,Au=Ir.propertyIsEnumerable,lo=ro.splice,Ru=We?We.isConcatSpreadable:r,li=We?We.iterator:r,nr=We?We.toStringTag:r,co=(function(){try{var t=cr(rt,"defineProperty");return t({},"",{}),t}catch(i){}})(),Lp=w.clearTimeout!==dt.clearTimeout&&w.clearTimeout,Sp=E&&E.now!==dt.Date.now&&E.now,Op=w.setTimeout!==dt.setTimeout&&w.setTimeout,ho=pt.ceil,fo=pt.floor,ds=rt.getOwnPropertySymbols,Ep=so?so.isBuffer:r,Fu=w.isFinite,Dp=ro.join,Ip=Ou(rt.keys,rt),mt=pt.max,xt=pt.min,Mp=E.now,Ap=w.parseInt,ku=pt.random,Rp=ro.reverse,ys=cr(w,"DataView"),ci=cr(w,"Map"),vs=cr(w,"Promise"),Mr=cr(w,"Set"),hi=cr(w,"WeakMap"),fi=cr(rt,"create"),po=hi&&new hi,Ar={},Fp=hr(ys),kp=hr(ci),Vp=hr(vs),Gp=hr(Mr),Np=hr(hi),mo=We?We.prototype:r,pi=mo?mo.valueOf:r,Vu=mo?mo.toString:r;function f(t){if(ut(t)&&!G(t)&&!(t instanceof z)){if(t instanceof Yt)return t;if(tt.call(t,"__wrapped__"))return Gl(t)}return new Yt(t)}var Rr=(function(){function t(){}return function(i){if(!at(i))return{};if(Mu)return Mu(i);t.prototype=i;var n=new t;return t.prototype=r,n}})();function go(){}function Yt(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}f.templateSettings={escape:Jh,evaluate:Zh,interpolate:$a,variable:"",imports:{_:f}},f.prototype=go.prototype,f.prototype.constructor=f,Yt.prototype=Rr(go.prototype),Yt.prototype.constructor=Yt;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=fe,this.__views__=[]}function jp(){var t=new z(this.__wrapped__);return t.__actions__=Dt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Dt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Dt(this.__views__),t}function Up(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Bp(){var t=this.__wrapped__.value(),i=this.__dir__,n=G(t),l=i<0,c=n?t.length:0,m=tg(0,c,this.__views__),d=m.start,y=m.end,b=y-d,C=l?y:d-1,_=this.__iteratees__,S=_.length,O=0,I=xt(b,this.__takeCount__);if(!n||!l&&c==b&&I==b)return al(t,this.__actions__);var F=[];t:for(;b--&&O<I;){C+=i;for(var j=-1,k=t[C];++j<S;){var W=_[j],$=W.iteratee,jt=W.type,St=$(k);if(jt==Fh)k=St;else if(!St){if(jt==Ua)continue t;break t}}F[O++]=k}return F}z.prototype=Rr(go.prototype),z.prototype.constructor=z;function sr(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function Hp(){this.__data__=fi?fi(null):{},this.size=0}function Wp(t){var i=this.has(t)&&delete this.__data__[t];return this.size-=i?1:0,i}function zp(t){var i=this.__data__;if(fi){var n=i[t];return n===g?r:n}return tt.call(i,t)?i[t]:r}function $p(t){var i=this.__data__;return fi?i[t]!==r:tt.call(i,t)}function qp(t,i){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=fi&&i===r?g:i,this}sr.prototype.clear=Hp,sr.prototype.delete=Wp,sr.prototype.get=zp,sr.prototype.has=$p,sr.prototype.set=qp;function Se(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function Yp(){this.__data__=[],this.size=0}function Xp(t){var i=this.__data__,n=yo(i,t);if(n<0)return!1;var l=i.length-1;return n==l?i.pop():lo.call(i,n,1),--this.size,!0}function Qp(t){var i=this.__data__,n=yo(i,t);return n<0?r:i[n][1]}function Kp(t){return yo(this.__data__,t)>-1}function Jp(t,i){var n=this.__data__,l=yo(n,t);return l<0?(++this.size,n.push([t,i])):n[l][1]=i,this}Se.prototype.clear=Yp,Se.prototype.delete=Xp,Se.prototype.get=Qp,Se.prototype.has=Kp,Se.prototype.set=Jp;function Oe(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function Zp(){this.size=0,this.__data__={hash:new sr,map:new(ci||Se),string:new sr}}function tm(t){var i=Eo(this,t).delete(t);return this.size-=i?1:0,i}function em(t){return Eo(this,t).get(t)}function rm(t){return Eo(this,t).has(t)}function im(t,i){var n=Eo(this,t),l=n.size;return n.set(t,i),this.size+=n.size==l?0:1,this}Oe.prototype.clear=Zp,Oe.prototype.delete=tm,Oe.prototype.get=em,Oe.prototype.has=rm,Oe.prototype.set=im;function ar(t){var i=-1,n=t==null?0:t.length;for(this.__data__=new Oe;++i<n;)this.add(t[i])}function om(t){return this.__data__.set(t,g),this}function nm(t){return this.__data__.has(t)}ar.prototype.add=ar.prototype.push=om,ar.prototype.has=nm;function oe(t){var i=this.__data__=new Se(t);this.size=i.size}function sm(){this.__data__=new Se,this.size=0}function am(t){var i=this.__data__,n=i.delete(t);return this.size=i.size,n}function um(t){return this.__data__.get(t)}function lm(t){return this.__data__.has(t)}function cm(t,i){var n=this.__data__;if(n instanceof Se){var l=n.__data__;if(!ci||l.length<a-1)return l.push([t,i]),this.size=++n.size,this;n=this.__data__=new Oe(l)}return n.set(t,i),this.size=n.size,this}oe.prototype.clear=sm,oe.prototype.delete=am,oe.prototype.get=um,oe.prototype.has=lm,oe.prototype.set=cm;function Gu(t,i){var n=G(t),l=!n&&fr(t),c=!n&&!l&&Xe(t),m=!n&&!l&&!c&&Gr(t),d=n||l||c||m,y=d?fs(t.length,Pp):[],b=y.length;for(var C in t)(i||tt.call(t,C))&&!(d&&(C=="length"||c&&(C=="offset"||C=="parent")||m&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Me(C,b)))&&y.push(C);return y}function Nu(t){var i=t.length;return i?t[Es(0,i-1)]:r}function hm(t,i){return Do(Dt(t),ur(i,0,t.length))}function fm(t){return Do(Dt(t))}function bs(t,i,n){(n!==r&&!ne(t[i],n)||n===r&&!(i in t))&&Ee(t,i,n)}function mi(t,i,n){var l=t[i];(!(tt.call(t,i)&&ne(l,n))||n===r&&!(i in t))&&Ee(t,i,n)}function yo(t,i){for(var n=t.length;n--;)if(ne(t[n][0],i))return n;return-1}function pm(t,i,n,l){return ze(t,function(c,m,d){i(l,c,n(c),d)}),l}function ju(t,i){return t&&me(i,yt(i),t)}function mm(t,i){return t&&me(i,Mt(i),t)}function Ee(t,i,n){i=="__proto__"&&co?co(t,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[i]=n}function Ps(t,i){for(var n=-1,l=i.length,c=x(l),m=t==null;++n<l;)c[n]=m?r:ta(t,i[n]);return c}function ur(t,i,n){return t===t&&(n!==r&&(t=t<=n?t:n),i!==r&&(t=t>=i?t:i)),t}function Xt(t,i,n,l,c,m){var d,y=i&D,b=i&Y,C=i&M;if(n&&(d=c?n(t,l,c,m):n(t)),d!==r)return d;if(!at(t))return t;var _=G(t);if(_){if(d=rg(t),!y)return Dt(t,d)}else{var S=wt(t),O=S==Yi||S==Ba;if(Xe(t))return cl(t,y);if(S==Le||S==_r||O&&!c){if(d=b||O?{}:El(t),!y)return b?zm(t,mm(d,t)):Wm(t,ju(d,t))}else{if(!it[S])return c?t:{};d=ig(t,S,y)}}m||(m=new oe);var I=m.get(t);if(I)return I;m.set(t,d),oc(t)?t.forEach(function(k){d.add(Xt(k,i,n,k,t,m))}):rc(t)&&t.forEach(function(k,W){d.set(W,Xt(k,i,n,W,t,m))});var F=C?b?js:Ns:b?Mt:yt,j=_?r:F(t);return $t(j||t,function(k,W){j&&(W=k,k=t[W]),mi(d,W,Xt(k,i,n,W,t,m))}),d}function gm(t){var i=yt(t);return function(n){return Uu(n,t,i)}}function Uu(t,i,n){var l=n.length;if(t==null)return!l;for(t=rt(t);l--;){var c=n[l],m=i[c],d=t[c];if(d===r&&!(c in t)||!m(d))return!1}return!0}function Bu(t,i,n){if(typeof t!="function")throw new qt(h);return Ti(function(){t.apply(r,n)},i)}function gi(t,i,n,l){var c=-1,m=Zi,d=!0,y=t.length,b=[],C=i.length;if(!y)return b;n&&(i=nt(i,Vt(n))),l?(m=ss,d=!1):i.length>=a&&(m=ui,d=!1,i=new ar(i));t:for(;++c<y;){var _=t[c],S=n==null?_:n(_);if(_=l||_!==0?_:0,d&&S===S){for(var O=C;O--;)if(i[O]===S)continue t;b.push(_)}else m(i,S,l)||b.push(_)}return b}var ze=gl(pe),Hu=gl(xs,!0);function dm(t,i){var n=!0;return ze(t,function(l,c,m){return n=!!i(l,c,m),n}),n}function vo(t,i,n){for(var l=-1,c=t.length;++l<c;){var m=t[l],d=i(m);if(d!=null&&(y===r?d===d&&!Nt(d):n(d,y)))var y=d,b=m}return b}function ym(t,i,n,l){var c=t.length;for(n=N(n),n<0&&(n=-n>c?0:c+n),l=l===r||l>c?c:N(l),l<0&&(l+=c),l=n>l?0:sc(l);n<l;)t[n++]=i;return t}function Wu(t,i){var n=[];return ze(t,function(l,c,m){i(l,c,m)&&n.push(l)}),n}function Pt(t,i,n,l,c){var m=-1,d=t.length;for(n||(n=ng),c||(c=[]);++m<d;){var y=t[m];i>0&&n(y)?i>1?Pt(y,i-1,n,l,c):Ue(c,y):l||(c[c.length]=y)}return c}var Ts=dl(),zu=dl(!0);function pe(t,i){return t&&Ts(t,i,yt)}function xs(t,i){return t&&zu(t,i,yt)}function bo(t,i){return je(i,function(n){return Ae(t[n])})}function lr(t,i){i=qe(i,t);for(var n=0,l=i.length;t!=null&&n<l;)t=t[ge(i[n++])];return n&&n==l?t:r}function $u(t,i,n){var l=i(t);return G(t)?l:Ue(l,n(t))}function _t(t){return t==null?t===r?zh:Hh:nr&&nr in rt(t)?Zm(t):fg(t)}function ws(t,i){return t>i}function vm(t,i){return t!=null&&tt.call(t,i)}function bm(t,i){return t!=null&&i in rt(t)}function Pm(t,i,n){return t>=xt(i,n)&&t<mt(i,n)}function Cs(t,i,n){for(var l=n?ss:Zi,c=t[0].length,m=t.length,d=m,y=x(m),b=1/0,C=[];d--;){var _=t[d];d&&i&&(_=nt(_,Vt(i))),b=xt(_.length,b),y[d]=!n&&(i||c>=120&&_.length>=120)?new ar(d&&_):r}_=t[0];var S=-1,O=y[0];t:for(;++S<c&&C.length<b;){var I=_[S],F=i?i(I):I;if(I=n||I!==0?I:0,!(O?ui(O,F):l(C,F,n))){for(d=m;--d;){var j=y[d];if(!(j?ui(j,F):l(t[d],F,n)))continue t}O&&O.push(F),C.push(I)}}return C}function Tm(t,i,n,l){return pe(t,function(c,m,d){i(l,n(c),m,d)}),l}function di(t,i,n){i=qe(i,t),t=Al(t,i);var l=t==null?t:t[ge(Kt(i))];return l==null?r:kt(l,t,n)}function qu(t){return ut(t)&&_t(t)==_r}function xm(t){return ut(t)&&_t(t)==ai}function wm(t){return ut(t)&&_t(t)==ri}function yi(t,i,n,l,c){return t===i?!0:t==null||i==null||!ut(t)&&!ut(i)?t!==t&&i!==i:Cm(t,i,n,l,yi,c)}function Cm(t,i,n,l,c,m){var d=G(t),y=G(i),b=d?$i:wt(t),C=y?$i:wt(i);b=b==_r?Le:b,C=C==_r?Le:C;var _=b==Le,S=C==Le,O=b==C;if(O&&Xe(t)){if(!Xe(i))return!1;d=!0,_=!1}if(O&&!_)return m||(m=new oe),d||Gr(t)?Ll(t,i,n,l,c,m):Km(t,i,b,n,l,c,m);if(!(n&H)){var I=_&&tt.call(t,"__wrapped__"),F=S&&tt.call(i,"__wrapped__");if(I||F){var j=I?t.value():t,k=F?i.value():i;return m||(m=new oe),c(j,k,n,l,m)}}return O?(m||(m=new oe),Jm(t,i,n,l,c,m)):!1}function _m(t){return ut(t)&&wt(t)==ee}function _s(t,i,n,l){var c=n.length,m=c,d=!l;if(t==null)return!m;for(t=rt(t);c--;){var y=n[c];if(d&&y[2]?y[1]!==t[y[0]]:!(y[0]in t))return!1}for(;++c<m;){y=n[c];var b=y[0],C=t[b],_=y[1];if(d&&y[2]){if(C===r&&!(b in t))return!1}else{var S=new oe;if(l)var O=l(C,_,b,t,i,S);if(!(O===r?yi(_,C,H|B,l,S):O))return!1}}return!0}function Yu(t){if(!at(t)||ag(t))return!1;var i=Ae(t)?_p:gf;return i.test(hr(t))}function Lm(t){return ut(t)&&_t(t)==oi}function Sm(t){return ut(t)&&wt(t)==re}function Om(t){return ut(t)&&ko(t.length)&&!!ot[_t(t)]}function Xu(t){return typeof t=="function"?t:t==null?At:typeof t=="object"?G(t)?Ju(t[0],t[1]):Ku(t):yc(t)}function Ls(t){if(!Pi(t))return Ip(t);var i=[];for(var n in rt(t))tt.call(t,n)&&n!="constructor"&&i.push(n);return i}function Em(t){if(!at(t))return hg(t);var i=Pi(t),n=[];for(var l in t)l=="constructor"&&(i||!tt.call(t,l))||n.push(l);return n}function Ss(t,i){return t<i}function Qu(t,i){var n=-1,l=It(t)?x(t.length):[];return ze(t,function(c,m,d){l[++n]=i(c,m,d)}),l}function Ku(t){var i=Bs(t);return i.length==1&&i[0][2]?Il(i[0][0],i[0][1]):function(n){return n===t||_s(n,t,i)}}function Ju(t,i){return Ws(t)&&Dl(i)?Il(ge(t),i):function(n){var l=ta(n,t);return l===r&&l===i?ea(n,t):yi(i,l,H|B)}}function Po(t,i,n,l,c){t!==i&&Ts(i,function(m,d){if(c||(c=new oe),at(m))Dm(t,i,d,n,Po,l,c);else{var y=l?l($s(t,d),m,d+"",t,i,c):r;y===r&&(y=m),bs(t,d,y)}},Mt)}function Dm(t,i,n,l,c,m,d){var y=$s(t,n),b=$s(i,n),C=d.get(b);if(C){bs(t,n,C);return}var _=m?m(y,b,n+"",t,i,d):r,S=_===r;if(S){var O=G(b),I=!O&&Xe(b),F=!O&&!I&&Gr(b);_=b,O||I||F?G(y)?_=y:lt(y)?_=Dt(y):I?(S=!1,_=cl(b,!0)):F?(S=!1,_=hl(b,!0)):_=[]:xi(b)||fr(b)?(_=y,fr(y)?_=ac(y):(!at(y)||Ae(y))&&(_=El(b))):S=!1}S&&(d.set(b,_),c(_,b,l,m,d),d.delete(b)),bs(t,n,_)}function Zu(t,i){var n=t.length;if(n)return i+=i<0?n:0,Me(i,n)?t[i]:r}function tl(t,i,n){i.length?i=nt(i,function(m){return G(m)?function(d){return lr(d,m.length===1?m[0]:m)}:m}):i=[At];var l=-1;i=nt(i,Vt(R()));var c=Qu(t,function(m,d,y){var b=nt(i,function(C){return C(m)});return{criteria:b,index:++l,value:m}});return ip(c,function(m,d){return Hm(m,d,n)})}function Im(t,i){return el(t,i,function(n,l){return ea(t,l)})}function el(t,i,n){for(var l=-1,c=i.length,m={};++l<c;){var d=i[l],y=lr(t,d);n(y,d)&&vi(m,qe(d,t),y)}return m}function Mm(t){return function(i){return lr(i,t)}}function Os(t,i,n,l){var c=l?rp:Or,m=-1,d=i.length,y=t;for(t===i&&(i=Dt(i)),n&&(y=nt(t,Vt(n)));++m<d;)for(var b=0,C=i[m],_=n?n(C):C;(b=c(y,_,b,l))>-1;)y!==t&&lo.call(y,b,1),lo.call(t,b,1);return t}function rl(t,i){for(var n=t?i.length:0,l=n-1;n--;){var c=i[n];if(n==l||c!==m){var m=c;Me(c)?lo.call(t,c,1):Ms(t,c)}}return t}function Es(t,i){return t+fo(ku()*(i-t+1))}function Am(t,i,n,l){for(var c=-1,m=mt(ho((i-t)/(n||1)),0),d=x(m);m--;)d[l?m:++c]=t,t+=n;return d}function Ds(t,i){var n="";if(!t||i<1||i>Ne)return n;do i%2&&(n+=t),i=fo(i/2),i&&(t+=t);while(i);return n}function U(t,i){return qs(Ml(t,i,At),t+"")}function Rm(t){return Nu(Nr(t))}function Fm(t,i){var n=Nr(t);return Do(n,ur(i,0,n.length))}function vi(t,i,n,l){if(!at(t))return t;i=qe(i,t);for(var c=-1,m=i.length,d=m-1,y=t;y!=null&&++c<m;){var b=ge(i[c]),C=n;if(b==="__proto__"||b==="constructor"||b==="prototype")return t;if(c!=d){var _=y[b];C=l?l(_,b,y):r,C===r&&(C=at(_)?_:Me(i[c+1])?[]:{})}mi(y,b,C),y=y[b]}return t}var il=po?function(t,i){return po.set(t,i),t}:At,km=co?function(t,i){return co(t,"toString",{configurable:!0,enumerable:!1,value:ia(i),writable:!0})}:At;function Vm(t){return Do(Nr(t))}function Qt(t,i,n){var l=-1,c=t.length;i<0&&(i=-i>c?0:c+i),n=n>c?c:n,n<0&&(n+=c),c=i>n?0:n-i>>>0,i>>>=0;for(var m=x(c);++l<c;)m[l]=t[l+i];return m}function Gm(t,i){var n;return ze(t,function(l,c,m){return n=i(l,c,m),!n}),!!n}function To(t,i,n){var l=0,c=t==null?l:t.length;if(typeof i=="number"&&i===i&&c<=Nh){for(;l<c;){var m=l+c>>>1,d=t[m];d!==null&&!Nt(d)&&(n?d<=i:d<i)?l=m+1:c=m}return c}return Is(t,i,At,n)}function Is(t,i,n,l){var c=0,m=t==null?0:t.length;if(m===0)return 0;i=n(i);for(var d=i!==i,y=i===null,b=Nt(i),C=i===r;c<m;){var _=fo((c+m)/2),S=n(t[_]),O=S!==r,I=S===null,F=S===S,j=Nt(S);if(d)var k=l||F;else C?k=F&&(l||O):y?k=F&&O&&(l||!I):b?k=F&&O&&!I&&(l||!j):I||j?k=!1:k=l?S<=i:S<i;k?c=_+1:m=_}return xt(m,Gh)}function ol(t,i){for(var n=-1,l=t.length,c=0,m=[];++n<l;){var d=t[n],y=i?i(d):d;if(!n||!ne(y,b)){var b=y;m[c++]=d===0?0:d}}return m}function nl(t){return typeof t=="number"?t:Nt(t)?zi:+t}function Gt(t){if(typeof t=="string")return t;if(G(t))return nt(t,Gt)+"";if(Nt(t))return Vu?Vu.call(t):"";var i=t+"";return i=="0"&&1/t==-ir?"-0":i}function $e(t,i,n){var l=-1,c=Zi,m=t.length,d=!0,y=[],b=y;if(n)d=!1,c=ss;else if(m>=a){var C=i?null:Xm(t);if(C)return eo(C);d=!1,c=ui,b=new ar}else b=i?[]:y;t:for(;++l<m;){var _=t[l],S=i?i(_):_;if(_=n||_!==0?_:0,d&&S===S){for(var O=b.length;O--;)if(b[O]===S)continue t;i&&b.push(S),y.push(_)}else c(b,S,n)||(b!==y&&b.push(S),y.push(_))}return y}function Ms(t,i){return i=qe(i,t),t=Al(t,i),t==null||delete t[ge(Kt(i))]}function sl(t,i,n,l){return vi(t,i,n(lr(t,i)),l)}function xo(t,i,n,l){for(var c=t.length,m=l?c:-1;(l?m--:++m<c)&&i(t[m],m,t););return n?Qt(t,l?0:m,l?m+1:c):Qt(t,l?m+1:0,l?c:m)}function al(t,i){var n=t;return n instanceof z&&(n=n.value()),as(i,function(l,c){return c.func.apply(c.thisArg,Ue([l],c.args))},n)}function As(t,i,n){var l=t.length;if(l<2)return l?$e(t[0]):[];for(var c=-1,m=x(l);++c<l;)for(var d=t[c],y=-1;++y<l;)y!=c&&(m[c]=gi(m[c]||d,t[y],i,n));return $e(Pt(m,1),i,n)}function ul(t,i,n){for(var l=-1,c=t.length,m=i.length,d={};++l<c;){var y=l<m?i[l]:r;n(d,t[l],y)}return d}function Rs(t){return lt(t)?t:[]}function Fs(t){return typeof t=="function"?t:At}function qe(t,i){return G(t)?t:Ws(t,i)?[t]:Vl(Z(t))}var Nm=U;function Ye(t,i,n){var l=t.length;return n=n===r?l:n,!i&&n>=l?t:Qt(t,i,n)}var ll=Lp||function(t){return dt.clearTimeout(t)};function cl(t,i){if(i)return t.slice();var n=t.length,l=Iu?Iu(n):new t.constructor(n);return t.copy(l),l}function ks(t){var i=new t.constructor(t.byteLength);return new ao(i).set(new ao(t)),i}function jm(t,i){var n=i?ks(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Um(t){var i=new t.constructor(t.source,qa.exec(t));return i.lastIndex=t.lastIndex,i}function Bm(t){return pi?rt(pi.call(t)):{}}function hl(t,i){var n=i?ks(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function fl(t,i){if(t!==i){var n=t!==r,l=t===null,c=t===t,m=Nt(t),d=i!==r,y=i===null,b=i===i,C=Nt(i);if(!y&&!C&&!m&&t>i||m&&d&&b&&!y&&!C||l&&d&&b||!n&&b||!c)return 1;if(!l&&!m&&!C&&t<i||C&&n&&c&&!l&&!m||y&&n&&c||!d&&c||!b)return-1}return 0}function Hm(t,i,n){for(var l=-1,c=t.criteria,m=i.criteria,d=c.length,y=n.length;++l<d;){var b=fl(c[l],m[l]);if(b){if(l>=y)return b;var C=n[l];return b*(C=="desc"?-1:1)}}return t.index-i.index}function pl(t,i,n,l){for(var c=-1,m=t.length,d=n.length,y=-1,b=i.length,C=mt(m-d,0),_=x(b+C),S=!l;++y<b;)_[y]=i[y];for(;++c<d;)(S||c<m)&&(_[n[c]]=t[c]);for(;C--;)_[y++]=t[c++];return _}function ml(t,i,n,l){for(var c=-1,m=t.length,d=-1,y=n.length,b=-1,C=i.length,_=mt(m-y,0),S=x(_+C),O=!l;++c<_;)S[c]=t[c];for(var I=c;++b<C;)S[I+b]=i[b];for(;++d<y;)(O||c<m)&&(S[I+n[d]]=t[c++]);return S}function Dt(t,i){var n=-1,l=t.length;for(i||(i=x(l));++n<l;)i[n]=t[n];return i}function me(t,i,n,l){var c=!n;n||(n={});for(var m=-1,d=i.length;++m<d;){var y=i[m],b=l?l(n[y],t[y],y,n,t):r;b===r&&(b=t[y]),c?Ee(n,y,b):mi(n,y,b)}return n}function Wm(t,i){return me(t,Hs(t),i)}function zm(t,i){return me(t,Sl(t),i)}function wo(t,i){return function(n,l){var c=G(n)?Qf:pm,m=i?i():{};return c(n,t,R(l,2),m)}}function Fr(t){return U(function(i,n){var l=-1,c=n.length,m=c>1?n[c-1]:r,d=c>2?n[2]:r;for(m=t.length>3&&typeof m=="function"?(c--,m):r,d&&Lt(n[0],n[1],d)&&(m=c<3?r:m,c=1),i=rt(i);++l<c;){var y=n[l];y&&t(i,y,l,m)}return i})}function gl(t,i){return function(n,l){if(n==null)return n;if(!It(n))return t(n,l);for(var c=n.length,m=i?c:-1,d=rt(n);(i?m--:++m<c)&&l(d[m],m,d)!==!1;);return n}}function dl(t){return function(i,n,l){for(var c=-1,m=rt(i),d=l(i),y=d.length;y--;){var b=d[t?y:++c];if(n(m[b],b,m)===!1)break}return i}}function $m(t,i,n){var l=i&st,c=bi(t);function m(){var d=this&&this!==dt&&this instanceof m?c:t;return d.apply(l?n:this,arguments)}return m}function yl(t){return function(i){i=Z(i);var n=Er(i)?ie(i):r,l=n?n[0]:i.charAt(0),c=n?Ye(n,1).join(""):i.slice(1);return l[t]()+c}}function kr(t){return function(i){return as(gc(mc(i).replace(kf,"")),t,"")}}function bi(t){return function(){var i=arguments;switch(i.length){case 0:return new t;case 1:return new t(i[0]);case 2:return new t(i[0],i[1]);case 3:return new t(i[0],i[1],i[2]);case 4:return new t(i[0],i[1],i[2],i[3]);case 5:return new t(i[0],i[1],i[2],i[3],i[4]);case 6:return new t(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=Rr(t.prototype),l=t.apply(n,i);return at(l)?l:n}}function qm(t,i,n){var l=bi(t);function c(){for(var m=arguments.length,d=x(m),y=m,b=Vr(c);y--;)d[y]=arguments[y];var C=m<3&&d[0]!==b&&d[m-1]!==b?[]:Be(d,b);if(m-=C.length,m<n)return xl(t,i,Co,c.placeholder,r,d,C,r,r,n-m);var _=this&&this!==dt&&this instanceof c?l:t;return kt(_,this,d)}return c}function vl(t){return function(i,n,l){var c=rt(i);if(!It(i)){var m=R(n,3);i=yt(i),n=function(y){return m(c[y],y,c)}}var d=t(i,n,l);return d>-1?c[m?i[d]:d]:r}}function bl(t){return Ie(function(i){var n=i.length,l=n,c=Yt.prototype.thru;for(t&&i.reverse();l--;){var m=i[l];if(typeof m!="function")throw new qt(h);if(c&&!d&&Oo(m)=="wrapper")var d=new Yt([],!0)}for(l=d?l:n;++l<n;){m=i[l];var y=Oo(m),b=y=="wrapper"?Us(m):r;b&&zs(b[0])&&b[1]==(_e|ce|he|ti)&&!b[4].length&&b[9]==1?d=d[Oo(b[0])].apply(d,b[3]):d=m.length==1&&zs(m)?d[y]():d.thru(m)}return function(){var C=arguments,_=C[0];if(d&&C.length==1&&G(_))return d.plant(_).value();for(var S=0,O=n?i[S].apply(this,C):_;++S<n;)O=i[S].call(this,O);return O}})}function Co(t,i,n,l,c,m,d,y,b,C){var _=i&_e,S=i&st,O=i&ft,I=i&(ce|wr),F=i&Un,j=O?r:bi(t);function k(){for(var W=arguments.length,$=x(W),jt=W;jt--;)$[jt]=arguments[jt];if(I)var St=Vr(k),Ut=np($,St);if(l&&($=pl($,l,c,I)),m&&($=ml($,m,d,I)),W-=Ut,I&&W<C){var ct=Be($,St);return xl(t,i,Co,k.placeholder,n,$,ct,y,b,C-W)}var se=S?n:this,Fe=O?se[t]:t;return W=$.length,y?$=pg($,y):F&&W>1&&$.reverse(),_&&b<W&&($.length=b),this&&this!==dt&&this instanceof k&&(Fe=j||bi(Fe)),Fe.apply(se,$)}return k}function Pl(t,i){return function(n,l){return Tm(n,t,i(l),{})}}function _o(t,i){return function(n,l){var c;if(n===r&&l===r)return i;if(n!==r&&(c=n),l!==r){if(c===r)return l;typeof n=="string"||typeof l=="string"?(n=Gt(n),l=Gt(l)):(n=nl(n),l=nl(l)),c=t(n,l)}return c}}function Vs(t){return Ie(function(i){return i=nt(i,Vt(R())),U(function(n){var l=this;return t(i,function(c){return kt(c,l,n)})})})}function Lo(t,i){i=i===r?" ":Gt(i);var n=i.length;if(n<2)return n?Ds(i,t):i;var l=Ds(i,ho(t/Dr(i)));return Er(i)?Ye(ie(l),0,t).join(""):l.slice(0,t)}function Ym(t,i,n,l){var c=i&st,m=bi(t);function d(){for(var y=-1,b=arguments.length,C=-1,_=l.length,S=x(_+b),O=this&&this!==dt&&this instanceof d?m:t;++C<_;)S[C]=l[C];for(;b--;)S[C++]=arguments[++y];return kt(O,c?n:this,S)}return d}function Tl(t){return function(i,n,l){return l&&typeof l!="number"&&Lt(i,n,l)&&(n=l=r),i=Re(i),n===r?(n=i,i=0):n=Re(n),l=l===r?i<n?1:-1:Re(l),Am(i,n,l,t)}}function So(t){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Jt(i),n=Jt(n)),t(i,n)}}function xl(t,i,n,l,c,m,d,y,b,C){var _=i&ce,S=_?d:r,O=_?r:d,I=_?m:r,F=_?r:m;i|=_?he:Cr,i&=~(_?Cr:he),i&rr||(i&=~(st|ft));var j=[t,i,c,I,S,F,O,y,b,C],k=n.apply(r,j);return zs(t)&&Rl(k,j),k.placeholder=l,Fl(k,t,i)}function Gs(t){var i=pt[t];return function(n,l){if(n=Jt(n),l=l==null?0:xt(N(l),292),l&&Fu(n)){var c=(Z(n)+"e").split("e"),m=i(c[0]+"e"+(+c[1]+l));return c=(Z(m)+"e").split("e"),+(c[0]+"e"+(+c[1]-l))}return i(n)}}var Xm=Mr&&1/eo(new Mr([,-0]))[1]==ir?function(t){return new Mr(t)}:sa;function wl(t){return function(i){var n=wt(i);return n==ee?ms(i):n==re?fp(i):op(i,t(i))}}function De(t,i,n,l,c,m,d,y){var b=i&ft;if(!b&&typeof t!="function")throw new qt(h);var C=l?l.length:0;if(C||(i&=~(he|Cr),l=c=r),d=d===r?d:mt(N(d),0),y=y===r?y:N(y),C-=c?c.length:0,i&Cr){var _=l,S=c;l=c=r}var O=b?r:Us(t),I=[t,i,n,l,c,_,S,m,d,y];if(O&&cg(I,O),t=I[0],i=I[1],n=I[2],l=I[3],c=I[4],y=I[9]=I[9]===r?b?0:t.length:mt(I[9]-C,0),!y&&i&(ce|wr)&&(i&=~(ce|wr)),!i||i==st)var F=$m(t,i,n);else i==ce||i==wr?F=qm(t,i,y):(i==he||i==(st|he))&&!c.length?F=Ym(t,i,n,l):F=Co.apply(r,I);var j=O?il:Rl;return Fl(j(F,I),t,i)}function Cl(t,i,n,l){return t===r||ne(t,Ir[n])&&!tt.call(l,n)?i:t}function _l(t,i,n,l,c,m){return at(t)&&at(i)&&(m.set(i,t),Po(t,i,r,_l,m),m.delete(i)),t}function Qm(t){return xi(t)?r:t}function Ll(t,i,n,l,c,m){var d=n&H,y=t.length,b=i.length;if(y!=b&&!(d&&b>y))return!1;var C=m.get(t),_=m.get(i);if(C&&_)return C==i&&_==t;var S=-1,O=!0,I=n&B?new ar:r;for(m.set(t,i),m.set(i,t);++S<y;){var F=t[S],j=i[S];if(l)var k=d?l(j,F,S,i,t,m):l(F,j,S,t,i,m);if(k!==r){if(k)continue;O=!1;break}if(I){if(!us(i,function(W,$){if(!ui(I,$)&&(F===W||c(F,W,n,l,m)))return I.push($)})){O=!1;break}}else if(!(F===j||c(F,j,n,l,m))){O=!1;break}}return m.delete(t),m.delete(i),O}function Km(t,i,n,l,c,m,d){switch(n){case Lr:if(t.byteLength!=i.byteLength||t.byteOffset!=i.byteOffset)return!1;t=t.buffer,i=i.buffer;case ai:return!(t.byteLength!=i.byteLength||!m(new ao(t),new ao(i)));case ei:case ri:case ii:return ne(+t,+i);case qi:return t.name==i.name&&t.message==i.message;case oi:case ni:return t==i+"";case ee:var y=ms;case re:var b=l&H;if(y||(y=eo),t.size!=i.size&&!b)return!1;var C=d.get(t);if(C)return C==i;l|=B,d.set(t,i);var _=Ll(y(t),y(i),l,c,m,d);return d.delete(t),_;case Xi:if(pi)return pi.call(t)==pi.call(i)}return!1}function Jm(t,i,n,l,c,m){var d=n&H,y=Ns(t),b=y.length,C=Ns(i),_=C.length;if(b!=_&&!d)return!1;for(var S=b;S--;){var O=y[S];if(!(d?O in i:tt.call(i,O)))return!1}var I=m.get(t),F=m.get(i);if(I&&F)return I==i&&F==t;var j=!0;m.set(t,i),m.set(i,t);for(var k=d;++S<b;){O=y[S];var W=t[O],$=i[O];if(l)var jt=d?l($,W,O,i,t,m):l(W,$,O,t,i,m);if(!(jt===r?W===$||c(W,$,n,l,m):jt)){j=!1;break}k||(k=O=="constructor")}if(j&&!k){var St=t.constructor,Ut=i.constructor;St!=Ut&&"constructor"in t&&"constructor"in i&&!(typeof St=="function"&&St instanceof St&&typeof Ut=="function"&&Ut instanceof Ut)&&(j=!1)}return m.delete(t),m.delete(i),j}function Ie(t){return qs(Ml(t,r,Ul),t+"")}function Ns(t){return $u(t,yt,Hs)}function js(t){return $u(t,Mt,Sl)}var Us=po?function(t){return po.get(t)}:sa;function Oo(t){for(var i=t.name+"",n=Ar[i],l=tt.call(Ar,i)?n.length:0;l--;){var c=n[l],m=c.func;if(m==null||m==t)return c.name}return i}function Vr(t){var i=tt.call(f,"placeholder")?f:t;return i.placeholder}function R(){var t=f.iteratee||oa;return t=t===oa?Xu:t,arguments.length?t(arguments[0],arguments[1]):t}function Eo(t,i){var n=t.__data__;return sg(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Bs(t){for(var i=yt(t),n=i.length;n--;){var l=i[n],c=t[l];i[n]=[l,c,Dl(c)]}return i}function cr(t,i){var n=lp(t,i);return Yu(n)?n:r}function Zm(t){var i=tt.call(t,nr),n=t[nr];try{t[nr]=r;var l=!0}catch(m){}var c=no.call(t);return l&&(i?t[nr]=n:delete t[nr]),c}var Hs=ds?function(t){return t==null?[]:(t=rt(t),je(ds(t),function(i){return Au.call(t,i)}))}:aa,Sl=ds?function(t){for(var i=[];t;)Ue(i,Hs(t)),t=uo(t);return i}:aa,wt=_t;(ys&&wt(new ys(new ArrayBuffer(1)))!=Lr||ci&&wt(new ci)!=ee||vs&&wt(vs.resolve())!=Ha||Mr&&wt(new Mr)!=re||hi&&wt(new hi)!=si)&&(wt=function(t){var i=_t(t),n=i==Le?t.constructor:r,l=n?hr(n):"";if(l)switch(l){case Fp:return Lr;case kp:return ee;case Vp:return Ha;case Gp:return re;case Np:return si}return i});function tg(t,i,n){for(var l=-1,c=n.length;++l<c;){var m=n[l],d=m.size;switch(m.type){case"drop":t+=d;break;case"dropRight":i-=d;break;case"take":i=xt(i,t+d);break;case"takeRight":t=mt(t,i-d);break}}return{start:t,end:i}}function eg(t){var i=t.match(af);return i?i[1].split(uf):[]}function Ol(t,i,n){i=qe(i,t);for(var l=-1,c=i.length,m=!1;++l<c;){var d=ge(i[l]);if(!(m=t!=null&&n(t,d)))break;t=t[d]}return m||++l!=c?m:(c=t==null?0:t.length,!!c&&ko(c)&&Me(d,c)&&(G(t)||fr(t)))}function rg(t){var i=t.length,n=new t.constructor(i);return i&&typeof t[0]=="string"&&tt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function El(t){return typeof t.constructor=="function"&&!Pi(t)?Rr(uo(t)):{}}function ig(t,i,n){var l=t.constructor;switch(i){case ai:return ks(t);case ei:case ri:return new l(+t);case Lr:return jm(t,n);case Bn:case Hn:case Wn:case zn:case $n:case qn:case Yn:case Xn:case Qn:return hl(t,n);case ee:return new l;case ii:case ni:return new l(t);case oi:return Um(t);case re:return new l;case Xi:return Bm(t)}}function og(t,i){var n=i.length;if(!n)return t;var l=n-1;return i[l]=(n>1?"& ":"")+i[l],i=i.join(n>2?", ":" "),t.replace(sf,`{
/* [wrapped with `+i+`] */
`)}function ng(t){return G(t)||fr(t)||!!(Ru&&t&&t[Ru])}function Me(t,i){var n=typeof t;return i=i!=null?i:Ne,!!i&&(n=="number"||n!="symbol"&&yf.test(t))&&t>-1&&t%1==0&&t<i}function Lt(t,i,n){if(!at(n))return!1;var l=typeof i;return(l=="number"?It(n)&&Me(i,n.length):l=="string"&&i in n)?ne(n[i],t):!1}function Ws(t,i){if(G(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Nt(t)?!0:ef.test(t)||!tf.test(t)||i!=null&&t in rt(i)}function sg(t){var i=typeof t;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?t!=="__proto__":t===null}function zs(t){var i=Oo(t),n=f[i];if(typeof n!="function"||!(i in z.prototype))return!1;if(t===n)return!0;var l=Us(n);return!!l&&t===l[0]}function ag(t){return!!Du&&Du in t}var ug=io?Ae:ua;function Pi(t){var i=t&&t.constructor,n=typeof i=="function"&&i.prototype||Ir;return t===n}function Dl(t){return t===t&&!at(t)}function Il(t,i){return function(n){return n==null?!1:n[t]===i&&(i!==r||t in rt(n))}}function lg(t){var i=Ro(t,function(l){return n.size===T&&n.clear(),l}),n=i.cache;return i}function cg(t,i){var n=t[1],l=i[1],c=n|l,m=c<(st|ft|_e),d=l==_e&&n==ce||l==_e&&n==ti&&t[7].length<=i[8]||l==(_e|ti)&&i[7].length<=i[8]&&n==ce;if(!(m||d))return t;l&st&&(t[2]=i[2],c|=n&st?0:rr);var y=i[3];if(y){var b=t[3];t[3]=b?pl(b,y,i[4]):y,t[4]=b?Be(t[3],L):i[4]}return y=i[5],y&&(b=t[5],t[5]=b?ml(b,y,i[6]):y,t[6]=b?Be(t[5],L):i[6]),y=i[7],y&&(t[7]=y),l&_e&&(t[8]=t[8]==null?i[8]:xt(t[8],i[8])),t[9]==null&&(t[9]=i[9]),t[0]=i[0],t[1]=c,t}function hg(t){var i=[];if(t!=null)for(var n in rt(t))i.push(n);return i}function fg(t){return no.call(t)}function Ml(t,i,n){return i=mt(i===r?t.length-1:i,0),function(){for(var l=arguments,c=-1,m=mt(l.length-i,0),d=x(m);++c<m;)d[c]=l[i+c];c=-1;for(var y=x(i+1);++c<i;)y[c]=l[c];return y[i]=n(d),kt(t,this,y)}}function Al(t,i){return i.length<2?t:lr(t,Qt(i,0,-1))}function pg(t,i){for(var n=t.length,l=xt(i.length,n),c=Dt(t);l--;){var m=i[l];t[l]=Me(m,n)?c[m]:r}return t}function $s(t,i){if(!(i==="constructor"&&typeof t[i]=="function")&&i!="__proto__")return t[i]}var Rl=kl(il),Ti=Op||function(t,i){return dt.setTimeout(t,i)},qs=kl(km);function Fl(t,i,n){var l=i+"";return qs(t,og(l,mg(eg(l),n)))}function kl(t){var i=0,n=0;return function(){var l=Mp(),c=Rh-(l-n);if(n=l,c>0){if(++i>=Ah)return arguments[0]}else i=0;return t.apply(r,arguments)}}function Do(t,i){var n=-1,l=t.length,c=l-1;for(i=i===r?l:i;++n<i;){var m=Es(n,c),d=t[m];t[m]=t[n],t[n]=d}return t.length=i,t}var Vl=lg(function(t){var i=[];return t.charCodeAt(0)===46&&i.push(""),t.replace(rf,function(n,l,c,m){i.push(c?m.replace(hf,"$1"):l||n)}),i});function ge(t){if(typeof t=="string"||Nt(t))return t;var i=t+"";return i=="0"&&1/t==-ir?"-0":i}function hr(t){if(t!=null){try{return oo.call(t)}catch(i){}try{return t+""}catch(i){}}return""}function mg(t,i){return $t(jh,function(n){var l="_."+n[0];i&n[1]&&!Zi(t,l)&&t.push(l)}),t.sort()}function Gl(t){if(t instanceof z)return t.clone();var i=new Yt(t.__wrapped__,t.__chain__);return i.__actions__=Dt(t.__actions__),i.__index__=t.__index__,i.__values__=t.__values__,i}function gg(t,i,n){(n?Lt(t,i,n):i===r)?i=1:i=mt(N(i),0);var l=t==null?0:t.length;if(!l||i<1)return[];for(var c=0,m=0,d=x(ho(l/i));c<l;)d[m++]=Qt(t,c,c+=i);return d}function dg(t){for(var i=-1,n=t==null?0:t.length,l=0,c=[];++i<n;){var m=t[i];m&&(c[l++]=m)}return c}function yg(){var t=arguments.length;if(!t)return[];for(var i=x(t-1),n=arguments[0],l=t;l--;)i[l-1]=arguments[l];return Ue(G(n)?Dt(n):[n],Pt(i,1))}var vg=U(function(t,i){return lt(t)?gi(t,Pt(i,1,lt,!0)):[]}),bg=U(function(t,i){var n=Kt(i);return lt(n)&&(n=r),lt(t)?gi(t,Pt(i,1,lt,!0),R(n,2)):[]}),Pg=U(function(t,i){var n=Kt(i);return lt(n)&&(n=r),lt(t)?gi(t,Pt(i,1,lt,!0),r,n):[]});function Tg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),Qt(t,i<0?0:i,l)):[]}function xg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),i=l-i,Qt(t,0,i<0?0:i)):[]}function wg(t,i){return t&&t.length?xo(t,R(i,3),!0,!0):[]}function Cg(t,i){return t&&t.length?xo(t,R(i,3),!0):[]}function _g(t,i,n,l){var c=t==null?0:t.length;return c?(n&&typeof n!="number"&&Lt(t,i,n)&&(n=0,l=c),ym(t,i,n,l)):[]}function Nl(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=n==null?0:N(n);return c<0&&(c=mt(l+c,0)),to(t,R(i,3),c)}function jl(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=l-1;return n!==r&&(c=N(n),c=n<0?mt(l+c,0):xt(c,l-1)),to(t,R(i,3),c,!0)}function Ul(t){var i=t==null?0:t.length;return i?Pt(t,1):[]}function Lg(t){var i=t==null?0:t.length;return i?Pt(t,ir):[]}function Sg(t,i){var n=t==null?0:t.length;return n?(i=i===r?1:N(i),Pt(t,i)):[]}function Og(t){for(var i=-1,n=t==null?0:t.length,l={};++i<n;){var c=t[i];l[c[0]]=c[1]}return l}function Bl(t){return t&&t.length?t[0]:r}function Eg(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=n==null?0:N(n);return c<0&&(c=mt(l+c,0)),Or(t,i,c)}function Dg(t){var i=t==null?0:t.length;return i?Qt(t,0,-1):[]}var Ig=U(function(t){var i=nt(t,Rs);return i.length&&i[0]===t[0]?Cs(i):[]}),Mg=U(function(t){var i=Kt(t),n=nt(t,Rs);return i===Kt(n)?i=r:n.pop(),n.length&&n[0]===t[0]?Cs(n,R(i,2)):[]}),Ag=U(function(t){var i=Kt(t),n=nt(t,Rs);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===t[0]?Cs(n,r,i):[]});function Rg(t,i){return t==null?"":Dp.call(t,i)}function Kt(t){var i=t==null?0:t.length;return i?t[i-1]:r}function Fg(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=l;return n!==r&&(c=N(n),c=c<0?mt(l+c,0):xt(c,l-1)),i===i?mp(t,i,c):to(t,xu,c,!0)}function kg(t,i){return t&&t.length?Zu(t,N(i)):r}var Vg=U(Hl);function Hl(t,i){return t&&t.length&&i&&i.length?Os(t,i):t}function Gg(t,i,n){return t&&t.length&&i&&i.length?Os(t,i,R(n,2)):t}function Ng(t,i,n){return t&&t.length&&i&&i.length?Os(t,i,r,n):t}var jg=Ie(function(t,i){var n=t==null?0:t.length,l=Ps(t,i);return rl(t,nt(i,function(c){return Me(c,n)?+c:c}).sort(fl)),l});function Ug(t,i){var n=[];if(!(t&&t.length))return n;var l=-1,c=[],m=t.length;for(i=R(i,3);++l<m;){var d=t[l];i(d,l,t)&&(n.push(d),c.push(l))}return rl(t,c),n}function Ys(t){return t==null?t:Rp.call(t)}function Bg(t,i,n){var l=t==null?0:t.length;return l?(n&&typeof n!="number"&&Lt(t,i,n)?(i=0,n=l):(i=i==null?0:N(i),n=n===r?l:N(n)),Qt(t,i,n)):[]}function Hg(t,i){return To(t,i)}function Wg(t,i,n){return Is(t,i,R(n,2))}function zg(t,i){var n=t==null?0:t.length;if(n){var l=To(t,i);if(l<n&&ne(t[l],i))return l}return-1}function $g(t,i){return To(t,i,!0)}function qg(t,i,n){return Is(t,i,R(n,2),!0)}function Yg(t,i){var n=t==null?0:t.length;if(n){var l=To(t,i,!0)-1;if(ne(t[l],i))return l}return-1}function Xg(t){return t&&t.length?ol(t):[]}function Qg(t,i){return t&&t.length?ol(t,R(i,2)):[]}function Kg(t){var i=t==null?0:t.length;return i?Qt(t,1,i):[]}function Jg(t,i,n){return t&&t.length?(i=n||i===r?1:N(i),Qt(t,0,i<0?0:i)):[]}function Zg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),i=l-i,Qt(t,i<0?0:i,l)):[]}function td(t,i){return t&&t.length?xo(t,R(i,3),!1,!0):[]}function ed(t,i){return t&&t.length?xo(t,R(i,3)):[]}var rd=U(function(t){return $e(Pt(t,1,lt,!0))}),id=U(function(t){var i=Kt(t);return lt(i)&&(i=r),$e(Pt(t,1,lt,!0),R(i,2))}),od=U(function(t){var i=Kt(t);return i=typeof i=="function"?i:r,$e(Pt(t,1,lt,!0),r,i)});function nd(t){return t&&t.length?$e(t):[]}function sd(t,i){return t&&t.length?$e(t,R(i,2)):[]}function ad(t,i){return i=typeof i=="function"?i:r,t&&t.length?$e(t,r,i):[]}function Xs(t){if(!(t&&t.length))return[];var i=0;return t=je(t,function(n){if(lt(n))return i=mt(n.length,i),!0}),fs(i,function(n){return nt(t,ls(n))})}function Wl(t,i){if(!(t&&t.length))return[];var n=Xs(t);return i==null?n:nt(n,function(l){return kt(i,r,l)})}var ud=U(function(t,i){return lt(t)?gi(t,i):[]}),ld=U(function(t){return As(je(t,lt))}),cd=U(function(t){var i=Kt(t);return lt(i)&&(i=r),As(je(t,lt),R(i,2))}),hd=U(function(t){var i=Kt(t);return i=typeof i=="function"?i:r,As(je(t,lt),r,i)}),fd=U(Xs);function pd(t,i){return ul(t||[],i||[],mi)}function md(t,i){return ul(t||[],i||[],vi)}var gd=U(function(t){var i=t.length,n=i>1?t[i-1]:r;return n=typeof n=="function"?(t.pop(),n):r,Wl(t,n)});function zl(t){var i=f(t);return i.__chain__=!0,i}function dd(t,i){return i(t),t}function Io(t,i){return i(t)}var yd=Ie(function(t){var i=t.length,n=i?t[0]:0,l=this.__wrapped__,c=function(m){return Ps(m,t)};return i>1||this.__actions__.length||!(l instanceof z)||!Me(n)?this.thru(c):(l=l.slice(n,+n+(i?1:0)),l.__actions__.push({func:Io,args:[c],thisArg:r}),new Yt(l,this.__chain__).thru(function(m){return i&&!m.length&&m.push(r),m}))});function vd(){return zl(this)}function bd(){return new Yt(this.value(),this.__chain__)}function Pd(){this.__values__===r&&(this.__values__=nc(this.value()));var t=this.__index__>=this.__values__.length,i=t?r:this.__values__[this.__index__++];return{done:t,value:i}}function Td(){return this}function xd(t){for(var i,n=this;n instanceof go;){var l=Gl(n);l.__index__=0,l.__values__=r,i?c.__wrapped__=l:i=l;var c=l;n=n.__wrapped__}return c.__wrapped__=t,i}function wd(){var t=this.__wrapped__;if(t instanceof z){var i=t;return this.__actions__.length&&(i=new z(this)),i=i.reverse(),i.__actions__.push({func:Io,args:[Ys],thisArg:r}),new Yt(i,this.__chain__)}return this.thru(Ys)}function Cd(){return al(this.__wrapped__,this.__actions__)}var _d=wo(function(t,i,n){tt.call(t,n)?++t[n]:Ee(t,n,1)});function Ld(t,i,n){var l=G(t)?Pu:dm;return n&&Lt(t,i,n)&&(i=r),l(t,R(i,3))}function Sd(t,i){var n=G(t)?je:Wu;return n(t,R(i,3))}var Od=vl(Nl),Ed=vl(jl);function Dd(t,i){return Pt(Mo(t,i),1)}function Id(t,i){return Pt(Mo(t,i),ir)}function Md(t,i,n){return n=n===r?1:N(n),Pt(Mo(t,i),n)}function $l(t,i){var n=G(t)?$t:ze;return n(t,R(i,3))}function ql(t,i){var n=G(t)?Kf:Hu;return n(t,R(i,3))}var Ad=wo(function(t,i,n){tt.call(t,n)?t[n].push(i):Ee(t,n,[i])});function Rd(t,i,n,l){t=It(t)?t:Nr(t),n=n&&!l?N(n):0;var c=t.length;return n<0&&(n=mt(c+n,0)),Vo(t)?n<=c&&t.indexOf(i,n)>-1:!!c&&Or(t,i,n)>-1}var Fd=U(function(t,i,n){var l=-1,c=typeof i=="function",m=It(t)?x(t.length):[];return ze(t,function(d){m[++l]=c?kt(i,d,n):di(d,i,n)}),m}),kd=wo(function(t,i,n){Ee(t,n,i)});function Mo(t,i){var n=G(t)?nt:Qu;return n(t,R(i,3))}function Vd(t,i,n,l){return t==null?[]:(G(i)||(i=i==null?[]:[i]),n=l?r:n,G(n)||(n=n==null?[]:[n]),tl(t,i,n))}var Gd=wo(function(t,i,n){t[n?0:1].push(i)},function(){return[[],[]]});function Nd(t,i,n){var l=G(t)?as:Cu,c=arguments.length<3;return l(t,R(i,4),n,c,ze)}function jd(t,i,n){var l=G(t)?Jf:Cu,c=arguments.length<3;return l(t,R(i,4),n,c,Hu)}function Ud(t,i){var n=G(t)?je:Wu;return n(t,Fo(R(i,3)))}function Bd(t){var i=G(t)?Nu:Rm;return i(t)}function Hd(t,i,n){(n?Lt(t,i,n):i===r)?i=1:i=N(i);var l=G(t)?hm:Fm;return l(t,i)}function Wd(t){var i=G(t)?fm:Vm;return i(t)}function zd(t){if(t==null)return 0;if(It(t))return Vo(t)?Dr(t):t.length;var i=wt(t);return i==ee||i==re?t.size:Ls(t).length}function $d(t,i,n){var l=G(t)?us:Gm;return n&&Lt(t,i,n)&&(i=r),l(t,R(i,3))}var qd=U(function(t,i){if(t==null)return[];var n=i.length;return n>1&&Lt(t,i[0],i[1])?i=[]:n>2&&Lt(i[0],i[1],i[2])&&(i=[i[0]]),tl(t,Pt(i,1),[])}),Ao=Sp||function(){return dt.Date.now()};function Yd(t,i){if(typeof i!="function")throw new qt(h);return t=N(t),function(){if(--t<1)return i.apply(this,arguments)}}function Yl(t,i,n){return i=n?r:i,i=t&&i==null?t.length:i,De(t,_e,r,r,r,r,i)}function Xl(t,i){var n;if(typeof i!="function")throw new qt(h);return t=N(t),function(){return--t>0&&(n=i.apply(this,arguments)),t<=1&&(i=r),n}}var Qs=U(function(t,i,n){var l=st;if(n.length){var c=Be(n,Vr(Qs));l|=he}return De(t,l,i,n,c)}),Ql=U(function(t,i,n){var l=st|ft;if(n.length){var c=Be(n,Vr(Ql));l|=he}return De(i,l,t,n,c)});function Kl(t,i,n){i=n?r:i;var l=De(t,ce,r,r,r,r,r,i);return l.placeholder=Kl.placeholder,l}function Jl(t,i,n){i=n?r:i;var l=De(t,wr,r,r,r,r,r,i);return l.placeholder=Jl.placeholder,l}function Zl(t,i,n){var l,c,m,d,y,b,C=0,_=!1,S=!1,O=!0;if(typeof t!="function")throw new qt(h);i=Jt(i)||0,at(n)&&(_=!!n.leading,S="maxWait"in n,m=S?mt(Jt(n.maxWait)||0,i):m,O="trailing"in n?!!n.trailing:O);function I(ct){var se=l,Fe=c;return l=c=r,C=ct,d=t.apply(Fe,se),d}function F(ct){return C=ct,y=Ti(W,i),_?I(ct):d}function j(ct){var se=ct-b,Fe=ct-C,vc=i-se;return S?xt(vc,m-Fe):vc}function k(ct){var se=ct-b,Fe=ct-C;return b===r||se>=i||se<0||S&&Fe>=m}function W(){var ct=Ao();if(k(ct))return $(ct);y=Ti(W,j(ct))}function $(ct){return y=r,O&&l?I(ct):(l=c=r,d)}function jt(){y!==r&&ll(y),C=0,l=b=c=y=r}function St(){return y===r?d:$(Ao())}function Ut(){var ct=Ao(),se=k(ct);if(l=arguments,c=this,b=ct,se){if(y===r)return F(b);if(S)return ll(y),y=Ti(W,i),I(b)}return y===r&&(y=Ti(W,i)),d}return Ut.cancel=jt,Ut.flush=St,Ut}var Xd=U(function(t,i){return Bu(t,1,i)}),Qd=U(function(t,i,n){return Bu(t,Jt(i)||0,n)});function Kd(t){return De(t,Un)}function Ro(t,i){if(typeof t!="function"||i!=null&&typeof i!="function")throw new qt(h);var n=function(){var l=arguments,c=i?i.apply(this,l):l[0],m=n.cache;if(m.has(c))return m.get(c);var d=t.apply(this,l);return n.cache=m.set(c,d)||m,d};return n.cache=new(Ro.Cache||Oe),n}Ro.Cache=Oe;function Fo(t){if(typeof t!="function")throw new qt(h);return function(){var i=arguments;switch(i.length){case 0:return!t.call(this);case 1:return!t.call(this,i[0]);case 2:return!t.call(this,i[0],i[1]);case 3:return!t.call(this,i[0],i[1],i[2])}return!t.apply(this,i)}}function Jd(t){return Xl(2,t)}var Zd=Nm(function(t,i){i=i.length==1&&G(i[0])?nt(i[0],Vt(R())):nt(Pt(i,1),Vt(R()));var n=i.length;return U(function(l){for(var c=-1,m=xt(l.length,n);++c<m;)l[c]=i[c].call(this,l[c]);return kt(t,this,l)})}),Ks=U(function(t,i){var n=Be(i,Vr(Ks));return De(t,he,r,i,n)}),tc=U(function(t,i){var n=Be(i,Vr(tc));return De(t,Cr,r,i,n)}),ty=Ie(function(t,i){return De(t,ti,r,r,r,i)});function ey(t,i){if(typeof t!="function")throw new qt(h);return i=i===r?i:N(i),U(t,i)}function ry(t,i){if(typeof t!="function")throw new qt(h);return i=i==null?0:mt(N(i),0),U(function(n){var l=n[i],c=Ye(n,0,i);return l&&Ue(c,l),kt(t,this,c)})}function iy(t,i,n){var l=!0,c=!0;if(typeof t!="function")throw new qt(h);return at(n)&&(l="leading"in n?!!n.leading:l,c="trailing"in n?!!n.trailing:c),Zl(t,i,{leading:l,maxWait:i,trailing:c})}function oy(t){return Yl(t,1)}function ny(t,i){return Ks(Fs(i),t)}function sy(){if(!arguments.length)return[];var t=arguments[0];return G(t)?t:[t]}function ay(t){return Xt(t,M)}function uy(t,i){return i=typeof i=="function"?i:r,Xt(t,M,i)}function ly(t){return Xt(t,D|M)}function cy(t,i){return i=typeof i=="function"?i:r,Xt(t,D|M,i)}function hy(t,i){return i==null||Uu(t,i,yt(i))}function ne(t,i){return t===i||t!==t&&i!==i}var fy=So(ws),py=So(function(t,i){return t>=i}),fr=qu((function(){return arguments})())?qu:function(t){return ut(t)&&tt.call(t,"callee")&&!Au.call(t,"callee")},G=x.isArray,my=mu?Vt(mu):xm;function It(t){return t!=null&&ko(t.length)&&!Ae(t)}function lt(t){return ut(t)&&It(t)}function gy(t){return t===!0||t===!1||ut(t)&&_t(t)==ei}var Xe=Ep||ua,dy=gu?Vt(gu):wm;function yy(t){return ut(t)&&t.nodeType===1&&!xi(t)}function vy(t){if(t==null)return!0;if(It(t)&&(G(t)||typeof t=="string"||typeof t.splice=="function"||Xe(t)||Gr(t)||fr(t)))return!t.length;var i=wt(t);if(i==ee||i==re)return!t.size;if(Pi(t))return!Ls(t).length;for(var n in t)if(tt.call(t,n))return!1;return!0}function by(t,i){return yi(t,i)}function Py(t,i,n){n=typeof n=="function"?n:r;var l=n?n(t,i):r;return l===r?yi(t,i,r,n):!!l}function Js(t){if(!ut(t))return!1;var i=_t(t);return i==qi||i==Bh||typeof t.message=="string"&&typeof t.name=="string"&&!xi(t)}function Ty(t){return typeof t=="number"&&Fu(t)}function Ae(t){if(!at(t))return!1;var i=_t(t);return i==Yi||i==Ba||i==Uh||i==Wh}function ec(t){return typeof t=="number"&&t==N(t)}function ko(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ne}function at(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}function ut(t){return t!=null&&typeof t=="object"}var rc=du?Vt(du):_m;function xy(t,i){return t===i||_s(t,i,Bs(i))}function wy(t,i,n){return n=typeof n=="function"?n:r,_s(t,i,Bs(i),n)}function Cy(t){return ic(t)&&t!=+t}function _y(t){if(ug(t))throw new V(u);return Yu(t)}function Ly(t){return t===null}function Sy(t){return t==null}function ic(t){return typeof t=="number"||ut(t)&&_t(t)==ii}function xi(t){if(!ut(t)||_t(t)!=Le)return!1;var i=uo(t);if(i===null)return!0;var n=tt.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&oo.call(n)==wp}var Zs=yu?Vt(yu):Lm;function Oy(t){return ec(t)&&t>=-Ne&&t<=Ne}var oc=vu?Vt(vu):Sm;function Vo(t){return typeof t=="string"||!G(t)&&ut(t)&&_t(t)==ni}function Nt(t){return typeof t=="symbol"||ut(t)&&_t(t)==Xi}var Gr=bu?Vt(bu):Om;function Ey(t){return t===r}function Dy(t){return ut(t)&&wt(t)==si}function Iy(t){return ut(t)&&_t(t)==$h}var My=So(Ss),Ay=So(function(t,i){return t<=i});function nc(t){if(!t)return[];if(It(t))return Vo(t)?ie(t):Dt(t);if(li&&t[li])return hp(t[li]());var i=wt(t),n=i==ee?ms:i==re?eo:Nr;return n(t)}function Re(t){if(!t)return t===0?t:0;if(t=Jt(t),t===ir||t===-ir){var i=t<0?-1:1;return i*Vh}return t===t?t:0}function N(t){var i=Re(t),n=i%1;return i===i?n?i-n:i:0}function sc(t){return t?ur(N(t),0,fe):0}function Jt(t){if(typeof t=="number")return t;if(Nt(t))return zi;if(at(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=at(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=_u(t);var n=mf.test(t);return n||df.test(t)?Yf(t.slice(2),n?2:8):pf.test(t)?zi:+t}function ac(t){return me(t,Mt(t))}function Ry(t){return t?ur(N(t),-Ne,Ne):t===0?t:0}function Z(t){return t==null?"":Gt(t)}var Fy=Fr(function(t,i){if(Pi(i)||It(i)){me(i,yt(i),t);return}for(var n in i)tt.call(i,n)&&mi(t,n,i[n])}),uc=Fr(function(t,i){me(i,Mt(i),t)}),Go=Fr(function(t,i,n,l){me(i,Mt(i),t,l)}),ky=Fr(function(t,i,n,l){me(i,yt(i),t,l)}),Vy=Ie(Ps);function Gy(t,i){var n=Rr(t);return i==null?n:ju(n,i)}var Ny=U(function(t,i){t=rt(t);var n=-1,l=i.length,c=l>2?i[2]:r;for(c&&Lt(i[0],i[1],c)&&(l=1);++n<l;)for(var m=i[n],d=Mt(m),y=-1,b=d.length;++y<b;){var C=d[y],_=t[C];(_===r||ne(_,Ir[C])&&!tt.call(t,C))&&(t[C]=m[C])}return t}),jy=U(function(t){return t.push(r,_l),kt(lc,r,t)});function Uy(t,i){return Tu(t,R(i,3),pe)}function By(t,i){return Tu(t,R(i,3),xs)}function Hy(t,i){return t==null?t:Ts(t,R(i,3),Mt)}function Wy(t,i){return t==null?t:zu(t,R(i,3),Mt)}function zy(t,i){return t&&pe(t,R(i,3))}function $y(t,i){return t&&xs(t,R(i,3))}function qy(t){return t==null?[]:bo(t,yt(t))}function Yy(t){return t==null?[]:bo(t,Mt(t))}function ta(t,i,n){var l=t==null?r:lr(t,i);return l===r?n:l}function Xy(t,i){return t!=null&&Ol(t,i,vm)}function ea(t,i){return t!=null&&Ol(t,i,bm)}var Qy=Pl(function(t,i,n){i!=null&&typeof i.toString!="function"&&(i=no.call(i)),t[i]=n},ia(At)),Ky=Pl(function(t,i,n){i!=null&&typeof i.toString!="function"&&(i=no.call(i)),tt.call(t,i)?t[i].push(n):t[i]=[n]},R),Jy=U(di);function yt(t){return It(t)?Gu(t):Ls(t)}function Mt(t){return It(t)?Gu(t,!0):Em(t)}function Zy(t,i){var n={};return i=R(i,3),pe(t,function(l,c,m){Ee(n,i(l,c,m),l)}),n}function tv(t,i){var n={};return i=R(i,3),pe(t,function(l,c,m){Ee(n,c,i(l,c,m))}),n}var ev=Fr(function(t,i,n){Po(t,i,n)}),lc=Fr(function(t,i,n,l){Po(t,i,n,l)}),rv=Ie(function(t,i){var n={};if(t==null)return n;var l=!1;i=nt(i,function(m){return m=qe(m,t),l||(l=m.length>1),m}),me(t,js(t),n),l&&(n=Xt(n,D|Y|M,Qm));for(var c=i.length;c--;)Ms(n,i[c]);return n});function iv(t,i){return cc(t,Fo(R(i)))}var ov=Ie(function(t,i){return t==null?{}:Im(t,i)});function cc(t,i){if(t==null)return{};var n=nt(js(t),function(l){return[l]});return i=R(i),el(t,n,function(l,c){return i(l,c[0])})}function nv(t,i,n){i=qe(i,t);var l=-1,c=i.length;for(c||(c=1,t=r);++l<c;){var m=t==null?r:t[ge(i[l])];m===r&&(l=c,m=n),t=Ae(m)?m.call(t):m}return t}function sv(t,i,n){return t==null?t:vi(t,i,n)}function av(t,i,n,l){return l=typeof l=="function"?l:r,t==null?t:vi(t,i,n,l)}var hc=wl(yt),fc=wl(Mt);function uv(t,i,n){var l=G(t),c=l||Xe(t)||Gr(t);if(i=R(i,4),n==null){var m=t&&t.constructor;c?n=l?new m:[]:at(t)?n=Ae(m)?Rr(uo(t)):{}:n={}}return(c?$t:pe)(t,function(d,y,b){return i(n,d,y,b)}),n}function lv(t,i){return t==null?!0:Ms(t,i)}function cv(t,i,n){return t==null?t:sl(t,i,Fs(n))}function hv(t,i,n,l){return l=typeof l=="function"?l:r,t==null?t:sl(t,i,Fs(n),l)}function Nr(t){return t==null?[]:ps(t,yt(t))}function fv(t){return t==null?[]:ps(t,Mt(t))}function pv(t,i,n){return n===r&&(n=i,i=r),n!==r&&(n=Jt(n),n=n===n?n:0),i!==r&&(i=Jt(i),i=i===i?i:0),ur(Jt(t),i,n)}function mv(t,i,n){return i=Re(i),n===r?(n=i,i=0):n=Re(n),t=Jt(t),Pm(t,i,n)}function gv(t,i,n){if(n&&typeof n!="boolean"&&Lt(t,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&i===r?(t=0,i=1):(t=Re(t),i===r?(i=t,t=0):i=Re(i)),t>i){var l=t;t=i,i=l}if(n||t%1||i%1){var c=ku();return xt(t+c*(i-t+qf("1e-"+((c+"").length-1))),i)}return Es(t,i)}var dv=kr(function(t,i,n){return i=i.toLowerCase(),t+(n?pc(i):i)});function pc(t){return ra(Z(t).toLowerCase())}function mc(t){return t=Z(t),t&&t.replace(vf,sp).replace(Vf,"")}function yv(t,i,n){t=Z(t),i=Gt(i);var l=t.length;n=n===r?l:ur(N(n),0,l);var c=n;return n-=i.length,n>=0&&t.slice(n,c)==i}function vv(t){return t=Z(t),t&&Kh.test(t)?t.replace(za,ap):t}function bv(t){return t=Z(t),t&&of.test(t)?t.replace(Kn,"\\$&"):t}var Pv=kr(function(t,i,n){return t+(n?"-":"")+i.toLowerCase()}),Tv=kr(function(t,i,n){return t+(n?" ":"")+i.toLowerCase()}),xv=yl("toLowerCase");function wv(t,i,n){t=Z(t),i=N(i);var l=i?Dr(t):0;if(!i||l>=i)return t;var c=(i-l)/2;return Lo(fo(c),n)+t+Lo(ho(c),n)}function Cv(t,i,n){t=Z(t),i=N(i);var l=i?Dr(t):0;return i&&l<i?t+Lo(i-l,n):t}function _v(t,i,n){t=Z(t),i=N(i);var l=i?Dr(t):0;return i&&l<i?Lo(i-l,n)+t:t}function Lv(t,i,n){return n||i==null?i=0:i&&(i=+i),Ap(Z(t).replace(Jn,""),i||0)}function Sv(t,i,n){return(n?Lt(t,i,n):i===r)?i=1:i=N(i),Ds(Z(t),i)}function Ov(){var t=arguments,i=Z(t[0]);return t.length<3?i:i.replace(t[1],t[2])}var Ev=kr(function(t,i,n){return t+(n?"_":"")+i.toLowerCase()});function Dv(t,i,n){return n&&typeof n!="number"&&Lt(t,i,n)&&(i=n=r),n=n===r?fe:n>>>0,n?(t=Z(t),t&&(typeof i=="string"||i!=null&&!Zs(i))&&(i=Gt(i),!i&&Er(t))?Ye(ie(t),0,n):t.split(i,n)):[]}var Iv=kr(function(t,i,n){return t+(n?" ":"")+ra(i)});function Mv(t,i,n){return t=Z(t),n=n==null?0:ur(N(n),0,t.length),i=Gt(i),t.slice(n,n+i.length)==i}function Av(t,i,n){var l=f.templateSettings;n&&Lt(t,i,n)&&(i=r),t=Z(t),i=Go({},i,l,Cl);var c=Go({},i.imports,l.imports,Cl),m=yt(c),d=ps(c,m),y,b,C=0,_=i.interpolate||Qi,S="__p += '",O=gs((i.escape||Qi).source+"|"+_.source+"|"+(_===$a?ff:Qi).source+"|"+(i.evaluate||Qi).source+"|$","g"),I="//# sourceURL="+(tt.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Bf+"]")+`
`;t.replace(O,function(k,W,$,jt,St,Ut){return $||($=jt),S+=t.slice(C,Ut).replace(bf,up),W&&(y=!0,S+=`' +
__e(`+W+`) +
'`),St&&(b=!0,S+=`';
`+St+`;
__p += '`),$&&(S+=`' +
((__t = (`+$+`)) == null ? '' : __t) +
'`),C=Ut+k.length,k}),S+=`';
`;var F=tt.call(i,"variable")&&i.variable;if(!F)S=`with (obj) {
`+S+`
}
`;else if(cf.test(F))throw new V(p);S=(b?S.replace(qh,""):S).replace(Yh,"$1").replace(Xh,"$1;"),S="function("+(F||"obj")+`) {
`+(F?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(b?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+S+`return __p
}`;var j=dc(function(){return Q(m,I+"return "+S).apply(r,d)});if(j.source=S,Js(j))throw j;return j}function Rv(t){return Z(t).toLowerCase()}function Fv(t){return Z(t).toUpperCase()}function kv(t,i,n){if(t=Z(t),t&&(n||i===r))return _u(t);if(!t||!(i=Gt(i)))return t;var l=ie(t),c=ie(i),m=Lu(l,c),d=Su(l,c)+1;return Ye(l,m,d).join("")}function Vv(t,i,n){if(t=Z(t),t&&(n||i===r))return t.slice(0,Eu(t)+1);if(!t||!(i=Gt(i)))return t;var l=ie(t),c=Su(l,ie(i))+1;return Ye(l,0,c).join("")}function Gv(t,i,n){if(t=Z(t),t&&(n||i===r))return t.replace(Jn,"");if(!t||!(i=Gt(i)))return t;var l=ie(t),c=Lu(l,ie(i));return Ye(l,c).join("")}function Nv(t,i){var n=Ih,l=Mh;if(at(i)){var c="separator"in i?i.separator:c;n="length"in i?N(i.length):n,l="omission"in i?Gt(i.omission):l}t=Z(t);var m=t.length;if(Er(t)){var d=ie(t);m=d.length}if(n>=m)return t;var y=n-Dr(l);if(y<1)return l;var b=d?Ye(d,0,y).join(""):t.slice(0,y);if(c===r)return b+l;if(d&&(y+=b.length-y),Zs(c)){if(t.slice(y).search(c)){var C,_=b;for(c.global||(c=gs(c.source,Z(qa.exec(c))+"g")),c.lastIndex=0;C=c.exec(_);)var S=C.index;b=b.slice(0,S===r?y:S)}}else if(t.indexOf(Gt(c),y)!=y){var O=b.lastIndexOf(c);O>-1&&(b=b.slice(0,O))}return b+l}function jv(t){return t=Z(t),t&&Qh.test(t)?t.replace(Wa,gp):t}var Uv=kr(function(t,i,n){return t+(n?" ":"")+i.toUpperCase()}),ra=yl("toUpperCase");function gc(t,i,n){return t=Z(t),i=n?r:i,i===r?cp(t)?vp(t):ep(t):t.match(i)||[]}var dc=U(function(t,i){try{return kt(t,r,i)}catch(n){return Js(n)?n:new V(n)}}),Bv=Ie(function(t,i){return $t(i,function(n){n=ge(n),Ee(t,n,Qs(t[n],t))}),t});function Hv(t){var i=t==null?0:t.length,n=R();return t=i?nt(t,function(l){if(typeof l[1]!="function")throw new qt(h);return[n(l[0]),l[1]]}):[],U(function(l){for(var c=-1;++c<i;){var m=t[c];if(kt(m[0],this,l))return kt(m[1],this,l)}})}function Wv(t){return gm(Xt(t,D))}function ia(t){return function(){return t}}function zv(t,i){return t==null||t!==t?i:t}var $v=bl(),qv=bl(!0);function At(t){return t}function oa(t){return Xu(typeof t=="function"?t:Xt(t,D))}function Yv(t){return Ku(Xt(t,D))}function Xv(t,i){return Ju(t,Xt(i,D))}var Qv=U(function(t,i){return function(n){return di(n,t,i)}}),Kv=U(function(t,i){return function(n){return di(t,n,i)}});function na(t,i,n){var l=yt(i),c=bo(i,l);n==null&&!(at(i)&&(c.length||!l.length))&&(n=i,i=t,t=this,c=bo(i,yt(i)));var m=!(at(n)&&"chain"in n)||!!n.chain,d=Ae(t);return $t(c,function(y){var b=i[y];t[y]=b,d&&(t.prototype[y]=function(){var C=this.__chain__;if(m||C){var _=t(this.__wrapped__),S=_.__actions__=Dt(this.__actions__);return S.push({func:b,args:arguments,thisArg:t}),_.__chain__=C,_}return b.apply(t,Ue([this.value()],arguments))})}),t}function Jv(){return dt._===this&&(dt._=Cp),this}function sa(){}function Zv(t){return t=N(t),U(function(i){return Zu(i,t)})}var tb=Vs(nt),eb=Vs(Pu),rb=Vs(us);function yc(t){return Ws(t)?ls(ge(t)):Mm(t)}function ib(t){return function(i){return t==null?r:lr(t,i)}}var ob=Tl(),nb=Tl(!0);function aa(){return[]}function ua(){return!1}function sb(){return{}}function ab(){return""}function ub(){return!0}function lb(t,i){if(t=N(t),t<1||t>Ne)return[];var n=fe,l=xt(t,fe);i=R(i),t-=fe;for(var c=fs(l,i);++n<t;)i(n);return c}function cb(t){return G(t)?nt(t,ge):Nt(t)?[t]:Dt(Vl(Z(t)))}function hb(t){var i=++xp;return Z(t)+i}var fb=_o(function(t,i){return t+i},0),pb=Gs("ceil"),mb=_o(function(t,i){return t/i},1),gb=Gs("floor");function db(t){return t&&t.length?vo(t,At,ws):r}function yb(t,i){return t&&t.length?vo(t,R(i,2),ws):r}function vb(t){return wu(t,At)}function bb(t,i){return wu(t,R(i,2))}function Pb(t){return t&&t.length?vo(t,At,Ss):r}function Tb(t,i){return t&&t.length?vo(t,R(i,2),Ss):r}var xb=_o(function(t,i){return t*i},1),wb=Gs("round"),Cb=_o(function(t,i){return t-i},0);function _b(t){return t&&t.length?hs(t,At):0}function Lb(t,i){return t&&t.length?hs(t,R(i,2)):0}return f.after=Yd,f.ary=Yl,f.assign=Fy,f.assignIn=uc,f.assignInWith=Go,f.assignWith=ky,f.at=Vy,f.before=Xl,f.bind=Qs,f.bindAll=Bv,f.bindKey=Ql,f.castArray=sy,f.chain=zl,f.chunk=gg,f.compact=dg,f.concat=yg,f.cond=Hv,f.conforms=Wv,f.constant=ia,f.countBy=_d,f.create=Gy,f.curry=Kl,f.curryRight=Jl,f.debounce=Zl,f.defaults=Ny,f.defaultsDeep=jy,f.defer=Xd,f.delay=Qd,f.difference=vg,f.differenceBy=bg,f.differenceWith=Pg,f.drop=Tg,f.dropRight=xg,f.dropRightWhile=wg,f.dropWhile=Cg,f.fill=_g,f.filter=Sd,f.flatMap=Dd,f.flatMapDeep=Id,f.flatMapDepth=Md,f.flatten=Ul,f.flattenDeep=Lg,f.flattenDepth=Sg,f.flip=Kd,f.flow=$v,f.flowRight=qv,f.fromPairs=Og,f.functions=qy,f.functionsIn=Yy,f.groupBy=Ad,f.initial=Dg,f.intersection=Ig,f.intersectionBy=Mg,f.intersectionWith=Ag,f.invert=Qy,f.invertBy=Ky,f.invokeMap=Fd,f.iteratee=oa,f.keyBy=kd,f.keys=yt,f.keysIn=Mt,f.map=Mo,f.mapKeys=Zy,f.mapValues=tv,f.matches=Yv,f.matchesProperty=Xv,f.memoize=Ro,f.merge=ev,f.mergeWith=lc,f.method=Qv,f.methodOf=Kv,f.mixin=na,f.negate=Fo,f.nthArg=Zv,f.omit=rv,f.omitBy=iv,f.once=Jd,f.orderBy=Vd,f.over=tb,f.overArgs=Zd,f.overEvery=eb,f.overSome=rb,f.partial=Ks,f.partialRight=tc,f.partition=Gd,f.pick=ov,f.pickBy=cc,f.property=yc,f.propertyOf=ib,f.pull=Vg,f.pullAll=Hl,f.pullAllBy=Gg,f.pullAllWith=Ng,f.pullAt=jg,f.range=ob,f.rangeRight=nb,f.rearg=ty,f.reject=Ud,f.remove=Ug,f.rest=ey,f.reverse=Ys,f.sampleSize=Hd,f.set=sv,f.setWith=av,f.shuffle=Wd,f.slice=Bg,f.sortBy=qd,f.sortedUniq=Xg,f.sortedUniqBy=Qg,f.split=Dv,f.spread=ry,f.tail=Kg,f.take=Jg,f.takeRight=Zg,f.takeRightWhile=td,f.takeWhile=ed,f.tap=dd,f.throttle=iy,f.thru=Io,f.toArray=nc,f.toPairs=hc,f.toPairsIn=fc,f.toPath=cb,f.toPlainObject=ac,f.transform=uv,f.unary=oy,f.union=rd,f.unionBy=id,f.unionWith=od,f.uniq=nd,f.uniqBy=sd,f.uniqWith=ad,f.unset=lv,f.unzip=Xs,f.unzipWith=Wl,f.update=cv,f.updateWith=hv,f.values=Nr,f.valuesIn=fv,f.without=ud,f.words=gc,f.wrap=ny,f.xor=ld,f.xorBy=cd,f.xorWith=hd,f.zip=fd,f.zipObject=pd,f.zipObjectDeep=md,f.zipWith=gd,f.entries=hc,f.entriesIn=fc,f.extend=uc,f.extendWith=Go,na(f,f),f.add=fb,f.attempt=dc,f.camelCase=dv,f.capitalize=pc,f.ceil=pb,f.clamp=pv,f.clone=ay,f.cloneDeep=ly,f.cloneDeepWith=cy,f.cloneWith=uy,f.conformsTo=hy,f.deburr=mc,f.defaultTo=zv,f.divide=mb,f.endsWith=yv,f.eq=ne,f.escape=vv,f.escapeRegExp=bv,f.every=Ld,f.find=Od,f.findIndex=Nl,f.findKey=Uy,f.findLast=Ed,f.findLastIndex=jl,f.findLastKey=By,f.floor=gb,f.forEach=$l,f.forEachRight=ql,f.forIn=Hy,f.forInRight=Wy,f.forOwn=zy,f.forOwnRight=$y,f.get=ta,f.gt=fy,f.gte=py,f.has=Xy,f.hasIn=ea,f.head=Bl,f.identity=At,f.includes=Rd,f.indexOf=Eg,f.inRange=mv,f.invoke=Jy,f.isArguments=fr,f.isArray=G,f.isArrayBuffer=my,f.isArrayLike=It,f.isArrayLikeObject=lt,f.isBoolean=gy,f.isBuffer=Xe,f.isDate=dy,f.isElement=yy,f.isEmpty=vy,f.isEqual=by,f.isEqualWith=Py,f.isError=Js,f.isFinite=Ty,f.isFunction=Ae,f.isInteger=ec,f.isLength=ko,f.isMap=rc,f.isMatch=xy,f.isMatchWith=wy,f.isNaN=Cy,f.isNative=_y,f.isNil=Sy,f.isNull=Ly,f.isNumber=ic,f.isObject=at,f.isObjectLike=ut,f.isPlainObject=xi,f.isRegExp=Zs,f.isSafeInteger=Oy,f.isSet=oc,f.isString=Vo,f.isSymbol=Nt,f.isTypedArray=Gr,f.isUndefined=Ey,f.isWeakMap=Dy,f.isWeakSet=Iy,f.join=Rg,f.kebabCase=Pv,f.last=Kt,f.lastIndexOf=Fg,f.lowerCase=Tv,f.lowerFirst=xv,f.lt=My,f.lte=Ay,f.max=db,f.maxBy=yb,f.mean=vb,f.meanBy=bb,f.min=Pb,f.minBy=Tb,f.stubArray=aa,f.stubFalse=ua,f.stubObject=sb,f.stubString=ab,f.stubTrue=ub,f.multiply=xb,f.nth=kg,f.noConflict=Jv,f.noop=sa,f.now=Ao,f.pad=wv,f.padEnd=Cv,f.padStart=_v,f.parseInt=Lv,f.random=gv,f.reduce=Nd,f.reduceRight=jd,f.repeat=Sv,f.replace=Ov,f.result=nv,f.round=wb,f.runInContext=v,f.sample=Bd,f.size=zd,f.snakeCase=Ev,f.some=$d,f.sortedIndex=Hg,f.sortedIndexBy=Wg,f.sortedIndexOf=zg,f.sortedLastIndex=$g,f.sortedLastIndexBy=qg,f.sortedLastIndexOf=Yg,f.startCase=Iv,f.startsWith=Mv,f.subtract=Cb,f.sum=_b,f.sumBy=Lb,f.template=Av,f.times=lb,f.toFinite=Re,f.toInteger=N,f.toLength=sc,f.toLower=Rv,f.toNumber=Jt,f.toSafeInteger=Ry,f.toString=Z,f.toUpper=Fv,f.trim=kv,f.trimEnd=Vv,f.trimStart=Gv,f.truncate=Nv,f.unescape=jv,f.uniqueId=hb,f.upperCase=Uv,f.upperFirst=ra,f.each=$l,f.eachRight=ql,f.first=Bl,na(f,(function(){var t={};return pe(f,function(i,n){tt.call(f.prototype,n)||(t[n]=i)}),t})(),{chain:!1}),f.VERSION=o,$t(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){f[t].placeholder=f}),$t(["drop","take"],function(t,i){z.prototype[t]=function(n){n=n===r?1:mt(N(n),0);var l=this.__filtered__&&!i?new z(this):this.clone();return l.__filtered__?l.__takeCount__=xt(n,l.__takeCount__):l.__views__.push({size:xt(n,fe),type:t+(l.__dir__<0?"Right":"")}),l},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),$t(["filter","map","takeWhile"],function(t,i){var n=i+1,l=n==Ua||n==kh;z.prototype[t]=function(c){var m=this.clone();return m.__iteratees__.push({iteratee:R(c,3),type:n}),m.__filtered__=m.__filtered__||l,m}}),$t(["head","last"],function(t,i){var n="take"+(i?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),$t(["initial","tail"],function(t,i){var n="drop"+(i?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(At)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=U(function(t,i){return typeof t=="function"?new z(this):this.map(function(n){return di(n,t,i)})}),z.prototype.reject=function(t){return this.filter(Fo(R(t)))},z.prototype.slice=function(t,i){t=N(t);var n=this;return n.__filtered__&&(t>0||i<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),i!==r&&(i=N(i),n=i<0?n.dropRight(-i):n.take(i-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(fe)},pe(z.prototype,function(t,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),l=/^(?:head|last)$/.test(i),c=f[l?"take"+(i=="last"?"Right":""):i],m=l||/^find/.test(i);c&&(f.prototype[i]=function(){var d=this.__wrapped__,y=l?[1]:arguments,b=d instanceof z,C=y[0],_=b||G(d),S=function(W){var $=c.apply(f,Ue([W],y));return l&&O?$[0]:$};_&&n&&typeof C=="function"&&C.length!=1&&(b=_=!1);var O=this.__chain__,I=!!this.__actions__.length,F=m&&!O,j=b&&!I;if(!m&&_){d=j?d:new z(this);var k=t.apply(d,y);return k.__actions__.push({func:Io,args:[S],thisArg:r}),new Yt(k,O)}return F&&j?t.apply(this,y):(k=this.thru(S),F?l?k.value()[0]:k.value():k)})}),$t(["pop","push","shift","sort","splice","unshift"],function(t){var i=ro[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",l=/^(?:pop|shift)$/.test(t);f.prototype[t]=function(){var c=arguments;if(l&&!this.__chain__){var m=this.value();return i.apply(G(m)?m:[],c)}return this[n](function(d){return i.apply(G(d)?d:[],c)})}}),pe(z.prototype,function(t,i){var n=f[i];if(n){var l=n.name+"";tt.call(Ar,l)||(Ar[l]=[]),Ar[l].push({name:i,func:n})}}),Ar[Co(r,ft).name]=[{name:"wrapper",func:r}],z.prototype.clone=jp,z.prototype.reverse=Up,z.prototype.value=Bp,f.prototype.at=yd,f.prototype.chain=vd,f.prototype.commit=bd,f.prototype.next=Pd,f.prototype.plant=xd,f.prototype.reverse=wd,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Cd,f.prototype.first=f.prototype.head,li&&(f.prototype[li]=Td),f},He=bp();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(dt._=He,define(function(){return He})):or?((or.exports=He)._=He,os._=He):dt._=He}).call(s)}),Oh=class extends Set{constructor(s,e=!1){super(s),this.valuesAsFlags=e}};function Ui(s){if(s instanceof Map)return Object.fromEntries([...s.entries()].map(([e,r])=>[e,Ui(r)]));if(s instanceof Set)return Array.from(s.values()).map(Ui);if(s instanceof Oh)return{values:[...s.values()],valuesAsFlags:s.valuesAsFlags};if(typeof s=="object"){let e={};return Object.entries(s).forEach(([r,o])=>{e[r]=Ui(o)}),e}else return s}var N1=ka(Va(),1);var NP=ka(Va(),1);function xr(s,e){if(typeof s!="object")throw new Error(`Cannot merge into non-object objectToMergeWith. Received: ${JSON.stringify(s)}`);if(typeof e!="object")throw new Error(`Cannot merge using non-object objectToMergeWith. Received: ${JSON.stringify(e)}`);let r=(0,NP.cloneDeep)(s);for(let[o,a]of Object.entries(e))typeof a!="object"||a instanceof Set||r[o]===void 0?r[o]=a:r[o]=xr(r[o],a);return r}function Eh(s,e){if(!(s===void 0||typeof s!="object"))for(let r of Object.keys(s)){if(r===e)return s[r];let o=s[r];if(typeof o=="object"){let a=Eh(o,e);if(a!==void 0)return a}}}var Fa="@composite:",jP="@inherit:",UP=class{constructor(s,e,r){this.tiledClassToMembersMap=s,this.enumNameToValuesMap=e,this.parserOptions=r,this.memoiser=new Map}flattenMembers(s,e){return this.memoiser.has(s)?{[s]:this.memoiser.get(s)}:(this.memoiser.set(s,e.reduce((r,o)=>K(K({},r),this.flattenMemberProperty(o)),{})),{[s]:this.memoiser.get(s)})}flattenMemberProperty(s){var r;let e=(r=s.propertyType)!=null?r:s.propertytype;if(s.type==="class"){if(!this.memoiser.has(e)){let u=this.tiledClassToMembersMap.get(e).reduce((h,p)=>xr(this.flattenMemberProperty(p),h),{});this.memoiser.set(e,u)}let o=this.memoiser.get(e),a=xr(o,this.flattenValue(s.value,o));return this.checkIfShouldFlatten(s.name)?a:{[s.name.replace(Fa,"")]:a}}else return this.enumNameToValuesMap.has(e)?this.enumNameToValuesMap.get(e).valuesAsFlags?{[s.name]:new Set(s.value.split(",").filter(o=>o!==""))}:{[s.name]:s.value}:{[s.name]:s.value}}get memoisedFlattenedProperties(){return this.memoiser}flattenValue(s,e){return Object.entries(s).reduce((r,[o,a])=>{if(typeof a!="object")return Eh(e,o)instanceof Set?xr({[o]:new Set(a.split(",").filter(u=>u!==""))},r):xr({[o]:a},r);if(this.checkIfShouldFlatten(o))return xr(this.flattenValue(a,e),r);{let u=o.replace(Fa,"");return xr({[u]:this.flattenValue(a,e)},r)}},{})}checkIfShouldFlatten(s){var e;return((e=this.parserOptions)==null?void 0:e.defaultComposite)===!0?s.startsWith(jP):!s.startsWith(Fa)}},Lh=ka(Va(),1),BP=class{constructor(s){this.flattener=s}flattenPropertiesOnObject(s){var e,r,o,a;return Bt(K(K({},this.flattener.memoisedFlattenedProperties.get((e=s.class)!=null?e:s.type)),(r=s.properties)==null?void 0:r.reduce((u,h)=>K(K({},u),this.flattener.flattenMemberProperty(h)),{})),{name:s.name,id:s.id,class:(a=(o=s.class)!=null?o:s.type)!=null?a:null,x:s.x,y:s.y})}flattenPropertiesOnTile(s){var e,r,o,a;return Bt(K(K({},this.flattener.memoisedFlattenedProperties.get((e=s.class)!=null?e:s.type)),(r=s.properties)==null?void 0:r.reduce((u,h)=>K(K({},u),this.flattener.flattenMemberProperty(h)),{})),{id:s.id,class:(a=(o=s.class)!=null?o:s.type)!=null?a:null})}getCustomTypesMap(){return new Map([...this.flattener.memoisedFlattenedProperties.entries()].map(([s,e])=>[s,(0,Lh.cloneDeep)(e)]))}getEnumsMap(){return new Map([...this.flattener.enumNameToValuesMap.entries()].map(([s,e])=>[s,(0,Lh.cloneDeep)(e)]))}toJSON(){return JSON.stringify({customTypes:Ui(this.getCustomTypesMap()),enums:Ui(this.getEnumsMap())},null,4)}};function HP(s,e){let r=new Map(s.propertyTypes.filter(u=>u.type==="enum").map(u=>[u.name,new Oh(u.values,u.valuesAsFlags)])),o=new Map(s.propertyTypes.filter(u=>u.type==="class").map(u=>[u.name,u.members])),a=new UP(o,r,e);return o.forEach((u,h)=>{a.flattenMembers(h,u)}),new BP(a)}var Dh={parse:HP};var er=class{constructor(e,r){this.phaserTile=e;this.tiledProject=r}getProperty(e){var a,u;let r={};if(this.tiledProject){let h=Dh.parse(this.tiledProject),p=this.getType();if(p){let g=(a=h.getCustomTypesMap())==null?void 0:a.get(p);if(g)for(let[T,L]of Object.entries(g))r[T]=L}}return(u=this.phaserTile.properties[e])!=null?u:r[e]}hasProperty(e){return this.getProperty(e)!=null}getType(){var e,r;return(r=(e=this.phaserTile.tileset)==null?void 0:e.tileData[this.phaserTile.index-1])==null?void 0:r.type}};var Kr=class{constructor(e,r){this.phaserTilemapLayer=e;this.tiledProject=r}getName(){return this.phaserTilemapLayer.layer.name}getProperty(e){let r=this.phaserTilemapLayer.layer.properties,o=r==null?void 0:r.find(a=>a.name==e);return o==null?void 0:o.value}hasProperty(e){return this.getProperty(e)!=null}isCharLayer(){return this.hasProperty(Xr)}getData(){return this.phaserTilemapLayer.layer.data.map(e=>e.map(r=>new er(r,this.tiledProject)))}};var Bi=class{constructor(e,r){this.phaserTilemap=e;this.tiledProject=r;for(let o of this.phaserTilemap.layers)if(o.tilemapLayer==null)throw new Error(`Error initializing tilemap. Layer '${o.name}' has no 'tilemapLayer'. This can happen if you call 'createLayer' with the wrong layer ID.`)}getTileWidth(){return this.phaserTilemap.tileWidth}getTileHeight(){return this.phaserTilemap.tileHeight}getWidth(){return this.phaserTilemap.width}getHeight(){return this.phaserTilemap.height}getOrientation(){return this.phaserTilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()?"isometric":"orthogonal"}getLayers(){return this.phaserTilemap.layers.map(e=>new Kr(e.tilemapLayer,this.tiledProject))}hasTileAt(e,r,o){return!!this.phaserTilemap.hasTileAt(e,r,o)}getTileAt(e,r,o){let a=this.phaserTilemap.getTileAt(e,r,!1,o);if(a)return new er(a,this.tiledProject)}};var Nn=class{constructor(e,r="orthogonal",o="ge_collide"){this.map=e;this.orientation=r;this.layerMap=new Map;this.layers=[];let a=-1,u=-1;Object.entries(e).map(([h,p])=>{var Y;let g=(Y=p.data[0])==null?void 0:Y.length,T=p.data.length;if(a!==-1&&a!==g||u!==-1&&u!==T)throw new Error("All tilemap layers must have the same dimensions.");a=g,u=T;let L=[];for(let M=0;M<p.data.length;M++){let H=[];for(let B=0;B<p.data[M].length;B++){let st=new Na(p.data[M][B]===1,o);H.push(st)}L.push(H)}let D=new Ga(h,L,p.isCharLayer);this.layers.push(D),this.layerMap.set(h,D)})}getWidth(){var e,r;return((r=(e=Object.values(this.map)[0])==null?void 0:e.data[0])==null?void 0:r.length)||0}getHeight(){var e;return((e=Object.values(this.map)[0])==null?void 0:e.data.length)||0}getOrientation(){return this.orientation}getLayers(){return this.layers}hasTileAt(e,r,o){return!o||!this.layerMap.get(o)?!1:e>=0&&e<this.getWidth()&&r>=0&&r<this.getHeight()}getTileAt(e,r,o){if(!o)return;let a=this.layerMap.get(o);if(a)return a.getData()[r][e]}},Ga=class{constructor(e,r,o=!1){this.name=e;this.tiles=r;this.isCharLayerInternal=o}getName(){return this.name}getProperty(e){if(e==="ge_charLayer"&&this.isCharLayerInternal)return this.name}hasProperty(e){return e==="ge_charLayer"&&this.isCharLayerInternal}getData(){return this.tiles}isCharLayer(){return this.isCharLayerInternal}},Na=class{constructor(e,r){this.isBlocking=e;this.collisionPropertyName=r}getProperty(e){return e===this.collisionPropertyName?this.isBlocking:!1}hasProperty(e){return e===this.collisionPropertyName}};var Jr=class{constructor(e,r){this.props={};var u;let o=e.find(h=>{var T;if(!h.tiles)return!1;let p=(T=h.firstgid)!=null?T:0;return!!h.tiles.find(L=>L.id+p===r)});if(!o)return;let a=(u=o.tiles)==null?void 0:u.find(h=>{var p;return h.id+((p=o.firstgid)!=null?p:0)===r});if(a!=null&&a.properties)for(let h of a.properties)h.name&&(this.props[h.name]=h.value)}getProperty(e){return this.props[e]}hasProperty(e){return this.props[e]!==void 0}};var Zr=class{constructor(e,r){this.layer=r;this.data=[];if(this.data=[],this.layer.data)for(let o=0;o<(this.layer.height||0);o++){let a=[];for(let u=0;u<(this.layer.width||0);u++){let h=this.layer.data[o*(this.layer.width||0)+u];h!==void 0?a.push(new Jr(e,h)):a.push(void 0)}this.data.push(a)}}getName(){return this.layer.name}getProperty(e){var r,o;return(o=(r=this.layer.properties)==null?void 0:r.find(a=>a.name===e))==null?void 0:o.value}hasProperty(e){return this.getProperty(e)!==void 0}getData(){return this.data}isCharLayer(){return this.hasProperty("ge_charLayer")}};var jn=class{constructor(e){this.rawTilemap=e;this.layers=[];var r;this.layers=(r=this.rawTilemap.layers)==null?void 0:r.map(o=>new Zr(this.rawTilemap.tilesets,o))}hasTileAt(e,r,o){if(e<0||e>=this.rawTilemap.width||r<0||r>=this.rawTilemap.height||!this.rawTilemap.layers)return!1;let a=this.rawTilemap.layers.find(h=>h.name===o);if(!a)return!1;let u=r*this.rawTilemap.width+e;return a.data[u]>0}getTileAt(e,r,o){if(e<0||e>=this.rawTilemap.width||r<0||r>=this.rawTilemap.height||!this.rawTilemap.layers)return;let a=this.layers.find(u=>u.getName()===o);if(a)return a.getData()[r][e]}getOrientation(){return this.rawTilemap.orientation}getLayers(){return this.layers}getWidth(){return this.rawTilemap.width}getHeight(){return this.rawTilemap.height}};var Hi=class Hi{constructor(e){this.scene=e;this.geHeadless=new ji(!1);this.isCreatedInternal=!1;Hi.welcomeMessagePrinted||(console.log(`Using GridEngine Phaser Plugin v${On}`),Hi.welcomeMessagePrinted=!0),this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this)}getCharLayer(e){return this.geHeadless.getCharLayer(e)}getTransition(e,r){return this.geHeadless.getTransition(e,r)}setTransition(e,r,o){this.geHeadless.setTransition(e,r,o)}create(e,r){this.geHeadless.create(new Bi(e,r.tiledProject),r),this.isCreatedInternal=!0,this.gridCharacters=new Map;let o=this.setConfigDefaults(r);this.config=o,this.gridTilemap=new br(e),this.addCharacters()}getPosition(e){return this.geHeadless.getPosition(e)}move(e,r){this.geHeadless.move(e,r)}moveRandomly(e,r=0,o=-1){this.geHeadless.moveRandomly(e,r,o)}getMovement(e){return this.geHeadless.getMovement(e)}moveTo(e,r,o){return this.geHeadless.moveTo(e,r,o)}stopMovement(e){this.geHeadless.stopMovement(e)}setSpeed(e,r){this.geHeadless.setSpeed(e,r)}getSpeed(e){return this.geHeadless.getSpeed(e)}setContainer(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setContainer(r)}getContainer(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getContainer()}getOffsetX(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getOffsetX()}setOffsetX(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setOffsetX(r)}getOffsetY(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getOffsetY()}setOffsetY(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.setOffsetY(r)}getDepthOffset(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getDepthOffset()}collidesWithTiles(e){return this.geHeadless.collidesWithTiles(e)}getWalkingAnimationMapping(e){var a;this.initGuard();let r=(a=this.gridCharacters)==null?void 0:a.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getAnimation();return o==null?void 0:o.getWalkingAnimationMapping()}hasLayerOverlay(){var e;return this.initGuard(),!!((e=this.config)!=null&&e.layerOverlay)}setWalkingAnimationMapping(e,r){var u;this.initGuard();let o=(u=this.gridCharacters)==null?void 0:u.get(e);if(!o)throw this.createCharUnknownErr(e);let a=o.getAnimation();a==null||a.setWalkingAnimationMapping(r)}update(e,r){if(this.isCreatedInternal&&this.gridCharacters)for(let[o,a]of this.gridCharacters)a.update(r);this.geHeadless.update(e,r)}addCharacter(e){this.geHeadless.addCharacter(e),this.addCharacterInternal(e)}hasCharacter(e){return this.geHeadless.hasCharacter(e)}removeCharacter(e){var o,a;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.destroy(),(a=this.gridCharacters)==null||a.delete(e),this.geHeadless.removeCharacter(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters){for(let e of this.gridCharacters.keys())this.removeCharacter(e);this.geHeadless.removeAllCharacters()}}getAllCharacters(e){return this.geHeadless.getAllCharacters(e)}getLabels(e){return this.geHeadless.getLabels(e)}addLabels(e,r){this.geHeadless.addLabels(e,r)}removeLabels(e,r){this.geHeadless.removeLabels(e,r)}clearLabels(e){this.geHeadless.clearLabels(e)}follow(e,r,o,a){let u;o===void 0?u={distance:0,closestPointIfBlocked:!1}:typeof o=="number"?(u={distance:o,closestPointIfBlocked:!1},a&&(u.closestPointIfBlocked=!0)):u=o,this.geHeadless.follow(e,r,u)}isMoving(e){return this.geHeadless.isMoving(e)}getFacingDirection(e){return this.geHeadless.getFacingDirection(e)}getFacingPosition(e){return this.geHeadless.getFacingPosition(e)}turnTowards(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);o.turnTowards(r),this.geHeadless.turnTowards(e,r)}getCharactersAt(e,r){return this.geHeadless.getCharactersAt(e,r)}setPosition(e,r,o){this.geHeadless.setPosition(e,r,o)}getSprite(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getSprite()}setSprite(e,r){var a;this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(e);if(!o)throw this.createCharUnknownErr(e);r.setOrigin(0,0),o.setSprite(r)}isBlocked(e,r,o=["geDefault"]){return this.geHeadless.isBlocked(e,r,o)}isTileBlocked(e,r){return this.geHeadless.isTileBlocked(e,r)}getCollisionGroups(e){return this.geHeadless.getCollisionGroups(e)}setCollisionGroups(e,r){this.geHeadless.setCollisionGroups(e,r)}getIgnoreCollisionGroups(e){return this.geHeadless.getIgnoreCollisionGroups(e)}setIgnoreCollisionGroups(e,r){this.geHeadless.setIgnoreCollisionGroups(e,r)}getTilePosInDirection(e,r,o){return this.geHeadless.getTilePosInDirection(e,r,o)}findShortestPath(e,r,o={}){return this.geHeadless.findShortestPath(e,r,o)}steppedOn(e,r,o){return this.geHeadless.steppedOn(e,r,o)}characterShifted(){return this.geHeadless.characterShifted()}movementStarted(){return this.geHeadless.movementStarted()}movementStopped(){return this.geHeadless.movementStopped()}directionChanged(){return this.geHeadless.directionChanged()}positionChangeStarted(){return this.geHeadless.positionChangeStarted()}positionChangeFinished(){return this.geHeadless.positionChangeFinished()}getMovementProgress(e){return this.geHeadless.getMovementProgress(e)}rebuildTileCollisionCache(e,r,o,a){this.geHeadless.rebuildTileCollisionCache(e,r,o,a)}addQueueMovements(e,r,o){this.geHeadless.addQueueMovements(e,r,o)}getEnqueuedMovements(e){return this.geHeadless.getEnqueuedMovements(e)}queueMovementFinished(){return this.geHeadless.queueMovementFinished()}clearEnqueuedMovements(e){return this.geHeadless.clearEnqueuedMovements(e)}getState(){return{characters:this.geHeadless.getState().characters.map(e=>Bt(K({},e),{offsetX:this.getOffsetX(e.id),offsetY:this.getOffsetY(e.id)}))}}setState(e){if(this.geHeadless.setState(e),this.gridCharacters)for(let r of e.characters){let o=this.gridCharacters.get(r.id);o&&(o.setOffsetX(r.offsetX),o.setOffsetY(r.offsetY))}}getTileCost(e,r,o){return this.initGuard(),this.geHeadless.getTileCost(e,r,o)}revertCurrentMovement(e){this.geHeadless.revertCurrentMovement(e)}isCurrentMovementReverted(e){return this.geHeadless.isCurrentMovementReverted(e)}setConfigDefaults(e){return K({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",layerOverlay:!1,cacheTileCollisions:!1},e)}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(r=>this.addCharacterInternal(r))}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}addCharacterInternal(e){var o;if(this.initGuard(),!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let r=new gn(e,this.scene,this.gridTilemap,this.config.layerOverlay,this.geHeadless);(o=this.gridCharacters)==null||o.set(e.id,r)}};Hi.welcomeMessagePrinted=!1;var Wi=Hi;window.GridEngine=Wi;window.GridEngineImports=ja;})();
/*! Bundled license information:

tiled-property-flattener/dist/tiled_property_flattener.min.js:
  (*! Bundled license information:
  
  lodash/lodash.js:
    (**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     *)
  *)
*/
