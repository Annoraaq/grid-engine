var GridEngine=(()=>{var lu=Object.create;var dr=Object.defineProperty,cu=Object.defineProperties,pu=Object.getOwnPropertyDescriptor,fu=Object.getOwnPropertyDescriptors,mu=Object.getOwnPropertyNames,To=Object.getOwnPropertySymbols,du=Object.getPrototypeOf,xo=Object.prototype.hasOwnProperty,gu=Object.prototype.propertyIsEnumerable;var wo=(r,t,e)=>t in r?dr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,w=(r,t)=>{for(var e in t||(t={}))xo.call(t,e)&&wo(r,e,t[e]);if(To)for(var e of To(t))gu.call(t,e)&&wo(r,e,t[e]);return r},Mt=(r,t)=>cu(r,fu(t));var m=(r,t)=>()=>(r&&(t=r(r=0)),t);var v=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),yu=(r,t)=>{for(var e in t)dr(r,e,{get:t[e],enumerable:!0})},vu=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of mu(t))!xo.call(r,n)&&n!==e&&dr(r,n,{get:()=>t[n],enumerable:!(i=pu(t,n))||i.enumerable});return r};var So=(r,t,e)=>(e=r!=null?lu(du(r)):{},vu(t||!r||!r.__esModule?dr(e,"default",{value:r,enumerable:!0}):e,r));var g,rt=m(()=>{g=class r{static get ZERO(){return new r(0,0)}static get ONE(){return new r(1,1)}static get UP(){return new r(0,-1)}static get DOWN(){return new r(0,1)}static get LEFT(){return new r(-1,0)}static get RIGHT(){return new r(1,0)}static get UP_LEFT(){return new r(-1,-1)}static get UP_RIGHT(){return new r(1,-1)}static get DOWN_RIGHT(){return new r(1,1)}static get DOWN_LEFT(){return new r(-1,1)}constructor(t,e){typeof t=="number"?(this.x=t,this.y=e||0):(this.x=t.x,this.y=t.y)}clone(){return new r(this.x,this.y)}add(t){return new r(this.x+t.x,this.y+t.y)}multiply(t){return new r(this.x*t.x,this.y*t.y)}divide(t){return new r(this.x/t.x,this.y/t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}equals(t){return this.x===t.x&&this.y===t.y}abs(){return new r(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}modulo(t){return new r(this.x%t.x,this.y%t.y)}scalarModulo(t){return new r(this.x%t,this.y%t)}scalarMult(t){return new r(this.x*t,this.y*t)}toPosition(){return{x:this.x,y:this.y}}toString(){return`${this.x}#${this.y}`}}});var b,Dt=m(()=>{rt();b=class{static equal(t,e){return t.position.x===e.position.x&&t.position.y===e.position.y&&t.layer===e.layer}static copyOver(t,e){e.position.x=t.position.x,e.position.y=t.position.y,e.layer=t.layer}static clone(t){return{position:t.position.clone(),layer:t.layer}}static toString(t){return`${t.position.toString()}#${t.layer}`}static toInternal(t){return{position:new g(t.position.x,t.position.y),layer:t.charLayer}}static fromInternal(t){return{position:t.position.toPosition(),charLayer:t.layer}}}});function $e(){return["up","down","left","right","none","up-left","up-right","down-right","down-left"]}function Se(r){return xu.includes(r)}function Ui(r){return["left","right"].includes(r)}function Co(r){return["up","down"].includes(r)}function Lo(r){return wu[r]}function gr(r){return Tu[r]}function St(r){return Pu[r]}function Eo(r){return bu[r]}function it(r,t){if(r.x===t.x){if(r.y>t.y)return"up";if(r.y<t.y)return"down"}else if(r.y===t.y){if(r.x>t.x)return"left";if(r.x<t.x)return"right"}else if(r.x>t.x){if(r.y<t.y)return"down-left";if(r.y>t.y)return"up-left"}else if(r.x<t.x){if(r.y<t.y)return"down-right";if(r.y>t.y)return"up-right"}return"none"}function ee(r){return typeof r=="string"&&$e().includes(r)}var pt,bu,Pu,Tu,wu,xu,Qt,$=m(()=>{rt();pt=(u=>(u.NONE="none",u.LEFT="left",u.UP_LEFT="up-left",u.UP="up",u.UP_RIGHT="up-right",u.RIGHT="right",u.DOWN_RIGHT="down-right",u.DOWN="down",u.DOWN_LEFT="down-left",u))(pt||{}),bu={up:"down",down:"up",left:"right",right:"left",none:"none","up-left":"down-right","up-right":"down-left","down-right":"up-left","down-left":"up-right"},Pu={up:g.UP,down:g.DOWN,left:g.LEFT,right:g.RIGHT,none:g.ZERO,"up-left":g.UP_LEFT,"up-right":g.UP_RIGHT,"down-right":g.DOWN_RIGHT,"down-left":g.DOWN_LEFT},Tu={left:"up-left","up-left":"up",up:"up-right","up-right":"right",right:"down-right","down-right":"down",down:"down-left","down-left":"left",none:"none"},wu={left:"down-left","up-left":"left",up:"up-left","up-right":"up",right:"up-right","down-right":"right",down:"down-right","down-left":"down",none:"none"},xu=["down-left","down-right","up-right","up-left"];Qt=(e=>(e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT",e))(Qt||{})});function re(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Hi(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Oo(r,t,e,i){function n(o){return o instanceof e?o:new e(function(s){s(o)})}return new(e||(e=Promise))(function(o,s){function a(l){try{u(i.next(l))}catch(c){s(c)}}function h(l){try{u(i.throw(l))}catch(c){s(c)}}function u(l){l.done?o(l.value):n(l.value).then(a,h)}u((i=i.apply(r,t||[])).next())})}function yr(r,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return h([u,l])}}function h(u){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(e=0)),e;)try{if(i=1,n&&(o=u[0]&2?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){e.label=u[1];break}if(u[0]===6&&e.label<o[1]){e.label=o[1],o=u;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(u);break}o[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(l){u=[6,l],n=0}finally{i=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Kt(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function It(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(a){s={error:a}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(s)throw s.error}}return o}function kt(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,o;i<n;i++)(o||!(i in t))&&(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return r.concat(o||Array.prototype.slice.call(t))}function ce(r){return this instanceof ce?(this.v=r,this):new ce(r)}function Ao(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(r,t||[]),n,o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(p){i[p]&&(n[p]=function(f){return new Promise(function(d,y){o.push([p,f,d,y])>1||a(p,f)})})}function a(p,f){try{h(i[p](f))}catch(d){c(o[0][3],d)}}function h(p){p.value instanceof ce?Promise.resolve(p.value.v).then(u,l):c(o[0][2],p)}function u(p){a("next",p)}function l(p){a("throw",p)}function c(p,f){p(f),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Mo(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof Kt=="function"?Kt(r):r[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(o){e[o]=r[o]&&function(s){return new Promise(function(a,h){s=r[o](s),n(a,h,s.done,s.value)})}}function n(o,s,a,h){Promise.resolve(h).then(function(u){o({value:u,done:a})},s)}}var Hi,Ft=m(()=>{Hi=function(r,t){return Hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},Hi(r,t)}});function C(r){return typeof r=="function"}var ft=m(()=>{});function vr(r){var t=function(i){Error.call(i),i.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Gi=m(()=>{});var br,Do=m(()=>{Gi();br=vr(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(i,n){return n+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}})});function Qe(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var Bi=m(()=>{});function Pr(r){return r instanceof Ce||r&&"closed"in r&&C(r.remove)&&C(r.add)&&C(r.unsubscribe)}function Io(r){C(r)?r():r.unsubscribe()}var Ce,qi,Tr=m(()=>{Ft();ft();Do();Bi();Ce=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,i,n,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=Kt(s),h=a.next();!h.done;h=a.next()){var u=h.value;u.remove(this)}}catch(y){t={error:y}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else s.remove(this);var l=this.initialTeardown;if(C(l))try{l()}catch(y){o=y instanceof br?y.errors:[y]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var p=Kt(c),f=p.next();!f.done;f=p.next()){var d=f.value;try{Io(d)}catch(y){o=o!=null?o:[],y instanceof br?o=kt(kt([],It(o)),It(y.errors)):o.push(y)}}}catch(y){i={error:y}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}}if(o)throw new br(o)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Io(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Qe(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&Qe(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}(),qi=Ce.EMPTY});var Ct,Ke=m(()=>{Ct={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}});var Le,Wi=m(()=>{Ft();Le={setTimeout:function(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];var n=Le.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,kt([r,t],It(e))):setTimeout.apply(void 0,kt([r,t],It(e)))},clearTimeout:function(r){var t=Le.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0}});function wr(r){Le.setTimeout(function(){var t=Ct.onUnhandledError;if(t)t(r);else throw r})}var ji=m(()=>{Ke();Wi()});function Ye(){}var $i=m(()=>{});function Fo(r){return Qi("E",void 0,r)}function Ro(r){return Qi("N",r,void 0)}function Qi(r,t,e){return{kind:r,value:t,error:e}}var ko,_o=m(()=>{ko=function(){return Qi("C",void 0,void 0)}()});function Ee(r){if(Ct.useDeprecatedSynchronousErrorHandling){var t=!pe;if(t&&(pe={errorThrown:!1,error:null}),r(),t){var e=pe,i=e.errorThrown,n=e.error;if(pe=null,i)throw n}}else r()}function zo(r){Ct.useDeprecatedSynchronousErrorHandling&&pe&&(pe.errorThrown=!0,pe.error=r)}var pe,xr=m(()=>{Ke();pe=null});function Ki(r,t){return Su.call(r,t)}function Sr(r){Ct.useDeprecatedSynchronousErrorHandling?zo(r):wr(r)}function Lu(r){throw r}function Yi(r,t){var e=Ct.onStoppedNotification;e&&Le.setTimeout(function(){return e(r,t)})}var Xe,Su,Cu,Cr,Eu,Xi=m(()=>{Ft();ft();Tr();Ke();ji();$i();_o();Wi();xr();Xe=function(r){re(t,r);function t(e){var i=r.call(this)||this;return i.isStopped=!1,e?(i.destination=e,Pr(e)&&e.add(i)):i.destination=Eu,i}return t.create=function(e,i,n){return new Cr(e,i,n)},t.prototype.next=function(e){this.isStopped?Yi(Ro(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Yi(Fo(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Yi(ko,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ce),Su=Function.prototype.bind;Cu=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){Sr(i)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){Sr(i)}else Sr(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Sr(e)}},r}(),Cr=function(r){re(t,r);function t(e,i,n){var o=r.call(this)||this,s;if(C(e)||!e)s={next:e!=null?e:void 0,error:i!=null?i:void 0,complete:n!=null?n:void 0};else{var a;o&&Ct.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=function(){return o.unsubscribe()},s={next:e.next&&Ki(e.next,a),error:e.error&&Ki(e.error,a),complete:e.complete&&Ki(e.complete,a)}):s=e}return o.destination=new Cu(s),o}return t}(Xe);Eu={closed:!0,next:Ye,error:Lu,complete:Ye}});var Oe,Lr=m(()=>{Oe=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}()});function Er(r){return r}var Ji=m(()=>{});function Zi(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return tn(r)}function tn(r){return r.length===0?Er:r.length===1?r[0]:function(e){return r.reduce(function(i,n){return n(i)},e)}}var en=m(()=>{Ji()});function Vo(r){var t;return(t=r!=null?r:Ct.Promise)!==null&&t!==void 0?t:Promise}function Ou(r){return r&&C(r.next)&&C(r.error)&&C(r.complete)}function Au(r){return r&&r instanceof Xe||Ou(r)&&Pr(r)}var Q,fe=m(()=>{Xi();Tr();Lr();en();Ke();ft();xr();Q=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var n=this,o=Au(t)?t:new Cr(t,e,i);return Ee(function(){var s=n,a=s.operator,h=s.source;o.add(a?a.call(o,h):h?n._subscribe(o):n._trySubscribe(o))}),o},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var i=this;return e=Vo(e),new e(function(n,o){var s=new Cr({next:function(a){try{t(a)}catch(h){o(h),s.unsubscribe()}},error:o,complete:n});i.subscribe(s)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Oe]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return tn(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Vo(t),new t(function(i,n){var o;e.subscribe(function(s){return o=s},function(s){return n(s)},function(){return i(o)})})},r.create=function(t){return new r(t)},r}()});function Mu(r){return C(r==null?void 0:r.lift)}function nt(r){return function(t){if(Mu(t))return t.lift(function(e){try{return r(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}var Yt=m(()=>{ft()});function yt(r,t,e,i,n){return new Du(r,t,e,i,n)}var Du,me=m(()=>{Ft();Xi();Du=function(r){re(t,r);function t(e,i,n,o,s,a){var h=r.call(this,e)||this;return h.onFinalize=s,h.shouldUnsubscribe=a,h._next=i?function(u){try{i(u)}catch(l){e.error(l)}}:r.prototype._next,h._error=o?function(u){try{o(u)}catch(l){e.error(l)}finally{this.unsubscribe()}}:r.prototype._error,h._complete=n?function(){try{n()}catch(u){e.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,h}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;r.prototype.unsubscribe.call(this),!i&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(Xe)});var No,Uo=m(()=>{Gi();No=vr(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})});var E,Ho,Go=m(()=>{Ft();fe();Tr();Uo();Bi();xr();E=function(r){re(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new Ho(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new No},t.prototype.next=function(e){var i=this;Ee(function(){var n,o;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var s=Kt(i.currentObservers),a=s.next();!a.done;a=s.next()){var h=a.value;h.next(e)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var i=this;Ee(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var n=i.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Ee(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,n=this,o=n.hasError,s=n.isStopped,a=n.observers;return o||s?qi:(this.currentObservers=null,a.push(e),new Ce(function(){i.currentObservers=null,Qe(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,n=i.hasError,o=i.thrownError,s=i.isStopped;n?e.error(o):s&&e.complete()},t.prototype.asObservable=function(){var e=new Q;return e.source=this,e},t.create=function(e,i){return new Ho(e,i)},t}(Q),Ho=function(r){re(t,r);function t(e,i){var n=r.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,e)},t.prototype.error=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&n!==void 0?n:qi},t}(E)});var Or,rn=m(()=>{fe();Or=new Q(function(r){return r.complete()})});function Bo(r){return r&&C(r.schedule)}var qo=m(()=>{ft()});function Wo(r){return r[r.length-1]}function Ar(r){return Bo(Wo(r))?r.pop():void 0}function Mr(r,t){return typeof Wo(r)=="number"?r.pop():t}var nn=m(()=>{qo()});var Dr,on=m(()=>{Dr=function(r){return r&&typeof r.length=="number"&&typeof r!="function"}});function Ir(r){return C(r==null?void 0:r.then)}var sn=m(()=>{ft()});function kr(r){return C(r[Oe])}var an=m(()=>{Lr();ft()});function Fr(r){return Symbol.asyncIterator&&C(r==null?void 0:r[Symbol.asyncIterator])}var hn=m(()=>{ft()});function Rr(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var un=m(()=>{});function Iu(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var _r,ln=m(()=>{_r=Iu()});function zr(r){return C(r==null?void 0:r[_r])}var cn=m(()=>{ln();ft()});function Vr(r){return Ao(this,arguments,function(){var e,i,n,o;return yr(this,function(s){switch(s.label){case 0:e=r.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ce(e.read())];case 3:return i=s.sent(),n=i.value,o=i.done,o?[4,ce(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ce(n)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Nr(r){return C(r==null?void 0:r.getReader)}var Ur=m(()=>{Ft();ft()});function mt(r){if(r instanceof Q)return r;if(r!=null){if(kr(r))return ku(r);if(Dr(r))return Fu(r);if(Ir(r))return Ru(r);if(Fr(r))return jo(r);if(zr(r))return _u(r);if(Nr(r))return zu(r)}throw Rr(r)}function ku(r){return new Q(function(t){var e=r[Oe]();if(C(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Fu(r){return new Q(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}function Ru(r){return new Q(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,wr)})}function _u(r){return new Q(function(t){var e,i;try{for(var n=Kt(r),o=n.next();!o.done;o=n.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){e={error:a}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}t.complete()})}function jo(r){return new Q(function(t){Vu(r,t).catch(function(e){return t.error(e)})})}function zu(r){return jo(Vr(r))}function Vu(r,t){var e,i,n,o;return Oo(this,void 0,void 0,function(){var s,a;return yr(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),e=Mo(r),h.label=1;case 1:return[4,e.next()];case 2:if(i=h.sent(),!!i.done)return[3,4];if(s=i.value,t.next(s),t.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=h.sent(),n={error:a},[3,11];case 6:return h.trys.push([6,,9,10]),i&&!i.done&&(o=e.return)?[4,o.call(e)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}var ie=m(()=>{Ft();on();sn();fe();an();hn();un();cn();Ur();ft();ji();Lr()});function Tt(r,t,e,i,n){i===void 0&&(i=0),n===void 0&&(n=!1);var o=t.schedule(function(){e(),n?r.add(this.schedule(null,i)):this.unsubscribe()},i);if(r.add(o),!n)return o}var Je=m(()=>{});function Hr(r,t){return t===void 0&&(t=0),nt(function(e,i){e.subscribe(yt(i,function(n){return Tt(i,r,function(){return i.next(n)},t)},function(){return Tt(i,r,function(){return i.complete()},t)},function(n){return Tt(i,r,function(){return i.error(n)},t)}))})}var pn=m(()=>{Je();Yt();me()});function Gr(r,t){return t===void 0&&(t=0),nt(function(e,i){i.add(r.schedule(function(){return e.subscribe(i)},t))})}var fn=m(()=>{Yt()});function $o(r,t){return mt(r).pipe(Gr(t),Hr(t))}var Qo=m(()=>{ie();pn();fn()});function Ko(r,t){return mt(r).pipe(Gr(t),Hr(t))}var Yo=m(()=>{ie();pn();fn()});function Xo(r,t){return new Q(function(e){var i=0;return t.schedule(function(){i===r.length?e.complete():(e.next(r[i++]),e.closed||this.schedule())})})}var Jo=m(()=>{fe()});function Zo(r,t){return new Q(function(e){var i;return Tt(e,t,function(){i=r[_r](),Tt(e,t,function(){var n,o,s;try{n=i.next(),o=n.value,s=n.done}catch(a){e.error(a);return}s?e.complete():e.next(o)},0,!0)}),function(){return C(i==null?void 0:i.return)&&i.return()}})}var ts=m(()=>{fe();ln();ft();Je()});function Br(r,t){if(!r)throw new Error("Iterable cannot be null");return new Q(function(e){Tt(e,t,function(){var i=r[Symbol.asyncIterator]();Tt(e,t,function(){i.next().then(function(n){n.done?e.complete():e.next(n.value)})},0,!0)})})}var mn=m(()=>{fe();Je()});function es(r,t){return Br(Vr(r),t)}var rs=m(()=>{mn();Ur()});function is(r,t){if(r!=null){if(kr(r))return $o(r,t);if(Dr(r))return Xo(r,t);if(Ir(r))return Ko(r,t);if(Fr(r))return Br(r,t);if(zr(r))return Zo(r,t);if(Nr(r))return es(r,t)}throw Rr(r)}var ns=m(()=>{Qo();Yo();Jo();ts();mn();an();sn();on();cn();hn();un();Ur();rs()});function qr(r,t){return t?is(r,t):mt(r)}var dn=m(()=>{ns();ie()});function Rt(r,t){return nt(function(e,i){var n=0;e.subscribe(yt(i,function(o){i.next(r.call(t,o,n++))}))})}var Wr=m(()=>{Yt();me()});function os(r,t,e,i,n,o,s,a){var h=[],u=0,l=0,c=!1,p=function(){c&&!h.length&&!u&&t.complete()},f=function(y){return u<i?d(y):h.push(y)},d=function(y){o&&t.next(y),u++;var P=!1;mt(e(y,l++)).subscribe(yt(t,function(x){n==null||n(x),o?f(x):t.next(x)},function(){P=!0},void 0,function(){if(P)try{u--;for(var x=function(){var T=h.shift();s?Tt(t,s,function(){return d(T)}):d(T)};h.length&&u<i;)x();p()}catch(T){t.error(T)}}))};return r.subscribe(yt(t,f,function(){c=!0,p()})),function(){a==null||a()}}var ss=m(()=>{ie();Je();me()});function gn(r,t,e){return e===void 0&&(e=1/0),C(t)?gn(function(i,n){return Rt(function(o,s){return t(i,o,n,s)})(mt(r(i,n)))},e):(typeof t=="number"&&(e=t),nt(function(i,n){return os(i,n,r,e)}))}var as=m(()=>{Wr();ie();Yt();ss();ft()});function jr(r){return r===void 0&&(r=1/0),gn(Er,r)}var yn=m(()=>{as();Ji()});function vn(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=Ar(r),i=Mr(r,1/0),n=r;return n.length?n.length===1?mt(n[0]):jr(i)(qr(n,e)):Or}var hs=m(()=>{yn();ie();rn();nn();dn()});function us(r){return r.length===1&&Nu(r[0])?r[0]:r}var Nu,ls=m(()=>{Nu=Array.isArray});function Z(r,t){return nt(function(e,i){var n=0;e.subscribe(yt(i,function(o){return r.call(t,o,n++)&&i.next(o)}))})}var bn=m(()=>{Yt();me()});var cs=m(()=>{});function dt(r){return r<=0?function(){return Or}:nt(function(t,e){var i=0;t.subscribe(yt(e,function(n){++i<=r&&(e.next(n),r<=i&&e.complete())}))})}var Pn=m(()=>{rn();Yt();me()});function ps(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=Ar(r),i=Mr(r,1/0);return r=us(r),nt(function(n,o){jr(i)(qr(kt([n],It(r)),e)).subscribe(o)})}var fs=m(()=>{Ft();Yt();ls();yn();nn();dn()});function Tn(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return ps.apply(void 0,kt([],It(r)))}var ms=m(()=>{Ft();fs()});function B(r){return nt(function(t,e){mt(r).subscribe(yt(e,function(){return e.complete()},Ye)),!e.closed&&t.subscribe(e)})}var wn=m(()=>{Yt();me();ie();$i()});var ne=m(()=>{Go();en();hs();cs();bn();Wr();Pn();wn()});var de,$r,Qr=m(()=>{Dt();$();$();ne();rt();de=1e3,$r=class{constructor(t,e){this.id=t;this.movementDirection="none";this._tilePos={position:new g(0,0),layer:void 0};this.movementStarted$=new E;this.movementStopped$=new E;this.directionChanged$=new E;this.positionChangeStarted$=new E;this.positionChangeFinished$=new E;this.tilePositionSet$=new E;this.autoMovementSet$=new E;this.lastMovementImpulse="none";this.facingDirection="down";this.depthChanged$=new E;this.movementProgress=0;var i,n,o;this.tilemap=e.tilemap,this.speed=e.speed,this.collidesWithTilesInternal=e.collidesWithTiles,this._tilePos.layer=e.charLayer,this.ignoreMissingTiles=(i=e.ignoreMissingTiles)!=null?i:!1,this.collisionGroups=new Set(e.collisionGroups||[]),this.labels=new Set(e.labels||[]),this.numberOfDirections=e.numberOfDirections,e.facingDirection&&this.turnTowards(e.facingDirection),this.tileWidth=(n=e.tileWidth)!=null?n:1,this.tileHeight=(o=e.tileHeight)!=null?o:1}getId(){return this.id}getSpeed(){return this.speed}setSpeed(t){this.speed=t}setMovement(t){this.autoMovementSet$.next(t),this.movement=t}getMovement(){return this.movement}collidesWithTiles(){return this.collidesWithTilesInternal}getIgnoreMissingTiles(){return this.ignoreMissingTiles}setTilePosition(t){this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(w({},t)),this.fire(this.positionChangeStarted$,this.tilePos,t),this.fire(this.positionChangeFinished$,this.tilePos,t),this.movementDirection="none",this.lastMovementImpulse="none",this.tilePos=t,this.movementProgress=0}getTilePos(){return this.tilePos}getNextTilePos(){if(!this.isMoving())return this.tilePos;let t=this.tilePos.layer,e=this.tilePosInDirection(this.tilePos.position,this.movementDirection),i=this.tilemap.getTransition(e,this.tilePos.layer);return i&&(t=i),{position:this.tilePosInDirection(this.tilePos.position,this.movementDirection),layer:t}}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}move(t){this.lastMovementImpulse=t,t!="none"&&(this.isMoving()||(this.isBlockingDirection(t)?this.changeFacingDirection(t):this.startMoving(t)))}update(t){var e;(e=this.movement)==null||e.update(t),this.isMoving()&&this.updateCharacterPosition(t),this.lastMovementImpulse="none"}getMovementDirection(){return this.movementDirection}isBlockingDirection(t){if(t=="none")return!1;let e=this.tilePosInDirection(this.getNextTilePos().position,t),i=this.tilemap.getTransition(e,this.getNextTilePos().layer)||this.getNextTilePos().layer;return this.collidesWithTilesInternal&&this.isTileBlocking(t,i)?!0:this.isCharBlocking(t,i)}isTileBlocking(t,e){return this.someCharTile((i,n)=>{let o=this.tilePosInDirection(new g(i,n),t);return this.tilemap.hasBlockingTile(o,e,Eo(t),this.ignoreMissingTiles)})}isCharBlocking(t,e){return this.someCharTile((i,n)=>{let o=this.tilePosInDirection(new g(i,n),t);return this.tilemap.hasBlockingChar(o,e,this.getCollisionGroups(),new Set([this.getId()]))})}isMoving(){return this.movementDirection!="none"}turnTowards(t){this.isMoving()||t!="none"&&this.changeFacingDirection(t)}changeFacingDirection(t){this.facingDirection!==t&&(this.facingDirection=t,this.directionChanged$.next(t))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(St(this.facingDirection))}addCollisionGroup(t){this.collisionGroups.add(t)}setCollisionGroups(t){this.collisionGroups=new Set(t)}getCollisionGroups(){return Array.from(this.collisionGroups)}hasCollisionGroup(t){return this.collisionGroups.has(t)}removeCollisionGroup(t){this.collisionGroups.delete(t)}removeAllCollisionGroups(){this.collisionGroups.clear()}addLabels(t){for(let e of t)this.labels.add(e)}getLabels(){return[...this.labels.values()]}hasLabel(t){return this.labels.has(t)}clearLabels(){this.labels.clear()}removeLabels(t){for(let e of t)this.labels.delete(e)}getNumberOfDirections(){return this.numberOfDirections}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}depthChanged(){return this.depthChanged$}getMovementProgress(){return this.movementProgress}hasWalkedHalfATile(){return this.movementProgress>de/2}updateCharacterPosition(t){let i=t/1e3,n=Math.floor(i*this.speed*de),o=this.movementProgress+n>=de,a=1-(o?de-this.movementProgress:n)/n;this.movementProgress=Math.min(this.movementProgress+n,de),o&&(this.movementProgress=0,this.shouldContinueMoving()?(this.fire(this.positionChangeFinished$,this.tilePos,this.getNextTilePos()),this.tilePos=this.getNextTilePos(),this.startMoving(this.lastMovementImpulse),a>0&&this.updateCharacterPosition(t*a)):this.stopMoving())}get tilePos(){return b.clone(this._tilePos)}set tilePos(t){b.copyOver(t,this._tilePos)}startMoving(t){t!=="none"&&(t!=this.movementDirection&&this.movementStarted$.next(t),this.movementDirection=t,this.facingDirection=t,this.fire(this.positionChangeStarted$,this.tilePos,this.getNextTilePos()))}tilePosInDirection(t,e){return t.add(St(this.tilemap.toMapDirection(e)))}shouldContinueMoving(){return this.lastMovementImpulse!=="none"&&!this.isBlockingDirection(this.lastMovementImpulse)}stopMoving(){if(this.movementDirection==="none")return;let t=this.tilePos,e=this.getNextTilePos(),i=this.movementDirection;this.tilePos=this.getNextTilePos(),this.movementDirection="none",this.movementStopped$.next(i),this.fire(this.positionChangeFinished$,t,e)}fire(t,{position:e,layer:i},{position:n,layer:o}){t.next({exitTile:e,enterTile:n,exitLayer:i,enterLayer:o})}someCharTile(t){let e=this.getNextTilePos().position;for(let i=e.x;i<e.x+this.getTileWidth();i++)for(let n=e.y;n<e.y+this.getTileHeight();n++)if(t(i,n))return!0;return!1}}});var ge,Ze,Kr=m(()=>{$();ne();ge=class ge{constructor(t,e){this.walkingAnimationMapping=t;this.charsInRow=e;this.lastFootLeft=!1;this.directionToFrameRow={down:0,"down-left":1,"down-right":2,left:1,right:2,up:3,"up-left":1,"up-right":2};this._isEnabled=!0;this.frameChange$=new E;this.setWalkingAnimationMapping(t)}frameChange(){return this.frameChange$}setIsEnabled(t){this._isEnabled=t}isEnabled(){return this._isEnabled}updateCharacterFrame(t,e,i){this._isEnabled&&(e?this.setStandingFrameDuringWalk(t,i):this.setWalkingFrame(t))}setStandingFrame(t){this._isEnabled&&this._setStandingFrame(t)}setWalkingAnimationMapping(t){this.walkingAnimationMapping=t,this._isEnabled=this.walkingAnimationMapping!==void 0}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharsInRow(){return this.charsInRow}setStandingFrameDuringWalk(t,e){this.isCurrentFrameStanding(t,e)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(t)}setWalkingFrame(t){let e=this.framesOfDirection(t);e&&this.frameChange$.next(this.lastFootLeft?e.rightFoot:e.leftFoot)}_setStandingFrame(t){let e=this.framesOfDirection(t);e&&this.frameChange$.next(e.standing)}isCurrentFrameStanding(t,e){var i;return e===((i=this.framesOfDirection(t))==null?void 0:i.standing)}framesOfDirection(t){return typeof this.walkingAnimationMapping=="number"?this.getFramesForCharIndex(t,this.walkingAnimationMapping):this.getFramesForAnimationMapping(t)}getFramesForAnimationMapping(t){if(this.walkingAnimationMapping)return this.walkingAnimationMapping[t]||this.walkingAnimationMapping[this.fallbackDirection(t)]}fallbackDirection(t){switch(t){case"down-left":return"left";case"down-right":return"right";case"up-left":return"left";case"up-right":return"right"}return t}getFramesForCharIndex(t,e){var u;let i=Math.floor(e/this.charsInRow),n=e%this.charsInRow,o=this.charsInRow*ge.FRAMES_CHAR_ROW,s=ge.FRAMES_CHAR_ROW*n,a=((u=this.directionToFrameRow[t])!=null?u:0)+i*ge.FRAMES_CHAR_COL,h=s+a*o;return{rightFoot:h,standing:h+1,leftFoot:h+2}}};ge.FRAMES_CHAR_ROW=3,ge.FRAMES_CHAR_COL=4;Ze=ge});var Ae,xn=m(()=>{Ae=class{static shiftPad(t,e){let i=Math.floor(t),o=`${i}`.padStart(e,"0").length;return i/Math.pow(10,o)}}});var Me=m(()=>{bn();Wr();ms();Pn();wn()});var Yr,ds=m(()=>{Qr();rt();Kr();xn();ne();Me();$();Yr=class{constructor(t,e,i,n,o){this.charData=t;this.scene=e;this.tilemap=i;this.geHeadless=o;this.customOffset=new g(0,0);this.newSpriteSet$=new E;this.destroy$=new E;this.layerOverlaySprite=n&&t.sprite?this.scene.add.sprite(0,0,t.sprite.texture):void 0,this.walkingAnimationMapping=t.walkingAnimationMapping,this.customOffset=new g(t.offsetX||0,t.offsetY||0),this.sprite=t.sprite,this.container=t.container,this.geHeadless.directionChanged().pipe(Z(({charId:s})=>s===this.charData.id)).subscribe(({direction:s})=>{var a;(a=this.animation)==null||a.setStandingFrame(s)}),this.sprite&&(this.sprite.setOrigin(0,0),this.resetAnimation(this.sprite),this.updateOverlaySprite(),this.updateGridChar())}destroy(){this.destroy$.next(),this.destroy$.complete(),this.newSpriteSet$.complete()}setSprite(t){t?(this.sprite&&(t.x=this.sprite.x,t.y=this.sprite.y),this.sprite=t,this.newSpriteSet$.next(),this.layerOverlaySprite=this.layerOverlaySprite?this.scene.add.sprite(0,0,this.sprite.texture):void 0,this.updateOverlaySprite(),this.resetAnimation(this.sprite),this.updateDepth()):(this.layerOverlaySprite=void 0,this.sprite=void 0)}getSprite(){return this.sprite}getLayerOverlaySprite(){return this.layerOverlaySprite}setContainer(t){this.container=t}getContainer(){return this.container}getOffsetX(){return this.customOffset.x}setOffsetX(t){this.customOffset.x=t}getOffsetY(){return this.customOffset.y}setOffsetY(t){this.customOffset.y=t}getWalkingAnimationMapping(){return this.walkingAnimationMapping}turnTowards(t){var e;this.geHeadless.isMoving(this.charData.id)||t!="none"&&(this.geHeadless.turnTowards(this.charData.id,t),(e=this.animation)==null||e.setStandingFrame(t))}getAnimation(){return this.animation}setAnimation(t){this.animation=t}update(t){this.updateGridChar()}getEngineOffset(){var i,n,o,s;if(!this.sprite)return g.ZERO;let t=this.tilemap.getTileWidth()/2-Math.floor(((n=(i=this.sprite)==null?void 0:i.displayWidth)!=null?n:0)/2),e=-((s=(o=this.sprite)==null?void 0:o.displayHeight)!=null?s:0)+this.tilemap.getTileHeight();return new g(t,e)}updatePixelPos(){let t=new g(this.geHeadless.getPosition(this.charData.id)),e=this.geHeadless.getMovementProgress(this.charData.id)/1e3,n=this.tilemap.tilePosToPixelPos(t).add(this.getEngineOffset()).add(this.customOffset).add(St(this.geHeadless.getFacingDirection(this.charData.id)).multiply(this.tilemap.getTileDistance(this.geHeadless.getFacingDirection(this.charData.id)).scalarMult(e))),o=this.getGameObj();o&&(o.x=Math.floor(n.x),o.y=Math.floor(n.y))}getGameObj(){return this.container||this.sprite}updateGridChar(){var t;if(this.updatePixelPos(),this.sprite&&this.geHeadless.isMoving(this.charData.id)){let e=this.geHeadless.getMovementProgress(this.charData.id)>de/2;(t=this.getAnimation())==null||t.updateCharacterFrame(this.geHeadless.getFacingDirection(this.charData.id),e,Number(this.sprite.frame.name))}this.updateDepth()}resetAnimation(t){let e=new Ze(this.walkingAnimationMapping,t.texture.source[0].width/t.width/Ze.FRAMES_CHAR_ROW);this.setAnimation(e),e.frameChange().pipe(B(this.newSpriteSet$)).subscribe(i=>{t==null||t.setFrame(i)}),e.setIsEnabled(this.walkingAnimationMapping!==void 0),e.setStandingFrame(this.geHeadless.getFacingDirection(this.charData.id))}updateOverlaySprite(){if(!this.layerOverlaySprite||!this.sprite)return;this.layerOverlaySprite.scale=this.sprite.scale;let t=this.tilemap.getTileHeight()/this.layerOverlaySprite.scale;this.layerOverlaySprite.setCrop(0,0,this.layerOverlaySprite.displayWidth,this.sprite.height-t),this.layerOverlaySprite.setOrigin(0,0)}updateDepth(){let t=this.getGameObj();if(!t)return;let e=new g(this.geHeadless.getPosition(this.charData.id)),i=this.geHeadless.getCharLayer(this.charData.id);this.setDepth(t,{position:e,layer:i});let n=this.getLayerOverlaySprite();if(n){let o=new g(Mt(w({},e),{y:e.y-1}));this.setDepth(n,{position:o,layer:i})}}setDepth(t,e){t.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(e))+this.getPaddedPixelDepth(t))}getPaddedPixelDepth(t){return Ae.shiftPad(t.y+t.displayHeight,7)}getTransitionLayer(t){if(t.layer)return this.geHeadless.getTransition(t.position,t.layer)||t.layer}}});var tr,Xr=m(()=>{tr=(n=>(n.DONT_BLOCK="DONT_BLOCK",n.BLOCK_TWO_TILES="BLOCK_TWO_TILES",n.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",n.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND",n))(tr||{})});var ye,er=m(()=>{ye=(i=>(i.STOP="STOP",i.CLOSEST_REACHABLE="CLOSEST_REACHABLE",i.RETRY="RETRY",i))(ye||{})});var _,Xt=m(()=>{rt();_=class r{static vec2str(t){return`${t.x}#${t.y}`}static equal(t,e){return r.vec2str(t)==r.vec2str(e)}static manhattanDistance(t,e){let i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return i+n}static chebyshevDistance(t,e){let i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return Math.max(i,n)}static scalarMult(t,e){return t.clone().multiply(new g(e,e))}}});var Jr,gs=m(()=>{Xt();$();rt();Jr=class{distance(t,e){return _.manhattanDistance(t,e)}direction(t,e){if(_.equal(t,e))return"none";let i=t.clone().subtract(e);return Math.abs(i.x)>Math.abs(i.y)?i.x>0?"left":"right":i.y>0?"up":"down"}neighbors(t){return[new g(t.x,t.y+1),new g(t.x+1,t.y),new g(t.x-1,t.y),new g(t.x,t.y-1)]}getDirections(){return["up","right","down","left"]}}});var Zr,ys=m(()=>{Xt();$();rt();Zr=class{distance(t,e){return _.chebyshevDistance(t,e)}neighbors(t){let e=[new g(t.x,t.y+1),new g(t.x+1,t.y),new g(t.x-1,t.y),new g(t.x,t.y-1)],i=[new g(t.x+1,t.y+1),new g(t.x+1,t.y-1),new g(t.x-1,t.y+1),new g(t.x-1,t.y-1)];return[...e,...i]}direction(t,e){return e.x>t.x?e.y>t.y?"down-right":e.y<t.y?"up-right":"right":e.x<t.x?e.y>t.y?"down-left":e.y<t.y?"up-left":"left":e.y<t.y?"up":e.y>t.y?"down":"none"}getDirections(){return["up","right","down","left","down-left","down-right","up-right","up-left"]}}});var ht,ve=m(()=>{gs();$();ys();ht=class{static create(t){switch(t){case 4:return new Jr;case 8:return new Zr}}}});var rr,vs=m(()=>{rr=class{constructor(t,e,i){this.backoffMs=t;this.maxRetries=e;this.onFinished=i;this.retries=0;this.elapsed=0}retry(t,e){this.shouldRetry()?(this.elapsed+=t,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,e())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}getBackoffMs(){return this.backoffMs}shouldRetry(){return this.maxRetries===-1||this.retries<this.maxRetries}}});var De,ti=m(()=>{De=(i=>(i.WAIT="WAIT",i.RETRY="RETRY",i.STOP="STOP",i))(De||{})});var _t,be=m(()=>{ve();rt();$();Dt();Xt();_t=class{constructor(t,{shortestPathAlgorithm:e="BFS",pathWidth:i=1,pathHeight:n=1,numberOfDirections:o=4,isPositionAllowed:s=(y,P)=>!0,collisionGroups:a=[],ignoredChars:h=[],ignoreTiles:u=!1,ignoreMapBounds:l=!1,ignoreBlockedTarget:c=!1,maxPathLength:p=1/0,ignoreLayers:f=!1,considerCosts:d=!1}={}){this.gridTilemap=t;this.options={shortestPathAlgorithm:e,pathWidth:i,pathHeight:n,numberOfDirections:o,isPositionAllowed:s,collisionGroups:a,ignoredChars:h,ignoreTiles:u,ignoreMapBounds:l,ignoreBlockedTarget:c,maxPathLength:p,ignoreLayers:f,considerCosts:d}}findShortestPath(t,e){this.options.ignoreLayers&&(this.gridTilemap.fixCacheLayer(t.layer),e.layer=t.layer);let i=this.findShortestPathImpl(t,e);return this.gridTilemap.unfixCacheLayers(),i}getNeighbors(t,e){var s;return ht.create((s=this.options.numberOfDirections)!=null?s:4).neighbors(t.position).map(a=>{let h=t.layer;return this.options.ignoreLayers||(h=this.gridTilemap.getTransition(a,t.layer)),{position:a,layer:h||t.layer}}).filter(a=>!this.isBlocking(t,a)||this.options.ignoreBlockedTarget&&b.equal(a,e))}getTransition(t,e){if(!this.options.ignoreLayers)return this.gridTilemap.getTransition(t,e)}getCosts(t,e){if(!this.options.considerCosts)return 1;let i=it(e.position,t);return this.gridTilemap.getTileCosts(e,i)}isBlocking(t,e){return!(this.options.ignoreMapBounds||this.gridTilemap.isInRange(e.position))||!this.options.isPositionAllowed(e.position,e.layer)||!this.options.ignoreTiles&&this.hasBlockingTileFrom(t,e,this.options.pathWidth,this.options.pathHeight,this.options.ignoreMapBounds,this.gridTilemap)?!0:this.hasBlockingCharFrom(e,this.options.pathWidth,this.options.pathHeight,this.options.collisionGroups,this.options.ignoredChars,this.gridTilemap)}distance(t,e){return(this.options.numberOfDirections===4?_.manhattanDistance:_.chebyshevDistance)(t,e)}getTilePosInDir(t,e){return this.gridTilemap.getTilePosInDirection(t,e)}getReverseNeighbors(t,e){var a;let n=ht.create((a=this.options.numberOfDirections)!=null?a:4).neighbors(t.position),o;if(!this.options.ignoreLayers){let h=this.gridTilemap.getReverseTransitions(t.position,t.layer);o=h?[...h]:void 0}return n.map(h=>o?o.map(u=>({position:h,layer:u||t.layer})):[{position:h,layer:t.layer}]).flat().filter(h=>!this.isBlocking(h,t)||this.options.ignoreBlockedTarget&&b.equal(t,e))}hasBlockingCharFrom(t,e,i,n,o,s){for(let a=t.position.x;a<t.position.x+e;a++)for(let h=t.position.y;h<t.position.y+i;h++)if(s.hasBlockingChar(new g(a,h),t.layer,n,new Set(o)))return!0;return!1}hasBlockingTileFrom(t,e,i,n,o,s){for(let a=e.position.x;a<e.position.x+i;a++)for(let h=e.position.y;h<e.position.y+n;h++)if(s.hasBlockingTile(new g(a,h),e.layer,it(e.position,t.position),o))return!0;return!1}}});var nr=v(ir=>{var Uu=function(r,t){return r<t?-1:r>t?1:0},Hu=function(r,t){return r<t?1:r>t?-1:0};function Gu(r){return function(t,e){return r(e,t)}}function Bu(r){return r===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var i=0;i<r;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i++}return 0}}ir.DEFAULT_COMPARATOR=Uu;ir.DEFAULT_REVERSE_COMPARATOR=Hu;ir.reverseComparator=Gu;ir.createTupleComparator=Bu});var bs=v(Sn=>{Sn.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer!="undefined";Sn.SYMBOL_SUPPORT=typeof Symbol!="undefined"});var M=v((Dg,Ts)=>{var Ps=bs(),qu=Ps.ARRAY_BUFFER_SUPPORT,Wu=Ps.SYMBOL_SUPPORT;Ts.exports=function(t,e){var i,n,o,s,a;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||qu&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(o=0,s=t.length;o<s;o++)e(t[o],o);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(Wu&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(i=t,o=0;a=i.next(),a.done!==!0;)e(a.value,o),o++;return}for(n in t)t.hasOwnProperty(n)&&e(t[n],n)}});var ri=v((Ig,Os)=>{var ws=nr(),xs=M(),Ss=ws.DEFAULT_COMPARATOR,ju=ws.reverseComparator;function ut(r){if(this.clear(),this.comparator=r||Ss,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.")}ut.prototype.clear=function(){this.root=null,this.min=null,this.size=0};function $u(r){return{item:r,degree:0}}function Cs(r,t){r.root?(t.right=r.root.right,t.left=r.root,r.root.right.left=t,r.root.right=t):r.root=t}ut.prototype.push=function(r){var t=$u(r);return t.left=t,t.right=t,Cs(this,t),(!this.min||this.comparator(t.item,this.min.item)<=0)&&(this.min=t),++this.size};ut.prototype.peek=function(){return this.min?this.min.item:void 0};function Ls(r){for(var t=[],e=r,i=!1;!(e===r&&i);)e===r&&(i=!0),t.push(e),e=e.right;return t}function Es(r,t){r.root===t&&(r.root=t.right),t.left.right=t.right,t.right.left=t.left}function Qu(r,t){r.child?(t.right=r.child.right,t.left=r.child,r.child.right.left=t,r.child.right=t):r.child=t}function Ku(r,t,e){Es(r,t),t.left=t,t.right=t,Qu(e,t),e.degree++,t.parent=e}function Yu(r){var t=new Array(r.size),e=Ls(r.root),i,n,o,s,a,h;for(i=0,n=e.length;i<n;i++){for(o=e[i],a=o.degree;t[a];)s=t[a],r.comparator(o.item,s.item)>0&&(h=o,o=s,s=h),Ku(r,s,o),t[a]=null,a++;t[a]=o}for(i=0;i<r.size;i++)t[i]&&r.comparator(t[i].item,r.min.item)<=0&&(r.min=t[i])}ut.prototype.pop=function(){if(this.size){var r=this.min;if(r.child){var t=Ls(r.child),e,i,n;for(i=0,n=t.length;i<n;i++)e=t[i],Cs(this,e),delete e.parent}return Es(this,r),r===r.right?(this.min=null,this.root=null):(this.min=r.right,Yu(this)),this.size--,r.item}};ut.prototype.inspect=function(){var r={size:this.size};return this.min&&"item"in this.min&&(r.top=this.min.item),Object.defineProperty(r,"constructor",{value:ut,enumerable:!1}),r};typeof Symbol!="undefined"&&(ut.prototype[Symbol.for("nodejs.util.inspect.custom")]=ut.prototype.inspect);function ei(r){if(this.clear(),this.comparator=r||Ss,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.");this.comparator=ju(this.comparator)}ei.prototype=ut.prototype;ut.from=function(r,t){var e=new ut(t);return xs(r,function(i){e.push(i)}),e};ei.from=function(r,t){var e=new ei(t);return xs(r,function(i){e.push(i)}),e};ut.MinFibonacciHeap=ut;ut.MaxFibonacciHeap=ei;Os.exports=ut});function or(r,t){var e;return(e=r.get(b.toString(t)))!=null?e:Number.MAX_VALUE}function As(r,t){return _.equal(r.position,t.position)?r.layer===t.layer:!1}var Ms,ii,Ds=m(()=>{be();Xt();Ms=So(ri());Dt();ii=class extends _t{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"A_STAR"}}shortestPathBfs(t,e){let i=new Map,n=new Map,o=new Map,s=new Ms.MinFibonacciHeap((l,c)=>or(o,l)-or(o,c)),a=t,h=this.distance(t.position,e.position),u=0;for(s.push(t),n.set(b.toString(t),0),o.set(b.toString(t),this.distance(t.position,e.position));s.size>0;){let l=s.pop();if(!l)break;u++;let c=this.distance(l.position,e.position);if(c<h&&(h=c,a=l),As(l,e))return{previous:i,closestToTarget:a,steps:u,maxPathLengthReached:!1};if(or(n,l)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:a,steps:u,maxPathLengthReached:!0};for(let p of this.getNeighbors(l,e)){let f=or(n,l)+this.getCosts(l.position,p),d=b.toString(p);(!n.has(d)||f<or(n,p))&&(i.set(d,l),n.set(d,f),o.set(d,f+this.distance(p.position,e.position)),s.push(p))}}return{previous:i,closestToTarget:a,steps:u,maxPathLengthReached:!1}}returnPath(t,e,i){let n=[],o=i;for(n.push(o);!As(o,e);){if(o=t.get(b.toString(o)),!o)return[];n.push(o)}return n.reverse()}}});var ni,Jt,oi=m(()=>{ni=class{constructor(t){this.data=t}},Jt=class{constructor(){this.sizeInternal=0}dequeue(){if(this.tail===void 0)return;this.sizeInternal--;let t=this.tail.data;return this.tail.prev===void 0?(this.tail=void 0,this.head=void 0,t):(this.tail.prev.next=void 0,this.tail=this.tail.prev,t)}enqueue(t){if(this.sizeInternal++,this.head===void 0){this.head=new ni(t),this.tail=this.head;return}let e=new ni(t);e.next=this.head,this.head.prev=e,this.head=e}peek(){return this.tail?this.tail.data:void 0}peekAll(){let t=[],e=this.tail;for(;e;)t.push(e.data),e=e.prev;return t}clear(){this.head=void 0,this.tail=void 0,this.sizeInternal=0}peekEnd(){var t;return(t=this.head)==null?void 0:t.data}size(){return this.sizeInternal}}});var Ie,Cn=m(()=>{be();Xt();oi();Dt();Ie=class extends _t{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BFS"}}equal(t,e){return _.equal(t.position,e.position)?t.layer===e.layer:!1}shortestPathBfs(t,e){let i=new Map,n=new Set,o=new Jt,s=t,a=this.distance(t.position,e.position),h=0;for(o.enqueue({node:t,dist:0}),n.add(b.toString(t));o.size()>0;){let u=o.dequeue();if(h++,!u)break;let{node:l,dist:c}=u;if(c>this.options.maxPathLength)return{previous:new Map,closestToTarget:s,steps:h,maxPathLengthReached:!0};let p=this.distance(l.position,e.position);if(p<a&&(a=p,s=l),this.equal(l,e))return{previous:i,closestToTarget:s,steps:h,maxPathLengthReached:!1};for(let f of this.getNeighbors(l,e))n.has(b.toString(f))||(i.set(b.toString(f),l),o.enqueue({node:f,dist:c+1}),n.add(b.toString(f)))}return{previous:i,closestToTarget:s,steps:h,maxPathLengthReached:!1}}returnPath(t,e,i){let n=[],o=i;for(n.push(o);!this.equal(o,e);){if(o=t.get(b.toString(o)),!o)return[];n.push(o)}return n.reverse()}}});var si,ai,Is=m(()=>{Dt();be();Xt();oi();si=class{constructor(){this.previous=new Map;this.visited=new Map;this.queue=new Jt;this.minMatching=1/0;this.lastDist=0}isNewFrontier(){let t=this.queue.peek();return!!(t&&t.dist>this.lastDist)}step(t,e,i){var n;this.lastDist=i;for(let o of t){let s=b.toString(o);if(!this.visited.has(s)){this.previous.set(s,e),this.queue.enqueue({node:o,dist:i+1}),this.visited.set(s,i+1);let a=(n=this.otherBfs)==null?void 0:n.visited.get(s);a!==void 0&&a<this.minMatching&&(this.minMatching=a,this.minMatchingNode=o)}}}},ai=class extends _t{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,i.previous2,i.matchingPos,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BIDIRECTIONAL_SEARCH"}}equal(t,e){return _.equal(t.position,e.position)?t.layer===e.layer:!1}shortestPathBfs(t,e){var h;if(b.equal(t,e))return{previous:new Map,previous2:new Map,closestToTarget:t,steps:0,maxPathLengthReached:!1};let i=new si,n=new si,o=0;i.otherBfs=n,n.otherBfs=i;let s=t,a=this.distance(t.position,e.position);for(i.queue.enqueue({node:t,dist:0}),n.queue.enqueue({node:e,dist:0}),i.visited.set(b.toString(t),0),n.visited.set(b.toString(e),0);i.queue.size()>0||n.queue.size()>0;){let u=i.queue.dequeue();if(!u)break;let{node:l,dist:c}=u;if(c+1+(((h=n.queue.peek())==null?void 0:h.dist)||0)>this.options.maxPathLength)return{previous:i.previous,previous2:n.previous,closestToTarget:s,steps:o,maxPathLengthReached:!0};let p=this.distance(l.position,e.position);if(p<a&&(a=p,s=l),o++,i.step(this.getNeighbors(l,e),l,c),i.isNewFrontier()&&i.minMatchingNode)return{previous:i.previous,previous2:n.previous,closestToTarget:e,matchingPos:i.minMatchingNode,steps:o,maxPathLengthReached:!1};let f=n.queue.dequeue();if(!f)continue;let{node:d,dist:y}=f;if(o++,n.step(this.getReverseNeighbors(d,e),d,y),n.isNewFrontier()&&n.minMatchingNode)return{previous:i.previous,previous2:n.previous,closestToTarget:e,matchingPos:n.minMatchingNode,steps:o,maxPathLengthReached:!1}}return{previous:i.previous,previous2:n.previous,closestToTarget:s,steps:o,maxPathLengthReached:!1}}returnPath(t,e,i,n,o){if(i){let s=this.getPathFromPrev(t,n,i).reverse(),a=this.getPathFromPrev(e,o,i);return s.pop(),[...s,...a]}else return this.getPathFromPrev(t,n,o).reverse()}getPathFromPrev(t,e,i){let n=[],o=i;for(n.push(o);!this.equal(o,e);){if(o=t.get(b.toString(o)),!o)return[];n.push(o)}return n}}});var lt=v(zt=>{var Xu=Math.pow(2,8)-1,Ju=Math.pow(2,16)-1,Zu=Math.pow(2,32)-1,tl=Math.pow(2,7)-1,el=Math.pow(2,15)-1,rl=Math.pow(2,31)-1;zt.getPointerArray=function(r){var t=r-1;if(t<=Xu)return Uint8Array;if(t<=Ju)return Uint16Array;if(t<=Zu)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};zt.getSignedPointerArray=function(r){var t=r-1;return t<=tl?Int8Array:t<=el?Int16Array:t<=rl?Int32Array:Float64Array};zt.getNumberType=function(r){return r===(r|0)?Math.sign(r)===-1?r<=127&&r>=-128?Int8Array:r<=32767&&r>=-32768?Int16Array:Int32Array:r<=255?Uint8Array:r<=65535?Uint16Array:Uint32Array:Float64Array};var il={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};zt.getMinimalRepresentation=function(r,t){var e=null,i=0,n,o,s,a,h;for(a=0,h=r.length;a<h;a++)s=t?t(r[a]):r[a],o=zt.getNumberType(s),n=il[o.name],n>i&&(i=n,e=o);return e};zt.isTypedArray=function(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView(r)};zt.concat=function(){var r=0,t,e,i;for(t=0,i=arguments.length;t<i;t++)r+=arguments[t].length;var n=new arguments[0].constructor(r);for(t=0,e=0;t<i;t++)n.set(arguments[t],e),e+=arguments[t].length;return n};zt.indices=function(r){for(var t=zt.getPointerArray(r),e=new t(r),i=0;i<r;i++)e[i]=i;return e}});var gt=v(sr=>{var ks=M(),Fs=lt();function nl(r){return Array.isArray(r)||Fs.isTypedArray(r)}function Ln(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function ol(r){var t=Ln(r),e=typeof t=="number"?new Array(t):[],i=0;return ks(r,function(n){e[i++]=n}),e}function sl(r){var t=Ln(r),e=typeof t=="number"?Fs.getPointerArray(t):Array,i=typeof t=="number"?new Array(t):[],n=typeof t=="number"?new e(t):[],o=0;return ks(r,function(s){i[o]=s,n[o]=o++}),[i,n]}sr.isArrayLike=nl;sr.guessLength=Ln;sr.toArray=ol;sr.toArrayWithIndices=sl});var ci=v((ry,Vs)=>{var hi=M(),Rs=nr(),Vt=gt(),li=Rs.DEFAULT_COMPARATOR,En=Rs.reverseComparator;function On(r,t,e,i){for(var n=t[i],o,s;i>e;){if(o=i-1>>1,s=t[o],r(n,s)<0){t[i]=s,i=o;continue}break}t[i]=n}function ar(r,t,e){for(var i=t.length,n=e,o=t[e],s=2*e+1,a;s<i;)a=s+1,a<i&&r(t[s],t[a])>=0&&(s=a),t[e]=t[s],e=s,s=2*e+1;t[e]=o,On(r,t,n,e)}function _s(r,t,e){t.push(e),On(r,t,0,t.length-1)}function An(r,t){var e=t.pop();if(t.length!==0){var i=t[0];return t[0]=e,ar(r,t,0),i}return e}function ke(r,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var i=t[0];return t[0]=e,ar(r,t,0),i}function zs(r,t,e){var i;return t.length!==0&&r(t[0],e)<0&&(i=t[0],t[0]=e,e=i,ar(r,t,0)),e}function Pe(r,t){for(var e=t.length,i=e>>1,n=i;--n>=0;)ar(r,t,n)}function Mn(r,t){for(var e=t.length,i=0,n=new Array(e);i<e;)n[i++]=An(r,t);return n}function al(r,t,e){arguments.length===2&&(e=t,t=r,r=li);var i=En(r),n,o,s,a=1/0,h;if(t===1){if(Vt.isArrayLike(e)){for(n=0,o=e.length;n<o;n++)s=e[n],(a===1/0||r(s,a)<0)&&(a=s);return h=new e.constructor(1),h[0]=a,h}return hi(e,function(l){(a===1/0||r(l,a)<0)&&(a=l)}),[a]}if(Vt.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(h=e.slice(0,t),Pe(i,h),n=t,o=e.length;n<o;n++)i(e[n],h[0])>0&&ke(i,h,e[n]);return h.sort(r)}var u=Vt.guessLength(e);return u!==null&&u<t&&(t=u),h=new Array(t),n=0,hi(e,function(l){n<t?h[n]=l:(n===t&&Pe(i,h),i(l,h[0])>0&&ke(i,h,l)),n++}),h.length>n&&(h.length=n),h.sort(r)}function hl(r,t,e){arguments.length===2&&(e=t,t=r,r=li);var i=En(r),n,o,s,a=-1/0,h;if(t===1){if(Vt.isArrayLike(e)){for(n=0,o=e.length;n<o;n++)s=e[n],(a===-1/0||r(s,a)>0)&&(a=s);return h=new e.constructor(1),h[0]=a,h}return hi(e,function(l){(a===-1/0||r(l,a)>0)&&(a=l)}),[a]}if(Vt.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(h=e.slice(0,t),Pe(r,h),n=t,o=e.length;n<o;n++)r(e[n],h[0])>0&&ke(r,h,e[n]);return h.sort(i)}var u=Vt.guessLength(e);return u!==null&&u<t&&(t=u),h=new Array(t),n=0,hi(e,function(l){n<t?h[n]=l:(n===t&&Pe(r,h),r(l,h[0])>0&&ke(r,h,l)),n++}),h.length>n&&(h.length=n),h.sort(i)}function O(r){if(this.clear(),this.comparator=r||li,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}O.prototype.clear=function(){this.items=[],this.size=0};O.prototype.push=function(r){return _s(this.comparator,this.items,r),++this.size};O.prototype.peek=function(){return this.items[0]};O.prototype.pop=function(){return this.size!==0&&this.size--,An(this.comparator,this.items)};O.prototype.replace=function(r){return ke(this.comparator,this.items,r)};O.prototype.pushpop=function(r){return zs(this.comparator,this.items,r)};O.prototype.consume=function(){return this.size=0,Mn(this.comparator,this.items)};O.prototype.toArray=function(){return Mn(this.comparator,this.items.slice())};O.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:O,enumerable:!1}),r};typeof Symbol!="undefined"&&(O.prototype[Symbol.for("nodejs.util.inspect.custom")]=O.prototype.inspect);function ui(r){if(this.clear(),this.comparator=r||li,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=En(this.comparator)}ui.prototype=O.prototype;O.from=function(r,t){var e=new O(t),i;return Vt.isArrayLike(r)?i=r.slice():i=Vt.toArray(r),Pe(e.comparator,i),e.items=i,e.size=i.length,e};ui.from=function(r,t){var e=new ui(t),i;return Vt.isArrayLike(r)?i=r.slice():i=Vt.toArray(r),Pe(e.comparator,i),e.items=i,e.size=i.length,e};O.siftUp=ar;O.siftDown=On;O.push=_s;O.pop=An;O.replace=ke;O.pushpop=zs;O.heapify=Pe;O.consume=Mn;O.nsmallest=al;O.nlargest=hl;O.MinHeap=O;O.MaxHeap=ui;Vs.exports=O});var Bs=v((iy,Gs)=>{var Ns="";function Us(r,t,e){for(var i=t.length,n=[],o=i,s=-1,a,h=0,u;o--;)s=Math.max(r[t[o]+e],s);for(u=s>>24&&32||s>>16&&24||s>>8&&16||8;h<u;h+=4){for(o=16;o--;)n[o]=[];for(o=i;o--;)n[r[t[o]+e]>>h&15].push(t[o]);for(a=0;a<16;a++)for(s=n[a].length;s--;)t[++o]=n[a][s]}}function ul(r,t,e,i){return r[e]-r[i]||(e%3===2?r[e+1]-r[i+1]||t[e+2]-t[i+2]:t[e+1]-t[i+1])}function Dn(r,t){var e=[],i=[],n=2*t/3|0,o=t-n,s=n+1>>1,a=n,h=0,u,l=[],c=[];if(t===1)return[0];for(;a--;)e[a]=(a*3>>1)+1;for(a=3;a--;)Us(r,e,a);for(h=i[(e[0]/3|0)+(e[0]%3===1?0:s)]=1,a=1;a<n;a++)(r[e[a]]!==r[e[a-1]]||r[e[a]+1]!==r[e[a-1]+1]||r[e[a]+2]!==r[e[a-1]+2])&&h++,i[(e[a]/3|0)+(e[a]%3===1?0:s)]=h;if(h<n)for(i=Dn(i,n),a=n;a--;)e[a]=i[a]<s?i[a]*3+1:(i[a]-s)*3+2;for(a=n;a--;)l[e[a]]=a;for(l[t]=-1,l[t+1]=-2,i=t%3===1?[t-1]:[],a=0;a<n;a++)e[a]%3===1&&i.push(e[a]-1);for(Us(r,i,0),a=0,h=0,u=0;a<n&&h<o;)c[u++]=ul(r,l,e[a],i[h])<0?e[a++]:i[h++];for(;a<n;)c[u++]=e[a++];for(;h<o;)c[u++]=i[h++];return c}function Hs(r){var t=r.length,e=t%3,i=new Array(t+e),n,o;if(typeof r!="string"){var s=Object.create(null);for(o=0;o<t;o++)s[r[o]]||(s[r[o]]=!0);var a=Object.create(null),h=Object.keys(s).sort();for(o=0,n=h.length;o<n;o++)a[h[o]]=o+1;for(o=0;o<t;o++)i[o]=a[r[o]]}else for(o=0;o<t;o++)i[o]=r.charCodeAt(o);for(o=t;o<t+e;o++)i[o]=0;return i}function oe(r){this.hasArbitrarySequence=typeof r!="string",this.string=r,this.length=r.length,this.array=Dn(Hs(r),this.length)}oe.prototype.toString=function(){return this.array.join(",")};oe.prototype.toJSON=function(){return this.array};oe.prototype.inspect=function(){for(var r=new Array(this.length),t=0;t<this.length;t++)r[t]=this.string.slice(this.array[t]);return Object.defineProperty(r,"constructor",{value:oe,enumerable:!1}),r};typeof Symbol!="undefined"&&(oe.prototype[Symbol.for("nodejs.util.inspect.custom")]=oe.prototype.inspect);function se(r){if(this.hasArbitrarySequence=typeof r[0]!="string",this.size=r.length,this.hasArbitrarySequence){this.text=[];for(var t=0,e=this.size;t<e;t++)this.text.push.apply(this.text,r[t]),t<e-1&&this.text.push(Ns)}else this.text=r.join(Ns);this.firstLength=r[0].length,this.length=this.text.length,this.array=Dn(Hs(this.text),this.length)}se.prototype.longestCommonSubsequence=function(){var r=this.hasArbitrarySequence?[]:"",t,e,i,n,o;for(e=1;e<this.length;e++)if(n=this.array[e],o=this.array[e-1],!(n<this.firstLength&&o<this.firstLength)&&!(n>this.firstLength&&o>this.firstLength)){for(t=Math.min(this.length-n,this.length-o),i=0;i<t;i++)if(this.text[n+i]!==this.text[o+i]){t=i;break}t>r.length&&(r=this.text.slice(n,n+t))}return r};se.prototype.toString=function(){return this.array.join(",")};se.prototype.toJSON=function(){return this.array};se.prototype.inspect=function(){for(var r=new Array(this.length),t=0;t<this.length;t++)r[t]=this.text.slice(this.array[t]);return Object.defineProperty(r,"constructor",{value:se,enumerable:!1}),r};typeof Symbol!="undefined"&&(se.prototype[Symbol.for("nodejs.util.inspect.custom")]=se.prototype.inspect);oe.GeneralizedSuffixArray=se;Gs.exports=oe});var Qs=v((ny,$s)=>{var ll=M();function Lt(r){this.size=0,this.items=new Map,this.inverse=r}function vt(){this.size=0,this.items=new Map,this.inverse=new Lt(this)}function qs(){this.size=0,this.items.clear(),this.inverse.items.clear()}vt.prototype.clear=qs;Lt.prototype.clear=qs;function Ws(r,t){if(this.items.has(r)){var e=this.items.get(r);if(e===t)return this;this.inverse.items.delete(e)}if(this.inverse.items.has(t)){var i=this.inverse.items.get(t);if(i===r)return this;this.items.delete(i)}return this.items.set(r,t),this.inverse.items.set(t,r),this.size=this.items.size,this.inverse.size=this.inverse.items.size,this}vt.prototype.set=Ws;Lt.prototype.set=Ws;function js(r){if(this.items.has(r)){var t=this.items.get(r);return this.items.delete(r),this.inverse.items.delete(t),this.size=this.items.size,this.inverse.size=this.inverse.items.size,!0}return!1}vt.prototype.delete=js;Lt.prototype.delete=js;var cl=["has","get","forEach","keys","values","entries"];cl.forEach(function(r){vt.prototype[r]=Lt.prototype[r]=function(){return Map.prototype[r].apply(this.items,arguments)}});typeof Symbol!="undefined"&&(vt.prototype[Symbol.iterator]=vt.prototype.entries,Lt.prototype[Symbol.iterator]=Lt.prototype.entries);vt.prototype.inspect=function(){var r={left:this.items,right:this.inverse.items};return Object.defineProperty(r,"constructor",{value:vt,enumerable:!1}),r};typeof Symbol!="undefined"&&(vt.prototype[Symbol.for("nodejs.util.inspect.custom")]=vt.prototype.inspect);Lt.prototype.inspect=function(){var r={left:this.inverse.items,right:this.items};return Object.defineProperty(r,"constructor",{value:Lt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Lt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Lt.prototype.inspect);vt.from=function(r){var t=new vt;return ll(r,function(e,i){t.set(i,e)}),t};$s.exports=vt});var K=v((oy,Ks)=>{function Nt(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol!="undefined"&&(Nt.prototype[Symbol.iterator]=function(){return this});Nt.of=function(){var r=arguments,t=r.length,e=0;return new Nt(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};Nt.empty=function(){var r=new Nt(function(){return{done:!0}});return r};Nt.fromSequence=function(r){var t=0,e=r.length;return new Nt(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};Nt.is=function(r){return r instanceof Nt?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};Ks.exports=Nt});var kn=v(Et=>{function Xs(r){return r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r&~(r>>1)}Et.msb32=Xs;function In(r){return r|=r>>1,r|=r>>2,r|=r>>4,r&~(r>>1)}Et.msb8=In;Et.test=function(r,t){return r>>t&1};Et.criticalBit8=function(r,t){return In(r^t)};Et.criticalBit8Mask=function(r,t){return~In(r^t)>>>0&255};Et.testCriticalBit8=function(r,t){return 1+(r|t)>>8};Et.criticalBit32Mask=function(r,t){return~Xs(r^t)>>>0&4294967295};Et.popcount=function(r){return r-=r>>1&1431655765,r=(r&858993459)+(r>>2&858993459),r=r+(r>>4)&252645135,r+=r>>8,r+=r>>16,r&127};var Fe=new Uint8Array(Math.pow(2,8));for(hr=0,Ys=Fe.length;hr<Ys;hr++)Fe[hr]=Et.popcount(hr);var hr,Ys;Et.table8Popcount=function(r){return Fe[r&255]+Fe[r>>8&255]+Fe[r>>16&255]+Fe[r>>24&255]}});var ea=v((ay,ta)=>{var Zs=K(),Js=kn();function q(r){this.length=r,this.clear()}q.prototype.clear=function(){this.size=0,this.array=new Uint32Array(Math.ceil(this.length/32))};q.prototype.set=function(r,t){var e=r>>5,i=r&31,n=this.array[e],o;return t===0||t===!1?o=this.array[e]&=~(1<<i):o=this.array[e]|=1<<i,o=o>>>0,o>n?this.size++:o<n&&this.size--,this};q.prototype.reset=function(r){var t=r>>5,e=r&31,i=this.array[t],n;return n=this.array[t]&=~(1<<e),n<i&&this.size--,this};q.prototype.flip=function(r){var t=r>>5,e=r&31,i=this.array[t],n=this.array[t]^=1<<e;return n=n>>>0,n>i?this.size++:n<i&&this.size--,this};q.prototype.get=function(r){var t=r>>5,e=r&31;return this.array[t]>>e&1};q.prototype.test=function(r){return!!this.get(r)};q.prototype.rank=function(r){if(this.size===0)return 0;for(var t=r>>5,e=r&31,i=0,n=0;n<t;n++)i+=Js.table8Popcount(this.array[n]);var o=this.array[t]&(1<<e)-1;return i+=Js.table8Popcount(o),i};q.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var t,e=32,i=0,n=0,o=0,s=this.array.length;o<s;o++)if(t=this.array[o],t!==0){o===s-1&&(e=this.length%32||32);for(var a=0;a<e;a++,i++)if(n+=t>>a&1,n===r)return i}};q.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.length,i,n,o=32,s=0,a=this.array.length;s<a;s++){i=this.array[s],s===a-1&&(o=e%32||32);for(var h=0;h<o;h++)n=i>>h&1,r.call(t,n,s*32+h)}};q.prototype.values=function(){var r=this.length,t=!1,e,i,n=this.array,o=n.length,s=0,a=-1,h=32;return new Zs(function u(){if(!t){if(s>=o)return{done:!0};s===o-1&&(h=r%32||32),e=n[s++],t=!0,a=-1}return a++,a>=h?(t=!1,u()):(i=e>>a&1,{value:i})})};q.prototype.entries=function(){var r=this.length,t=!1,e,i,n=this.array,o,s=n.length,a=0,h=-1,u=32;return new Zs(function l(){if(!t){if(a>=s)return{done:!0};a===s-1&&(u=r%32||32),e=n[a++],t=!0,h=-1}return h++,o=~-a*32+h,h>=u?(t=!1,l()):(i=e>>h&1,{value:[o,i]})})};typeof Symbol!="undefined"&&(q.prototype[Symbol.iterator]=q.prototype.values);q.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(t,e){r[e]=t}),Object.defineProperty(r,"constructor",{value:q,enumerable:!1}),r};typeof Symbol!="undefined"&&(q.prototype[Symbol.for("nodejs.util.inspect.custom")]=q.prototype.inspect);q.prototype.toJSON=function(){return Array.from(this.array)};ta.exports=q});var oa=v((hy,na)=>{var ia=K(),ra=kn(),pl=function(r){return Math.max(1,Math.ceil(r*1.5))};function fl(r){return new Uint32Array(Math.ceil(r/32))}function D(r){var t=r||0,e=pl;typeof r=="object"&&(t=r.initialLength||r.initialCapacity||0,e=r.policy||e),this.size=0,this.length=t,this.capacity=Math.ceil(this.length/32)*32,this.policy=e,this.array=fl(this.capacity)}D.prototype.set=function(r,t){if(this.length<r)throw new Error("BitVector.set: index out of bounds.");var e=r>>5,i=r&31,n=this.array[e],o;return t===0||t===!1?o=this.array[e]&=~(1<<i):o=this.array[e]|=1<<i,o=o>>>0,o>n?this.size++:o<n&&this.size--,this};D.prototype.reset=function(r){var t=r>>5,e=r&31,i=this.array[t],n;return n=this.array[t]&=~(1<<e),n<i&&this.size--,this};D.prototype.flip=function(r){var t=r>>5,e=r&31,i=this.array[t],n=this.array[t]^=1<<e;return n=n>>>0,n>i?this.size++:n<i&&this.size--,this};D.prototype.applyPolicy=function(r){var t=this.policy(r||this.capacity);if(typeof t!="number"||t<0)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(t<=this.capacity)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned a less or equal capacity to allocate.");return Math.ceil(t/32)*32};D.prototype.reallocate=function(r){var t=r;if(r=Math.ceil(r/32)*32,t<this.length&&(this.length=t),r===this.capacity)return this;var e=this.array,i=r/32;return i===this.array.length?this:(i>this.array.length?(this.array=new Uint32Array(i),this.array.set(e,0)):this.array=e.slice(0,i),this.capacity=r,this)};D.prototype.grow=function(r){var t;if(typeof r=="number"){if(this.capacity>=r)return this;for(t=this.capacity;t<r;)t=this.applyPolicy(t);return this.reallocate(t),this}return t=this.applyPolicy(),this.reallocate(t),this};D.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};D.prototype.push=function(r){if(this.capacity===this.length&&this.grow(),r===0||r===!1)return++this.length;this.size++;var t=this.length++,e=t>>5,i=t&31;return this.array[e]|=1<<i,this.length};D.prototype.pop=function(){if(this.length!==0){var r=--this.length,t=r>>5,e=r&31;return this.array[t]>>e&1}};D.prototype.get=function(r){if(!(this.length<r)){var t=r>>5,e=r&31;return this.array[t]>>e&1}};D.prototype.test=function(r){return this.length<r?!1:!!this.get(r)};D.prototype.rank=function(r){if(this.size===0)return 0;for(var t=r>>5,e=r&31,i=0,n=0;n<t;n++)i+=ra.table8Popcount(this.array[n]);var o=this.array[t]&(1<<e)-1;return i+=ra.table8Popcount(o),i};D.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var t,e=32,i=0,n=0,o=0,s=this.array.length;o<s;o++)if(t=this.array[o],t!==0){o===s-1&&(e=this.length%32||32);for(var a=0;a<e;a++,i++)if(n+=t>>a&1,n===r)return i}};D.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.length,i,n,o=32,s=0,a=this.array.length;s<a;s++){i=this.array[s],s===a-1&&(o=e%32||32);for(var h=0;h<o;h++)n=i>>h&1,r.call(t,n,s*32+h)}};D.prototype.values=function(){var r=this.length,t=!1,e,i,n=this.array,o=n.length,s=0,a=-1,h=32;return new ia(function u(){if(!t){if(s>=o)return{done:!0};s===o-1&&(h=r%32||32),e=n[s++],t=!0,a=-1}return a++,a>=h?(t=!1,u()):(i=e>>a&1,{value:i})})};D.prototype.entries=function(){var r=this.length,t=!1,e,i,n=this.array,o,s=n.length,a=0,h=-1,u=32;return new ia(function l(){if(!t){if(a>=s)return{done:!0};a===s-1&&(u=r%32||32),e=n[a++],t=!0,h=-1}return h++,o=~-a*32+h,h>=u?(t=!1,l()):(i=e>>h&1,{value:[o,i]})})};typeof Symbol!="undefined"&&(D.prototype[Symbol.iterator]=D.prototype.values);D.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(t,e){r[e]=t}),Object.defineProperty(r,"constructor",{value:D,enumerable:!1}),r};typeof Symbol!="undefined"&&(D.prototype[Symbol.for("nodejs.util.inspect.custom")]=D.prototype.inspect);D.prototype.toJSON=function(){return Array.from(this.array.slice(0,(this.length>>5)+1))};na.exports=D});var aa=v((uy,sa)=>{function Te(r,t){return(r&65535)*t+(((r>>>16)*t&65535)<<16)&4294967295}function ml(r,t){return(r&65535)+(t>>>16)+(((r>>>16)+t&65535)<<16)&4294967295}function Fn(r,t){return r<<t|r>>>32-t}sa.exports=function(t,e){var i=3432918353,n=461845907,o=15,s=13,a=5,h=1801774676,u=t,l,c,p;for(c=0,p=e.length-4;c<=p;c+=4)l=e[c]|e[c+1]<<8|e[c+2]<<16|e[c+3]<<24,l=Te(l,i),l=Fn(l,o),l=Te(l,n),u^=l,u=Fn(u,s),u=Te(u,a),u=ml(u,h);switch(l=0,e.length&3){case 3:l^=e[c+2]<<16;case 2:l^=e[c+1]<<8;case 1:l^=e[c],l=Te(l,i),l=Fn(l,o),l=Te(l,n),u^=l;default:}return u^=e.length,u^=u>>>16,u=Te(u,2246822507),u^=u>>>13,u=Te(u,3266489909),u^=u>>>16,u>>>0}});var ca=v((ly,la)=>{var dl=aa(),gl=M(),yl=Math.LN2*Math.LN2,vl={errorRate:.005};function ha(r){var t=new Uint16Array(r.length),e,i;for(e=0,i=r.length;e<i;e++)t[e]=r.charCodeAt(e);return t}function ua(r,t,e){var i=dl(t*4221880213&4294967295,e);return i%(r*8)}function we(r){var t={};if(!r)throw new Error("mnemonist/BloomFilter.constructor: a BloomFilter must be created with a capacity.");if(typeof r=="object"?t=r:t.capacity=r,typeof t.capacity!="number"||t.capacity<=0)throw new Error("mnemonist/BloomFilter.constructor: `capacity` option should be a positive integer.");if(this.capacity=t.capacity,this.errorRate=t.errorRate||vl.errorRate,typeof this.errorRate!="number"||t.errorRate<=0)throw new Error("mnemonist/BloomFilter.constructor: `errorRate` option should be a positive float.");this.clear()}we.prototype.clear=function(){var r=-1/yl*this.capacity*Math.log(this.errorRate),t=r/8|0;this.hashFunctions=t*8/this.capacity*Math.LN2|0,this.data=new Uint8Array(t)};we.prototype.add=function(r){for(var t=ha(r),e=0,i=this.hashFunctions;e<i;e++){var n=ua(this.data.length,e,t),o=1<<(7&n);this.data[n>>3]|=o}return this};we.prototype.test=function(r){for(var t=ha(r),e=0,i=this.hashFunctions;e<i;e++){var n=ua(this.data.length,e,t);if(!(this.data[n>>3]&1<<(7&n)))return!1}return!0};we.prototype.toJSON=function(){return this.data};we.from=function(r,t){if(!t&&(t=r.length||r.size,typeof t!="number"))throw new Error("BloomFilter.from: could not infer the filter's capacity. Try passing it as second argument.");var e=new we(t);return gl(r,function(i){e.add(i)}),e};la.exports=we});var fa=v((cy,pa)=>{var bl=M();function Ot(r){if(typeof r!="function")throw new Error("mnemonist/BKTree.constructor: given `distance` should be a function.");this.distance=r,this.clear()}Ot.prototype.add=function(r){if(!this.root)return this.root={item:r,children:{}},this.size++,this;for(var t=this.root,e;e=this.distance(r,t.item),!!t.children[e];)t=t.children[e];return t.children[e]={item:r,children:{}},this.size++,this};Ot.prototype.search=function(r,t){if(!this.root)return[];for(var e=[],i=[this.root],n,o,s,a,h;i.length;)for(n=i.pop(),s=this.distance(t,n.item),s<=r&&e.push({item:n.item,distance:s}),a=s-r,h=s+r+1;a<h;a++)o=n.children[a],o&&i.push(o);return e};Ot.prototype.clear=function(){this.size=0,this.root=null};Ot.prototype.toJSON=function(){return this.root};Ot.prototype.inspect=function(){for(var r=[],t=[this.root],e,i;t.length;)if(e=t.pop(),!!e){r.push(e.item);for(i in e.children)t.push(e.children[i])}return Object.defineProperty(r,"constructor",{value:Ot,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ot.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ot.prototype.inspect);Ot.from=function(r,t){var e=new Ot(t);return bl(r,function(i){e.add(i)}),e};pa.exports=Ot});var _n=v((py,da)=>{var Rn=gt(),ma=K();function z(r,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=t,this.items=new r(this.capacity),this.clear()}z.prototype.clear=function(){this.start=0,this.size=0};z.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=(this.start+this.size)%this.capacity;return this.items[t]=r,++this.size};z.prototype.unshift=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=r,this.start=t,++this.size};z.prototype.pop=function(){if(this.size===0)return;let r=(this.start+this.size-1)%this.capacity;return this.size--,this.items[r]};z.prototype.shift=function(){if(this.size!==0){var r=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[r]}};z.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};z.prototype.peekLast=function(){if(this.size!==0){var r=this.start+this.size-1;return r>this.capacity&&(r-=this.capacity),this.items[r]}};z.prototype.get=function(r){if(this.size!==0)return r=this.start+r,r>this.capacity&&(r-=this.capacity),this.items[r]};z.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.capacity,i=this.size,n=this.start,o=0;o<i;)r.call(t,this.items[n],o,this),n++,o++,n===e&&(n=0)};z.prototype.toArray=function(){var r=this.start+this.size;if(r<this.capacity)return this.items.slice(this.start,r);for(var t=new this.ArrayClass(this.size),e=this.capacity,i=this.size,n=this.start,o=0;o<i;)t[o]=this.items[n],n++,o++,n===e&&(n=0);return t};z.prototype.values=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,n=0;return new ma(function(){if(n>=e)return{done:!0};var o=r[i];return i++,n++,i===t&&(i=0),{value:o,done:!1}})};z.prototype.entries=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,n=0;return new ma(function(){if(n>=e)return{done:!0};var o=r[i];return i++,i===t&&(i=0),{value:[n++,o],done:!1}})};typeof Symbol!="undefined"&&(z.prototype[Symbol.iterator]=z.prototype.values);z.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:z,enumerable:!1}),r};typeof Symbol!="undefined"&&(z.prototype[Symbol.for("nodejs.util.inspect.custom")]=z.prototype.inspect);z.from=function(r,t,e){if(arguments.length<3&&(e=Rn.guessLength(r),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new z(t,e);if(Rn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return Rn.forEach(r,function(s){i.push(s)}),i};da.exports=z});var va=v((fy,ya)=>{var zn=gt(),Vn=_n();function Re(r,t){if(arguments.length<2)throw new Error("mnemonist/circular-buffer: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/circular-buffer: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=t,this.items=new r(this.capacity),this.clear()}function ga(r){Re.prototype[r]=Vn.prototype[r]}Object.keys(Vn.prototype).forEach(ga);typeof Symbol!="undefined"&&Object.getOwnPropertySymbols(Vn.prototype).forEach(ga);Re.prototype.push=function(r){var t=(this.start+this.size)%this.capacity;return this.items[t]=r,this.size===this.capacity?(this.start=(t+1)%this.capacity,this.size):++this.size};Re.prototype.unshift=function(r){var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=r,this.size===this.capacity?(this.start=t,this.size):(this.start=t,++this.size)};Re.from=function(r,t,e){if(arguments.length<3&&(e=zn.guessLength(r),typeof e!="number"))throw new Error("mnemonist/circular-buffer.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new Re(t,e);if(zn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return zn.forEach(r,function(s){i.push(s)}),i};ya.exports=Re});var Pa=v((my,ba)=>{function tt(r){if(typeof r!="function")throw new Error("mnemonist/DefaultMap.constructor: expecting a function.");this.items=new Map,this.factory=r,this.size=0}tt.prototype.clear=function(){this.items.clear(),this.size=0};tt.prototype.get=function(r){var t=this.items.get(r);return typeof t=="undefined"&&(t=this.factory(r,this.size),this.items.set(r,t),this.size++),t};tt.prototype.peek=function(r){return this.items.get(r)};tt.prototype.set=function(r,t){return this.items.set(r,t),this.size=this.items.size,this};tt.prototype.has=function(r){return this.items.has(r)};tt.prototype.delete=function(r){var t=this.items.delete(r);return this.size=this.items.size,t};tt.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};tt.prototype.entries=function(){return this.items.entries()};tt.prototype.keys=function(){return this.items.keys()};tt.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(tt.prototype[Symbol.iterator]=tt.prototype.entries);tt.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(tt.prototype[Symbol.for("nodejs.util.inspect.custom")]=tt.prototype.inspect);tt.autoIncrement=function(){var r=0;return function(){return r++}};ba.exports=tt});var wa=v((dy,Ta)=>{function Ut(r){if(typeof r!="function")throw new Error("mnemonist/DefaultWeakMap.constructor: expecting a function.");this.items=new WeakMap,this.factory=r}Ut.prototype.clear=function(){this.items=new WeakMap};Ut.prototype.get=function(r){var t=this.items.get(r);return typeof t=="undefined"&&(t=this.factory(r),this.items.set(r,t)),t};Ut.prototype.peek=function(r){return this.items.get(r)};Ut.prototype.set=function(r,t){return this.items.set(r,t),this};Ut.prototype.has=function(r){return this.items.has(r)};Ut.prototype.delete=function(r){return this.items.delete(r)};Ut.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(Ut.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ut.prototype.inspect);Ta.exports=Ut});var Sa=v((gy,xa)=>{var Nn=lt();function Ht(r){var t=Nn.getPointerArray(r),e=Nn.getPointerArray(Math.log2(r));this.size=r,this.dimension=r,this.parents=new t(r),this.ranks=new e(r);for(var i=0;i<r;i++)this.parents[i]=i}Ht.prototype.find=function(r){for(var t=r,e,i;e=this.parents[t],t!==e;)t=e;for(;i=this.parents[r],i!==t;)this.parents[r]=t,r=i;return t};Ht.prototype.union=function(r,t){var e=this.find(r),i=this.find(t);if(e===i)return this;this.dimension--;var n=this.ranks[r],o=this.ranks[t];return n<o?this.parents[e]=i:n>o?this.parents[i]=e:(this.parents[i]=e,this.ranks[e]++),this};Ht.prototype.connected=function(r,t){var e=this.find(r);return e===this.find(t)};Ht.prototype.mapping=function(){for(var r=Nn.getPointerArray(this.dimension),t={},e=new r(this.size),i=0,n,o=0,s=this.parents.length;o<s;o++)n=this.find(o),typeof t[n]=="undefined"?(e[o]=i,t[n]=i++):e[o]=t[n];return e};Ht.prototype.compile=function(){for(var r={},t=new Array(this.dimension),e=0,i,n=0,o=this.parents.length;n<o;n++)i=this.find(n),typeof r[i]=="undefined"?(t[e]=[n],r[i]=e++):t[r[i]].push(n);return t};Ht.prototype.inspect=function(){var r=this.compile();return Object.defineProperty(r,"constructor",{value:Ht,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ht.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ht.prototype.inspect);xa.exports=Ht});var pi=v((yy,Ea)=>{var Ca=nr(),Un=ci(),Pl=Ca.DEFAULT_COMPARATOR,Tl=Ca.reverseComparator;function wl(r,t,e,i){for(var n=e,o=i,s=t[i],a=2*i+1,h;a<n;)h=a+1,h<n&&r(t[a],t[h])>=0&&(a=h),t[i]=t[a],i=a,a=2*i+1;t[i]=s,Un.siftDown(r,t,o,i)}function La(r,t,e,i){for(var n=i,o=n,s=new r(i),a,h;o>0;)a=e[--o],o!==0&&(h=e[0],e[0]=a,wl(t,e,--i,0),a=h),s[o]=a;return s}function Gt(r,t,e){if(arguments.length===2&&(e=t,t=null),this.ArrayClass=r,this.capacity=e,this.items=new r(e),this.clear(),this.comparator=t||Pl,typeof e!="number"&&e<=0)throw new Error("mnemonist/FixedReverseHeap.constructor: capacity should be a number > 0.");if(typeof this.comparator!="function")throw new Error("mnemonist/FixedReverseHeap.constructor: given comparator should be a function.");this.comparator=Tl(this.comparator)}Gt.prototype.clear=function(){this.size=0};Gt.prototype.push=function(r){return this.size<this.capacity?(this.items[this.size]=r,Un.siftDown(this.comparator,this.items,0,this.size),this.size++):this.comparator(r,this.items[0])>0&&Un.replace(this.comparator,this.items,r),this.size};Gt.prototype.peek=function(){return this.items[0]};Gt.prototype.consume=function(){var r=La(this.ArrayClass,this.comparator,this.items,this.size);return this.size=0,r};Gt.prototype.toArray=function(){return La(this.ArrayClass,this.comparator,this.items.slice(0,this.size),this.size)};Gt.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:Gt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Gt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Gt.prototype.inspect);Ea.exports=Gt});var Ma=v((vy,Aa)=>{var xl=M(),Oa=function(r){return r};function ot(r){if(this.items=new Map,this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=Oa),this.readHashFunction||(this.readHashFunction=Oa),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.")}ot.prototype.clear=function(){this.items.clear(),this.size=0};ot.prototype.add=function(r){var t=this.writeHashFunction(r);return this.items.set(t,r),this.size=this.items.size,this};ot.prototype.set=function(r,t){return r=this.writeHashFunction(r),this.items.set(r,t),this.size=this.items.size,this};ot.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};ot.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};ot.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(function(e){r.call(t,e,e)})};ot.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(ot.prototype[Symbol.iterator]=ot.prototype.values);ot.prototype.inspect=function(){var r=Array.from(this.items.values());return Object.defineProperty(r,"constructor",{value:ot,enumerable:!1}),r};typeof Symbol!="undefined"&&(ot.prototype[Symbol.for("nodejs.util.inspect.custom")]=ot.prototype.inspect);ot.from=function(r,t,e){var i=new ot(t);return xl(r,function(n,o){e?i.set(o,n):i.add(n)}),i};Aa.exports=ot});var Hn=v((by,Da)=>{var fi=K(),Sl=M();function A(r){this.Container=r||Array,this.items=new Map,this.clear(),Object.defineProperty(this.items,"constructor",{value:A,enumerable:!1})}A.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};A.prototype.set=function(r,t){var e=this.items.get(r),i;return e||(this.dimension++,e=new this.Container,this.items.set(r,e)),this.Container===Set?(i=e.size,e.add(t),i<e.size&&this.size++):(e.push(t),this.size++),this};A.prototype.delete=function(r){var t=this.items.get(r);return t?(this.size-=this.Container===Set?t.size:t.length,this.dimension--,this.items.delete(r),!0):!1};A.prototype.remove=function(r,t){var e=this.items.get(r),i,n;return e?this.Container===Set?(i=e.delete(t),i&&this.size--,e.size===0&&(this.items.delete(r),this.dimension--),i):(n=e.indexOf(t),n===-1?!1:(this.size--,e.length===1?(this.items.delete(r),this.dimension--,!0):(e.splice(n,1),!0))):!1};A.prototype.has=function(r){return this.items.has(r)};A.prototype.get=function(r){return this.items.get(r)};A.prototype.multiplicity=function(r){var t=this.items.get(r);return typeof t=="undefined"?0:this.Container===Set?t.size:t.length};A.prototype.count=A.prototype.multiplicity;A.prototype.forEach=function(r,t){t=arguments.length>1?t:this;var e;function i(n){r.call(t,n,e)}this.items.forEach(function(n,o){e=o,n.forEach(i)})};A.prototype.forEachAssociation=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};A.prototype.keys=function(){return this.items.keys()};A.prototype.values=function(){var r=this.items.values(),t=!1,e,i,n,o;return this.Container===Set?new fi(function s(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,e=i.value.values()}return i=e.next(),i.done?(t=!1,s()):{done:!1,value:i.value}}):new fi(function s(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,e=i.value,n=0,o=e.length}return n>=o?(t=!1,s()):{done:!1,value:e[n++]}})};A.prototype.entries=function(){var r=this.items.entries(),t=!1,e,i,n,o,s;return this.Container===Set?new fi(function a(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,n=i.value[0],e=i.value[1].values()}return i=e.next(),i.done?(t=!1,a()):{done:!1,value:[n,i.value]}}):new fi(function a(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,n=i.value[0],e=i.value[1],o=0,s=e.length}return o>=s?(t=!1,a()):{done:!1,value:[n,e[o++]]}})};A.prototype.containers=function(){return this.items.values()};A.prototype.associations=function(){return this.items.entries()};typeof Symbol!="undefined"&&(A.prototype[Symbol.iterator]=A.prototype.entries);A.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(A.prototype[Symbol.for("nodejs.util.inspect.custom")]=A.prototype.inspect);A.prototype.toJSON=function(){return this.items};A.from=function(r,t){var e=new A(t);return Sl(r,function(i,n){e.set(n,i)}),e};Da.exports=A});var Fa=v((Py,ka)=>{var Cl=Hn(),Ll=M(),Ia=function(r){return r};function st(r,t){if(this.items=new Cl(t),this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=Ia),this.readHashFunction||(this.readHashFunction=Ia),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.")}st.prototype.clear=function(){this.items.clear(),this.size=0,this.dimension=0};st.prototype.add=function(r){var t=this.writeHashFunction(r);return this.items.set(t,r),this.size=this.items.size,this.dimension=this.items.dimension,this};st.prototype.set=function(r,t){return r=this.writeHashFunction(r),this.items.set(r,t),this.size=this.items.size,this.dimension=this.items.dimension,this};st.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};st.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};st.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(function(e){r.call(t,e,e)})};st.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(st.prototype[Symbol.iterator]=st.prototype.values);st.prototype.inspect=function(){var r=Array.from(this);return Object.defineProperty(r,"constructor",{value:st,enumerable:!1}),r};typeof Symbol!="undefined"&&(st.prototype[Symbol.for("nodejs.util.inspect.custom")]=st.prototype.inspect);st.from=function(r,t,e,i){arguments.length===3&&typeof e=="boolean"&&(i=e,e=Array);var n=new st(t,e);return Ll(r,function(o,s){i?n.set(s,o):n.add(o)}),n};ka.exports=st});var za=v((Ty,_a)=>{var Ra=1024;function El(r){return(r&r-1)===0}function At(r,t){if(arguments.length<1)throw new Error("mnemonist/hashed-array-tree: expecting at least a byte array constructor.");var e=t||0,i=Ra,n=0;if(typeof t=="object"&&(e=t.initialCapacity||0,n=t.initialLength||0,i=t.blockSize||Ra),!i||!El(i))throw new Error("mnemonist/hashed-array-tree: block size should be a power of two.");var o=Math.max(n,e),s=Math.ceil(o/i);this.ArrayClass=r,this.length=n,this.capacity=s*i,this.blockSize=i,this.offsetMask=i-1,this.blockMask=Math.log2(i),this.blocks=new Array(s);for(var a=0;a<s;a++)this.blocks[a]=new this.ArrayClass(this.blockSize)}At.prototype.set=function(r,t){if(this.length<r)throw new Error("HashedArrayTree("+this.ArrayClass.name+").set: index out of bounds.");var e=r>>this.blockMask,i=r&this.offsetMask;return this.blocks[e][i]=t,this};At.prototype.get=function(r){if(!(this.length<r)){var t=r>>this.blockMask,e=r&this.offsetMask;return this.blocks[t][e]}};At.prototype.grow=function(r){if(typeof r!="number"&&(r=this.capacity+this.blockSize),this.capacity>=r)return this;for(;this.capacity<r;)this.blocks.push(new this.ArrayClass(this.blockSize)),this.capacity+=this.blockSize;return this};At.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.grow(r),this)};At.prototype.push=function(r){this.capacity===this.length&&this.grow();var t=this.length,e=t>>this.blockMask,i=t&this.offsetMask;return this.blocks[e][i]=r,++this.length};At.prototype.pop=function(){if(this.length!==0){var r=this.blocks[this.blocks.length-1],t=--this.length&this.offsetMask;return r[t]}};At.prototype.inspect=function(){for(var r=new this.ArrayClass(this.length),t,e=0,i=this.length;e<i;e++)t=e>>this.blockMask,r[e]=this.blocks[t][e&this.offsetMask];return r.type=this.ArrayClass.name,r.items=this.length,r.capacity=this.capacity,r.blockSize=this.blockSize,Object.defineProperty(r,"constructor",{value:At,enumerable:!1}),r};typeof Symbol!="undefined"&&(At.prototype[Symbol.for("nodejs.util.inspect.custom")]=At.prototype.inspect);_a.exports=At});var Bn=v((wy,Na)=>{var Va=K(),Gn=gt();function W(r,t){if(arguments.length<2)throw new Error("mnemonist/fixed-stack: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-stack: `capacity` should be a positive number.");this.capacity=t,this.ArrayClass=r,this.items=new this.ArrayClass(this.capacity),this.clear()}W.prototype.clear=function(){this.size=0};W.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-stack.push: stack capacity ("+this.capacity+") exceeded!");return this.items[this.size++]=r,this.size};W.prototype.pop=function(){if(this.size!==0)return this.items[--this.size]};W.prototype.peek=function(){return this.items[this.size-1]};W.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.items.length;e<i;e++)r.call(t,this.items[i-e-1],e,this)};W.prototype.toArray=function(){for(var r=new this.ArrayClass(this.size),t=this.size-1,e=this.size;e--;)r[e]=this.items[t-e];return r};W.prototype.values=function(){var r=this.items,t=this.size,e=0;return new Va(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return e++,{value:i,done:!1}})};W.prototype.entries=function(){var r=this.items,t=this.size,e=0;return new Va(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(W.prototype[Symbol.iterator]=W.prototype.values);W.prototype.toString=function(){return this.toArray().join(",")};W.prototype.toJSON=function(){return this.toArray()};W.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:W,enumerable:!1}),r};typeof Symbol!="undefined"&&(W.prototype[Symbol.for("nodejs.util.inspect.custom")]=W.prototype.inspect);W.from=function(r,t,e){if(arguments.length<3&&(e=Gn.guessLength(r),typeof e!="number"))throw new Error("mnemonist/fixed-stack.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new W(t,e);if(Gn.isArrayLike(r)){var n,o;for(n=0,o=r.length;n<o;n++)i.items[n]=r[n];return i.size=o,i}return Gn.forEach(r,function(s){i.push(s)}),i};Na.exports=W});var Ha=v((xy,Ua)=>{var Ol=gt(),Al=lt(),Ml=Bn();function qn(r,t,e,i,n,o,s,a){var h=s+(a-s)/2|0,u=~-h,l=-~h,c=e[h];i[o]=c+1;var p=t?t(r[c]):r[c][1],f=o*2+1,d=o*2+2,y=-1/0,P=-1/0;s<=u&&(y=qn(r,t,e,i,n,f,s,u)),l<=a&&(P=qn(r,t,e,i,n,d,l,a));var x=Math.max(p,y,P),T=c;return x===y?T=n[i[f]-1]:x===P&&(T=n[i[d]-1]),n[c]=T,x}function Bt(r,t){this.size=r.length,this.intervals=r;var e=null,i=null;Array.isArray(t)&&(e=t[0],i=t[1]);var n=r.length,o=Al.getPointerArray(n+1),s=new o(n),a;for(a=1;a<n;a++)s[a]=a;s.sort(function(p,f){return p=r[p],f=r[f],e?(p=e(p),f=e(f)):(p=p[0],f=f[0]),p<f?-1:p>f?1:0});var h=Math.ceil(Math.log2(n+1)),u=Math.pow(2,h)-1,l=new o(u),c=new o(n);qn(r,i,s,l,c,0,0,n-1),s=null,this.height=h,this.tree=l,this.augmentations=c,this.startGetter=e,this.endGetter=i,this.stack=new Ml(o,this.height)}Bt.prototype.intervalsContainingPoint=function(r){var t=[],e=this.stack;e.clear(),e.push(0);for(var i=this.tree.length,n,o,s,a,h,u,l,c,p;e.size;)n=e.pop(),o=this.tree[n]-1,s=this.intervals[o],a=this.intervals[this.augmentations[o]],l=this.endGetter?this.endGetter(a):a[1],!(r>l)&&(c=n*2+1,c<i&&this.tree[c]!==0&&e.push(c),h=this.startGetter?this.startGetter(s):s[0],u=this.endGetter?this.endGetter(s):s[1],r>=h&&r<=u&&t.push(s),!(r<h)&&(p=n*2+2,p<i&&this.tree[p]!==0&&e.push(p)));return t};Bt.prototype.intervalsOverlappingInterval=function(r){var t=this.startGetter?this.startGetter(r):r[0],e=this.endGetter?this.endGetter(r):r[1],i=[],n=this.stack;n.clear(),n.push(0);for(var o=this.tree.length,s,a,h,u,l,c,p,f,d;n.size;)s=n.pop(),a=this.tree[s]-1,h=this.intervals[a],u=this.intervals[this.augmentations[a]],p=this.endGetter?this.endGetter(u):u[1],!(t>p)&&(f=s*2+1,f<o&&this.tree[f]!==0&&n.push(f),l=this.startGetter?this.startGetter(h):h[0],c=this.endGetter?this.endGetter(h):h[1],e>=l&&t<=c&&i.push(h),!(e<l)&&(d=s*2+2,d<o&&this.tree[d]!==0&&n.push(d)));return i};Bt.prototype.inspect=function(){var r=this.intervals.slice();return Object.defineProperty(r,"constructor",{value:Bt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Bt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Bt.prototype.inspect);Bt.from=function(r,t){return Ol.isArrayLike(r)?new Bt(r,t):new Bt(Array.from(r),t)};Ua.exports=Bt});var Wn=v(ae=>{ae.search=function(r,t,e,i){var n=0;e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length,i--;for(var o;e<=i;)if(n=e+i>>>1,o=r[n],o>t)i=~-n;else if(o<t)e=-~n;else return n;return-1};ae.searchWithComparator=function(r,t,e){for(var i=0,n=0,o=~-t.length,s;n<=o;)if(i=n+o>>>1,s=r(t[i],e),s>0)o=~-i;else if(s<0)n=-~i;else return i;return-1};ae.lowerBound=function(r,t,e,i){var n=0;for(e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length;e<i;)n=e+i>>>1,t<=r[n]?i=n:e=-~n;return e};ae.lowerBoundWithComparator=function(r,t,e){for(var i=0,n=0,o=t.length;n<o;)i=n+o>>>1,r(e,t[i])<=0?o=i:n=-~i;return n};ae.lowerBoundIndices=function(r,t,e,i,n){var o=0;for(i=typeof i!="undefined"?i:0,n=typeof n!="undefined"?n:r.length;i<n;)o=i+n>>>1,e<=r[t[o]]?n=o:i=-~o;return i};ae.upperBound=function(r,t,e,i){var n=0;for(e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length;e<i;)n=e+i>>>1,t>=r[n]?e=-~n:i=n;return e};ae.upperBoundWithComparator=function(r,t,e){for(var i=0,n=0,o=t.length;n<o;)i=n+o>>>1,r(e,t[i])>=0?n=-~i:o=i;return n}});var Wa=v(he=>{var _e=lt(),ze=gt().isArrayLike,xe=Wn(),Ga=ri();function Ba(r,t){if(r.length===0)return t.slice();if(t.length===0)return r.slice();var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],n=t[0];if(i<=n)return _e.isTypedArray(r)?_e.concat(r,t):r.concat(t);var o=new r.constructor(r.length+t.length),s,a,h;for(s=0,a=r.length;s<a&&(h=r[s],h<=n);s++)o[s]=h;for(var u=s,l=r.length,c=0,p=t.length,f,d;u<l&&c<p;)f=r[u],d=t[c],f<=d?(o[s++]=f,u++):(o[s++]=d,c++);for(;u<l;)o[s++]=r[u++];for(;c<p;)o[s++]=t[c++];return o}function qa(r,t){if(r.length===0)return t.slice();if(t.length===0)return r.slice();var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],n=t[0];if(i<n)return _e.isTypedArray(r)?_e.concat(r,t):r.concat(t);var o=new r.constructor,s,a,h;for(s=0,a=r.length;s<a&&(h=r[s],h<n);s++)o.push(h);for(var u=s,l=r.length,c=0,p=t.length,f,d;u<l&&c<p;)f=r[u],d=t[c],f<=d?((o.length===0||o[o.length-1]!==f)&&o.push(f),u++):((o.length===0||o[o.length-1]!==d)&&o.push(d),c++);for(;u<l;)f=r[u++],(o.length===0||o[o.length-1]!==f)&&o.push(f);for(;c<p;)d=t[c++],(o.length===0||o[o.length-1]!==d)&&o.push(d);return o}he.intersectionUniqueArrays=function(r,t){if(r.length===0||t.length===0)return new r.constructor(0);var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],n=t[0];if(i<n)return new r.constructor(0);for(var o=new r.constructor,s=xe.lowerBound(r,n),a=r.length,h=0,u=xe.upperBound(t,i),l,c;s<a&&h<u;)l=r[s],c=t[h],l<c?s=xe.lowerBound(r,c,s+1):l>c?h=xe.lowerBound(t,l,h+1):(o.push(l),s++,h++);return o};function Dl(r){var t=0,e=-1/0,i,n,o,s=[];for(n=0,o=r.length;n<o;n++)i=r[n].length,i!==0&&(s.push(r[n]),t+=i,i>e&&(e=i));if(s.length===0)return new r[0].constructor(0);if(s.length===1)return s[0].slice();if(s.length===2)return Ba(s[0],s[1]);r=s;var a=new r[0].constructor(t),h=_e.getPointerArray(e),u=new h(r.length),l=new Ga(function(f,d){return f=r[f][u[f]],d=r[d][u[d]],f<d?-1:f>d?1:0});for(n=0;n<o;n++)l.push(n);n=0;for(var c,p;l.size;)c=l.pop(),p=r[c][u[c]++],a[n++]=p,u[c]<r[c].length&&l.push(c);return a}function Il(r){var t=-1/0,e,i,n,o=[];for(i=0,n=r.length;i<n;i++)e=r[i].length,e!==0&&(o.push(r[i]),e>t&&(t=e));if(o.length===0)return new r[0].constructor(0);if(o.length===1)return o[0].slice();if(o.length===2)return qa(o[0],o[1]);r=o;var s=new r[0].constructor,a=_e.getPointerArray(t),h=new a(r.length),u=new Ga(function(p,f){return p=r[p][h[p]],f=r[f][h[f]],p<f?-1:p>f?1:0});for(i=0;i<n;i++)u.push(i);for(var l,c;u.size;)l=u.pop(),c=r[l][h[l]++],(s.length===0||s[s.length-1]!==c)&&s.push(c),h[l]<r[l].length&&u.push(l);return s}he.kWayIntersectionUniqueArrays=function(r){var t=-1/0,e=-1/0,i=1/0,n,o,s,a,h;for(a=0,h=r.length;a<h;a++){if(s=r[a].length,s===0)return[];s>t&&(t=s),n=r[a][0],o=r[a][s-1],n>e&&(e=n),o<i&&(i=o)}if(e>i)return[];if(e===i)return[e];var u,l,c=r[0],p,f,d,y,P,x,T=e;for(a=1;a<h;a++){for(u=c,l=r[a],c=new Array,p=0,f=xe.lowerBound(l,T),d=u.length,y=l.length;p<d&&f<y;)P=u[p],x=l[f],P<x?p=xe.lowerBound(u,x,p+1):P>x?f=xe.lowerBound(l,P,f+1):(c.push(P),p++,f++);if(c.length===0)return c;T=c[0]}return c};he.merge=function(){if(arguments.length===2){if(ze(arguments[0]))return Ba(arguments[0],arguments[1])}else if(ze(arguments[0]))return Dl(arguments);return null};he.unionUnique=function(){if(arguments.length===2){if(ze(arguments[0]))return qa(arguments[0],arguments[1])}else if(ze(arguments[0]))return Il(arguments);return null};he.intersectionUnique=function(){if(arguments.length===2){if(ze(arguments[0]))return he.intersectionUniqueArrays(arguments[0],arguments[1])}else if(ze(arguments[0]))return he.kWayIntersectionUniqueArrays(arguments);return null}});var Qa=v((Ly,$a)=>{var kl=K(),Fl=M(),Rl=Wa();function ja(r){return r}function ct(r){if(this.clear(),Array.isArray(r)?(this.documentTokenizer=r[0],this.queryTokenizer=r[1]):(this.documentTokenizer=r,this.queryTokenizer=r),this.documentTokenizer||(this.documentTokenizer=ja),this.queryTokenizer||(this.queryTokenizer=ja),typeof this.documentTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: document tokenizer is not a function.");if(typeof this.queryTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: query tokenizer is not a function.")}ct.prototype.clear=function(){this.items=[],this.mapping=new Map,this.size=0,this.dimension=0};ct.prototype.add=function(r){this.size++;var t=this.items.length;this.items.push(r);var e=this.documentTokenizer(r);if(!Array.isArray(e))throw new Error("mnemonist/InvertedIndex.add: tokenizer function should return an array of tokens.");for(var i=new Set,n,o,s=0,a=e.length;s<a;s++)n=e[s],!i.has(n)&&(i.add(n),o=this.mapping.get(n),o||(o=[],this.mapping.set(n,o)),o.push(t));return this.dimension=this.mapping.size,this};ct.prototype.get=function(r){if(!this.size)return[];var t=this.queryTokenizer(r);if(!Array.isArray(t))throw new Error("mnemonist/InvertedIndex.query: tokenizer function should return an array of tokens.");if(!t.length)return[];var e=this.mapping.get(t[0]),i,n,o;if(typeof e=="undefined"||e.length===0)return[];if(t.length>1)for(n=1,o=t.length;n<o;n++){if(i=this.mapping.get(t[n]),typeof i=="undefined"||i.length===0)return[];e=Rl.intersectionUniqueArrays(e,i)}var s=new Array(e.length);for(n=0,o=s.length;n<o;n++)s[n]=this.items[e[n]];return s};ct.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.documents.length;e<i;e++)r.call(t,this.documents[e],e,this)};ct.prototype.documents=function(){var r=this.items,t=r.length,e=0;return new kl(function(){if(e>=t)return{done:!0};var i=r[e++];return{value:i,done:!1}})};ct.prototype.tokens=function(){return this.mapping.keys()};typeof Symbol!="undefined"&&(ct.prototype[Symbol.iterator]=ct.prototype.documents);ct.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:ct,enumerable:!1}),r};typeof Symbol!="undefined"&&(ct.prototype[Symbol.for("nodejs.util.inspect.custom")]=ct.prototype.inspect);ct.from=function(r,t){var e=new ct(t);return Fl(r,function(i){e.add(i)}),e};$a.exports=ct});var $n=v(jn=>{var Y=new Float64Array(64),F=new Float64Array(64);function _l(r,t,e){var i,n,o,s,a;for(Y[0]=t,F[0]=e,n=0;n>=0;)if(o=Y[n],s=F[n]-1,o<s){for(i=r[o];o<s;){for(;r[s]>=i&&o<s;)s--;for(o<s&&(r[o++]=r[s]);r[o]<=i&&o<s;)o++;o<s&&(r[s--]=r[o])}r[o]=i,Y[n+1]=o+1,F[n+1]=F[n],F[n++]=o,F[n]-Y[n]>F[n-1]-Y[n-1]&&(a=Y[n],Y[n]=Y[n-1],Y[n-1]=a,a=F[n],F[n]=F[n-1],F[n-1]=a)}else n--;return r}jn.inplaceQuickSort=_l;function zl(r,t,e,i){var n,o,s,a,h,u;for(Y[0]=e,F[0]=i,o=0;o>=0;)if(s=Y[o],a=F[o]-1,s<a){for(h=t[s],n=r[h];s<a;){for(;r[t[a]]>=n&&s<a;)a--;for(s<a&&(t[s++]=t[a]);r[t[s]]<=n&&s<a;)s++;s<a&&(t[a--]=t[s])}t[s]=h,Y[o+1]=s+1,F[o+1]=F[o],F[o++]=s,F[o]-Y[o]>F[o-1]-Y[o-1]&&(u=Y[o],Y[o]=Y[o-1],Y[o-1]=u,u=F[o],F[o]=F[o-1],F[o-1]=u)}else o--;return t}jn.inplaceQuickSortIndices=zl});var Za=v((Oy,Ja)=>{var Vl=gt(),mi=lt(),Ka=nr().createTupleComparator,Ya=pi(),Nl=$n().inplaceQuickSortIndices;function Qn(r,t,e,i){var n,o=0,s;for(n=0;n<r;n++)s=t[n][e]-i[n],o+=s*s;return o}function Ul(r,t){var e=t.length,i=new Array(r),n=new Array(e),o,s=mi.getPointerArray(e),a=new s(e),h,u,l,c=!0;for(h=0;h<r;h++){for(o=new Float64Array(e),u=0;u<e;u++)l=t[u],o[u]=l[1][h],c&&(n[u]=l[0],a[u]=u);c=!1,i[h]=o}return{axes:i,ids:a,labels:n}}function Xa(r,t,e,i){for(var n=i.length,o=mi.getPointerArray(n+1),s=new o(n),a=new o(n),h=new o(n),u=[[0,0,e.length,-1,0]],l,c,p,f,d,y,P,x,T=0;u.length!==0;)l=u.pop(),x=l[0],y=l[1],P=l[2],c=l[3],p=l[4],Nl(t[x],e,y,P),n=P-y,f=y+(n>>>1),d=e[f],s[T]=d,c>-1&&(p===0?a[c]=T+1:h[c]=T+1),x=(x+1)%r,f!==y&&f!==P-1&&u.push([x,f+1,P,T,1]),f!==y&&u.push([x,y,f,T,0]),T++;return{axes:t,labels:i,pivots:s,lefts:a,rights:h}}function wt(r,t){this.dimensions=r,this.visited=0,this.axes=t.axes,this.labels=t.labels,this.pivots=t.pivots,this.lefts=t.lefts,this.rights=t.rights,this.size=this.labels.length}wt.prototype.nearestNeighbor=function(r){var t=1/0,e=null,i=this.dimensions,n=this.axes,o=this.pivots,s=this.lefts,a=this.rights,h=0;function u(l,c){h++;var p=s[c],f=a[c],d=o[c],y=Qn(i,n,d,r);if(!(y<t&&(e=d,t=y,y===0))){var P=n[l][d]-r[l];l=(l+1)%i,P>0?p!==0&&u(l,p-1):f!==0&&u(l,f-1),P*P<t&&(P>0?f!==0&&u(l,f-1):p!==0&&u(l,p-1))}}return u(0,0),this.visited=h,this.labels[e]};var Hl=Ka(3),Gl=Ka(2);wt.prototype.kNearestNeighbors=function(r,t){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");if(r=Math.min(r,this.size),r===1)return[this.nearestNeighbor(t)];var e=new Ya(Array,Hl,r),i=this.dimensions,n=this.axes,o=this.pivots,s=this.lefts,a=this.rights,h=0;function u(p,f){var d=s[f],y=a[f],P=o[f],x=Qn(i,n,P,t);e.push([x,h++,P]);var T=t[p],R=n[p][P],G=T-R;p=(p+1)%i,T<R?d!==0&&u(p,d-1):y!==0&&u(p,y-1),(G*G<e.peek()[0]||e.size<r)&&(T<R?y!==0&&u(p,y-1):d!==0&&u(p,d-1))}u(0,0),this.visited=h;for(var l=e.consume(),c=0;c<l.length;c++)l[c]=this.labels[l[c][2]];return l};wt.prototype.linearKNearestNeighbors=function(r,t){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");r=Math.min(r,this.size);var e=new Ya(Array,Gl,r),i,n,o;for(i=0,n=this.size;i<n;i++)o=Qn(this.dimensions,this.axes,this.pivots[i],t),e.push([o,i]);var s=e.consume();for(i=0;i<s.length;i++)s[i]=this.labels[this.pivots[s[i][1]]];return s};wt.prototype.inspect=function(){var r=new Map;r.dimensions=this.dimensions,Object.defineProperty(r,"constructor",{value:wt,enumerable:!1});var t,e,i;for(t=0;t<this.size;t++){for(i=new Array(this.dimensions),e=0;e<this.dimensions;e++)i[e]=this.axes[e][t];r.set(this.labels[t],i)}return r};typeof Symbol!="undefined"&&(wt.prototype[Symbol.for("nodejs.util.inspect.custom")]=wt.prototype.inspect);wt.from=function(r,t){var e=Vl.toArray(r),i=Ul(t,e),n=Xa(t,i.axes,i.ids,i.labels);return new wt(t,n)};wt.fromAxes=function(r,t){t||(t=mi.indices(r[0].length));var e=r.length,i=Xa(r.length,r,mi.indices(t.length),t);return new wt(e,i)};Ja.exports=wt});var rh=v((Ay,eh)=>{var th=K(),Bl=M();function I(){this.clear()}I.prototype.clear=function(){this.head=null,this.tail=null,this.size=0};I.prototype.first=function(){return this.head?this.head.item:void 0};I.prototype.peek=I.prototype.first;I.prototype.last=function(){return this.tail?this.tail.item:void 0};I.prototype.push=function(r){var t={item:r,next:null};return this.head?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),this.size++,this.size};I.prototype.unshift=function(r){var t={item:r,next:null};return this.head?(this.head.next||(this.tail=this.head),t.next=this.head,this.head=t):(this.head=t,this.tail=t),this.size++,this.size};I.prototype.shift=function(){if(this.size){var r=this.head;return this.head=r.next,this.size--,r.item}};I.prototype.forEach=function(r,t){if(this.size){t=arguments.length>1?t:this;for(var e=this.head,i=0;e;)r.call(t,e.item,i,this),e=e.next,i++}};I.prototype.toArray=function(){if(!this.size)return[];for(var r=new Array(this.size),t=0,e=this.size,i=this.head;t<e;t++)r[t]=i.item,i=i.next;return r};I.prototype.values=function(){var r=this.head;return new th(function(){if(!r)return{done:!0};var t=r.item;return r=r.next,{value:t,done:!1}})};I.prototype.entries=function(){var r=this.head,t=0;return new th(function(){if(!r)return{done:!0};var e=r.item;return r=r.next,t++,{value:[t-1,e],done:!1}})};typeof Symbol!="undefined"&&(I.prototype[Symbol.iterator]=I.prototype.values);I.prototype.toString=function(){return this.toArray().join(",")};I.prototype.toJSON=function(){return this.toArray()};I.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:I,enumerable:!1}),r};typeof Symbol!="undefined"&&(I.prototype[Symbol.for("nodejs.util.inspect.custom")]=I.prototype.inspect);I.from=function(r){var t=new I;return Bl(r,function(e){t.push(e)}),t};eh.exports=I});var di=v((My,ih)=>{var Kn=K(),ql=M(),Wl=lt(),jl=gt();function H(r,t,e){if(arguments.length<2&&(e=r,r=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=Wl.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof r=="function"?new r(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items={}}H.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};H.prototype.splayOnTop=function(r){var t=this.head;if(this.head===r)return this;var e=this.backward[r],i=this.forward[r];return this.tail===r?this.tail=e:this.backward[i]=e,this.forward[e]=i,this.backward[t]=r,this.head=r,this.forward[r]=t,this};H.prototype.set=function(r,t){var e=this.items[r];if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};H.prototype.setpop=function(r,t){var e=null,i=null,n=this.items[r];return typeof n!="undefined"?(this.splayOnTop(n),e=this.V[n],this.V[n]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],e=this.V[n],i=this.K[n],delete this.items[this.K[n]]),this.items[r]=n,this.K[n]=r,this.V[n]=t,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:e}:null)};H.prototype.has=function(r){return r in this.items};H.prototype.get=function(r){var t=this.items[r];if(typeof t!="undefined")return this.splayOnTop(t),this.V[t]};H.prototype.peek=function(r){var t=this.items[r];if(typeof t!="undefined")return this.V[t]};H.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.size,n=this.head,o=this.K,s=this.V,a=this.forward;e<i;)r.call(t,s[n],o[n],this),n=a[n],e++};H.prototype.keys=function(){var r=0,t=this.size,e=this.head,i=this.K,n=this.forward;return new Kn(function(){if(r>=t)return{done:!0};var o=i[e];return r++,r<t&&(e=n[e]),{done:!1,value:o}})};H.prototype.values=function(){var r=0,t=this.size,e=this.head,i=this.V,n=this.forward;return new Kn(function(){if(r>=t)return{done:!0};var o=i[e];return r++,r<t&&(e=n[e]),{done:!1,value:o}})};H.prototype.entries=function(){var r=0,t=this.size,e=this.head,i=this.K,n=this.V,o=this.forward;return new Kn(function(){if(r>=t)return{done:!0};var s=i[e],a=n[e];return r++,r<t&&(e=o[e]),{done:!1,value:[s,a]}})};typeof Symbol!="undefined"&&(H.prototype[Symbol.iterator]=H.prototype.entries);H.prototype.inspect=function(){for(var r=new Map,t=this.entries(),e;e=t.next(),!e.done;)r.set(e.value[0],e.value[1]);return Object.defineProperty(r,"constructor",{value:H,enumerable:!1}),r};typeof Symbol!="undefined"&&(H.prototype[Symbol.for("nodejs.util.inspect.custom")]=H.prototype.inspect);H.from=function(r,t,e,i){if(arguments.length<2){if(i=jl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var n=new H(t,e,i);return ql(r,function(o,s){n.set(s,o)}),n};ih.exports=H});var oh=v((Dy,nh)=>{var Ve=di(),$l=M(),Ql=lt(),Kl=gt();function qt(r,t,e){arguments.length<2?Ve.call(this,r):Ve.call(this,r,t,e);var i=Ql.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(Yn in Ve.prototype)qt.prototype[Yn]=Ve.prototype[Yn];var Yn;typeof Symbol!="undefined"&&(qt.prototype[Symbol.iterator]=Ve.prototype[Symbol.iterator]);qt.prototype.clear=function(){Ve.prototype.clear.call(this),this.deletedSize=0};qt.prototype.set=function(r,t){var e=this.items[r];if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?(this.deletedSize>0?e=this.deleted[--this.deletedSize]:e=this.size,this.size++):(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};qt.prototype.setpop=function(r,t){var e=null,i=null,n=this.items[r];return typeof n!="undefined"?(this.splayOnTop(n),e=this.V[n],this.V[n]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?(this.deletedSize>0?n=this.deleted[--this.deletedSize]:n=this.size,this.size++):(n=this.tail,this.tail=this.backward[n],e=this.V[n],i=this.K[n],delete this.items[this.K[n]]),this.items[r]=n,this.K[n]=r,this.V[n]=t,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:e}:null)};qt.prototype.delete=function(r){var t=this.items[r];if(typeof t=="undefined")return!1;if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var e=this.backward[t],i=this.forward[t];return this.head===t&&(this.head=i),this.tail===t&&(this.tail=e),this.forward[e]=i,this.backward[i]=e,this.size--,this.deleted[this.deletedSize++]=t,!0};qt.prototype.remove=function(r,t=void 0){var e=this.items[r];if(typeof e=="undefined")return t;var i=this.V[e];if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var n=this.backward[e],o=this.forward[e];return this.head===e&&(this.head=o),this.tail===e&&(this.tail=n),this.forward[n]=o,this.backward[o]=n,this.size--,this.deleted[this.deletedSize++]=e,i};qt.from=function(r,t,e,i){if(arguments.length<2){if(i=Kl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var n=new qt(t,e,i);return $l(r,function(o,s){n.set(s,o)}),n};nh.exports=qt});var Xn=v((Iy,sh)=>{var Ne=di(),Yl=M(),Xl=lt(),Jl=gt();function et(r,t,e){if(arguments.length<2&&(e=r,r=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-map: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-map: capacity should be a finite positive integer.");var i=Xl.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof r=="function"?new r(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items=new Map}et.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items.clear()};et.prototype.set=function(r,t){var e=this.items.get(r);if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],this.items.delete(this.K[e])),this.items.set(r,e),this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};et.prototype.setpop=function(r,t){var e=null,i=null,n=this.items.get(r);return typeof n!="undefined"?(this.splayOnTop(n),e=this.V[n],this.V[n]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],e=this.V[n],i=this.K[n],this.items.delete(this.K[n])),this.items.set(r,n),this.K[n]=r,this.V[n]=t,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:e}:null)};et.prototype.has=function(r){return this.items.has(r)};et.prototype.get=function(r){var t=this.items.get(r);if(typeof t!="undefined")return this.splayOnTop(t),this.V[t]};et.prototype.peek=function(r){var t=this.items.get(r);if(typeof t!="undefined")return this.V[t]};et.prototype.splayOnTop=Ne.prototype.splayOnTop;et.prototype.forEach=Ne.prototype.forEach;et.prototype.keys=Ne.prototype.keys;et.prototype.values=Ne.prototype.values;et.prototype.entries=Ne.prototype.entries;typeof Symbol!="undefined"&&(et.prototype[Symbol.iterator]=et.prototype.entries);et.prototype.inspect=Ne.prototype.inspect;et.from=function(r,t,e,i){if(arguments.length<2){if(i=Jl.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var n=new et(t,e,i);return Yl(r,function(o,s){n.set(s,o)}),n};sh.exports=et});var hh=v((ky,ah)=>{var Ue=Xn(),Zl=M(),tc=lt(),ec=gt();function Wt(r,t,e){arguments.length<2?Ue.call(this,r):Ue.call(this,r,t,e);var i=tc.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(Jn in Ue.prototype)Wt.prototype[Jn]=Ue.prototype[Jn];var Jn;typeof Symbol!="undefined"&&(Wt.prototype[Symbol.iterator]=Ue.prototype[Symbol.iterator]);Wt.prototype.clear=function(){Ue.prototype.clear.call(this),this.deletedSize=0};Wt.prototype.set=function(r,t){var e=this.items.get(r);if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?(this.deletedSize>0?e=this.deleted[--this.deletedSize]:e=this.size,this.size++):(e=this.tail,this.tail=this.backward[e],this.items.delete(this.K[e])),this.items.set(r,e),this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};Wt.prototype.setpop=function(r,t){var e=null,i=null,n=this.items.get(r);return typeof n!="undefined"?(this.splayOnTop(n),e=this.V[n],this.V[n]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?(this.deletedSize>0?n=this.deleted[--this.deletedSize]:n=this.size,this.size++):(n=this.tail,this.tail=this.backward[n],e=this.V[n],i=this.K[n],this.items.delete(this.K[n])),this.items.set(r,n),this.K[n]=r,this.V[n]=t,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n,i?{evicted:!0,key:i,value:e}:null)};Wt.prototype.delete=function(r){var t=this.items.get(r);if(typeof t=="undefined")return!1;if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var e=this.backward[t],i=this.forward[t];return this.head===t&&(this.head=i),this.tail===t&&(this.tail=e),this.forward[e]=i,this.backward[i]=e,this.size--,this.deleted[this.deletedSize++]=t,!0};Wt.prototype.remove=function(r,t=void 0){var e=this.items.get(r);if(typeof e=="undefined")return t;var i=this.V[e];if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var n=this.backward[e],o=this.forward[e];return this.head===e&&(this.head=o),this.tail===e&&(this.tail=n),this.forward[n]=o,this.backward[o]=n,this.size--,this.deleted[this.deletedSize++]=e,i};Wt.from=function(r,t,e,i){if(arguments.length<2){if(i=ec.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-map.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var n=new Wt(t,e,i);return Zl(r,function(o,s){n.set(s,o)}),n};ah.exports=Wt});var lh=v((Fy,uh)=>{var rc=K(),ic=M(),nc=pi(),oc=function(r,t){return r[1]>t[1]?-1:r[1]<t[1]?1:0};function L(){this.items=new Map,Object.defineProperty(this.items,"constructor",{value:L,enumerable:!1}),this.clear()}L.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};L.prototype.add=function(r,t){if(t===0)return this;if(t<0)return this.remove(r,-t);if(t=t||1,typeof t!="number")throw new Error("mnemonist/multi-set.add: given count should be a number.");this.size+=t;let e=this.items.get(r);return e===void 0?this.dimension++:t+=e,this.items.set(r,t),this};L.prototype.set=function(r,t){var e;if(typeof t!="number")throw new Error("mnemonist/multi-set.set: given count should be a number.");return t<=0?(e=this.items.get(r),typeof e!="undefined"&&(this.size-=e,this.dimension--),this.items.delete(r),this):(t=t||1,e=this.items.get(r),typeof e=="number"?this.items.set(r,e+t):(this.dimension++,this.items.set(r,t)),this.size+=t,this)};L.prototype.has=function(r){return this.items.has(r)};L.prototype.delete=function(r){var t=this.items.get(r);return t===0?!1:(this.size-=t,this.dimension--,this.items.delete(r),!0)};L.prototype.remove=function(r,t){if(t!==0){if(t<0)return this.add(r,-t);if(t=t||1,typeof t!="number")throw new Error("mnemonist/multi-set.remove: given count should be a number.");var e=this.items.get(r);if(typeof e!="undefined"){var i=Math.max(0,e-t);i===0?(this.items.delete(r),this.size-=e,this.dimension--):(this.items.set(r,i),this.size-=t)}}};L.prototype.edit=function(r,t){var e=this.multiplicity(r);if(e!==0){var i=this.multiplicity(t);return this.items.set(t,e+i),this.items.delete(r),this}};L.prototype.multiplicity=function(r){var t=this.items.get(r);return typeof t=="undefined"?0:t};L.prototype.get=L.prototype.multiplicity;L.prototype.count=L.prototype.multiplicity;L.prototype.frequency=function(r){if(this.size===0)return 0;var t=this.multiplicity(r);return t/this.size};L.prototype.top=function(r){if(typeof r!="number"||r<=0)throw new Error("mnemonist/multi-set.top: n must be a number > 0.");for(var t=new nc(Array,oc,r),e=this.items.entries(),i;i=e.next(),!i.done;)t.push(i.value);return t.consume()};L.prototype.forEach=function(r,t){t=arguments.length>1?t:this;var e;this.items.forEach(function(i,n){for(e=0;e<i;e++)r.call(t,n,n)})};L.prototype.forEachMultiplicity=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};L.prototype.keys=function(){return this.items.keys()};L.prototype.values=function(){var r=this.items.entries(),t=!1,e,i,n,o;return new rc(function s(){if(!t){if(e=r.next(),e.done)return{done:!0};t=!0,i=e.value[0],n=e.value[1],o=0}return o>=n?(t=!1,s()):(o++,{done:!1,value:i})})};L.prototype.multiplicities=function(){return this.items.entries()};typeof Symbol!="undefined"&&(L.prototype[Symbol.iterator]=L.prototype.values);L.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(L.prototype[Symbol.for("nodejs.util.inspect.custom")]=L.prototype.inspect);L.prototype.toJSON=function(){return this.items};L.from=function(r){var t=new L;return ic(r,function(e){t.add(e)}),t};L.isSubset=function(r,t){var e=r.multiplicities(),i,n,o;if(r===t)return!0;if(r.dimension>t.dimension)return!1;for(;i=e.next(),!i.done;)if(n=i.value[0],o=i.value[1],t.multiplicity(n)<o)return!1;return!0};L.isSuperset=function(r,t){return L.isSubset(t,r)};uh.exports=L});var gh=v((Ry,dh)=>{var sc=K(),ac=M();function hc(r,t,e){return((Math.pow(r,2)-Math.pow(Math.abs(t-e),2))/2|0)+r+1}function uc(r,t){for(var e=0,i=0,n=t+1;i<n;i++)e+=hc(r,t,i);return e}function lc(r,t){return r.length>t.length?-1:r.length<t.length?1:r<t?-1:r>t?1:0}function ch(r,t){var e=r+1,i=t/e|0,n=i+1,o,s,a=t-i*e,h=e-a,u=new Array(r+1);for(o=0;o<h;o++)u[o]=[o*i,i];var l=(o-1)*i+i;for(s=0;s<a;s++)u[o+s]=[l+s*n,n];return u}function ph(r,t){var e=t.length,i=r+1,n=e/i|0,o=n+1,s,a,h,u=e-n*i,l=i-u,c=new Array(r+1);for(a=0;a<l;a++)s=a*n,c[a]=t.slice(s,s+n);var p=(a-1)*n+n;for(h=0;h<u;h++)s=p+h*o,c[a+h]=t.slice(s,s+o);return c}function cc(r,t,e){if(t===0)return 0;var i=e.length,n=r+1,o=i/n|0,s=o+1,a=i-o*n,h=n-a;if(t<=h-1)return t*o;var u=t-h;return h*o+u*s}function fh(r,t,e,i,n,o){var s=n-e,a=n+e,h=r-e,u=n+t-h,l=n+t+h,c=i-o;return[Math.max(0,s,u),Math.min(a,l,c)]}function mh(r,t,e,i,n,o){var s=t.length,a=s-e,h=fh(r,a,i,s,n,o),u=h[0],l=h[1],c="",p=[],f,d,y;for(d=u,y=l+1;d<y;d++)f=t.slice(d,d+o),f!==c&&(p.push(f),c=f);return p}function V(r,t){if(typeof r!="function")throw new Error("mnemonist/passjoin-index: `levenshtein` should be a function returning edit distance between two strings.");if(typeof t!="number"||t<1)throw new Error("mnemonist/passjoin-index: `k` should be a number > 0");this.levenshtein=r,this.k=t,this.clear()}V.prototype.clear=function(){this.size=0,this.strings=[],this.invertedIndices={}};V.prototype.add=function(r){var t=r.length,e=this.size;this.strings.push(r),this.size++;var i=ph(this.k,r),n=this.invertedIndices[t];typeof n=="undefined"&&(n={},this.invertedIndices[t]=n);var o,s,a,h,u;for(h=0,u=i.length;h<u;h++)o=i[h],a=o+h,s=n[a],typeof s=="undefined"?(s=[e],n[a]=s):s.push(e);return this};V.prototype.search=function(r){var t=r.length,e=this.k,i=new Set,n,o,s,a,h,u,l,c,p,f,d,y,P,x,T;for(c=Math.max(0,t-e),p=t+e+1;c<p;c++){var R=this.invertedIndices[c];if(typeof R!="undefined"){for(l=ch(e,c),f=0,d=l.length;f<d;f++)for(s=l[f][0],a=l[f][1],u=mh(e,r,c,f,s,a),u.length||(u=[""]),y=0,P=u.length;y<P;y++)if(h=u[y]+f,n=R[h],typeof n!="undefined")for(x=0,T=n.length;x<T;x++)o=this.strings[n[x]],(t<=e&&c<=e||!i.has(o)&&this.levenshtein(r,o)<=e)&&i.add(o)}}return i};V.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.strings.length;e<i;e++)r.call(t,this.strings[e],e,this)};V.prototype.values=function(){var r=this.strings,t=r.length,e=0;return new sc(function(){if(e>=t)return{done:!0};var i=r[e];return e++,{value:i,done:!1}})};typeof Symbol!="undefined"&&(V.prototype[Symbol.iterator]=V.prototype.values);V.prototype.inspect=function(){var r=this.strings.slice();return Object.defineProperty(r,"constructor",{value:V,enumerable:!1}),r};typeof Symbol!="undefined"&&(V.prototype[Symbol.for("nodejs.util.inspect.custom")]=V.prototype.inspect);V.from=function(r,t,e){var i=new V(t,e);return ac(r,function(n){i.add(n)}),i};V.countKeys=uc;V.comparator=lc;V.partition=ch;V.segments=ph;V.segmentPos=cc;V.multiMatchAwareInterval=fh;V.multiMatchAwareSubstrings=mh;dh.exports=V});var bh=v((_y,vh)=>{var yh=K(),pc=M();function N(){this.clear()}N.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};N.prototype.enqueue=function(r){return this.items.push(r),++this.size};N.prototype.dequeue=function(){if(this.size){var r=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,r}};N.prototype.peek=function(){if(this.size)return this.items[this.offset]};N.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.offset,i=0,n=this.items.length;e<n;e++,i++)r.call(t,this.items[e],i,this)};N.prototype.toArray=function(){return this.items.slice(this.offset)};N.prototype.values=function(){var r=this.items,t=this.offset;return new yh(function(){if(t>=r.length)return{done:!0};var e=r[t];return t++,{value:e,done:!1}})};N.prototype.entries=function(){var r=this.items,t=this.offset,e=0;return new yh(function(){if(t>=r.length)return{done:!0};var i=r[t];return t++,{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(N.prototype[Symbol.iterator]=N.prototype.values);N.prototype.toString=function(){return this.toArray().join(",")};N.prototype.toJSON=function(){return this.toArray()};N.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:N,enumerable:!1}),r};typeof Symbol!="undefined"&&(N.prototype[Symbol.for("nodejs.util.inspect.custom")]=N.prototype.inspect);N.from=function(r){var t=new N;return pc(r,function(e){t.enqueue(e)}),t};N.of=function(){return N.from(arguments)};vh.exports=N});var wh=v((zy,Th)=>{var Ph=K(),fc=M();function U(){this.clear()}U.prototype.clear=function(){this.items=[],this.size=0};U.prototype.push=function(r){return this.items.push(r),++this.size};U.prototype.pop=function(){if(this.size!==0)return this.size--,this.items.pop()};U.prototype.peek=function(){return this.items[this.size-1]};U.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.items.length;e<i;e++)r.call(t,this.items[i-e-1],e,this)};U.prototype.toArray=function(){for(var r=new Array(this.size),t=this.size-1,e=this.size;e--;)r[e]=this.items[t-e];return r};U.prototype.values=function(){var r=this.items,t=r.length,e=0;return new Ph(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return e++,{value:i,done:!1}})};U.prototype.entries=function(){var r=this.items,t=r.length,e=0;return new Ph(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(U.prototype[Symbol.iterator]=U.prototype.values);U.prototype.toString=function(){return this.toArray().join(",")};U.prototype.toJSON=function(){return this.toArray()};U.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:U,enumerable:!1}),r};typeof Symbol!="undefined"&&(U.prototype[Symbol.for("nodejs.util.inspect.custom")]=U.prototype.inspect);U.from=function(r){var t=new U;return fc(r,function(e){t.push(e)}),t};U.of=function(){return U.from(arguments)};Th.exports=U});var xh=v(j=>{j.intersection=function(){if(arguments.length<2)throw new Error("mnemonist/Set.intersection: needs at least two arguments.");var r=new Set,t=1/0,e=null,i,n,o=arguments.length;for(n=0;n<o;n++){if(i=arguments[n],i.size===0)return r;i.size<t&&(t=i.size,e=i)}for(var s=e.values(),a,h,u,l;a=s.next(),!a.done;){for(h=a.value,u=!0,n=0;n<o;n++)if(l=arguments[n],l!==e&&!l.has(h)){u=!1;break}u&&r.add(h)}return r};j.union=function(){if(arguments.length<2)throw new Error("mnemonist/Set.union: needs at least two arguments.");var r=new Set,t,e=arguments.length,i,n;for(t=0;t<e;t++)for(i=arguments[t].values();n=i.next(),!n.done;)r.add(n.value);return r};j.difference=function(r,t){if(!r.size)return new Set;if(!t.size)return new Set(r);for(var e=new Set,i=r.values(),n;n=i.next(),!n.done;)t.has(n.value)||e.add(n.value);return e};j.symmetricDifference=function(r,t){for(var e=new Set,i=r.values(),n;n=i.next(),!n.done;)t.has(n.value)||e.add(n.value);for(i=t.values();n=i.next(),!n.done;)r.has(n.value)||e.add(n.value);return e};j.isSubset=function(r,t){var e=r.values(),i;if(r===t)return!0;if(r.size>t.size)return!1;for(;i=e.next(),!i.done;)if(!t.has(i.value))return!1;return!0};j.isSuperset=function(r,t){return j.isSubset(t,r)};j.add=function(r,t){for(var e=t.values(),i;i=e.next(),!i.done;)r.add(i.value)};j.subtract=function(r,t){for(var e=t.values(),i;i=e.next(),!i.done;)r.delete(i.value)};j.intersect=function(r,t){for(var e=r.values(),i;i=e.next(),!i.done;)t.has(i.value)||r.delete(i.value)};j.disjunct=function(r,t){for(var e=r.values(),i,n=[];i=e.next(),!i.done;)t.has(i.value)&&n.push(i.value);for(e=t.values();i=e.next(),!i.done;)r.has(i.value)||r.add(i.value);for(var o=0,s=n.length;o<s;o++)r.delete(n[o])};j.intersectionSize=function(r,t){var e;if(r.size>t.size&&(e=r,r=t,t=e),r.size===0)return 0;if(r===t)return r.size;for(var i=r.values(),n,o=0;n=i.next(),!n.done;)t.has(n.value)&&o++;return o};j.unionSize=function(r,t){var e=j.intersectionSize(r,t);return r.size+t.size-e};j.jaccard=function(r,t){var e=j.intersectionSize(r,t);if(e===0)return 0;var i=r.size+t.size-e;return e/i};j.overlap=function(r,t){var e=j.intersectionSize(r,t);return e===0?0:e/Math.min(r.size,t.size)}});var Ch=v((Ny,Sh)=>{var mc=K(),dc=lt().getPointerArray;function bt(r){var t=dc(r);this.start=0,this.size=0,this.capacity=r,this.dense=new t(r),this.sparse=new t(r)}bt.prototype.clear=function(){this.start=0,this.size=0};bt.prototype.has=function(r){if(this.size===0)return!1;var t=this.sparse[r],e=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;return e&&this.dense[t]===r};bt.prototype.enqueue=function(r){var t=this.sparse[r];if(this.size!==0){var e=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;if(e&&this.dense[t]===r)return this}return t=(this.start+this.size)%this.capacity,this.dense[t]=r,this.sparse[r]=t,this.size++,this};bt.prototype.dequeue=function(){if(this.size!==0){var r=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var t=this.dense[r];return this.sparse[t]=this.capacity,t}};bt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.capacity,i=this.size,n=this.start,o=0;o<i;)r.call(t,this.dense[n],o,this),n++,o++,n===e&&(n=0)};bt.prototype.values=function(){var r=this.dense,t=this.capacity,e=this.size,i=this.start,n=0;return new mc(function(){if(n>=e)return{done:!0};var o=r[i];return i++,n++,i===t&&(i=0),{value:o,done:!1}})};typeof Symbol!="undefined"&&(bt.prototype[Symbol.iterator]=bt.prototype.values);bt.prototype.inspect=function(){var r=[];return this.forEach(function(t){r.push(t)}),Object.defineProperty(r,"constructor",{value:bt,enumerable:!1}),r.capacity=this.capacity,r};typeof Symbol!="undefined"&&(bt.prototype[Symbol.for("nodejs.util.inspect.custom")]=bt.prototype.inspect);Sh.exports=bt});var Eh=v((Uy,Lh)=>{var Zn=K(),gc=lt().getPointerArray;function at(r,t){arguments.length<2&&(t=r,r=Array);var e=gc(t);this.size=0,this.length=t,this.dense=new e(t),this.sparse=new e(t),this.vals=new r(t)}at.prototype.clear=function(){this.size=0};at.prototype.has=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r};at.prototype.get=function(r){var t=this.sparse[r];if(t<this.size&&this.dense[t]===r)return this.vals[t]};at.prototype.set=function(r,t){var e=this.sparse[r];return e<this.size&&this.dense[e]===r?(this.vals[e]=t,this):(this.dense[this.size]=r,this.sparse[r]=this.size,this.vals[this.size]=t,this.size++,this)};at.prototype.delete=function(r){var t=this.sparse[r];return t>=this.size||this.dense[t]!==r?!1:(t=this.dense[this.size-1],this.dense[this.sparse[r]]=t,this.sparse[t]=this.sparse[r],this.size--,!0)};at.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0;e<this.size;e++)r.call(t,this.vals[e],this.dense[e])};at.prototype.keys=function(){var r=this.size,t=this.dense,e=0;return new Zn(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};at.prototype.values=function(){var r=this.size,t=this.vals,e=0;return new Zn(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};at.prototype.entries=function(){var r=this.size,t=this.dense,e=this.vals,i=0;return new Zn(function(){if(i<r){var n=[t[i],e[i]];return i++,{value:n}}return{done:!0}})};typeof Symbol!="undefined"&&(at.prototype[Symbol.iterator]=at.prototype.entries);at.prototype.inspect=function(){for(var r=new Map,t=0;t<this.size;t++)r.set(this.dense[t],this.vals[t]);return Object.defineProperty(r,"constructor",{value:at,enumerable:!1}),r.length=this.length,this.vals.constructor!==Array&&(r.type=this.vals.constructor.name),r};typeof Symbol!="undefined"&&(at.prototype[Symbol.for("nodejs.util.inspect.custom")]=at.prototype.inspect);Lh.exports=at});var Ah=v((Hy,Oh)=>{var yc=K(),vc=lt().getPointerArray;function Pt(r){var t=vc(r);this.size=0,this.length=r,this.dense=new t(r),this.sparse=new t(r)}Pt.prototype.clear=function(){this.size=0};Pt.prototype.has=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r};Pt.prototype.add=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r?this:(this.dense[this.size]=r,this.sparse[r]=this.size,this.size++,this)};Pt.prototype.delete=function(r){var t=this.sparse[r];return t>=this.size||this.dense[t]!==r?!1:(t=this.dense[this.size-1],this.dense[this.sparse[r]]=t,this.sparse[t]=this.sparse[r],this.size--,!0)};Pt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e,i=0;i<this.size;i++)e=this.dense[i],r.call(t,e,e)};Pt.prototype.values=function(){var r=this.size,t=this.dense,e=0;return new yc(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};typeof Symbol!="undefined"&&(Pt.prototype[Symbol.iterator]=Pt.prototype.values);Pt.prototype.inspect=function(){for(var r=new Set,t=0;t<this.size;t++)r.add(this.dense[t]);return Object.defineProperty(r,"constructor",{value:Pt,enumerable:!1}),r.length=this.length,r};typeof Symbol!="undefined"&&(Pt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Pt.prototype.inspect);Oh.exports=Pt});var Fh=v((Gy,kh)=>{var bc=M(),Pc=2,Tc=2,wc=new Set([0,1,2]),xc={0:"Returns only the top suggestion",1:"Returns suggestions with the smallest edit distance",2:"Returns every suggestion (no early termination)"};function gi(r){var t=new Set;return typeof r=="number"&&t.add(r),{suggestions:t,count:0}}function Mh(r,t,e){return{term:r||"",distance:t||0,count:e||0}}function Ih(r,t,e,i){i=i||new Set,t++;var n,o=r.length,s;if(o>1)for(s=0;s<o;s++)n=r.substring(0,s)+r.substring(s+1),i.has(n)||(i.add(n),t<e&&Ih(n,t,e,i));return i}function Sc(r,t,e,i,n,o){var s=e.suggestions.values().next().value;t<2&&e.suggestions.size>0&&r[s].length-o.length>i.length-o.length&&(e.suggestions=new Set,e.count=0),(t===2||!e.suggestions.size||r[s].length-o.length>=i.length-o.length)&&e.suggestions.add(n)}function Dh(r,t){var e=r.length,i=t.length,n=[[]],o=e+i,s=new Map,a,h,u;for(n[0][0]=o,a=0;a<=e;a++)n[a+1]||(n[a+1]=[]),n[a+1][1]=a,n[a+1][0]=o;for(u=0;u<=i;u++)n[1][u+1]=u,n[0][u+1]=o;var l=r+t,c;for(a=0,h=l.length;a<h;a++)c=l[a],s.has(c)||s.set(c,0);for(a=1;a<=e;a++){var p=0;for(u=1;u<=i;u++){var f=s.get(t[u-1]),d=p;r[a-1]===t[u-1]?(n[a+1][u+1]=n[a][u],p=u):n[a+1][u+1]=Math.min(n[a][u],n[a+1][u],n[a][u+1])+1,n[a+1][u+1]=Math.min(n[a+1][u+1],n[f][d]+(a-f-1)+1+(u-d-1))}s.set(r[a-1],a)}return n[e+1][i+1]}function Cc(r,t,e,i,n,o){var s=o.length;if(s-i>n)return[];for(var a=[o],h=new Set,u=new Set,l=[],c,p;a.length>0&&(c=a.shift(),!(e<2&&l.length>0&&s-c.length>l[0].distance));){if(p=r[c],p!==void 0){if(typeof p=="number"&&(p=gi(p)),p.count>0&&!u.has(c)){u.add(c);var f=Mh(c,s-c.length,p.count);if(l.push(f),e<2&&s-c.length===0)break}p.suggestions.forEach(x=>{var T=t[x];if(!u.has(T)){u.add(T);var R=0;if(o!==T)if(T.length===c.length)R=s-c.length;else if(s===c.length)R=T.length-c.length;else{for(var G=0,te=0,mr=T.length;G<mr&&G<s&&T[G]===o[G];)G++;for(;te<mr-G&&te<s&&T[mr-te-1]===o[s-te-1];)te++;G>0||te>0?R=Dh(T.substr(G,mr-G-te),o.substr(G,s-G-te)):R=Dh(T,o)}if(e<2&&l.length>0&&l[0].distance>R&&(l=[]),!(e<2&&l.length>0&&R>l[0].distance)&&R<=i){var Po=r[T];Po!==void 0&&l.push(Mh(T,R,Po.count))}}})}if(s-c.length<i){if(e<2&&l.length>0&&s-c.length>=l[0].distance)continue;for(var d=0,y=c.length;d<y;d++){var P=c.substring(0,d)+c.substring(d+1);h.has(P)||(h.add(P),a.push(P))}}}return e===0?l.slice(0,1):l}function jt(r){if(r=r||{},this.clear(),this.maxDistance=typeof r.maxDistance=="number"?r.maxDistance:Pc,this.verbosity=typeof r.verbosity=="number"?r.verbosity:Tc,typeof this.maxDistance!="number"||this.maxDistance<=0)throw Error("mnemonist/SymSpell.constructor: invalid `maxDistance` option. Should be a integer greater than 0.");if(!wc.has(this.verbosity))throw Error("mnemonist/SymSpell.constructor: invalid `verbosity` option. Should be either 0, 1 or 2.")}jt.prototype.clear=function(){this.size=0,this.dictionary=Object.create(null),this.maxLength=0,this.words=[]};jt.prototype.add=function(r){var t=this.dictionary[r];if(t!==void 0?(typeof t=="number"&&(t=gi(t),this.dictionary[r]=t),t.count++):(t=gi(),t.count++,this.dictionary[r]=t,r.length>this.maxLength&&(this.maxLength=r.length)),t.count===1){var e=this.words.length;this.words.push(r);var i=Ih(r,0,this.maxDistance);i.forEach(n=>{var o=this.dictionary[n];o!==void 0?(typeof o=="number"&&(o=gi(o),this.dictionary[n]=o),o.suggestions.has(e)||Sc(this.words,this.verbosity,o,r,e,n)):this.dictionary[n]=e})}return this.size++,this};jt.prototype.search=function(r){return Cc(this.dictionary,this.words,this.verbosity,this.maxDistance,this.maxLength,r)};jt.prototype.inspect=function(){var r=[];r.size=this.size,r.maxDistance=this.maxDistance,r.verbosity=this.verbosity,r.behavior=xc[this.verbosity];for(var t in this.dictionary)typeof this.dictionary[t]=="object"&&this.dictionary[t].count&&r.push([t,this.dictionary[t].count]);return Object.defineProperty(r,"constructor",{value:jt,enumerable:!1}),r};typeof Symbol!="undefined"&&(jt.prototype[Symbol.for("nodejs.util.inspect.custom")]=jt.prototype.inspect);jt.from=function(r,t){var e=new jt(t);return bc(r,function(i){e.add(i)}),e};kh.exports=jt});var to=v((By,Rh)=>{var Lc=M(),He=K(),X=String.fromCharCode(0);function k(r){this.mode=r===Array?"array":"string",this.clear()}k.prototype.clear=function(){this.root={},this.size=0};k.prototype.set=function(r,t){for(var e=this.root,i,n=0,o=r.length;n<o;n++)i=r[n],e=e[i]||(e[i]={});return X in e||this.size++,e[X]=t,this};k.prototype.update=function(r,t){for(var e=this.root,i,n=0,o=r.length;n<o;n++)i=r[n],e=e[i]||(e[i]={});return X in e||this.size++,e[X]=t(e[X]),this};k.prototype.get=function(r){var t=this.root,e,i,n;for(i=0,n=r.length;i<n;i++)if(e=r[i],t=t[e],typeof t=="undefined")return;if(X in t)return t[X]};k.prototype.delete=function(r){var t=this.root,e=null,i=null,n,o,s,a;for(s=0,a=r.length;s<a;s++){if(o=r[s],n=t,t=t[o],typeof t=="undefined")return!1;e!==null?Object.keys(t).length>1&&(e=null,i=null):Object.keys(t).length<2&&(e=n,i=o)}return X in t?(this.size--,e?delete e[i]:delete t[X],!0):!1};k.prototype.has=function(r){for(var t=this.root,e,i=0,n=r.length;i<n;i++)if(e=r[i],t=t[e],typeof t=="undefined")return!1;return X in t};k.prototype.find=function(r){var t=typeof r=="string",e=this.root,i=[],n,o,s;for(o=0,s=r.length;o<s;o++)if(n=r[o],e=e[n],typeof e=="undefined")return i;for(var a=[e],h=[r],u;a.length;){r=h.pop(),e=a.pop();for(u in e){if(u===X){i.push([r,e[X]]);continue}a.push(e[u]),h.push(t?r+u:r.concat(u))}}return i};k.prototype.values=function(r){var t=this.root,e=[],i,n,o;if(r){for(n=0,o=r.length;n<o;n++)if(i=r[n],t=t[i],typeof t=="undefined")return He.empty()}return e.push(t),new He(function(){for(var s,a=!1,h;e.length;){s=e.pop();for(h in s){if(h===X){a=!0;continue}e.push(s[h])}if(a)return{done:!1,value:s[X]}}return{done:!0}})};k.prototype.prefixes=function(r){var t=this.root,e=[],i=[],n,o,s,a=this.mode==="string";if(r){for(o=0,s=r.length;o<s;o++)if(n=r[o],t=t[n],typeof t=="undefined")return He.empty()}else r=a?"":[];return e.push(t),i.push(r),new He(function(){for(var h,u,l=!1,c;e.length;){h=e.pop(),u=i.pop();for(c in h){if(c===X){l=!0;continue}e.push(h[c]),i.push(a?u+c:u.concat(c))}if(l)return{done:!1,value:u}}return{done:!0}})};k.prototype.keys=k.prototype.prefixes;k.prototype.entries=function(r){var t=this.root,e=[],i=[],n,o,s,a=this.mode==="string";if(r){for(o=0,s=r.length;o<s;o++)if(n=r[o],t=t[n],typeof t=="undefined")return He.empty()}else r=a?"":[];return e.push(t),i.push(r),new He(function(){for(var h,u,l=!1,c;e.length;){h=e.pop(),u=i.pop();for(c in h){if(c===X){l=!0;continue}e.push(h[c]),i.push(a?u+c:u.concat(c))}if(l)return{done:!1,value:[u,h[X]]}}return{done:!0}})};typeof Symbol!="undefined"&&(k.prototype[Symbol.iterator]=k.prototype.entries);k.prototype.inspect=function(){for(var r=new Array(this.size),t=this.entries(),e,i=0;e=t.next(),!e.done;)r[i++]=e.value;return Object.defineProperty(r,"constructor",{value:k,enumerable:!1}),r};typeof Symbol!="undefined"&&(k.prototype[Symbol.for("nodejs.util.inspect.custom")]=k.prototype.inspect);k.prototype.toJSON=function(){return this.root};k.from=function(r){var t=new k;return Lc(r,function(e,i){t.set(i,e)}),t};k.SENTINEL=X;Rh.exports=k});var Vh=v((qy,zh)=>{var Ec=M(),_h=to(),yi=String.fromCharCode(0);function J(r){this.mode=r===Array?"array":"string",this.clear()}for(eo in _h.prototype)J.prototype[eo]=_h.prototype[eo];var eo;delete J.prototype.set;delete J.prototype.get;delete J.prototype.values;delete J.prototype.entries;J.prototype.add=function(r){for(var t=this.root,e,i=0,n=r.length;i<n;i++)e=r[i],t=t[e]||(t[e]={});return yi in t||this.size++,t[yi]=!0,this};J.prototype.find=function(r){var t=typeof r=="string",e=this.root,i=[],n,o,s;for(o=0,s=r.length;o<s;o++)if(n=r[o],e=e[n],typeof e=="undefined")return i;for(var a=[e],h=[r],u;a.length;){r=h.pop(),e=a.pop();for(u in e){if(u===yi){i.push(r);continue}a.push(e[u]),h.push(t?r+u:r.concat(u))}}return i};typeof Symbol!="undefined"&&(J.prototype[Symbol.iterator]=J.prototype.keys);J.prototype.inspect=function(){for(var r=new Set,t=this.keys(),e;e=t.next(),!e.done;)r.add(e.value);return Object.defineProperty(r,"constructor",{value:J,enumerable:!1}),r};typeof Symbol!="undefined"&&(J.prototype[Symbol.for("nodejs.util.inspect.custom")]=J.prototype.inspect);J.prototype.toJSON=function(){return this.root};J.from=function(r){var t=new J;return Ec(r,function(e){t.add(e)}),t};J.SENTINEL=yi;zh.exports=J});var Gh=v((Wy,Hh)=>{var Nh=K(),Oc=M(),Ac=gt(),Uh=lt(),Mc=function(r){return Math.max(1,Math.ceil(r*1.5))},Dc=function(r){var t=Uh.getPointerArray(r);return new t(r)};function S(r,t){if(arguments.length<1)throw new Error("mnemonist/vector: expecting at least a byte array constructor.");var e=t||0,i=Mc,n=0,o=!1;typeof t=="object"&&(e=t.initialCapacity||0,n=t.initialLength||0,i=t.policy||i,o=t.factory===!0),this.factory=o?r:null,this.ArrayClass=r,this.length=n,this.capacity=Math.max(n,e),this.policy=i,this.array=new r(this.capacity)}S.prototype.set=function(r,t){if(this.length<r)throw new Error("Vector("+this.ArrayClass.name+").set: index out of bounds.");return this.array[r]=t,this};S.prototype.get=function(r){if(!(this.length<r))return this.array[r]};S.prototype.applyPolicy=function(r){var t=this.policy(r||this.capacity);if(typeof t!="number"||t<0)throw new Error("mnemonist/vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(t<=this.capacity)throw new Error("mnemonist/vector.applyPolicy: policy returned a less or equal capacity to allocate.");return t};S.prototype.reallocate=function(r){if(r===this.capacity)return this;var t=this.array;if(r<this.length&&(this.length=r),r>this.capacity)if(this.factory===null?this.array=new this.ArrayClass(r):this.array=this.factory(r),Uh.isTypedArray(this.array))this.array.set(t,0);else for(var e=0,i=this.length;e<i;e++)this.array[e]=t[e];else this.array=t.slice(0,r);return this.capacity=r,this};S.prototype.grow=function(r){var t;if(typeof r=="number"){if(this.capacity>=r)return this;for(t=this.capacity;t<r;)t=this.applyPolicy(t);return this.reallocate(t),this}return t=this.applyPolicy(),this.reallocate(t),this};S.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};S.prototype.push=function(r){return this.capacity===this.length&&this.grow(),this.array[this.length++]=r,this.length};S.prototype.pop=function(){if(this.length!==0)return this.array[--this.length]};S.prototype.values=function(){var r=this.array,t=this.length,e=0;return new Nh(function(){if(e>=t)return{done:!0};var i=r[e];return e++,{value:i,done:!1}})};S.prototype.entries=function(){var r=this.array,t=this.length,e=0;return new Nh(function(){if(e>=t)return{done:!0};var i=r[e];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(S.prototype[Symbol.iterator]=S.prototype.values);S.prototype.inspect=function(){var r=this.array.slice(0,this.length);return r.type=this.array.constructor.name,r.items=this.length,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:S,enumerable:!1}),r};typeof Symbol!="undefined"&&(S.prototype[Symbol.for("nodejs.util.inspect.custom")]=S.prototype.inspect);S.from=function(r,t,e){if(arguments.length<3&&(e=Ac.guessLength(r),typeof e!="number"))throw new Error("mnemonist/vector.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new S(t,e);return Oc(r,function(n){i.push(n)}),i};function $t(r){var t=function(i){S.call(this,r,i)};for(var e in S.prototype)S.prototype.hasOwnProperty(e)&&(t.prototype[e]=S.prototype[e]);return t.from=function(i,n){return S.from(i,r,n)},typeof Symbol!="undefined"&&(t.prototype[Symbol.iterator]=t.prototype.values),t}S.Int8Vector=$t(Int8Array);S.Uint8Vector=$t(Uint8Array);S.Uint8ClampedVector=$t(Uint8ClampedArray);S.Int16Vector=$t(Int16Array);S.Uint16Vector=$t(Uint16Array);S.Int32Vector=$t(Int32Array);S.Uint32Vector=$t(Uint32Array);S.Float32Vector=$t(Float32Array);S.Float64Vector=$t(Float64Array);S.PointerVector=$t(Dc);Hh.exports=S});var qh=v((jy,Bh)=>{var Ic=gt(),kc=lt(),Fc=$n().inplaceQuickSortIndices,Rc=Wn().lowerBoundIndices,_c=ci(),zc=kc.getPointerArray;function Vc(r,t){return r.distance<t.distance?1:r.distance>t.distance?-1:0}function Nc(r,t,e){for(var i=e.length,n=zc(i),o=0,s=new n(i),a=new n(i),h=new n(i),u=new Float64Array(i),l=[0,0,i],c=new Float64Array(i),p,f,d,y,P,x,T,R,G;l.length;)if(P=l.pop(),y=l.pop(),p=l.pop(),f=e[P-1],P--,G=P-y,s[p]=f,G!==0){if(G===1){T=r(t[f],t[e[y]]),u[p]=T,o++,h[p]=o,s[o]=e[y];continue}for(R=y;R<P;R++)c[e[R]]=r(t[f],t[e[R]]);Fc(c,e,y,P),d=y+G/2-1,d===(d|0)?T=(c[e[d]]+c[e[d+1]])/2:T=c[e[Math.ceil(d)]],u[p]=T,x=Rc(c,e,T,y,P),P-x>0&&(o++,h[p]=o,l.push(o,x,P)),x-y>0&&(o++,a[p]=o,l.push(o,y,x))}return{nodes:s,lefts:a,rights:h,mus:u}}function Zt(r,t){if(typeof r!="function")throw new Error("mnemonist/VPTree.constructor: given `distance` must be a function.");if(!t)throw new Error("mnemonist/VPTree.constructor: you must provide items to the tree. A VPTree cannot be updated after its creation.");this.distance=r,this.heap=new _c(Vc),this.D=0;var e=Ic.toArrayWithIndices(t);this.items=e[0];var i=e[1];this.size=i.length;var n=Nc(r,this.items,i);this.nodes=n.nodes,this.lefts=n.lefts,this.rights=n.rights,this.mus=n.mus}Zt.prototype.nearestNeighbors=function(r,t){var e=this.heap,i=[0],n=1/0,o,s,a,h,u,l,c;for(this.D=0;i.length;)o=i.pop(),s=this.nodes[o],a=this.items[s],c=this.distance(a,t),this.D++,c<n&&(e.push({distance:c,item:a}),e.size>r&&e.pop(),e.size>=r&&(n=e.peek().distance)),h=this.lefts[o],u=this.rights[o],!(!h&&!u)&&(l=this.mus[o],c<l?(h&&c<l+n&&i.push(h),u&&c>=l-n&&i.push(u)):(u&&c>=l-n&&i.push(u),h&&c<l+n&&i.push(h)));for(var p=new Array(e.size),f=e.size-1;f>=0;f--)p[f]=e.pop();return p};Zt.prototype.neighbors=function(r,t){var e=[],i=[0],n,o,s,a,h,u,l;for(this.D=0;i.length;)n=i.pop(),o=this.nodes[n],s=this.items[o],l=this.distance(s,t),this.D++,l<=r&&e.push({distance:l,item:s}),a=this.lefts[n],h=this.rights[n],!(!a&&!h)&&(u=this.mus[n],l<u?(a&&l<u+r&&i.push(a),h&&l>=u-r&&i.push(h)):(h&&l>=u-r&&i.push(h),a&&l<u+r&&i.push(a)));return e};Zt.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:Zt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Zt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Zt.prototype.inspect);Zt.from=function(r,t){return new Zt(t,r)};Bh.exports=Zt});var $h=v(($y,jh)=>{var ro=ci(),io=ri(),Wh=Bs();jh.exports={BiMap:Qs(),BitSet:ea(),BitVector:oa(),BloomFilter:ca(),BKTree:fa(),CircularBuffer:va(),DefaultMap:Pa(),DefaultWeakMap:wa(),FixedDeque:_n(),StaticDisjointSet:Sa(),FibonacciHeap:io,MinFibonacciHeap:io.MinFibonacciHeap,MaxFibonacciHeap:io.MaxFibonacciHeap,FixedReverseHeap:pi(),FuzzyMap:Ma(),FuzzyMultiMap:Fa(),HashedArrayTree:za(),Heap:ro,MinHeap:ro.MinHeap,MaxHeap:ro.MaxHeap,StaticIntervalTree:Ha(),InvertedIndex:Qa(),KDTree:Za(),LinkedList:rh(),LRUCache:di(),LRUCacheWithDelete:oh(),LRUMap:Xn(),LRUMapWithDelete:hh(),MultiMap:Hn(),MultiSet:lh(),PassjoinIndex:gh(),Queue:bh(),FixedStack:Bn(),Stack:wh(),SuffixArray:Wh,GeneralizedSuffixArray:Wh.GeneralizedSuffixArray,Set:xh(),SparseQueueSet:Ch(),SparseMap:Eh(),SparseSet:Ah(),SymSpell:Fh(),Trie:Vh(),TrieMap:to(),Vector:Gh(),VPTree:qh()}});function ur(r,t){var e;return(e=r.get(b.toString(t)))!=null?e:Number.MAX_VALUE}function Uc(){let r=["right","down-right","down","down-left","left","up-left","up","up-right"],t=new Map;for(let e=0;e<r.length;e++){let i=new Map,n=r[e];i.set(0,n);for(let o=1;o<=7;o++)n=gr(n),i.set(o,n);t.set(r[e],i)}return t}var no,Ge,oo=m(()=>{be();no=So($h());$();rt();Dt();ve();Xt();Ge=class extends _t{constructor(e,i={}){super(e,i);this.openSet=new no.MinFibonacciHeap;this.g=new Map;this.f=new Map;this.closestToTarget={position:new g(0,0),layer:void 0};this.smallestDistToTarget=0;this.steps=0;this.maxFrontierSize=0;this.maxJumpSize=0;this.turnOrder={right:0,"down-right":1,down:2,"down-left":3,left:4,"up-left":5,up:6,"up-right":7};this.turnTimes=Uc();this.distanceUtils=ht.create(4)}findShortestPathImpl(e,i){this.maxJumpSize=this.distance(e.position,i.position);let n=this.shortestPath(e,i);return{path:this.returnPath(n.previous,e,i),closestToTarget:n.closestToTarget,steps:n.steps,maxPathLengthReached:n.maxPathLengthReached,algorithmUsed:"JPS"}}shortestPath(e,i){this.steps=0;let n=new Map;this.g=new Map,this.f=new Map,this.closestToTarget=e,this.smallestDistToTarget=this.distance(e.position,i.position),this.openSet=new no.MinFibonacciHeap((s,a)=>ur(this.f,s)-ur(this.f,a)),this.openSet.push(e);let o=b.toString(e);for(this.g.set(o,0),this.f.set(o,this.distance(e.position,i.position)),this.maxFrontierSize=Math.max(this.maxFrontierSize,this.openSet.size);this.openSet.size>0;){let s=this.openSet.pop();if(!s)break;if(this.steps++,b.equal(s,i))return{previous:n,closestToTarget:i,steps:this.steps,maxPathLengthReached:!1};if(ur(this.g,s)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!0};this.updateClosestToTarget(s,i);for(let a of this.getNeighborsInternal(s,n.get(b.toString(s)),i)){let h=b.toString(a.p),u=ur(this.g,s)+a.dist;(!this.g.has(h)||u<ur(this.g,a.p))&&(n.set(h,s),this.g.set(h,u),this.f.set(h,u+this.distance(a.p.position,i.position)),this.openSet.push(a.p))}}return{previous:n,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!1}}updateClosestToTarget(e,i){let n=this.distance(e.position,i.position);n<this.smallestDistToTarget&&(this.smallestDistToTarget=n,this.closestToTarget=e)}getNeighborsInternal(e,i,n){if(!i||e.layer!==i.layer)return this.getNeighbors(e,n).map(a=>({p:a,dist:1}));let o=this.prune(i,e).map(a=>{let h=this.getTransition(a.position,e.layer);return{position:a.position,layer:h||e.layer}}),s=[];for(let a of o){let h=this.jump(e,a,n,1);h&&s.push(h)}return s}jump(e,i,n,o){let s=this.distanceUtils.direction(e.position,i.position);if(!(this.isBlocking(e,i)&&!(b.equal(i,n)&&this.options.ignoreBlockedTarget)))return b.equal(i,n)?{p:i,dist:o}:o>=this.maxJumpSize?{p:i,dist:o}:this.getTransition(i.position,e.layer)!==void 0?{p:i,dist:o}:Ui(s)?{p:i,dist:o}:this.getForced(e,i).length>0?{p:i,dist:o}:(this.updateClosestToTarget(i,n),this.jump(i,this.getTilePosInDir(i,it(e.position,i.position)),n,o+1))}getForced(e,i){let n=[],o=this.posInDir(i,this.distanceUtils.direction(i.position,e.position)),{topLeft:s,downLeft:a,top:h,bottom:u}=this.normalizedPositions(o,i),l=(p,f)=>this.isBlocking(p,f)||this.getTransition(f.position,f.layer)!==void 0,c=this.distanceUtils.direction(e.position,i.position);return Co(c)&&((l(o,a)||l(a,u))&&!this.isBlocking(i,u)&&n.push(u),(l(o,s)||l(s,h))&&!this.isBlocking(i,h)&&n.push(h)),n}prune(e,i){let{right:n,top:o,bottom:s}=this.normalizedPositions(e,i),a=this.getForced(e,i),h=it(e.position,i.position);return Ui(h)?[n,o,s]:[n,...a]}normalizedPositions(e,i){var o,s,a,h,u,l,c;let n=it(e.position,i.position);return{topLeft:this.posInDir(i,((o=this.turnTimes.get("up-left"))==null?void 0:o.get(this.turnOrder[n]))||"up-left"),downLeft:this.posInDir(i,((s=this.turnTimes.get("down-left"))==null?void 0:s.get(this.turnOrder[n]))||"down-left"),downRight:this.posInDir(i,((a=this.turnTimes.get("down-right"))==null?void 0:a.get(this.turnOrder[n]))||"down-right"),topRight:this.posInDir(i,((h=this.turnTimes.get("up-right"))==null?void 0:h.get(this.turnOrder[n]))||"up-right"),top:this.posInDir(i,((u=this.turnTimes.get("up"))==null?void 0:u.get(this.turnOrder[n]))||"up"),bottom:this.posInDir(i,((l=this.turnTimes.get("down"))==null?void 0:l.get(this.turnOrder[n]))||"down"),right:this.posInDir(i,((c=this.turnTimes.get("right"))==null?void 0:c.get(this.turnOrder[n]))||"right")}}posInDir(e,i){return{position:e.position.add(St(i)),layer:e.layer}}returnPath(e,i,n){let o=[],s=n;for(o.push(s);!b.equal(s,i);){let a=e.get(b.toString(s));if(!a)return[];this.distance(a.position,s.position)>1?this.fillPath(s,a,o):o.push(a),s=a}return o.reverse()}fillPath(e,i,n){let o=e;do{let s=it(o.position,i.position);o=this.getTilePosInDir(o,s),n.push(o)}while(!_.equal(o.position,i.position))}}});var vi,Qh=m(()=>{Me();bi();rt();er();vi=class{constructor(t,e,i,n={}){this.character=t;this.gridTilemap=e;this.charToFollow=i;let o={distance:0,noPathFoundStrategy:"STOP",maxPathLength:1/0,shortestPathAlgorithm:"BIDIRECTIONAL_SEARCH",ignoreLayers:!1,considerCosts:n.considerCosts||!1};this.options=w(w({},o),n),this.options.considerCosts&&this.options.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.options.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.character=t,this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(B(this.character.autoMovementSet().pipe(Z(s=>s!==this),dt(1)))).subscribe(({enterTile:s,enterLayer:a})=>{this.updateTarget(s,a)})}update(t){var e;(e=this.targetMovement)==null||e.update(t)}getInfo(){return{type:"Follow",config:{charToFollow:this.charToFollow.getId(),distance:this.options.distance,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers}}}updateTarget(t,e){this.targetMovement=new Be(this.character,this.gridTilemap,{position:new g(t),layer:e},{distance:this.options.distance+1,config:{algorithm:this.options.shortestPathAlgorithm,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,considerCosts:this.options.considerCosts},ignoreBlockedTarget:!0})}}});var lr,Kh=m(()=>{lr=class{static getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}}});var Pi,Yh=m(()=>{Kh();ve();$();Me();rt();Pi=class{constructor(t,e=0,i=-1){this.character=t;this.delay=e;this.radius=i;this.stepSize=0;this.delayLeft=this.delay,this.initialRow=t.getNextTilePos().position.y,this.initialCol=t.getNextTilePos().position.x,this.randomizeStepSize(),this.stepsWalked=0,this.currentMovementDirection="none",this.character.positionChangeStarted().pipe(B(this.character.autoMovementSet().pipe(Z(n=>n!==this),dt(1)))).subscribe(()=>{this.stepsWalked++}),this.distanceUtils=ht.create(t.getNumberOfDirections())}update(t){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=t,this.delayLeft<=0){this.delayLeft=this.delay;let e=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(e),this.currentMovementDirection=e,this.randomizeStepSize()}}getInfo(){return{type:"Random",config:{delay:this.delay,radius:this.radius}}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!=="none"&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return this.distanceUtils.getDirections().filter(e=>!this.character.isBlockingDirection(e)).filter(e=>this.isWithinRadius(e))}isWithinRadius(t){return this.radius==-1?!0:this.getDist(t)<=this.radius}getDist(t){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(St(t)),new g(this.initialCol,this.initialRow))}getFreeRandomDirection(){let t=this.getFreeDirections();return t.length==0?"none":t[lr.getRandomInt(t.length)]}randomizeStepSize(){this.stepSize=lr.getRandomInt(this.radius)+1}}});function Xh(r,t){return r.filter(e=>{var i,n,o,s,a,h;return(i=t.labels)!=null&&i.withAllLabels?(n=t.labels)==null?void 0:n.withAllLabels.every(u=>e.hasLabel(u)):(o=t.labels)!=null&&o.withOneOfLabels?(s=t.labels)==null?void 0:s.withOneOfLabels.some(u=>e.hasLabel(u)):(a=t.labels)!=null&&a.withNoneLabels?!((h=t.labels)!=null&&h.withNoneLabels.some(u=>e.hasLabel(u))):!0})}var so=m(()=>{});var Ti,ao=m(()=>{Ti="2.32.3"});var wi,Jh=m(()=>{ne();rt();Xr();wi=class{constructor(t){this.collistionStrategy=t;this.tilePosToCharacters=new Map;this.charRemoved$=new E}isCharBlockingAt(t,e,i,n=new Set){if(i.length===0)return!1;let o=this.posToString(t,e),s=this.tilePosToCharacters.get(o);return!!(s&&s.size>0&&[...s].filter(a=>!n.has(a.getId())).some(a=>a.getCollisionGroups().some(h=>i.includes(h))))}getCharactersAt(t,e){let i=this.posToString(t,e),n=this.tilePosToCharacters.get(i);return new Set(n)}addCharacter(t){this.addTilePositions(t.getTilePos(),t),this.addTilePositions(t.getNextTilePos(),t),this.addPositionChangeSub(t),this.addPositionChangeFinishedSub(t),this.addTilePosSetSub(t)}removeCharacter(t){let e=t.getId();this.charRemoved$.next(e),this.deleteTilePositions(t.getTilePos(),t),this.deleteTilePositions(t.getNextTilePos(),t)}add(t,e){var i;this.tilePosToCharacters.has(t)||this.tilePosToCharacters.set(t,new Set),(i=this.tilePosToCharacters.get(t))==null||i.add(e)}addTilePosSetSub(t){t.tilePositionSet().pipe(B(this.charRemoved(t.getId()))).subscribe(e=>{this.deleteTilePositions(t.getNextTilePos(),t),this.addTilePositions(e,t)})}charRemoved(t){var e;return(e=this.charRemoved$)==null?void 0:e.pipe(dt(1),Z(i=>i==t))}addPositionChangeSub(t){t.positionChangeStarted().pipe(B(this.charRemoved(t.getId())),this.posChangeToLayerPos()).subscribe(e=>{this.collistionStrategy==="BLOCK_ONE_TILE_AHEAD"&&this.deleteTilePositions(e.exit,t),this.addTilePositions(e.enter,t)})}addPositionChangeFinishedSub(t){t.positionChangeFinished().pipe(B(this.charRemoved(t.getId())),this.posChangeToLayerPos()).subscribe(e=>{this.deleteTilePositions(e.exit,t),this.addTilePositions(e.enter,t)})}addTilePositions(t,e){this.forEachCharTile(t,e,(i,n)=>{this.add(this.posToString(new g(i,n),t.layer),e)})}deleteTilePositions(t,e){this.forEachCharTile(t,e,(i,n)=>{var o;(o=this.tilePosToCharacters.get(this.posToString(new g(i,n),t.layer)))==null||o.delete(e)})}forEachCharTile(t,e,i){let n=t.position;for(let o=n.x;o<n.x+e.getTileWidth();o++)for(let s=n.y;s<n.y+e.getTileHeight();s++)i(o,s)}posChangeToLayerPos(){return Zi(Rt(t=>({enter:{position:new g(t.enterTile),layer:t.enterLayer},exit:{position:new g(t.exitTile),layer:t.exitLayer}})))}posToString(t,e){return`${t.x}#${t.y}#${e}`}}});var ue,xi=m(()=>{ue=class{constructor(t,e,i,n){this.x=t;this.y=e;this.width=i;this.height=n}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}}});var Si,Ci=m(()=>{Si="ge_charLayer"});function uo(r,t){return r|1<<t}function Li(r,t){return(r>>t&1)==1}var Zh,Gc,ho,Ei,tu=m(()=>{$();rt();xi();Zh=0,Gc=1,ho={none:1,left:2,"up-left":3,up:4,"up-right":5,right:6,"down-right":7,down:8,"down-left":9},Ei=class{constructor(t,e){this.tilemap=t;this.gridTilemap=e;this.tileCollisionCache=new Map}fixLayer(t){this.fixedLayer=this.tileCollisionCache.get(t)}unfixLayers(){this.fixedLayer=void 0}rebuild(t){t||(t=new ue(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()));let e=this.tilemap.getLayers().filter(i=>i.isCharLayer());for(let i of[...e,void 0]){let n=this.tileCollisionCache.get(i==null?void 0:i.getName());if(n===void 0){n=new Array(this.tilemap.getWidth());for(let o=0;o<this.tilemap.getWidth();o++)n[o]=new Array(this.tilemap.getHeight());this.tileCollisionCache.set(i==null?void 0:i.getName(),n)}for(let o=t.getY();o<t.getY()+t.getHeight();o++)for(let s=t.getX();s<t.getX()+t.getWidth();s++){let a=0;!this.gridTilemap.hasNoTileUncached(new g(s,o),i==null?void 0:i.getName())&&(a=uo(a,0));for(let l of $e())this.gridTilemap.hasBlockingTileUncached(new g(s,o),i==null?void 0:i.getName(),l,!0)&&(a=uo(a,ho[l]));this.gridTilemap.hasBlockingTileUncached(new g(s,o),i==null?void 0:i.getName(),void 0,!0)&&(a=uo(a,ho[1])),n[s][o]=a}}}hasTileAt(t,e,i){var s;let n=this.fixedLayer||this.tileCollisionCache.get(i),o=(s=n==null?void 0:n[t])==null?void 0:s[e];if(o!==void 0)return Li(o,Zh)}isBlockingFrom(t,e,i,n,o){var h;let s=this.fixedLayer||this.tileCollisionCache.get(i),a=(h=s==null?void 0:s[t])==null?void 0:h[e];if(a!==void 0)return!o&&!Li(a,Zh)?!0:n===void 0?Li(a,Gc):Li(a,ho[n])}}});var eu,Ai,Oi,ru=m(()=>{$();Jh();xi();Ci();tu();eu="ge_cost",Ai=class Ai{constructor(t,e,i,n=!1){this.tilemap=t;this.collisionTilePropertyName=e;this.useTileCollisionCache=n;this.characters=new Map;this.transitions=new Map;this.reverseTransitions=new Map;this.collidesPropNames=new Map;this.tileCostPropNames=new Map;this.collisionRelevantLayersFrameCache=new Map;this.charBlockCache=new wi(i);for(let o of $e())this.collidesPropNames.set(o,Ai.ONE_WAY_COLLIDE_PROP_PREFIX+o),this.tileCostPropNames.set(o,`${eu}_${o}`);this.useTileCollisionCache&&(this.tileCollisionCache=new Ei(t,this),this.tileCollisionCache.rebuild())}fixCacheLayer(t){var e;(e=this.tileCollisionCache)==null||e.fixLayer(t)}unfixCacheLayers(){var t;(t=this.tileCollisionCache)==null||t.unfixLayers()}addCharacter(t){this.characters.set(t.getId(),t),t.getNextTilePos().layer===void 0&&t.setTilePosition(Mt(w({},t.getNextTilePos()),{layer:this.getLowestCharLayer()})),this.charBlockCache.addCharacter(t)}removeCharacter(t){let e=this.characters.get(t);e&&(this.charBlockCache.removeCharacter(e),this.characters.delete(t))}getCharacters(){return[...this.characters.values()]}getCharactersAt(t,e){return this.charBlockCache.getCharactersAt(t,e)}rebuildTileCollisionCache(t){var e;(e=this.tileCollisionCache)==null||e.rebuild(t)}hasBlockingTileUncached(t,e,i,n){if(!n&&this.hasNoTileUncached(t,e))return!0;let o=this.getCollisionRelevantLayers(e);for(let s of o)if(this.isLayerBlockingAt(s.getName(),t,i))return!0;return!1}hasBlockingTile(t,e,i,n){var s;let o=(s=this.tileCollisionCache)==null?void 0:s.isBlockingFrom(t.x,t.y,e,i,n);return o!==void 0?o:this.hasBlockingTileUncached(t,e,i,n)}getTransition(t,e){let i=this.transitions.get(t.toString());if(i)return i.get(e)}getReverseTransitions(t,e){let i=this.reverseTransitions.get(t.toString());if(i)return i.get(e)}setTransition(t,e,i){var n,o,s,a,h;this.transitions.has(t.toString())||this.transitions.set(t.toString(),new Map),this.reverseTransitions.has(t.toString())||this.reverseTransitions.set(t.toString(),new Map),(n=this.transitions.get(t.toString()))==null||n.set(e,i),(o=this.reverseTransitions.get(t.toString()))!=null&&o.has(i)||(s=this.reverseTransitions.get(t.toString()))==null||s.set(i,new Set),(h=(a=this.reverseTransitions.get(t.toString()))==null?void 0:a.get(i))==null||h.add(e)}getTransitions(){return new Map([...this.transitions].map(([t,e])=>[t,new Map(e)]))}getTileCosts(t,e){let i=this.getCollisionRelevantLayers(t.layer),n=1;for(let o of i)n=Math.max(n,this.getTileCostsForLayer(Mt(w({},t),{layer:o.getName()}),e));return n}getTileCostsForLayer(t,e){let i=this.tilemap.getTileAt(t.position.x,t.position.y,t.layer);return e&&(i==null?void 0:i.getProperty(this.tileCostPropNames.get(e)||""))||(i==null?void 0:i.getProperty(eu))||1}hasNoTileUncached(t,e){return!this.getCollisionRelevantLayers(e).some(n=>this.tilemap.hasTileAt(t.x,t.y,n.getName()))}hasNoTile(t,e){var n;let i=(n=this.tileCollisionCache)==null?void 0:n.hasTileAt(t.x,t.y,e);return i!==void 0?i:this.hasNoTileUncached(t,e)}hasBlockingChar(t,e,i,n=new Set){return this.charBlockCache.isCharBlockingAt(t,e,i,n)}isInRange(t){return new ue(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()).isInRange(t)}toMapDirection(t){return this.isIsometric()?Lo(t):t}fromMapDirection(t){return this.isIsometric()?gr(t):t}isIsometric(){return this.tilemap.getOrientation()==="isometric"}getTilePosInDirection(t,e){let i=t.position.add(St(this.toMapDirection(e))),n=this.getTransition(i,t.layer)||t.layer;return{position:i,layer:n}}invalidateFrameCache(){this.collisionRelevantLayersFrameCache.clear()}isLayerBlockingAt(t,e,i){let n=this.tilemap.getTileAt(e.x,e.y,t);return n?!!(n.getProperty(this.collisionTilePropertyName)||i&&n.getProperty(this.collidesPropNames.get(i)||"")):!1}getCharLayerIndexes(){return this.tilemap.getLayers().map((t,e)=>({layer:t,index:e})).filter(({layer:t})=>t.isCharLayer()).map(({index:t})=>t)}findPrevAndCharLayer(t){let e=this.getCharLayerIndexes(),i=this.tilemap.getLayers(),n=e.findIndex(o=>i[o].getProperty(Si)==t);return n==0?{prevIndex:-1,charLayerIndex:e[n]}:{prevIndex:e[n-1],charLayerIndex:e[n]}}getCollisionRelevantLayers(t){if(!t)return this.tilemap.getLayers();let e=this.collisionRelevantLayersFrameCache.get(t);if(e)return e;let{prevIndex:i,charLayerIndex:n}=this.findPrevAndCharLayer(t),o=this.tilemap.getLayers().slice(i+1,n+1);return this.collisionRelevantLayersFrameCache.set(t,o),o}getLowestCharLayer(){for(let t of this.tilemap.getLayers())if(t.isCharLayer())return t.getName()}};Ai.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_";Oi=Ai});var Mi,lo=m(()=>{Mi=(e=>(e.REMOVED="REMOVED",e.ADDED="ADDED",e))(Mi||{})});var co,Di,po=m(()=>{oi();$();ne();Me();ve();co=(i=>(i.WAIT="WAIT",i.SKIP="SKIP",i.STOP="STOP",i))(co||{}),Di=class{constructor(t,e){this.character=t;this.tilemap=e;this.queue=new Jt;this.finished$=new E;this.pathBlockedWaitElapsed=0;this.distanceUtils=ht.create(t.getNumberOfDirections()),this.character.autoMovementSet().pipe(Z(i=>i!==this),dt(1)).subscribe(()=>{this.queue.size()>0&&this.finishMovementTerminated(),this.finished$.complete()})}update(t){!this.character.isMoving()&&this.queue.size()>0&&this.moveCharOnPath(t)}getInfo(){return{type:"Queue"}}enqueue(t,e={}){var n,o,s;let i={pathBlockedStrategy:(n=e.pathBlockedStrategy)!=null?n:"STOP",pathBlockedWaitTimeoutMs:(e==null?void 0:e.pathBlockedWaitTimeoutMs)||-1,ignoreInvalidPositions:(o=e.ignoreInvalidPositions)!=null?o:!1,skipInvalidPositions:(s=e.skipInvalidPositions)!=null?s:!1};for(let a of t){let h={command:a,config:i};if(ee(a)){this.queue.enqueue(h);continue}let u=this.queue.peekEnd(),l=u==null?void 0:u.command;if(l||(l=this.character.getNextTilePos()),ee(l)){this.queue.enqueue(h);continue}let c=this.distanceUtils.distance(l.position,a.position)===1;(!e.ignoreInvalidPositions||c)&&this.queue.enqueue(h)}}peekAll(){return this.queue.peekAll()}size(){return this.queue.size()}finished(){return this.finished$}clear(){this.queue.clear()}moveCharOnPath(t){let e=this.queue.peek();if(!e)return;let i=e.command,n=e.config;if(ee(i)&&(i=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),i)),n.skipInvalidPositions){if(i=this.getNextValidPosition(),!i){this.finishInvalidNextPos(i);return}}else if(!this.isNeighborPos(i)){this.finishInvalidNextPos(i);return}if(this.character.isBlockingDirection(it(this.character.getTilePos().position,i.position))){if(n.pathBlockedStrategy==="STOP")this.finishPathBlocked(i);else if(n.pathBlockedStrategy==="SKIP"){this.queue.dequeue(),this.moveCharOnPath(t);return}else n.pathBlockedStrategy==="WAIT"&&n.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=t,this.pathBlockedWaitElapsed>=n.pathBlockedWaitTimeoutMs&&this.finishBlockedWaitTimeout(i,n.pathBlockedWaitTimeoutMs));return}this.pathBlockedWaitElapsed=0,this.queue.dequeue(),this.character.move(this.getDir(this.character.getTilePos().position,i.position)),this.isLastMovement()&&this.finish("SUCCESS")}getNextValidPosition(){var t;for(;this.queue.size()>0;){let e=(t=this.queue.peek())==null?void 0:t.command;if(ee(e)&&(e=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),e)),e&&this.isNeighborPos(e))return e;this.queue.dequeue()}}isLastMovement(){return this.queue.size()===0}isNeighborPos(t){let e=this.distanceUtils.distance(this.character.getTilePos().position,t.position)===1,i=this.tilemap.getTransition(t.position,this.character.getTilePos().layer);if(this.character.getTilePos().layer!==t.layer)return e&&i===t.layer;let n=i!==void 0&&i!==t.layer;return e&&!n}finishMovementTerminated(){this.finish("MOVEMENT_TERMINATED","New automatic movement has been set to character.")}finishInvalidNextPos(t){t?this.finish("INVALID_NEXT_POS",`Position ${this.posToStr(t)} is not reachable from ${this.posToStr(this.character.getTilePos())}.`):this.finish("INVALID_NEXT_POS",`No enqueued position is reachable from ${this.posToStr(this.character.getTilePos())}.`)}finishPathBlocked(t){this.finish("PATH_BLOCKED",`Position ${this.posToStr(t)} is blocked.`)}finishBlockedWaitTimeout(t,e){this.finish("PATH_BLOCKED_WAIT_TIMEOUT",`Position ${this.posToStr(t)} is blocked and the wait timeout of ${e} ms has been exceeded.`)}finish(t,e=""){this.queue=new Jt,this.finished$.next({position:this.character.getNextTilePos().position,result:t,description:e,layer:this.character.getNextTilePos().layer})}getDir(t,e){return this.tilemap.fromMapDirection(it(t,e))}posToStr(t){return`(${t.position.x}, ${t.position.y}, ${t.layer})`}}});var cr,fo=m(()=>{Xr();Qh();bi();Qr();$();Yh();ne();Me();rt();er();ti();Kr();so();ao();Ii();Dt();be();ru();lo();xi();po();cr=class{constructor(t=!0){this.isCreatedInternal=!1;t&&console.log(`Using GridEngine v${Ti}`)}getCharLayer(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getTilePos().layer}getTransition(t,e){var i;return this.initGuard(),(i=this.gridTilemap)==null?void 0:i.getTransition(new g(t),e)}setTransition(t,e,i){var n;return this.initGuard(),(n=this.gridTilemap)==null?void 0:n.setTransition(new g(t),e,i)}create(t,e){this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(e);this.config=i,this.movementStopped$=new E,this.movementStarted$=new E,this.directionChanged$=new E,this.positionChangeStarted$=new E,this.positionChangeFinished$=new E,this.queueMovementFinished$=new E,this.charRemoved$=new E,this.charAdded$=new E,this.gridTilemap=new Oi(t,this.config.collisionTilePropertyName,this.config.characterCollisionStrategy,this.config.cacheTileCollisions),this.addCharacters()}getPosition(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getTilePos().position}move(t,e){this.moveChar(t,e)}moveRandomly(t,e=0,i=-1){var s;this.initGuard();let n=(s=this.gridCharacters)==null?void 0:s.get(t);if(!n)throw this.createCharUnknownErr(t);let o=new Pi(n,e,i);n.setMovement(o)}getMovement(t){var n;this.initGuard();let e=(n=this.gridCharacters)==null?void 0:n.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getMovement();return i?i.getInfo():{type:"None"}}moveTo(t,e,i){var a;let n=this.assembleMoveToConfig(i);this.initGuard();let o=(a=this.gridCharacters)==null?void 0:a.get(t);if(!o)throw this.createCharUnknownErr(t);if(!this.gridTilemap)throw this.createUninitializedErr();let s=new Be(o,this.gridTilemap,{position:new g(e),layer:(i==null?void 0:i.targetLayer)||o.getNextTilePos().layer},{distance:0,config:n});return o.setMovement(s),s.finishedObs().pipe(Rt(h=>({charId:t,position:h.position,result:h.result,description:h.description,layer:h.layer})))}stopMovement(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.setMovement(void 0)}setSpeed(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.setSpeed(e)}getSpeed(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getSpeed()}collidesWithTiles(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.collidesWithTiles()}update(t,e){var i;if(this.isCreatedInternal&&this.gridCharacters)for(let[n,o]of this.gridCharacters)o.update(e);(i=this.gridTilemap)==null||i.invalidateFrameCache()}addCharacter(t){var o,s,a,h,u;if(!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let e={speed:t.speed||4,tilemap:this.gridTilemap,collidesWithTiles:!0,collisionGroups:["geDefault"],charLayer:t.charLayer,facingDirection:t.facingDirection,labels:t.labels,numberOfDirections:(o=t.numberOfDirections)!=null?o:this.config.numberOfDirections,tileWidth:t.tileWidth,tileHeight:t.tileHeight};typeof t.collides=="boolean"?t.collides===!1&&(e.collidesWithTiles=!1,e.collisionGroups=[]):t.collides!==void 0&&(t.collides.collidesWithTiles===!1&&(e.collidesWithTiles=!1),t.collides.collisionGroups&&(e.collisionGroups=t.collides.collisionGroups),e.ignoreMissingTiles=(a=(s=t.collides)==null?void 0:s.ignoreMissingTiles)!=null?a:!1);let i=new $r(t.id,e);t.startPosition&&i.setTilePosition({position:new g(t.startPosition),layer:i.getTilePos().layer}),(h=this.gridCharacters)==null||h.set(t.id,i),this.gridTilemap.addCharacter(i);let n=i.getId();i.movementStopped().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.movementStopped$)==null||c.next({charId:n,direction:l})}),i.movementStarted().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.movementStarted$)==null||c.next({charId:n,direction:l})}),i.directionChanged().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.directionChanged$)==null||c.next({charId:n,direction:l})}),i.positionChangeStarted().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.positionChangeStarted$)==null||c.next(w({charId:n},l))}),i.positionChangeFinished().pipe(B(this.charRemoved(n))).subscribe(l=>{var c;(c=this.positionChangeFinished$)==null||c.next(w({charId:n},l))}),(u=this.charAdded$)==null||u.next(n)}hasCharacter(t){var e;return this.initGuard(),!!((e=this.gridCharacters)!=null&&e.has(t))}removeCharacter(t){var i,n,o,s;if(this.initGuard(),!((i=this.gridCharacters)==null?void 0:i.get(t)))throw this.createCharUnknownErr(t);(n=this.gridTilemap)==null||n.removeCharacter(t),(o=this.gridCharacters)==null||o.delete(t),(s=this.charRemoved$)==null||s.next(t)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters)for(let t of this.gridCharacters.keys())this.removeCharacter(t)}getAllCharacters(t){if(this.initGuard(),!this.gridCharacters)return[];let e=[...this.gridCharacters.values()];return(t?Xh(e,t):e).map(n=>n.getId())}getLabels(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getLabels()}addLabels(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.addLabels(e)}removeLabels(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.removeLabels(e)}clearLabels(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.clearLabels()}follow(t,e,i,n){var u,l,c,p;let o;i===void 0?o={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(o={distance:i,closestPointIfBlocked:!1},n&&(o.closestPointIfBlocked=!0)):o=i,this.initGuard();let s=(u=this.gridCharacters)==null?void 0:u.get(t),a=(l=this.gridCharacters)==null?void 0:l.get(e);if(!s)throw this.createCharUnknownErr(t);if(!a)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let h=new vi(s,this.gridTilemap,a,{distance:o.distance,noPathFoundStrategy:o.closestPointIfBlocked?"CLOSEST_REACHABLE":"STOP",maxPathLength:(c=o.maxPathLength)!=null?c:1/0,shortestPathAlgorithm:(p=o.algorithm)!=null?p:"BIDIRECTIONAL_SEARCH",ignoreLayers:!!o.ignoreLayers});s.setMovement(h)}isMoving(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.isMoving()}getFacingDirection(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getFacingDirection()}getFacingPosition(t){var n;this.initGuard();let e=(n=this.gridCharacters)==null?void 0:n.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getFacingPosition();return{x:i.x,y:i.y}}turnTowards(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);return i.turnTowards(e)}getCharactersAt(t,e){if(this.initGuard(),!this.gridTilemap)return[];let i=this.gridTilemap.getCharactersAt(new g(t),e);return Array.from(i).map(n=>n.getId())}setPosition(t,e,i){var o;this.initGuard();let n=(o=this.gridCharacters)==null?void 0:o.get(t);if(!n)throw this.createCharUnknownErr(t);i||n.setTilePosition({position:new g(e),layer:n.getTilePos().layer}),n.setTilePosition({position:new g(e),layer:i})}isBlocked(t,e,i=["geDefault"]){var o,s;this.initGuard();let n=new g(t);return!!((o=this.gridTilemap)!=null&&o.hasBlockingTile(n,e)||(s=this.gridTilemap)!=null&&s.hasBlockingChar(n,e,i))}isTileBlocked(t,e){var i;return this.initGuard(),!!((i=this.gridTilemap)!=null&&i.hasBlockingTile(new g(t),e))}getCollisionGroups(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getCollisionGroups()||[]}setCollisionGroups(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.setCollisionGroups(e)}getTilePosInDirection(t,e,i){if(!this.gridTilemap)throw this.createUninitializedErr();let n=this.gridTilemap.getTilePosInDirection({position:new g(t),layer:e},i);return{position:n.position.toPosition(),charLayer:n.layer}}findShortestPath(t,e,i={}){if(!this.gridTilemap)throw this.createUninitializedErr();let n=i.shortestPathAlgorithm||"BFS";i.considerCosts&&n!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${n}'. It can only be used with A* algorithm.`);let s=new qe(this.gridTilemap).findShortestPath(b.toInternal(t),b.toInternal(e),Mt(w({},i),{shortestPathAlgorithm:n}));return{path:s.path.map(b.fromInternal),closestToTarget:b.fromInternal(s.closestToTarget),reachedMaxPathLength:!1,steps:s.steps}}steppedOn(t,e,i){return this.positionChangeFinished().pipe(Z(n=>t.includes(n.charId)&&e.some(o=>o.x===n.enterTile.x&&o.y===n.enterTile.y)&&(i===void 0||i.includes(n.enterLayer))))}characterShifted(){if(!this.charAdded$||!this.charRemoved$)throw this.createUninitializedErr();return this.charAdded$.pipe(Rt(t=>({charId:t,action:"ADDED"})),Tn(this.charRemoved$.pipe(Rt(t=>({charId:t,action:"REMOVED"})))))}movementStarted(){if(!this.movementStarted$)throw this.createUninitializedErr();return this.movementStarted$}movementStopped(){if(!this.movementStopped$)throw this.createUninitializedErr();return this.movementStopped$}directionChanged(){if(!this.directionChanged$)throw this.createUninitializedErr();return this.directionChanged$}positionChangeStarted(){if(!this.positionChangeStarted$)throw this.createUninitializedErr();return this.positionChangeStarted$}positionChangeFinished(){if(!this.positionChangeFinished$)throw this.createUninitializedErr();return this.positionChangeFinished$}getMovementProgress(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getMovementProgress()}rebuildTileCollisionCache(t,e,i,n){var o;(o=this.gridTilemap)==null||o.rebuildTileCollisionCache(new ue(t,e,i,n))}addQueueMovements(t,e,i){var s,a;this.initGuard();let n=(s=this.gridCharacters)==null?void 0:s.get(t);if(!n)throw this.createCharUnknownErr(t);if(!this.gridTilemap)throw this.createUninitializedErr();let o;((a=n==null?void 0:n.getMovement())==null?void 0:a.getInfo().type)==="Queue"?o=n.getMovement():(o=new Di(n,this.gridTilemap),n.setMovement(o),o.finished().pipe(B(vn(this.charRemoved(t),n.autoMovementSet()))).subscribe(h=>{var u;(u=this.queueMovementFinished$)==null||u.next(w({charId:t},h))})),o.enqueue(e.map(h=>ee(h)?h:{position:new g(h.position),layer:h.charLayer}),i)}queueMovementFinished(){if(!this.queueMovementFinished$)throw this.createUninitializedErr();return this.queueMovementFinished$}getEnqueuedMovements(t){var i,n;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return((n=e.getMovement())==null?void 0:n.getInfo().type)==="Queue"?e.getMovement().peekAll().map(s=>({command:ee(s.command)?s.command:b.fromInternal(s.command),config:s.config})):[]}clearEnqueuedMovements(t){var i,n;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);((n=e.getMovement())==null?void 0:n.getInfo().type)==="Queue"&&e.getMovement().clear()}getTileCost(t,e,i){var n,o;return this.initGuard(),(o=(n=this.gridTilemap)==null?void 0:n.getTileCosts({position:new g(t),layer:e},i))!=null?o:1}charRemoved(t){var e;if(!this.charRemoved$)throw this.createUninitializedErr();return(e=this.charRemoved$)==null?void 0:e.pipe(dt(1),Z(i=>i==t))}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var t;(t=this.config)==null||t.characters.forEach(e=>this.addCharacter(e))}moveChar(t,e){var n,o,s;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);if(i.getNumberOfDirections()===4){if(!((o=this.gridTilemap)!=null&&o.isIsometric())&&Se(e)){console.warn(`GridEngine: Character '${t}' can't be moved '${e}' in 4 direction mode.`);return}else if((s=this.gridTilemap)!=null&&s.isIsometric()&&!Se(e)){console.warn(`GridEngine: Character '${t}' can't be moved '${e}' in 4 direction isometric mode.`);return}}i.move(e)}createCharUnknownErr(t){return new Error(`Character unknown: ${t}`)}assembleMoveToConfig(t={}){let e=Mt(w({},t),{noPathFoundStrategy:"STOP",pathBlockedStrategy:"WAIT"});return t!=null&&t.noPathFoundStrategy&&(Object.values(ye).includes(t.noPathFoundStrategy)?e.noPathFoundStrategy=t.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${t.noPathFoundStrategy}'. Falling back to '${"STOP"}'`)),t!=null&&t.pathBlockedStrategy&&(Object.values(De).includes(t.pathBlockedStrategy)?e.pathBlockedStrategy=t.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${t.pathBlockedStrategy}'. Falling back to '${"WAIT"}'`)),e}setConfigDefaults(t){return w({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",cacheTileCollisions:!1},t)}}});var Fi,iu=m(()=>{$();fo();ve();Dt();oo();Fi=class extends Ge{constructor(t,e={}){super(t,e),this.distanceUtils=ht.create(8)}getForced(t,e){let i=[],n=this.posInDir(e,this.distanceUtils.direction(e.position,t.position)),{topLeft:o,downLeft:s,top:a,bottom:h,topRight:u,downRight:l}=this.normalizedPositions(n,e),c=this.distanceUtils.direction(t.position,e.position),p=(f,d)=>this.isBlocking(f,d)||this.getTransition(d.position,d.layer)!==void 0;return Se(c)?(p(t,o)&&!this.isBlocking(e,a)&&i.push(a),p(t,o)&&(p(t,s)||p(s,o))&&!this.isBlocking(e,o)&&i.push(o),p(t,s)&&!this.isBlocking(e,h)&&i.push(h),p(t,s)&&(p(t,o)||p(o,s))&&!this.isBlocking(e,s)&&i.push(s)):(p(t,a)&&(p(t,o)||p(o,a))&&(this.isBlocking(e,o)||i.push(o),this.isBlocking(e,a)||i.push(a)),p(t,a)&&(p(t,o)||p(o,a)||p(a,u))&&!this.isBlocking(e,u)&&i.push(u),p(t,h)&&(p(t,s)||p(s,a))&&(this.isBlocking(e,s)||i.push(s),this.isBlocking(e,h)||i.push(h)),p(t,h)&&(p(t,s)||p(o,h)||p(a,l))&&!this.isBlocking(e,l)&&i.push(l)),i}prune(t,e){let{right:i,topRight:n,downRight:o}=this.normalizedPositions(t,e),s=this.getForced(t,e),a=it(t.position,e.position);return Se(a)?[i,n,o,...s]:[i,...s]}jump(t,e,i,n){let o=this.distanceUtils.direction(t.position,e.position);if(!(this.isBlocking(t,e)&&!(b.equal(e,i)&&this.options.ignoreBlockedTarget))){if(b.equal(e,i))return{p:e,dist:n};if(n>=this.maxJumpSize)return{p:e,dist:n};if(this.getTransition(e.position,t.layer)!==void 0)return{p:e,dist:n};if(this.getForced(t,e).length>0)return{p:e,dist:n};if(this.updateClosestToTarget(e,i),o==="up-left"){if(this.jump(e,this.getTilePosInDir(e,"up"),i,n+1)!==void 0)return{p:e,dist:n};if(this.jump(e,this.getTilePosInDir(e,"left"),i,n+1)!==void 0)return{p:e,dist:n}}else if(o==="down-left"){if(this.jump(e,this.getTilePosInDir(e,"down"),i,n+1)!==void 0)return{p:e,dist:n};if(this.jump(e,this.getTilePosInDir(e,"left"),i,n+1)!==void 0)return{p:e,dist:n}}else if(o==="up-right"){if(this.jump(e,this.getTilePosInDir(e,"up"),i,n+1)!==void 0)return{p:e,dist:n};if(this.jump(e,this.getTilePosInDir(e,"right"),i,n+1)!==void 0)return{p:e,dist:n}}else if(o==="down-right"){if(this.jump(e,this.getTilePosInDir(e,"down"),i,n+1)!==void 0)return{p:e,dist:n};if(this.jump(e,this.getTilePosInDir(e,"right"),i,n+1)!==void 0)return{p:e,dist:n}}return this.jump(e,this.getTilePosInDir(e,it(t.position,e.position)),i,n+1)}}}});function Bc(r,t,e){switch(r){case"BIDIRECTIONAL_SEARCH":return new ai(t,e);case"A_STAR":return new ii(t,e);case"JPS":return e.numberOfDirections===8?new Fi(t,e):new Ge(t,e)}return new Ie(t,e)}var qe,Ii=m(()=>{$();Ds();Cn();Is();oo();iu();qe=class{constructor(t){this.gridTilemap=t}findShortestPath(t,e,i={}){return Bc(i.shortestPathAlgorithm||"BIDIRECTIONAL_SEARCH",this.gridTilemap,i).findShortestPath(t,e)}}});var ki,Be,bi=m(()=>{er();ve();vs();ti();ne();Ii();Cn();Dt();ki=(h=>(h.SUCCESS="SUCCESS",h.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",h.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",h.PATH_BLOCKED="PATH_BLOCKED",h.NO_PATH_FOUND="NO_PATH_FOUND",h.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",h.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED",h.MAX_PATH_LENGTH_REACHED="MAX_PATH_LENGTH_REACHED",h))(ki||{}),Be=class{constructor(t,e,i,{config:n,ignoreBlockedTarget:o=!1,distance:s=0}={}){this.character=t;this.tilemap=e;this.targetPos=i;this.shortestPath=[];this.distOffset=0;this.posOnPath=0;this.stopped=!1;this.pathBlockedWaitElapsed=0;this.isPositionAllowed=()=>!0;this.shortestPathAlgorithm="BIDIRECTIONAL_SEARCH";this.maxPathLength=1/0;this.considerCosts=!1;this.isBlocking=(t,e)=>t?new Ie(this.tilemap,this.getPathfindingOptions()).isBlocking(this.character.getTilePos(),{position:t,layer:e}):!0;var a;this.shortestPathAlgorithm=(a=n==null?void 0:n.algorithm)!=null?a:this.shortestPathAlgorithm,this.ignoreBlockedTarget=o,this.distance=s,this.noPathFoundStrategy=(n==null?void 0:n.noPathFoundStrategy)||"STOP",this.pathBlockedStrategy=(n==null?void 0:n.pathBlockedStrategy)||"WAIT",this.noPathFoundRetryable=new rr((n==null?void 0:n.noPathFoundRetryBackoffMs)||200,(n==null?void 0:n.noPathFoundMaxRetries)||-1,()=>{this.stop("NO_PATH_FOUND_MAX_RETRIES_EXCEEDED")}),this.pathBlockedRetryable=new rr((n==null?void 0:n.pathBlockedRetryBackoffMs)||200,(n==null?void 0:n.pathBlockedMaxRetries)||-1,()=>{this.stop("PATH_BLOCKED_MAX_RETRIES_EXCEEDED")}),n!=null&&n.isPositionAllowedFn&&(this.isPositionAllowed=n.isPositionAllowedFn),n!=null&&n.maxPathLength&&(this.maxPathLength=n.maxPathLength),n!=null&&n.considerCosts&&this.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.considerCosts=(n==null?void 0:n.considerCosts)||!1,this.ignoreLayers=!!(n!=null&&n.ignoreLayers),this.distanceUtils=ht.create(t.getNumberOfDirections()),this.pathBlockedWaitTimeoutMs=(n==null?void 0:n.pathBlockedWaitTimeoutMs)||-1,this.finished$=new E,this.setCharacter(t)}setPathBlockedStrategy(t){this.pathBlockedStrategy=t}getPathBlockedStrategy(){return this.pathBlockedStrategy}setCharacter(t){this.character=t,this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(Z(e=>e!==this),dt(1)).subscribe(()=>{this.stop("MOVEMENT_TERMINATED")})}getPathfindingOptions(){return{shortestPathAlgorithm:this.shortestPathAlgorithm,pathWidth:this.character.getTileWidth(),pathHeight:this.character.getTileHeight(),numberOfDirections:this.character.getNumberOfDirections(),isPositionAllowed:this.isPositionAllowed,collisionGroups:this.character.getCollisionGroups(),ignoredChars:[this.character.getId()],ignoreTiles:!this.character.collidesWithTiles(),ignoreMapBounds:this.character.getIgnoreMissingTiles(),ignoreBlockedTarget:this.ignoreBlockedTarget,maxPathLength:this.maxPathLength,ignoreLayers:this.ignoreLayers,considerCosts:this.considerCosts}}update(t){var e,i,n,o;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy==="RETRY"?this.noPathFoundRetryable.retry(t,()=>this.calcShortestPath()):this.noPathFoundStrategy==="STOP"&&this.stop("NO_PATH_FOUND")),this.updatePosOnPath(),this.isBlocking((e=this.nextTileOnPath())==null?void 0:e.position,(i=this.character)==null?void 0:i.getNextTilePos().layer)?this.applyPathBlockedStrategy(t):this.pathBlockedWaitElapsed=0,this.hasArrived()?(this.stop("SUCCESS"),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking((n=this.nextTileOnPath())==null?void 0:n.position,(o=this.character)==null?void 0:o.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}getInfo(){return{type:"Target",state:{pathAhead:this.shortestPath.slice(this.posOnPath).map(t=>b.fromInternal(t))},config:{algorithm:this.shortestPathAlgorithm,ignoreBlockedTarget:this.ignoreBlockedTarget,distance:this.distance,targetPos:b.fromInternal(this.targetPos),noPathFoundStrategy:this.noPathFoundStrategy,pathBlockedStrategy:this.pathBlockedStrategy,noPathFoundRetryBackoffMs:this.noPathFoundRetryable.getBackoffMs(),noPathFoundMaxRetries:this.noPathFoundRetryable.getMaxRetries()}}}resultToReason(t){switch(t){case"SUCCESS":return"Successfully arrived.";case"MOVEMENT_TERMINATED":return"Movement of character has been replaced before destination was reached.";case"PATH_BLOCKED":return"PathBlockedStrategy STOP: Path blocked.";case"NO_PATH_FOUND_MAX_RETRIES_EXCEEDED":return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case"NO_PATH_FOUND":return"NoPathFoundStrategy STOP: No path found.";case"PATH_BLOCKED_MAX_RETRIES_EXCEEDED":return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case"PATH_BLOCKED_WAIT_TIMEOUT":return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(t){this.pathBlockedStrategy==="RETRY"?this.pathBlockedRetryable.retry(t,()=>{let e=this.getShortestPath();e.path.length>0&&this.calcShortestPath(e)}):this.pathBlockedStrategy==="STOP"?this.stop("PATH_BLOCKED"):this.pathBlockedStrategy==="WAIT"&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=t,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop("PATH_BLOCKED_WAIT_TIMEOUT"))}moveCharOnPath(){let t=this.nextTileOnPath();if(!t)return;let e=this.getDir(this.character.getNextTilePos().position,t.position);this.character.move(e)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(t){this.finished$.next({position:this.character.getTilePos().position,result:t,description:this.resultToReason(t),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let t=this.shortestPath[this.posOnPath+1],e=this.getDir(this.character.getNextTilePos().position,t.position);this.character.turnTowards(e)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let t=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=t.position.x||this.character.getNextTilePos().position.y!=t.position.y);)this.posOnPath++,t=this.shortestPath[this.posOnPath]}noPathFound(){return this.shortestPath.length===0}calcShortestPath(t){t=t!=null?t:this.getShortestPath(),this.posOnPath=0,this.shortestPath=t.path,this.distOffset=t.distOffset}getShortestPath(){let t=new qe(this.tilemap),{path:e,closestToTarget:i}=t.findShortestPath(this.character.getNextTilePos(),this.targetPos,this.getPathfindingOptions());if(e.length==0&&this.noPathFoundStrategy==="CLOSEST_REACHABLE"){let o=t.findShortestPath(this.character.getNextTilePos(),i,this.getPathfindingOptions()).path,s=this.distanceUtils.distance(i.position,this.targetPos.position);return{path:o,distOffset:s}}return{path:e,distOffset:0}}getDir(t,e){return this.tilemap.fromMapDirection(this.distanceUtils.direction(t,e))}}});var xt,Ri,nu=m(()=>{mo();xn();rt();Xt();xt=class xt{constructor(t){this.tilemap=t;this.charLayerDepths=new Map;this.setLayerDepths()}getTileWidth(){var e,i;let t=(i=(e=this.tilemap.layers[0])==null?void 0:e.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileWidth*t}getTileHeight(){var e,i;let t=(i=(e=this.tilemap.layers[0])==null?void 0:e.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileHeight*t}getDepthOfCharLayer(t){var e;return(e=this.charLayerDepths.get(t))!=null?e:0}tilePosToPixelPos(t){return this.isIsometric()?_.scalarMult(this.getTileSize(),.5).multiply(new g(t.x-t.y,t.x+t.y)):t.clone().multiply(this.getTileSize())}getTileDistance(t){if(this.isIsometric())switch(t){case"down-left":case"down-right":case"up-left":case"up-right":return _.scalarMult(this.getTileSize(),.5);default:return this.getTileSize()}return this.getTileSize()}getTileSize(){return new g(this.getTileWidth(),this.getTileHeight())}isIsometric(){return this.tilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()}isLayerAlwaysOnTop(t){return this.hasLayerProp(t,xt.ALWAYS_TOP_PROP_NAME)}isCharLayer(t){return this.hasLayerProp(t,xt.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let t=[],e=-1,i=this.tilemap.layers.filter(o=>this.isLayerAlwaysOnTop(o));this.tilemap.layers.filter(o=>!this.isLayerAlwaysOnTop(o)).forEach(o=>{this.hasLayerProp(o,xt.HEIGHT_SHIFT_PROP_NAME)?(this.createHeightShiftLayers(o,e),t.push(o.tilemapLayer)):this.setDepth(o,++e)}),this.charLayerDepths.set(void 0,e),i.forEach((o,s)=>{o.tilemapLayer.setDepth(s+1+e)}),t.forEach(o=>o.destroy())}setDepth(t,e){t.tilemapLayer.setDepth(e),this.isCharLayer(t)&&this.charLayerDepths.set(this.getLayerProp(t,xt.CHAR_LAYER_PROP_NAME),e)}createHeightShiftLayers(t,e){let i=this.getLayerProp(t,xt.HEIGHT_SHIFT_PROP_NAME);isNaN(i)&&(i=0);let n=1;for(let o=0;o<t.height;o++){let s=this.copyLayer(t,o);s&&(s.scale=t.tilemapLayer.scale,s.setDepth(e+Ae.shiftPad((o+i)*this.getTileHeight()+n,xt.Z_INDEX_PADDING)))}}getLayerProp(t,e){let n=t.properties.find(o=>o.name==e);return n==null?void 0:n.value}hasLayerProp(t,e){return this.getLayerProp(t,e)!=null}copyLayer(t,e){let i=`${t.name}#${e}`,n=this.tilemap.createBlankLayer(i,t.tilemapLayer.tileset);if(n){n.name=i;for(let o=0;o<t.width;o++)n.putTileAt(t.data[e][o],o,e);return n}}};xt.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",xt.CHAR_LAYER_PROP_NAME="ge_charLayer",xt.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",xt.Z_INDEX_PADDING=7;Ri=xt});function zi(r,t){return Object.entries(r).reduce((e,[i,n])=>typeof n!="object"?t[i]instanceof Set?w({[i]:new Set(n.split(","))},e):w({[i]:n},e):i.startsWith(_i)?w({[i.replace(_i,"")]:zi(n,t)},e):w(w({},zi(n,t)),e),{})}function jc(r){let t=new Map(r.propertyTypes.filter(n=>n.type==="enum").map(n=>[n.name,new Set(n.values)])),e=new Map(r.propertyTypes.filter(n=>n.type==="class").map(n=>[n.name,n.members])),i=new Wc(e,t);return e.forEach((n,o)=>{i.flattenMembers(o,n)}),new qc(i)}var qc,_i,Wc,ou,su=m(()=>{qc=class{constructor(r){this.flattener=r}flattenPropertiesOnObject(r){var t,e,i,n;return Mt(w(w({},this.flattener.memoisedFlattenedProperties.get((t=r.class)!=null?t:r.type)),(e=r.properties)==null?void 0:e.reduce((o,s)=>w(w({},o),this.flattener.flattenMemberProperty(s)),{})),{name:r.name,id:r.id,class:(n=(i=r.class)!=null?i:r.type)!=null?n:null,x:r.x,y:r.y})}getCustomTypesMap(){return new Map([...this.flattener.memoisedFlattenedProperties.entries()].map(([r,t])=>[r,w({},t)]))}getEnums(){return new Map([...this.flattener.enumNameToValuesMap.entries()].map(([r,t])=>[r,new Set(t)]))}},_i="@composite:",Wc=class{constructor(r,t){this.tiledClassToMembersMap=r,this.enumNameToValuesMap=t,this.memoiser=new Map}flattenMembers(r,t){return this.memoiser.has(r)?{[r]:this.memoiser.get(r)}:(this.memoiser.set(r,t.reduce((e,i)=>w(w({},e),this.flattenMemberProperty(i)),{})),{[r]:this.memoiser.get(r)})}flattenMemberProperty(r){var e;let t=(e=r.propertyType)!=null?e:r.propertytype;if(r.type==="class"){if(!this.memoiser.has(t)){let n=this.tiledClassToMembersMap.get(t).reduce((o,s)=>w(w({},this.flattenMemberProperty(s)),o),{});this.memoiser.set(t,n)}let i=this.memoiser.get(t);return r.name.startsWith(_i)?{[r.name.replace(_i,"")]:w(w({},i),zi(r.value,i))}:w(w({},i),zi(r.value,i))}else return this.enumNameToValuesMap.has(t)?{[r.name]:new Set(r.value.split(","))}:{[r.name]:r.value}}get memoisedFlattenedProperties(){return this.memoiser}};ou={parse:jc}});var le,Vi=m(()=>{su();le=class{constructor(t,e){this.phaserTile=t;this.tiledProject=e}getProperty(t){var n,o;let e={};if(this.tiledProject){let s=ou.parse(this.tiledProject),a=this.getType();if(a){let h=(n=s.getCustomTypesMap())==null?void 0:n.get(a);if(h)for(let[u,l]of Object.entries(h))e[u]=l}}return(o=this.phaserTile.properties[t])!=null?o:e[t]}hasProperty(t){return this.getProperty(t)!=null}getType(){var t,e;return(e=(t=this.phaserTile.tileset)==null?void 0:t.tileData[this.phaserTile.index-1])==null?void 0:e.type}}});var We,go=m(()=>{Ci();Vi();We=class{constructor(t,e){this.phaserTilemapLayer=t;this.tiledProject=e}getName(){return this.phaserTilemapLayer.layer.name}getProperty(t){let e=this.phaserTilemapLayer.layer.properties,i=e==null?void 0:e.find(n=>n.name==t);return i==null?void 0:i.value}hasProperty(t){return this.getProperty(t)!=null}isCharLayer(){return this.hasProperty(Si)}getData(){return this.phaserTilemapLayer.layer.data.map(t=>t.map(e=>new le(e,this.tiledProject)))}}});var pr,au=m(()=>{Vi();go();pr=class{constructor(t,e){this.phaserTilemap=t;this.tiledProject=e}getTileWidth(){return this.phaserTilemap.tileWidth}getTileHeight(){return this.phaserTilemap.tileHeight}getWidth(){return this.phaserTilemap.width}getHeight(){return this.phaserTilemap.height}getOrientation(){return this.phaserTilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()?"isometric":"orthogonal"}getLayers(){return this.phaserTilemap.layers.map(t=>new We(t.tilemapLayer,this.tiledProject))}hasTileAt(t,e,i){return!!this.phaserTilemap.hasTileAt(t,e,i)}getTileAt(t,e,i){let n=this.phaserTilemap.getTileAt(t,e,!1,i);if(n)return new le(n,this.tiledProject)}}});var Ni,yo,vo,hu=m(()=>{Ni=class{constructor(t,e="orthogonal",i="ge_collide"){this.map=t;this.orientation=e;this.layerMap=new Map;this.layers=[];let n=-1,o=-1;Object.entries(t).map(([s,a])=>{var p;let h=(p=a.data[0])==null?void 0:p.length,u=a.data.length;if(n!==-1&&n!==h||o!==-1&&o!==u)throw new Error("All tilemap layers must have the same dimensions.");n=h,o=u;let l=[];for(let f=0;f<a.data.length;f++){let d=[];for(let y=0;y<a.data[f].length;y++){let P=new vo(a.data[f][y]===1,i);d.push(P)}l.push(d)}let c=new yo(s,l,a.isCharLayer);this.layers.push(c),this.layerMap.set(s,c)})}getWidth(){var t,e;return((e=(t=Object.values(this.map)[0])==null?void 0:t.data[0])==null?void 0:e.length)||0}getHeight(){var t;return((t=Object.values(this.map)[0])==null?void 0:t.data.length)||0}getOrientation(){return this.orientation}getLayers(){return this.layers}hasTileAt(t,e,i){return!i||!this.layerMap.get(i)?!1:t>=0&&t<this.getWidth()&&e>=0&&e<this.getHeight()}getTileAt(t,e,i){if(!i)return;let n=this.layerMap.get(i);if(n)return n.getData()[e][t]}},yo=class{constructor(t,e,i=!1){this.name=t;this.tiles=e;this.isCharLayerInternal=i}getName(){return this.name}getProperty(t){}hasProperty(t){return!1}getData(){return this.tiles}isCharLayer(){return this.isCharLayerInternal}},vo=class{constructor(t,e){this.isBlocking=t;this.collisionPropertyName=e}getProperty(t){return t===this.collisionPropertyName?this.isBlocking:!1}hasProperty(t){return t===this.collisionPropertyName}}});var bo={};yu(bo,{ArrayTilemap:()=>Ni,CharacterShiftAction:()=>Mi,CollisionStrategy:()=>tr,Direction:()=>pt,GridEngine:()=>je,GridEngineHeadless:()=>cr,MoveToResult:()=>ki,NoPathFoundStrategy:()=>ye,NumberOfDirections:()=>Qt,PathBlockedStrategy:()=>De,PhaserTile:()=>le,PhaserTileLayer:()=>We,PhaserTilemap:()=>pr,QueuedPathBlockedStrategy:()=>co,directionFromPos:()=>it});var fr,je,mo=m(()=>{ds();Xr();bi();Qr();$();er();ti();Kr();so();ao();Ii();be();fo();nu();au();Ci();go();Vi();po();lo();hu();fr=class fr{constructor(t){this.scene=t;this.geHeadless=new cr(!1);this.isCreatedInternal=!1;fr.welcomeMessagePrinted||(console.log(`Using GridEngine Phaser Plugin v${Ti}`),fr.welcomeMessagePrinted=!0),this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this)}getCharLayer(t){return this.geHeadless.getCharLayer(t)}getTransition(t,e){return this.geHeadless.getTransition(t,e)}setTransition(t,e,i){this.geHeadless.setTransition(t,e,i)}create(t,e){this.geHeadless.create(new pr(t,e.tiledProject),e),this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(e);this.config=i,this.gridTilemap=new Ri(t),this.addCharacters()}getPosition(t){return this.geHeadless.getPosition(t)}move(t,e){this.geHeadless.move(t,e)}moveRandomly(t,e=0,i=-1){this.geHeadless.moveRandomly(t,e,i)}getMovement(t){return this.geHeadless.getMovement(t)}moveTo(t,e,i){return this.geHeadless.moveTo(t,e,i)}stopMovement(t){this.geHeadless.stopMovement(t)}setSpeed(t,e){this.geHeadless.setSpeed(t,e)}getSpeed(t){return this.geHeadless.getSpeed(t)}getContainer(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getContainer()}getOffsetX(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getOffsetX()}setOffsetX(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.setOffsetX(e)}getOffsetY(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getOffsetY()}setOffsetY(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.setOffsetY(e)}collidesWithTiles(t){return this.geHeadless.collidesWithTiles(t)}getWalkingAnimationMapping(t){var n;this.initGuard();let e=(n=this.gridCharacters)==null?void 0:n.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getAnimation();return i==null?void 0:i.getWalkingAnimationMapping()}hasLayerOverlay(){var t;return this.initGuard(),!!((t=this.config)!=null&&t.layerOverlay)}setWalkingAnimationMapping(t,e){var o;this.initGuard();let i=(o=this.gridCharacters)==null?void 0:o.get(t);if(!i)throw this.createCharUnknownErr(t);let n=i.getAnimation();n==null||n.setWalkingAnimationMapping(e)}update(t,e){if(this.isCreatedInternal&&this.gridCharacters)for(let[i,n]of this.gridCharacters)n.update(e);this.geHeadless.update(t,e)}addCharacter(t){this.geHeadless.addCharacter(t),this.addCharacterInternal(t)}hasCharacter(t){return this.geHeadless.hasCharacter(t)}removeCharacter(t){var i,n;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.destroy(),(n=this.gridCharacters)==null||n.delete(t),this.geHeadless.removeCharacter(t)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters){for(let t of this.gridCharacters.keys())this.removeCharacter(t);this.geHeadless.removeAllCharacters()}}getAllCharacters(t){return this.geHeadless.getAllCharacters(t)}getLabels(t){return this.geHeadless.getLabels(t)}addLabels(t,e){this.geHeadless.addLabels(t,e)}removeLabels(t,e){this.geHeadless.removeLabels(t,e)}clearLabels(t){this.geHeadless.clearLabels(t)}follow(t,e,i,n){let o;i===void 0?o={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(o={distance:i,closestPointIfBlocked:!1},n&&(o.closestPointIfBlocked=!0)):o=i,this.geHeadless.follow(t,e,o)}isMoving(t){return this.geHeadless.isMoving(t)}getFacingDirection(t){return this.geHeadless.getFacingDirection(t)}getFacingPosition(t){return this.geHeadless.getFacingPosition(t)}turnTowards(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);i.turnTowards(e),this.geHeadless.turnTowards(t,e)}getCharactersAt(t,e){return this.geHeadless.getCharactersAt(t,e)}setPosition(t,e,i){this.geHeadless.setPosition(t,e,i)}getSprite(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getSprite()}setSprite(t,e){var n;this.initGuard();let i=(n=this.gridCharacters)==null?void 0:n.get(t);if(!i)throw this.createCharUnknownErr(t);e.setOrigin(0,0),this.setCharSprite(e,i)}isBlocked(t,e,i=["geDefault"]){return this.geHeadless.isBlocked(t,e,i)}isTileBlocked(t,e){return this.geHeadless.isTileBlocked(t,e)}getCollisionGroups(t){return this.geHeadless.getCollisionGroups(t)}setCollisionGroups(t,e){this.geHeadless.setCollisionGroups(t,e)}getTilePosInDirection(t,e,i){return this.geHeadless.getTilePosInDirection(t,e,i)}findShortestPath(t,e,i={}){return this.geHeadless.findShortestPath(t,e,i)}steppedOn(t,e,i){return this.geHeadless.steppedOn(t,e,i)}characterShifted(){return this.geHeadless.characterShifted()}movementStarted(){return this.geHeadless.movementStarted()}movementStopped(){return this.geHeadless.movementStopped()}directionChanged(){return this.geHeadless.directionChanged()}positionChangeStarted(){return this.geHeadless.positionChangeStarted()}positionChangeFinished(){return this.geHeadless.positionChangeFinished()}getMovementProgress(t){return this.geHeadless.getMovementProgress(t)}rebuildTileCollisionCache(t,e,i,n){this.geHeadless.rebuildTileCollisionCache(t,e,i,n)}addQueueMovements(t,e,i){this.geHeadless.addQueueMovements(t,e,i)}getEnqueuedMovements(t){return this.geHeadless.getEnqueuedMovements(t)}queueMovementFinished(){return this.geHeadless.queueMovementFinished()}clearEnqueuedMovements(t){return this.geHeadless.clearEnqueuedMovements(t)}getTileCost(t,e,i){return this.initGuard(),this.geHeadless.getTileCost(t,e,i)}setConfigDefaults(t){return w({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",layerOverlay:!1,cacheTileCollisions:!1},t)}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var t;(t=this.config)==null||t.characters.forEach(e=>this.addCharacterInternal(e))}createCharUnknownErr(t){return new Error(`Character unknown: ${t}`)}setCharSprite(t,e){e.setSprite(t)}addCharacterInternal(t){var i;if(this.initGuard(),!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let e=new Yr(t,this.scene,this.gridTilemap,this.config.layerOverlay,this.geHeadless);(i=this.gridCharacters)==null||i.set(t.id,e)}};fr.welcomeMessagePrinted=!1;je=fr});var $c=v((OT,uu)=>{mo();uu.exports=je;window.GridEngine=je;window.GridEngineImports=bo});return $c();})();
