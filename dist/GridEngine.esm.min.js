var tT=Object.create;var cu=Object.defineProperty,eT=Object.defineProperties,rT=Object.getOwnPropertyDescriptor,iT=Object.getOwnPropertyDescriptors,nT=Object.getOwnPropertyNames,qc=Object.getOwnPropertySymbols,oT=Object.getPrototypeOf,Yc=Object.prototype.hasOwnProperty,sT=Object.prototype.propertyIsEnumerable;var $c=(r,t,e)=>t in r?cu(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,it=(r,t)=>{for(var e in t||(t={}))Yc.call(t,e)&&$c(r,e,t[e]);if(qc)for(var e of qc(t))sT.call(t,e)&&$c(r,e,t[e]);return r},we=(r,t)=>eT(r,iT(t));var V=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var aT=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of nT(t))!Yc.call(r,s)&&s!==e&&cu(r,s,{get:()=>t[s],enumerable:!(i=rT(t,s))||i.enumerable});return r};var Qc=(r,t,e)=>(e=r!=null?tT(oT(r)):{},aT(t||!r||!r.__esModule?cu(e,"default",{value:r,enumerable:!0}):e,r));var An=V(On=>{var LT=function(r,t){return r<t?-1:r>t?1:0},ET=function(r,t){return r<t?1:r>t?-1:0};function OT(r){return function(t,e){return r(e,t)}}function AT(r){return r===2?function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:t[1]<e[1]?-1:t[1]>e[1]?1:0}:function(t,e){for(var i=0;i<r;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i++}return 0}}On.DEFAULT_COMPARATOR=LT;On.DEFAULT_REVERSE_COMPARATOR=ET;On.reverseComparator=OT;On.createTupleComparator=AT});var xf=V(Tu=>{Tu.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer!="undefined";Tu.SYMBOL_SUPPORT=typeof Symbol!="undefined"});var mt=V((kE,Cf)=>{var Sf=xf(),IT=Sf.ARRAY_BUFFER_SUPPORT,MT=Sf.SYMBOL_SUPPORT;Cf.exports=function(t,e){var i,s,a,h,c;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof e!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||IT&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(a=0,h=t.length;a<h;a++)e(t[a],a);return}if(typeof t.forEach=="function"){t.forEach(e);return}if(MT&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(i=t,a=0;c=i.next(),c.done!==!0;)e(c.value,a),a++;return}for(s in t)t.hasOwnProperty(s)&&e(t[s],s)}});var ms=V((FE,Mf)=>{var _f=An(),Lf=mt(),Ef=_f.DEFAULT_COMPARATOR,DT=_f.reverseComparator;function ie(r){if(this.clear(),this.comparator=r||Ef,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.")}ie.prototype.clear=function(){this.root=null,this.min=null,this.size=0};function kT(r){return{item:r,degree:0}}function Of(r,t){r.root?(t.right=r.root.right,t.left=r.root,r.root.right.left=t,r.root.right=t):r.root=t}ie.prototype.push=function(r){var t=kT(r);return t.left=t,t.right=t,Of(this,t),(!this.min||this.comparator(t.item,this.min.item)<=0)&&(this.min=t),++this.size};ie.prototype.peek=function(){return this.min?this.min.item:void 0};function Af(r){for(var t=[],e=r,i=!1;!(e===r&&i);)e===r&&(i=!0),t.push(e),e=e.right;return t}function If(r,t){r.root===t&&(r.root=t.right),t.left.right=t.right,t.right.left=t.left}function FT(r,t){r.child?(t.right=r.child.right,t.left=r.child,r.child.right.left=t,r.child.right=t):r.child=t}function RT(r,t,e){If(r,t),t.left=t,t.right=t,FT(e,t),e.degree++,t.parent=e}function zT(r){var t=new Array(r.size),e=Af(r.root),i,s,a,h,c,f;for(i=0,s=e.length;i<s;i++){for(a=e[i],c=a.degree;t[c];)h=t[c],r.comparator(a.item,h.item)>0&&(f=a,a=h,h=f),RT(r,h,a),t[c]=null,c++;t[c]=a}for(i=0;i<r.size;i++)t[i]&&r.comparator(t[i].item,r.min.item)<=0&&(r.min=t[i])}ie.prototype.pop=function(){if(this.size){var r=this.min;if(r.child){var t=Af(r.child),e,i,s;for(i=0,s=t.length;i<s;i++)e=t[i],Of(this,e),delete e.parent}return If(this,r),r===r.right?(this.min=null,this.root=null):(this.min=r.right,zT(this)),this.size--,r.item}};ie.prototype.inspect=function(){var r={size:this.size};return this.min&&"item"in this.min&&(r.top=this.min.item),Object.defineProperty(r,"constructor",{value:ie,enumerable:!1}),r};typeof Symbol!="undefined"&&(ie.prototype[Symbol.for("nodejs.util.inspect.custom")]=ie.prototype.inspect);function ps(r){if(this.clear(),this.comparator=r||Ef,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.");this.comparator=DT(this.comparator)}ps.prototype=ie.prototype;ie.from=function(r,t){var e=new ie(t);return Lf(r,function(i){e.push(i)}),e};ps.from=function(r,t){var e=new ps(t);return Lf(r,function(i){e.push(i)}),e};ie.MinFibonacciHeap=ie;ie.MaxFibonacciHeap=ps;Mf.exports=ie});var ne=V(or=>{var VT=Math.pow(2,8)-1,NT=Math.pow(2,16)-1,jT=Math.pow(2,32)-1,GT=Math.pow(2,7)-1,UT=Math.pow(2,15)-1,BT=Math.pow(2,31)-1;or.getPointerArray=function(r){var t=r-1;if(t<=VT)return Uint8Array;if(t<=NT)return Uint16Array;if(t<=jT)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};or.getSignedPointerArray=function(r){var t=r-1;return t<=GT?Int8Array:t<=UT?Int16Array:t<=BT?Int32Array:Float64Array};or.getNumberType=function(r){return r===(r|0)?Math.sign(r)===-1?r<=127&&r>=-128?Int8Array:r<=32767&&r>=-32768?Int16Array:Int32Array:r<=255?Uint8Array:r<=65535?Uint16Array:Uint32Array:Float64Array};var HT={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};or.getMinimalRepresentation=function(r,t){var e=null,i=0,s,a,h,c,f;for(c=0,f=r.length;c<f;c++)h=t?t(r[c]):r[c],a=or.getNumberType(h),s=HT[a.name],s>i&&(i=s,e=a);return e};or.isTypedArray=function(r){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView(r)};or.concat=function(){var r=0,t,e,i;for(t=0,i=arguments.length;t<i;t++)r+=arguments[t].length;var s=new arguments[0].constructor(r);for(t=0,e=0;t<i;t++)s.set(arguments[t],e),e+=arguments[t].length;return s};or.indices=function(r){for(var t=or.getPointerArray(r),e=new t(r),i=0;i<r;i++)e[i]=i;return e}});var pe=V(Mn=>{var Ff=mt(),Rf=ne();function WT(r){return Array.isArray(r)||Rf.isTypedArray(r)}function xu(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function qT(r){var t=xu(r),e=typeof t=="number"?new Array(t):[],i=0;return Ff(r,function(s){e[i++]=s}),e}function $T(r){var t=xu(r),e=typeof t=="number"?Rf.getPointerArray(t):Array,i=typeof t=="number"?new Array(t):[],s=typeof t=="number"?new e(t):[],a=0;return Ff(r,function(h){i[a]=h,s[a]=a++}),[i,s]}Mn.isArrayLike=WT;Mn.guessLength=xu;Mn.toArray=qT;Mn.toArrayWithIndices=$T});var Ts=V((oO,jf)=>{var bs=mt(),zf=An(),sr=pe(),Ps=zf.DEFAULT_COMPARATOR,Su=zf.reverseComparator;function Cu(r,t,e,i){for(var s=t[i],a,h;i>e;){if(a=i-1>>1,h=t[a],r(s,h)<0){t[i]=h,i=a;continue}break}t[i]=s}function Dn(r,t,e){for(var i=t.length,s=e,a=t[e],h=2*e+1,c;h<i;)c=h+1,c<i&&r(t[h],t[c])>=0&&(h=c),t[e]=t[h],e=h,h=2*e+1;t[e]=a,Cu(r,t,s,e)}function Vf(r,t,e){t.push(e),Cu(r,t,0,t.length-1)}function _u(r,t){var e=t.pop();if(t.length!==0){var i=t[0];return t[0]=e,Dn(r,t,0),i}return e}function Vi(r,t,e){if(t.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var i=t[0];return t[0]=e,Dn(r,t,0),i}function Nf(r,t,e){var i;return t.length!==0&&r(t[0],e)<0&&(i=t[0],t[0]=e,e=i,Dn(r,t,0)),e}function li(r,t){for(var e=t.length,i=e>>1,s=i;--s>=0;)Dn(r,t,s)}function Lu(r,t){for(var e=t.length,i=0,s=new Array(e);i<e;)s[i++]=_u(r,t);return s}function YT(r,t,e){arguments.length===2&&(e=t,t=r,r=Ps);var i=Su(r),s,a,h,c=1/0,f;if(t===1){if(sr.isArrayLike(e)){for(s=0,a=e.length;s<a;s++)h=e[s],(c===1/0||r(h,c)<0)&&(c=h);return f=new e.constructor(1),f[0]=c,f}return bs(e,function(y){(c===1/0||r(y,c)<0)&&(c=y)}),[c]}if(sr.isArrayLike(e)){if(t>=e.length)return e.slice().sort(r);for(f=e.slice(0,t),li(i,f),s=t,a=e.length;s<a;s++)i(e[s],f[0])>0&&Vi(i,f,e[s]);return f.sort(r)}var m=sr.guessLength(e);return m!==null&&m<t&&(t=m),f=new Array(t),s=0,bs(e,function(y){s<t?f[s]=y:(s===t&&li(i,f),i(y,f[0])>0&&Vi(i,f,y)),s++}),f.length>s&&(f.length=s),f.sort(r)}function QT(r,t,e){arguments.length===2&&(e=t,t=r,r=Ps);var i=Su(r),s,a,h,c=-1/0,f;if(t===1){if(sr.isArrayLike(e)){for(s=0,a=e.length;s<a;s++)h=e[s],(c===-1/0||r(h,c)>0)&&(c=h);return f=new e.constructor(1),f[0]=c,f}return bs(e,function(y){(c===-1/0||r(y,c)>0)&&(c=y)}),[c]}if(sr.isArrayLike(e)){if(t>=e.length)return e.slice().sort(i);for(f=e.slice(0,t),li(r,f),s=t,a=e.length;s<a;s++)r(e[s],f[0])>0&&Vi(r,f,e[s]);return f.sort(i)}var m=sr.guessLength(e);return m!==null&&m<t&&(t=m),f=new Array(t),s=0,bs(e,function(y){s<t?f[s]=y:(s===t&&li(r,f),r(y,f[0])>0&&Vi(r,f,y)),s++}),f.length>s&&(f.length=s),f.sort(i)}function at(r){if(this.clear(),this.comparator=r||Ps,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}at.prototype.clear=function(){this.items=[],this.size=0};at.prototype.push=function(r){return Vf(this.comparator,this.items,r),++this.size};at.prototype.peek=function(){return this.items[0]};at.prototype.pop=function(){return this.size!==0&&this.size--,_u(this.comparator,this.items)};at.prototype.replace=function(r){return Vi(this.comparator,this.items,r)};at.prototype.pushpop=function(r){return Nf(this.comparator,this.items,r)};at.prototype.consume=function(){return this.size=0,Lu(this.comparator,this.items)};at.prototype.toArray=function(){return Lu(this.comparator,this.items.slice())};at.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:at,enumerable:!1}),r};typeof Symbol!="undefined"&&(at.prototype[Symbol.for("nodejs.util.inspect.custom")]=at.prototype.inspect);function ws(r){if(this.clear(),this.comparator=r||Ps,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=Su(this.comparator)}ws.prototype=at.prototype;at.from=function(r,t){var e=new at(t),i;return sr.isArrayLike(r)?i=r.slice():i=sr.toArray(r),li(e.comparator,i),e.items=i,e.size=i.length,e};ws.from=function(r,t){var e=new ws(t),i;return sr.isArrayLike(r)?i=r.slice():i=sr.toArray(r),li(e.comparator,i),e.items=i,e.size=i.length,e};at.siftUp=Dn;at.siftDown=Cu;at.push=Vf;at.pop=_u;at.replace=Vi;at.pushpop=Nf;at.heapify=li;at.consume=Lu;at.nsmallest=YT;at.nlargest=QT;at.MinHeap=at;at.MaxHeap=ws;jf.exports=at});var Wf=V((sO,Hf)=>{var Gf="";function Uf(r,t,e){for(var i=t.length,s=[],a=i,h=-1,c,f=0,m;a--;)h=Math.max(r[t[a]+e],h);for(m=h>>24&&32||h>>16&&24||h>>8&&16||8;f<m;f+=4){for(a=16;a--;)s[a]=[];for(a=i;a--;)s[r[t[a]+e]>>f&15].push(t[a]);for(c=0;c<16;c++)for(h=s[c].length;h--;)t[++a]=s[c][h]}}function XT(r,t,e,i){return r[e]-r[i]||(e%3===2?r[e+1]-r[i+1]||t[e+2]-t[i+2]:t[e+1]-t[i+1])}function Eu(r,t){var e=[],i=[],s=2*t/3|0,a=t-s,h=s+1>>1,c=s,f=0,m,y=[],b=[];if(t===1)return[0];for(;c--;)e[c]=(c*3>>1)+1;for(c=3;c--;)Uf(r,e,c);for(f=i[(e[0]/3|0)+(e[0]%3===1?0:h)]=1,c=1;c<s;c++)(r[e[c]]!==r[e[c-1]]||r[e[c]+1]!==r[e[c-1]+1]||r[e[c]+2]!==r[e[c-1]+2])&&f++,i[(e[c]/3|0)+(e[c]%3===1?0:h)]=f;if(f<s)for(i=Eu(i,s),c=s;c--;)e[c]=i[c]<h?i[c]*3+1:(i[c]-h)*3+2;for(c=s;c--;)y[e[c]]=c;for(y[t]=-1,y[t+1]=-2,i=t%3===1?[t-1]:[],c=0;c<s;c++)e[c]%3===1&&i.push(e[c]-1);for(Uf(r,i,0),c=0,f=0,m=0;c<s&&f<a;)b[m++]=XT(r,y,e[c],i[f])<0?e[c++]:i[f++];for(;c<s;)b[m++]=e[c++];for(;f<a;)b[m++]=i[f++];return b}function Bf(r){var t=r.length,e=t%3,i=new Array(t+e),s,a;if(typeof r!="string"){var h=Object.create(null);for(a=0;a<t;a++)h[r[a]]||(h[r[a]]=!0);var c=Object.create(null),f=Object.keys(h).sort();for(a=0,s=f.length;a<s;a++)c[f[a]]=a+1;for(a=0;a<t;a++)i[a]=c[r[a]]}else for(a=0;a<t;a++)i[a]=r.charCodeAt(a);for(a=t;a<t+e;a++)i[a]=0;return i}function Br(r){this.hasArbitrarySequence=typeof r!="string",this.string=r,this.length=r.length,this.array=Eu(Bf(r),this.length)}Br.prototype.toString=function(){return this.array.join(",")};Br.prototype.toJSON=function(){return this.array};Br.prototype.inspect=function(){for(var r=new Array(this.length),t=0;t<this.length;t++)r[t]=this.string.slice(this.array[t]);return Object.defineProperty(r,"constructor",{value:Br,enumerable:!1}),r};typeof Symbol!="undefined"&&(Br.prototype[Symbol.for("nodejs.util.inspect.custom")]=Br.prototype.inspect);function Hr(r){if(this.hasArbitrarySequence=typeof r[0]!="string",this.size=r.length,this.hasArbitrarySequence){this.text=[];for(var t=0,e=this.size;t<e;t++)this.text.push.apply(this.text,r[t]),t<e-1&&this.text.push(Gf)}else this.text=r.join(Gf);this.firstLength=r[0].length,this.length=this.text.length,this.array=Eu(Bf(this.text),this.length)}Hr.prototype.longestCommonSubsequence=function(){var r=this.hasArbitrarySequence?[]:"",t,e,i,s,a;for(e=1;e<this.length;e++)if(s=this.array[e],a=this.array[e-1],!(s<this.firstLength&&a<this.firstLength)&&!(s>this.firstLength&&a>this.firstLength)){for(t=Math.min(this.length-s,this.length-a),i=0;i<t;i++)if(this.text[s+i]!==this.text[a+i]){t=i;break}t>r.length&&(r=this.text.slice(s,s+t))}return r};Hr.prototype.toString=function(){return this.array.join(",")};Hr.prototype.toJSON=function(){return this.array};Hr.prototype.inspect=function(){for(var r=new Array(this.length),t=0;t<this.length;t++)r[t]=this.text.slice(this.array[t]);return Object.defineProperty(r,"constructor",{value:Hr,enumerable:!1}),r};typeof Symbol!="undefined"&&(Hr.prototype[Symbol.for("nodejs.util.inspect.custom")]=Hr.prototype.inspect);Br.GeneralizedSuffixArray=Hr;Hf.exports=Br});var Xf=V((aO,Qf)=>{var KT=mt();function $e(r){this.size=0,this.items=new Map,this.inverse=r}function xe(){this.size=0,this.items=new Map,this.inverse=new $e(this)}function qf(){this.size=0,this.items.clear(),this.inverse.items.clear()}xe.prototype.clear=qf;$e.prototype.clear=qf;function $f(r,t){if(this.items.has(r)){var e=this.items.get(r);if(e===t)return this;this.inverse.items.delete(e)}if(this.inverse.items.has(t)){var i=this.inverse.items.get(t);if(i===r)return this;this.items.delete(i)}return this.items.set(r,t),this.inverse.items.set(t,r),this.size=this.items.size,this.inverse.size=this.inverse.items.size,this}xe.prototype.set=$f;$e.prototype.set=$f;function Yf(r){if(this.items.has(r)){var t=this.items.get(r);return this.items.delete(r),this.inverse.items.delete(t),this.size=this.items.size,this.inverse.size=this.inverse.items.size,!0}return!1}xe.prototype.delete=Yf;$e.prototype.delete=Yf;var JT=["has","get","forEach","keys","values","entries"];JT.forEach(function(r){xe.prototype[r]=$e.prototype[r]=function(){return Map.prototype[r].apply(this.items,arguments)}});typeof Symbol!="undefined"&&(xe.prototype[Symbol.iterator]=xe.prototype.entries,$e.prototype[Symbol.iterator]=$e.prototype.entries);xe.prototype.inspect=function(){var r={left:this.items,right:this.inverse.items};return Object.defineProperty(r,"constructor",{value:xe,enumerable:!1}),r};typeof Symbol!="undefined"&&(xe.prototype[Symbol.for("nodejs.util.inspect.custom")]=xe.prototype.inspect);$e.prototype.inspect=function(){var r={left:this.inverse.items,right:this.items};return Object.defineProperty(r,"constructor",{value:$e,enumerable:!1}),r};typeof Symbol!="undefined"&&($e.prototype[Symbol.for("nodejs.util.inspect.custom")]=$e.prototype.inspect);xe.from=function(r){var t=new xe;return KT(r,function(e,i){t.set(i,e)}),t};Qf.exports=xe});var Nt=V((uO,Kf)=>{function ar(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol!="undefined"&&(ar.prototype[Symbol.iterator]=function(){return this});ar.of=function(){var r=arguments,t=r.length,e=0;return new ar(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};ar.empty=function(){var r=new ar(function(){return{done:!0}});return r};ar.fromSequence=function(r){var t=0,e=r.length;return new ar(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};ar.is=function(r){return r instanceof ar?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};Kf.exports=ar});var Au=V(Ye=>{function Zf(r){return r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r&~(r>>1)}Ye.msb32=Zf;function Ou(r){return r|=r>>1,r|=r>>2,r|=r>>4,r&~(r>>1)}Ye.msb8=Ou;Ye.test=function(r,t){return r>>t&1};Ye.criticalBit8=function(r,t){return Ou(r^t)};Ye.criticalBit8Mask=function(r,t){return~Ou(r^t)>>>0&255};Ye.testCriticalBit8=function(r,t){return 1+(r|t)>>8};Ye.criticalBit32Mask=function(r,t){return~Zf(r^t)>>>0&4294967295};Ye.popcount=function(r){return r-=r>>1&1431655765,r=(r&858993459)+(r>>2&858993459),r=r+(r>>4)&252645135,r+=r>>8,r+=r>>16,r&127};var Ni=new Uint8Array(Math.pow(2,8));for(kn=0,Jf=Ni.length;kn<Jf;kn++)Ni[kn]=Ye.popcount(kn);var kn,Jf;Ye.table8Popcount=function(r){return Ni[r&255]+Ni[r>>8&255]+Ni[r>>16&255]+Ni[r>>24&255]}});var ip=V((lO,rp)=>{var ep=Nt(),tp=Au();function Dt(r){this.length=r,this.clear()}Dt.prototype.clear=function(){this.size=0,this.array=new Uint32Array(Math.ceil(this.length/32))};Dt.prototype.set=function(r,t){var e=r>>5,i=r&31,s=this.array[e],a;return t===0||t===!1?a=this.array[e]&=~(1<<i):a=this.array[e]|=1<<i,a=a>>>0,a>s?this.size++:a<s&&this.size--,this};Dt.prototype.reset=function(r){var t=r>>5,e=r&31,i=this.array[t],s;return s=this.array[t]&=~(1<<e),s<i&&this.size--,this};Dt.prototype.flip=function(r){var t=r>>5,e=r&31,i=this.array[t],s=this.array[t]^=1<<e;return s=s>>>0,s>i?this.size++:s<i&&this.size--,this};Dt.prototype.get=function(r){var t=r>>5,e=r&31;return this.array[t]>>e&1};Dt.prototype.test=function(r){return!!this.get(r)};Dt.prototype.rank=function(r){if(this.size===0)return 0;for(var t=r>>5,e=r&31,i=0,s=0;s<t;s++)i+=tp.table8Popcount(this.array[s]);var a=this.array[t]&(1<<e)-1;return i+=tp.table8Popcount(a),i};Dt.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var t,e=32,i=0,s=0,a=0,h=this.array.length;a<h;a++)if(t=this.array[a],t!==0){a===h-1&&(e=this.length%32||32);for(var c=0;c<e;c++,i++)if(s+=t>>c&1,s===r)return i}};Dt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.length,i,s,a=32,h=0,c=this.array.length;h<c;h++){i=this.array[h],h===c-1&&(a=e%32||32);for(var f=0;f<a;f++)s=i>>f&1,r.call(t,s,h*32+f)}};Dt.prototype.values=function(){var r=this.length,t=!1,e,i,s=this.array,a=s.length,h=0,c=-1,f=32;return new ep(function m(){if(!t){if(h>=a)return{done:!0};h===a-1&&(f=r%32||32),e=s[h++],t=!0,c=-1}return c++,c>=f?(t=!1,m()):(i=e>>c&1,{value:i})})};Dt.prototype.entries=function(){var r=this.length,t=!1,e,i,s=this.array,a,h=s.length,c=0,f=-1,m=32;return new ep(function y(){if(!t){if(c>=h)return{done:!0};c===h-1&&(m=r%32||32),e=s[c++],t=!0,f=-1}return f++,a=~-c*32+f,f>=m?(t=!1,y()):(i=e>>f&1,{value:[a,i]})})};typeof Symbol!="undefined"&&(Dt.prototype[Symbol.iterator]=Dt.prototype.values);Dt.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(t,e){r[e]=t}),Object.defineProperty(r,"constructor",{value:Dt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Dt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Dt.prototype.inspect);Dt.prototype.toJSON=function(){return Array.from(this.array)};rp.exports=Dt});var ap=V((cO,sp)=>{var op=Nt(),np=Au(),ZT=function(r){return Math.max(1,Math.ceil(r*1.5))};function tx(r){return new Uint32Array(Math.ceil(r/32))}function dt(r){var t=r||0,e=ZT;typeof r=="object"&&(t=r.initialLength||r.initialCapacity||0,e=r.policy||e),this.size=0,this.length=t,this.capacity=Math.ceil(this.length/32)*32,this.policy=e,this.array=tx(this.capacity)}dt.prototype.set=function(r,t){if(this.length<r)throw new Error("BitVector.set: index out of bounds.");var e=r>>5,i=r&31,s=this.array[e],a;return t===0||t===!1?a=this.array[e]&=~(1<<i):a=this.array[e]|=1<<i,a=a>>>0,a>s?this.size++:a<s&&this.size--,this};dt.prototype.reset=function(r){var t=r>>5,e=r&31,i=this.array[t],s;return s=this.array[t]&=~(1<<e),s<i&&this.size--,this};dt.prototype.flip=function(r){var t=r>>5,e=r&31,i=this.array[t],s=this.array[t]^=1<<e;return s=s>>>0,s>i?this.size++:s<i&&this.size--,this};dt.prototype.applyPolicy=function(r){var t=this.policy(r||this.capacity);if(typeof t!="number"||t<0)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(t<=this.capacity)throw new Error("mnemonist/bit-vector.applyPolicy: policy returned a less or equal capacity to allocate.");return Math.ceil(t/32)*32};dt.prototype.reallocate=function(r){var t=r;if(r=Math.ceil(r/32)*32,t<this.length&&(this.length=t),r===this.capacity)return this;var e=this.array,i=r/32;return i===this.array.length?this:(i>this.array.length?(this.array=new Uint32Array(i),this.array.set(e,0)):this.array=e.slice(0,i),this.capacity=r,this)};dt.prototype.grow=function(r){var t;if(typeof r=="number"){if(this.capacity>=r)return this;for(t=this.capacity;t<r;)t=this.applyPolicy(t);return this.reallocate(t),this}return t=this.applyPolicy(),this.reallocate(t),this};dt.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};dt.prototype.push=function(r){if(this.capacity===this.length&&this.grow(),r===0||r===!1)return++this.length;this.size++;var t=this.length++,e=t>>5,i=t&31;return this.array[e]|=1<<i,this.length};dt.prototype.pop=function(){if(this.length!==0){var r=--this.length,t=r>>5,e=r&31;return this.array[t]>>e&1}};dt.prototype.get=function(r){if(!(this.length<r)){var t=r>>5,e=r&31;return this.array[t]>>e&1}};dt.prototype.test=function(r){return this.length<r?!1:!!this.get(r)};dt.prototype.rank=function(r){if(this.size===0)return 0;for(var t=r>>5,e=r&31,i=0,s=0;s<t;s++)i+=np.table8Popcount(this.array[s]);var a=this.array[t]&(1<<e)-1;return i+=np.table8Popcount(a),i};dt.prototype.select=function(r){if(this.size===0||r>=this.length)return-1;for(var t,e=32,i=0,s=0,a=0,h=this.array.length;a<h;a++)if(t=this.array[a],t!==0){a===h-1&&(e=this.length%32||32);for(var c=0;c<e;c++,i++)if(s+=t>>c&1,s===r)return i}};dt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.length,i,s,a=32,h=0,c=this.array.length;h<c;h++){i=this.array[h],h===c-1&&(a=e%32||32);for(var f=0;f<a;f++)s=i>>f&1,r.call(t,s,h*32+f)}};dt.prototype.values=function(){var r=this.length,t=!1,e,i,s=this.array,a=s.length,h=0,c=-1,f=32;return new op(function m(){if(!t){if(h>=a)return{done:!0};h===a-1&&(f=r%32||32),e=s[h++],t=!0,c=-1}return c++,c>=f?(t=!1,m()):(i=e>>c&1,{value:i})})};dt.prototype.entries=function(){var r=this.length,t=!1,e,i,s=this.array,a,h=s.length,c=0,f=-1,m=32;return new op(function y(){if(!t){if(c>=h)return{done:!0};c===h-1&&(m=r%32||32),e=s[c++],t=!0,f=-1}return f++,a=~-c*32+f,f>=m?(t=!1,y()):(i=e>>f&1,{value:[a,i]})})};typeof Symbol!="undefined"&&(dt.prototype[Symbol.iterator]=dt.prototype.values);dt.prototype.inspect=function(){var r=new Uint8Array(this.length);return this.forEach(function(t,e){r[e]=t}),Object.defineProperty(r,"constructor",{value:dt,enumerable:!1}),r};typeof Symbol!="undefined"&&(dt.prototype[Symbol.for("nodejs.util.inspect.custom")]=dt.prototype.inspect);dt.prototype.toJSON=function(){return Array.from(this.array.slice(0,(this.length>>5)+1))};sp.exports=dt});var hp=V((fO,up)=>{function ci(r,t){return(r&65535)*t+(((r>>>16)*t&65535)<<16)&4294967295}function ex(r,t){return(r&65535)+(t>>>16)+(((r>>>16)+t&65535)<<16)&4294967295}function Iu(r,t){return r<<t|r>>>32-t}up.exports=function(t,e){var i=3432918353,s=461845907,a=15,h=13,c=5,f=1801774676,m=t,y,b,_;for(b=0,_=e.length-4;b<=_;b+=4)y=e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24,y=ci(y,i),y=Iu(y,a),y=ci(y,s),m^=y,m=Iu(m,h),m=ci(m,c),m=ex(m,f);switch(y=0,e.length&3){case 3:y^=e[b+2]<<16;case 2:y^=e[b+1]<<8;case 1:y^=e[b],y=ci(y,i),y=Iu(y,a),y=ci(y,s),m^=y;default:}return m^=e.length,m^=m>>>16,m=ci(m,2246822507),m^=m>>>13,m=ci(m,3266489909),m^=m>>>16,m>>>0}});var pp=V((pO,fp)=>{var rx=hp(),ix=mt(),nx=Math.LN2*Math.LN2,ox={errorRate:.005};function lp(r){var t=new Uint16Array(r.length),e,i;for(e=0,i=r.length;e<i;e++)t[e]=r.charCodeAt(e);return t}function cp(r,t,e){var i=rx(t*4221880213&4294967295,e);return i%(r*8)}function fi(r){var t={};if(!r)throw new Error("mnemonist/BloomFilter.constructor: a BloomFilter must be created with a capacity.");if(typeof r=="object"?t=r:t.capacity=r,typeof t.capacity!="number"||t.capacity<=0)throw new Error("mnemonist/BloomFilter.constructor: `capacity` option should be a positive integer.");if(this.capacity=t.capacity,this.errorRate=t.errorRate||ox.errorRate,typeof this.errorRate!="number"||t.errorRate<=0)throw new Error("mnemonist/BloomFilter.constructor: `errorRate` option should be a positive float.");this.clear()}fi.prototype.clear=function(){var r=-1/nx*this.capacity*Math.log(this.errorRate),t=r/8|0;this.hashFunctions=t*8/this.capacity*Math.LN2|0,this.data=new Uint8Array(t)};fi.prototype.add=function(r){for(var t=lp(r),e=0,i=this.hashFunctions;e<i;e++){var s=cp(this.data.length,e,t),a=1<<(7&s);this.data[s>>3]|=a}return this};fi.prototype.test=function(r){for(var t=lp(r),e=0,i=this.hashFunctions;e<i;e++){var s=cp(this.data.length,e,t);if(!(this.data[s>>3]&1<<(7&s)))return!1}return!0};fi.prototype.toJSON=function(){return this.data};fi.from=function(r,t){if(!t&&(t=r.length||r.size,typeof t!="number"))throw new Error("BloomFilter.from: could not infer the filter's capacity. Try passing it as second argument.");var e=new fi(t);return ix(r,function(i){e.add(i)}),e};fp.exports=fi});var dp=V((mO,mp)=>{var sx=mt();function Qe(r){if(typeof r!="function")throw new Error("mnemonist/BKTree.constructor: given `distance` should be a function.");this.distance=r,this.clear()}Qe.prototype.add=function(r){if(!this.root)return this.root={item:r,children:{}},this.size++,this;for(var t=this.root,e;e=this.distance(r,t.item),!!t.children[e];)t=t.children[e];return t.children[e]={item:r,children:{}},this.size++,this};Qe.prototype.search=function(r,t){if(!this.root)return[];for(var e=[],i=[this.root],s,a,h,c,f;i.length;)for(s=i.pop(),h=this.distance(t,s.item),h<=r&&e.push({item:s.item,distance:h}),c=h-r,f=h+r+1;c<f;c++)a=s.children[c],a&&i.push(a);return e};Qe.prototype.clear=function(){this.size=0,this.root=null};Qe.prototype.toJSON=function(){return this.root};Qe.prototype.inspect=function(){for(var r=[],t=[this.root],e,i;t.length;)if(e=t.pop(),!!e){r.push(e.item);for(i in e.children)t.push(e.children[i])}return Object.defineProperty(r,"constructor",{value:Qe,enumerable:!1}),r};typeof Symbol!="undefined"&&(Qe.prototype[Symbol.for("nodejs.util.inspect.custom")]=Qe.prototype.inspect);Qe.from=function(r,t){var e=new Qe(t);return sx(r,function(i){e.add(i)}),e};mp.exports=Qe});var Du=V((dO,yp)=>{var Mu=pe(),gp=Nt();function St(r,t){if(arguments.length<2)throw new Error("mnemonist/fixed-deque: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-deque: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=t,this.items=new r(this.capacity),this.clear()}St.prototype.clear=function(){this.start=0,this.size=0};St.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.push: deque capacity ("+this.capacity+") exceeded!");var t=this.start+this.size;return t>=this.capacity&&(t-=this.capacity),this.items[t]=r,++this.size};St.prototype.unshift=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-deque.unshift: deque capacity ("+this.capacity+") exceeded!");var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=r,this.start=t,++this.size};St.prototype.pop=function(){if(this.size!==0){this.size--;var r=this.start+this.size;return r>=this.capacity&&(r-=this.capacity),this.items[r]}};St.prototype.shift=function(){if(this.size!==0){var r=this.start;return this.size--,this.start++,this.start===this.capacity&&(this.start=0),this.items[r]}};St.prototype.peekFirst=function(){if(this.size!==0)return this.items[this.start]};St.prototype.peekLast=function(){if(this.size!==0){var r=this.start+this.size-1;return r>=this.capacity&&(r-=this.capacity),this.items[r]}};St.prototype.get=function(r){if(!(this.size===0||r>=this.capacity))return r=this.start+r,r>=this.capacity&&(r-=this.capacity),this.items[r]};St.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.capacity,i=this.size,s=this.start,a=0;a<i;)r.call(t,this.items[s],a,this),s++,a++,s===e&&(s=0)};St.prototype.toArray=function(){var r=this.start+this.size;if(r<this.capacity)return this.items.slice(this.start,r);for(var t=new this.ArrayClass(this.size),e=this.capacity,i=this.size,s=this.start,a=0;a<i;)t[a]=this.items[s],s++,a++,s===e&&(s=0);return t};St.prototype.values=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,s=0;return new gp(function(){if(s>=e)return{done:!0};var a=r[i];return i++,s++,i===t&&(i=0),{value:a,done:!1}})};St.prototype.entries=function(){var r=this.items,t=this.capacity,e=this.size,i=this.start,s=0;return new gp(function(){if(s>=e)return{done:!0};var a=r[i];return i++,i===t&&(i=0),{value:[s++,a],done:!1}})};typeof Symbol!="undefined"&&(St.prototype[Symbol.iterator]=St.prototype.values);St.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:St,enumerable:!1}),r};typeof Symbol!="undefined"&&(St.prototype[Symbol.for("nodejs.util.inspect.custom")]=St.prototype.inspect);St.from=function(r,t,e){if(arguments.length<3&&(e=Mu.guessLength(r),typeof e!="number"))throw new Error("mnemonist/fixed-deque.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new St(t,e);if(Mu.isArrayLike(r)){var s,a;for(s=0,a=r.length;s<a;s++)i.items[s]=r[s];return i.size=a,i}return Mu.forEach(r,function(h){i.push(h)}),i};yp.exports=St});var wp=V((gO,bp)=>{var ku=pe(),Fu=Du();function ji(r,t){if(arguments.length<2)throw new Error("mnemonist/circular-buffer: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/circular-buffer: `capacity` should be a positive number.");this.ArrayClass=r,this.capacity=t,this.items=new r(this.capacity),this.clear()}function vp(r){ji.prototype[r]=Fu.prototype[r]}Object.keys(Fu.prototype).forEach(vp);typeof Symbol!="undefined"&&Object.getOwnPropertySymbols(Fu.prototype).forEach(vp);ji.prototype.push=function(r){var t=this.start+this.size;return t>=this.capacity&&(t-=this.capacity),this.items[t]=r,this.size===this.capacity?(t++,t>=this.capacity?this.start=0:this.start=t,this.size):++this.size};ji.prototype.unshift=function(r){var t=this.start-1;return this.start===0&&(t=this.capacity-1),this.items[t]=r,this.size===this.capacity?(this.start=t,this.size):(this.start=t,++this.size)};ji.from=function(r,t,e){if(arguments.length<3&&(e=ku.guessLength(r),typeof e!="number"))throw new Error("mnemonist/circular-buffer.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new ji(t,e);if(ku.isArrayLike(r)){var s,a;for(s=0,a=r.length;s<a;s++)i.items[s]=r[s];return i.size=a,i}return ku.forEach(r,function(h){i.push(h)}),i};bp.exports=ji});var Tp=V((yO,Pp)=>{function qt(r){if(typeof r!="function")throw new Error("mnemonist/DefaultMap.constructor: expecting a function.");this.items=new Map,this.factory=r,this.size=0}qt.prototype.clear=function(){this.items.clear(),this.size=0};qt.prototype.get=function(r){var t=this.items.get(r);return typeof t=="undefined"&&(t=this.factory(r,this.size),this.items.set(r,t),this.size++),t};qt.prototype.peek=function(r){return this.items.get(r)};qt.prototype.set=function(r,t){return this.items.set(r,t),this.size=this.items.size,this};qt.prototype.has=function(r){return this.items.has(r)};qt.prototype.delete=function(r){var t=this.items.delete(r);return this.size=this.items.size,t};qt.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};qt.prototype.entries=function(){return this.items.entries()};qt.prototype.keys=function(){return this.items.keys()};qt.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(qt.prototype[Symbol.iterator]=qt.prototype.entries);qt.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(qt.prototype[Symbol.for("nodejs.util.inspect.custom")]=qt.prototype.inspect);qt.autoIncrement=function(){var r=0;return function(){return r++}};Pp.exports=qt});var Sp=V((vO,xp)=>{function ur(r){if(typeof r!="function")throw new Error("mnemonist/DefaultWeakMap.constructor: expecting a function.");this.items=new WeakMap,this.factory=r}ur.prototype.clear=function(){this.items=new WeakMap};ur.prototype.get=function(r){var t=this.items.get(r);return typeof t=="undefined"&&(t=this.factory(r),this.items.set(r,t)),t};ur.prototype.peek=function(r){return this.items.get(r)};ur.prototype.set=function(r,t){return this.items.set(r,t),this};ur.prototype.has=function(r){return this.items.has(r)};ur.prototype.delete=function(r){return this.items.delete(r)};ur.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(ur.prototype[Symbol.for("nodejs.util.inspect.custom")]=ur.prototype.inspect);xp.exports=ur});var _p=V((bO,Cp)=>{var Ru=ne();function hr(r){var t=Ru.getPointerArray(r),e=Ru.getPointerArray(Math.log2(r));this.size=r,this.dimension=r,this.parents=new t(r),this.ranks=new e(r);for(var i=0;i<r;i++)this.parents[i]=i}hr.prototype.find=function(r){for(var t=r,e,i;e=this.parents[t],t!==e;)t=e;for(;i=this.parents[r],i!==t;)this.parents[r]=t,r=i;return t};hr.prototype.union=function(r,t){var e=this.find(r),i=this.find(t);if(e===i)return this;this.dimension--;var s=this.ranks[r],a=this.ranks[t];return s<a?this.parents[e]=i:s>a?this.parents[i]=e:(this.parents[i]=e,this.ranks[e]++),this};hr.prototype.connected=function(r,t){var e=this.find(r);return e===this.find(t)};hr.prototype.mapping=function(){for(var r=Ru.getPointerArray(this.dimension),t={},e=new r(this.size),i=0,s,a=0,h=this.parents.length;a<h;a++)s=this.find(a),typeof t[s]=="undefined"?(e[a]=i,t[s]=i++):e[a]=t[s];return e};hr.prototype.compile=function(){for(var r={},t=new Array(this.dimension),e=0,i,s=0,a=this.parents.length;s<a;s++)i=this.find(s),typeof r[i]=="undefined"?(t[e]=[s],r[i]=e++):t[r[i]].push(s);return t};hr.prototype.inspect=function(){var r=this.compile();return Object.defineProperty(r,"constructor",{value:hr,enumerable:!1}),r};typeof Symbol!="undefined"&&(hr.prototype[Symbol.for("nodejs.util.inspect.custom")]=hr.prototype.inspect);Cp.exports=hr});var xs=V((wO,Op)=>{var Lp=An(),zu=Ts(),ax=Lp.DEFAULT_COMPARATOR,ux=Lp.reverseComparator;function hx(r,t,e,i){for(var s=e,a=i,h=t[i],c=2*i+1,f;c<s;)f=c+1,f<s&&r(t[c],t[f])>=0&&(c=f),t[i]=t[c],i=c,c=2*i+1;t[i]=h,zu.siftDown(r,t,a,i)}function Ep(r,t,e,i){for(var s=i,a=s,h=new r(i),c,f;a>0;)c=e[--a],a!==0&&(f=e[0],e[0]=c,hx(t,e,--i,0),c=f),h[a]=c;return h}function lr(r,t,e){if(arguments.length===2&&(e=t,t=null),this.ArrayClass=r,this.capacity=e,this.items=new r(e),this.clear(),this.comparator=t||ax,typeof e!="number"&&e<=0)throw new Error("mnemonist/FixedReverseHeap.constructor: capacity should be a number > 0.");if(typeof this.comparator!="function")throw new Error("mnemonist/FixedReverseHeap.constructor: given comparator should be a function.");this.comparator=ux(this.comparator)}lr.prototype.clear=function(){this.size=0};lr.prototype.push=function(r){return this.size<this.capacity?(this.items[this.size]=r,zu.siftDown(this.comparator,this.items,0,this.size),this.size++):this.comparator(r,this.items[0])>0&&zu.replace(this.comparator,this.items,r),this.size};lr.prototype.peek=function(){return this.items[0]};lr.prototype.consume=function(){var r=Ep(this.ArrayClass,this.comparator,this.items,this.size);return this.size=0,r};lr.prototype.toArray=function(){return Ep(this.ArrayClass,this.comparator,this.items.slice(0,this.size),this.size)};lr.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:lr,enumerable:!1}),r};typeof Symbol!="undefined"&&(lr.prototype[Symbol.for("nodejs.util.inspect.custom")]=lr.prototype.inspect);Op.exports=lr});var Mp=V((PO,Ip)=>{var lx=mt(),Ap=function(r){return r};function Kt(r){if(this.items=new Map,this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=Ap),this.readHashFunction||(this.readHashFunction=Ap),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMap.constructor: invalid hash function given.")}Kt.prototype.clear=function(){this.items.clear(),this.size=0};Kt.prototype.add=function(r){var t=this.writeHashFunction(r);return this.items.set(t,r),this.size=this.items.size,this};Kt.prototype.set=function(r,t){return r=this.writeHashFunction(r),this.items.set(r,t),this.size=this.items.size,this};Kt.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};Kt.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};Kt.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(function(e){r.call(t,e,e)})};Kt.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(Kt.prototype[Symbol.iterator]=Kt.prototype.values);Kt.prototype.inspect=function(){var r=Array.from(this.items.values());return Object.defineProperty(r,"constructor",{value:Kt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Kt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Kt.prototype.inspect);Kt.from=function(r,t,e){var i=new Kt(t);return lx(r,function(s,a){e?i.set(a,s):i.add(s)}),i};Ip.exports=Kt});var Vu=V((TO,Dp)=>{var Ss=Nt(),cx=mt();function ct(r){this.Container=r||Array,this.items=new Map,this.clear(),Object.defineProperty(this.items,"constructor",{value:ct,enumerable:!1})}ct.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};ct.prototype.set=function(r,t){var e=this.items.get(r),i;return e||(this.dimension++,e=new this.Container,this.items.set(r,e)),this.Container===Set?(i=e.size,e.add(t),i<e.size&&this.size++):(e.push(t),this.size++),this};ct.prototype.delete=function(r){var t=this.items.get(r);return t?(this.size-=this.Container===Set?t.size:t.length,this.dimension--,this.items.delete(r),!0):!1};ct.prototype.remove=function(r,t){var e=this.items.get(r),i,s;return e?this.Container===Set?(i=e.delete(t),i&&this.size--,e.size===0&&(this.items.delete(r),this.dimension--),i):(s=e.indexOf(t),s===-1?!1:(this.size--,e.length===1?(this.items.delete(r),this.dimension--,!0):(e.splice(s,1),!0))):!1};ct.prototype.has=function(r){return this.items.has(r)};ct.prototype.get=function(r){return this.items.get(r)};ct.prototype.multiplicity=function(r){var t=this.items.get(r);return typeof t=="undefined"?0:this.Container===Set?t.size:t.length};ct.prototype.count=ct.prototype.multiplicity;ct.prototype.forEach=function(r,t){t=arguments.length>1?t:this;var e;function i(s){r.call(t,s,e)}this.items.forEach(function(s,a){e=a,s.forEach(i)})};ct.prototype.forEachAssociation=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};ct.prototype.keys=function(){return this.items.keys()};ct.prototype.values=function(){var r=this.items.values(),t=!1,e,i,s,a;return this.Container===Set?new Ss(function h(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,e=i.value.values()}return i=e.next(),i.done?(t=!1,h()):{done:!1,value:i.value}}):new Ss(function h(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,e=i.value,s=0,a=e.length}return s>=a?(t=!1,h()):{done:!1,value:e[s++]}})};ct.prototype.entries=function(){var r=this.items.entries(),t=!1,e,i,s,a,h;return this.Container===Set?new Ss(function c(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,s=i.value[0],e=i.value[1].values()}return i=e.next(),i.done?(t=!1,c()):{done:!1,value:[s,i.value]}}):new Ss(function c(){if(!t){if(i=r.next(),i.done)return{done:!0};t=!0,s=i.value[0],e=i.value[1],a=0,h=e.length}return a>=h?(t=!1,c()):{done:!1,value:[s,e[a++]]}})};ct.prototype.containers=function(){return this.items.values()};ct.prototype.associations=function(){return this.items.entries()};typeof Symbol!="undefined"&&(ct.prototype[Symbol.iterator]=ct.prototype.entries);ct.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(ct.prototype[Symbol.for("nodejs.util.inspect.custom")]=ct.prototype.inspect);ct.prototype.toJSON=function(){return this.items};ct.from=function(r,t){var e=new ct(t);return cx(r,function(i,s){e.set(s,i)}),e};Dp.exports=ct});var Rp=V((xO,Fp)=>{var fx=Vu(),px=mt(),kp=function(r){return r};function Jt(r,t){if(this.items=new fx(t),this.clear(),Array.isArray(r)?(this.writeHashFunction=r[0],this.readHashFunction=r[1]):(this.writeHashFunction=r,this.readHashFunction=r),this.writeHashFunction||(this.writeHashFunction=kp),this.readHashFunction||(this.readHashFunction=kp),typeof this.writeHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.");if(typeof this.readHashFunction!="function")throw new Error("mnemonist/FuzzyMultiMap.constructor: invalid hash function given.")}Jt.prototype.clear=function(){this.items.clear(),this.size=0,this.dimension=0};Jt.prototype.add=function(r){var t=this.writeHashFunction(r);return this.items.set(t,r),this.size=this.items.size,this.dimension=this.items.dimension,this};Jt.prototype.set=function(r,t){return r=this.writeHashFunction(r),this.items.set(r,t),this.size=this.items.size,this.dimension=this.items.dimension,this};Jt.prototype.get=function(r){return r=this.readHashFunction(r),this.items.get(r)};Jt.prototype.has=function(r){return r=this.readHashFunction(r),this.items.has(r)};Jt.prototype.forEach=function(r,t){t=arguments.length>1?t:this,this.items.forEach(function(e){r.call(t,e,e)})};Jt.prototype.values=function(){return this.items.values()};typeof Symbol!="undefined"&&(Jt.prototype[Symbol.iterator]=Jt.prototype.values);Jt.prototype.inspect=function(){var r=Array.from(this);return Object.defineProperty(r,"constructor",{value:Jt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Jt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Jt.prototype.inspect);Jt.from=function(r,t,e,i){arguments.length===3&&typeof e=="boolean"&&(i=e,e=Array);var s=new Jt(t,e);return px(r,function(a,h){i?s.set(h,a):s.add(a)}),s};Fp.exports=Jt});var Np=V((SO,Vp)=>{var zp=1024;function mx(r){return(r&r-1)===0}function Xe(r,t){if(arguments.length<1)throw new Error("mnemonist/hashed-array-tree: expecting at least a byte array constructor.");var e=t||0,i=zp,s=0;if(typeof t=="object"&&(e=t.initialCapacity||0,s=t.initialLength||0,i=t.blockSize||zp),!i||!mx(i))throw new Error("mnemonist/hashed-array-tree: block size should be a power of two.");var a=Math.max(s,e),h=Math.ceil(a/i);this.ArrayClass=r,this.length=s,this.capacity=h*i,this.blockSize=i,this.offsetMask=i-1,this.blockMask=Math.log2(i),this.blocks=new Array(h);for(var c=0;c<h;c++)this.blocks[c]=new this.ArrayClass(this.blockSize)}Xe.prototype.set=function(r,t){if(this.length<r)throw new Error("HashedArrayTree("+this.ArrayClass.name+").set: index out of bounds.");var e=r>>this.blockMask,i=r&this.offsetMask;return this.blocks[e][i]=t,this};Xe.prototype.get=function(r){if(!(this.length<r)){var t=r>>this.blockMask,e=r&this.offsetMask;return this.blocks[t][e]}};Xe.prototype.grow=function(r){if(typeof r!="number"&&(r=this.capacity+this.blockSize),this.capacity>=r)return this;for(;this.capacity<r;)this.blocks.push(new this.ArrayClass(this.blockSize)),this.capacity+=this.blockSize;return this};Xe.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.grow(r),this)};Xe.prototype.push=function(r){this.capacity===this.length&&this.grow();var t=this.length,e=t>>this.blockMask,i=t&this.offsetMask;return this.blocks[e][i]=r,++this.length};Xe.prototype.pop=function(){if(this.length!==0){var r=this.blocks[this.blocks.length-1],t=--this.length&this.offsetMask;return r[t]}};Xe.prototype.inspect=function(){for(var r=new this.ArrayClass(this.length),t,e=0,i=this.length;e<i;e++)t=e>>this.blockMask,r[e]=this.blocks[t][e&this.offsetMask];return r.type=this.ArrayClass.name,r.items=this.length,r.capacity=this.capacity,r.blockSize=this.blockSize,Object.defineProperty(r,"constructor",{value:Xe,enumerable:!1}),r};typeof Symbol!="undefined"&&(Xe.prototype[Symbol.for("nodejs.util.inspect.custom")]=Xe.prototype.inspect);Vp.exports=Xe});var ju=V((CO,Gp)=>{var jp=Nt(),Nu=pe();function kt(r,t){if(arguments.length<2)throw new Error("mnemonist/fixed-stack: expecting an Array class and a capacity.");if(typeof t!="number"||t<=0)throw new Error("mnemonist/fixed-stack: `capacity` should be a positive number.");this.capacity=t,this.ArrayClass=r,this.items=new this.ArrayClass(this.capacity),this.clear()}kt.prototype.clear=function(){this.size=0};kt.prototype.push=function(r){if(this.size===this.capacity)throw new Error("mnemonist/fixed-stack.push: stack capacity ("+this.capacity+") exceeded!");return this.items[this.size++]=r,this.size};kt.prototype.pop=function(){if(this.size!==0)return this.items[--this.size]};kt.prototype.peek=function(){return this.items[this.size-1]};kt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.items.length;e<i;e++)r.call(t,this.items[i-e-1],e,this)};kt.prototype.toArray=function(){for(var r=new this.ArrayClass(this.size),t=this.size-1,e=this.size;e--;)r[e]=this.items[t-e];return r};kt.prototype.values=function(){var r=this.items,t=this.size,e=0;return new jp(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return e++,{value:i,done:!1}})};kt.prototype.entries=function(){var r=this.items,t=this.size,e=0;return new jp(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(kt.prototype[Symbol.iterator]=kt.prototype.values);kt.prototype.toString=function(){return this.toArray().join(",")};kt.prototype.toJSON=function(){return this.toArray()};kt.prototype.inspect=function(){var r=this.toArray();return r.type=this.ArrayClass.name,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:kt,enumerable:!1}),r};typeof Symbol!="undefined"&&(kt.prototype[Symbol.for("nodejs.util.inspect.custom")]=kt.prototype.inspect);kt.from=function(r,t,e){if(arguments.length<3&&(e=Nu.guessLength(r),typeof e!="number"))throw new Error("mnemonist/fixed-stack.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new kt(t,e);if(Nu.isArrayLike(r)){var s,a;for(s=0,a=r.length;s<a;s++)i.items[s]=r[s];return i.size=a,i}return Nu.forEach(r,function(h){i.push(h)}),i};Gp.exports=kt});var Bp=V((_O,Up)=>{var dx=pe(),gx=ne(),yx=ju();function Gu(r,t,e,i,s,a,h,c){var f=h+(c-h)/2|0,m=~-f,y=-~f,b=e[f];i[a]=b+1;var _=t?t(r[b]):r[b][1],S=a*2+1,I=a*2+2,M=-1/0,F=-1/0;h<=m&&(M=Gu(r,t,e,i,s,S,h,m)),y<=c&&(F=Gu(r,t,e,i,s,I,y,c));var j=Math.max(_,M,F),B=b;return j===M?B=s[i[S]-1]:j===F&&(B=s[i[I]-1]),s[b]=B,j}function cr(r,t){this.size=r.length,this.intervals=r;var e=null,i=null;Array.isArray(t)&&(e=t[0],i=t[1]);var s=r.length,a=gx.getPointerArray(s+1),h=new a(s),c;for(c=1;c<s;c++)h[c]=c;h.sort(function(_,S){return _=r[_],S=r[S],e?(_=e(_),S=e(S)):(_=_[0],S=S[0]),_<S?-1:_>S?1:0});var f=Math.ceil(Math.log2(s+1)),m=Math.pow(2,f)-1,y=new a(m),b=new a(s);Gu(r,i,h,y,b,0,0,s-1),h=null,this.height=f,this.tree=y,this.augmentations=b,this.startGetter=e,this.endGetter=i,this.stack=new yx(a,this.height)}cr.prototype.intervalsContainingPoint=function(r){var t=[],e=this.stack;e.clear(),e.push(0);for(var i=this.tree.length,s,a,h,c,f,m,y,b,_;e.size;)s=e.pop(),a=this.tree[s]-1,h=this.intervals[a],c=this.intervals[this.augmentations[a]],y=this.endGetter?this.endGetter(c):c[1],!(r>y)&&(b=s*2+1,b<i&&this.tree[b]!==0&&e.push(b),f=this.startGetter?this.startGetter(h):h[0],m=this.endGetter?this.endGetter(h):h[1],r>=f&&r<=m&&t.push(h),!(r<f)&&(_=s*2+2,_<i&&this.tree[_]!==0&&e.push(_)));return t};cr.prototype.intervalsOverlappingInterval=function(r){var t=this.startGetter?this.startGetter(r):r[0],e=this.endGetter?this.endGetter(r):r[1],i=[],s=this.stack;s.clear(),s.push(0);for(var a=this.tree.length,h,c,f,m,y,b,_,S,I;s.size;)h=s.pop(),c=this.tree[h]-1,f=this.intervals[c],m=this.intervals[this.augmentations[c]],_=this.endGetter?this.endGetter(m):m[1],!(t>_)&&(S=h*2+1,S<a&&this.tree[S]!==0&&s.push(S),y=this.startGetter?this.startGetter(f):f[0],b=this.endGetter?this.endGetter(f):f[1],e>=y&&t<=b&&i.push(f),!(e<y)&&(I=h*2+2,I<a&&this.tree[I]!==0&&s.push(I)));return i};cr.prototype.inspect=function(){var r=this.intervals.slice();return Object.defineProperty(r,"constructor",{value:cr,enumerable:!1}),r};typeof Symbol!="undefined"&&(cr.prototype[Symbol.for("nodejs.util.inspect.custom")]=cr.prototype.inspect);cr.from=function(r,t){return dx.isArrayLike(r)?new cr(r,t):new cr(Array.from(r),t)};Up.exports=cr});var Uu=V(Wr=>{Wr.search=function(r,t,e,i){var s=0;e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length,i--;for(var a;e<=i;)if(s=e+i>>>1,a=r[s],a>t)i=~-s;else if(a<t)e=-~s;else return s;return-1};Wr.searchWithComparator=function(r,t,e){for(var i=0,s=0,a=~-t.length,h;s<=a;)if(i=s+a>>>1,h=r(t[i],e),h>0)a=~-i;else if(h<0)s=-~i;else return i;return-1};Wr.lowerBound=function(r,t,e,i){var s=0;for(e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length;e<i;)s=e+i>>>1,t<=r[s]?i=s:e=-~s;return e};Wr.lowerBoundWithComparator=function(r,t,e){for(var i=0,s=0,a=t.length;s<a;)i=s+a>>>1,r(e,t[i])<=0?a=i:s=-~i;return s};Wr.lowerBoundIndices=function(r,t,e,i,s){var a=0;for(i=typeof i!="undefined"?i:0,s=typeof s!="undefined"?s:r.length;i<s;)a=i+s>>>1,e<=r[t[a]]?s=a:i=-~a;return i};Wr.upperBound=function(r,t,e,i){var s=0;for(e=typeof e!="undefined"?e:0,i=typeof i!="undefined"?i:r.length;e<i;)s=e+i>>>1,t>=r[s]?e=-~s:i=s;return e};Wr.upperBoundWithComparator=function(r,t,e){for(var i=0,s=0,a=t.length;s<a;)i=s+a>>>1,r(e,t[i])>=0?s=-~i:a=i;return s}});var $p=V(qr=>{var Gi=ne(),Ui=pe().isArrayLike,pi=Uu(),Hp=ms();function Wp(r,t){if(r.length===0)return t.slice();if(t.length===0)return r.slice();var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],s=t[0];if(i<=s)return Gi.isTypedArray(r)?Gi.concat(r,t):r.concat(t);var a=new r.constructor(r.length+t.length),h,c,f;for(h=0,c=r.length;h<c&&(f=r[h],f<=s);h++)a[h]=f;for(var m=h,y=r.length,b=0,_=t.length,S,I;m<y&&b<_;)S=r[m],I=t[b],S<=I?(a[h++]=S,m++):(a[h++]=I,b++);for(;m<y;)a[h++]=r[m++];for(;b<_;)a[h++]=t[b++];return a}function qp(r,t){if(r.length===0)return t.slice();if(t.length===0)return r.slice();var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],s=t[0];if(i<s)return Gi.isTypedArray(r)?Gi.concat(r,t):r.concat(t);var a=new r.constructor,h,c,f;for(h=0,c=r.length;h<c&&(f=r[h],f<s);h++)a.push(f);for(var m=h,y=r.length,b=0,_=t.length,S,I;m<y&&b<_;)S=r[m],I=t[b],S<=I?((a.length===0||a[a.length-1]!==S)&&a.push(S),m++):((a.length===0||a[a.length-1]!==I)&&a.push(I),b++);for(;m<y;)S=r[m++],(a.length===0||a[a.length-1]!==S)&&a.push(S);for(;b<_;)I=t[b++],(a.length===0||a[a.length-1]!==I)&&a.push(I);return a}qr.intersectionUniqueArrays=function(r,t){if(r.length===0||t.length===0)return new r.constructor(0);var e;r[0]>t[0]&&(e=r,r=t,t=e);var i=r[r.length-1],s=t[0];if(i<s)return new r.constructor(0);for(var a=new r.constructor,h=pi.lowerBound(r,s),c=r.length,f=0,m=pi.upperBound(t,i),y,b;h<c&&f<m;)y=r[h],b=t[f],y<b?h=pi.lowerBound(r,b,h+1):y>b?f=pi.lowerBound(t,y,f+1):(a.push(y),h++,f++);return a};function vx(r){var t=0,e=-1/0,i,s,a,h=[];for(s=0,a=r.length;s<a;s++)i=r[s].length,i!==0&&(h.push(r[s]),t+=i,i>e&&(e=i));if(h.length===0)return new r[0].constructor(0);if(h.length===1)return h[0].slice();if(h.length===2)return Wp(h[0],h[1]);r=h;var c=new r[0].constructor(t),f=Gi.getPointerArray(e),m=new f(r.length),y=new Hp(function(S,I){return S=r[S][m[S]],I=r[I][m[I]],S<I?-1:S>I?1:0});for(s=0;s<a;s++)y.push(s);s=0;for(var b,_;y.size;)b=y.pop(),_=r[b][m[b]++],c[s++]=_,m[b]<r[b].length&&y.push(b);return c}function bx(r){var t=-1/0,e,i,s,a=[];for(i=0,s=r.length;i<s;i++)e=r[i].length,e!==0&&(a.push(r[i]),e>t&&(t=e));if(a.length===0)return new r[0].constructor(0);if(a.length===1)return a[0].slice();if(a.length===2)return qp(a[0],a[1]);r=a;var h=new r[0].constructor,c=Gi.getPointerArray(t),f=new c(r.length),m=new Hp(function(_,S){return _=r[_][f[_]],S=r[S][f[S]],_<S?-1:_>S?1:0});for(i=0;i<s;i++)m.push(i);for(var y,b;m.size;)y=m.pop(),b=r[y][f[y]++],(h.length===0||h[h.length-1]!==b)&&h.push(b),f[y]<r[y].length&&m.push(y);return h}qr.kWayIntersectionUniqueArrays=function(r){var t=-1/0,e=-1/0,i=1/0,s,a,h,c,f;for(c=0,f=r.length;c<f;c++){if(h=r[c].length,h===0)return[];h>t&&(t=h),s=r[c][0],a=r[c][h-1],s>e&&(e=s),a<i&&(i=a)}if(e>i)return[];if(e===i)return[e];var m,y,b=r[0],_,S,I,M,F,j,B=e;for(c=1;c<f;c++){for(m=b,y=r[c],b=new Array,_=0,S=pi.lowerBound(y,B),I=m.length,M=y.length;_<I&&S<M;)F=m[_],j=y[S],F<j?_=pi.lowerBound(m,j,_+1):F>j?S=pi.lowerBound(y,F,S+1):(b.push(F),_++,S++);if(b.length===0)return b;B=b[0]}return b};qr.merge=function(){if(arguments.length===2){if(Ui(arguments[0]))return Wp(arguments[0],arguments[1])}else if(Ui(arguments[0]))return vx(arguments);return null};qr.unionUnique=function(){if(arguments.length===2){if(Ui(arguments[0]))return qp(arguments[0],arguments[1])}else if(Ui(arguments[0]))return bx(arguments);return null};qr.intersectionUnique=function(){if(arguments.length===2){if(Ui(arguments[0]))return qr.intersectionUniqueArrays(arguments[0],arguments[1])}else if(Ui(arguments[0]))return qr.kWayIntersectionUniqueArrays(arguments);return null}});var Xp=V((OO,Qp)=>{var wx=Nt(),Px=mt(),Tx=$p();function Yp(r){return r}function oe(r){if(this.clear(),Array.isArray(r)?(this.documentTokenizer=r[0],this.queryTokenizer=r[1]):(this.documentTokenizer=r,this.queryTokenizer=r),this.documentTokenizer||(this.documentTokenizer=Yp),this.queryTokenizer||(this.queryTokenizer=Yp),typeof this.documentTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: document tokenizer is not a function.");if(typeof this.queryTokenizer!="function")throw new Error("mnemonist/InvertedIndex.constructor: query tokenizer is not a function.")}oe.prototype.clear=function(){this.items=[],this.mapping=new Map,this.size=0,this.dimension=0};oe.prototype.add=function(r){this.size++;var t=this.items.length;this.items.push(r);var e=this.documentTokenizer(r);if(!Array.isArray(e))throw new Error("mnemonist/InvertedIndex.add: tokenizer function should return an array of tokens.");for(var i=new Set,s,a,h=0,c=e.length;h<c;h++)s=e[h],!i.has(s)&&(i.add(s),a=this.mapping.get(s),a||(a=[],this.mapping.set(s,a)),a.push(t));return this.dimension=this.mapping.size,this};oe.prototype.get=function(r){if(!this.size)return[];var t=this.queryTokenizer(r);if(!Array.isArray(t))throw new Error("mnemonist/InvertedIndex.query: tokenizer function should return an array of tokens.");if(!t.length)return[];var e=this.mapping.get(t[0]),i,s,a;if(typeof e=="undefined"||e.length===0)return[];if(t.length>1)for(s=1,a=t.length;s<a;s++){if(i=this.mapping.get(t[s]),typeof i=="undefined"||i.length===0)return[];e=Tx.intersectionUniqueArrays(e,i)}var h=new Array(e.length);for(s=0,a=h.length;s<a;s++)h[s]=this.items[e[s]];return h};oe.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.documents.length;e<i;e++)r.call(t,this.documents[e],e,this)};oe.prototype.documents=function(){var r=this.items,t=r.length,e=0;return new wx(function(){if(e>=t)return{done:!0};var i=r[e++];return{value:i,done:!1}})};oe.prototype.tokens=function(){return this.mapping.keys()};typeof Symbol!="undefined"&&(oe.prototype[Symbol.iterator]=oe.prototype.documents);oe.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:oe,enumerable:!1}),r};typeof Symbol!="undefined"&&(oe.prototype[Symbol.for("nodejs.util.inspect.custom")]=oe.prototype.inspect);oe.from=function(r,t){var e=new oe(t);return Px(r,function(i){e.add(i)}),e};Qp.exports=oe});var Hu=V(Bu=>{var jt=new Float64Array(64),wt=new Float64Array(64);function xx(r,t,e){var i,s,a,h,c;for(jt[0]=t,wt[0]=e,s=0;s>=0;)if(a=jt[s],h=wt[s]-1,a<h){for(i=r[a];a<h;){for(;r[h]>=i&&a<h;)h--;for(a<h&&(r[a++]=r[h]);r[a]<=i&&a<h;)a++;a<h&&(r[h--]=r[a])}r[a]=i,jt[s+1]=a+1,wt[s+1]=wt[s],wt[s++]=a,wt[s]-jt[s]>wt[s-1]-jt[s-1]&&(c=jt[s],jt[s]=jt[s-1],jt[s-1]=c,c=wt[s],wt[s]=wt[s-1],wt[s-1]=c)}else s--;return r}Bu.inplaceQuickSort=xx;function Sx(r,t,e,i){var s,a,h,c,f,m;for(jt[0]=e,wt[0]=i,a=0;a>=0;)if(h=jt[a],c=wt[a]-1,h<c){for(f=t[h],s=r[f];h<c;){for(;r[t[c]]>=s&&h<c;)c--;for(h<c&&(t[h++]=t[c]);r[t[h]]<=s&&h<c;)h++;h<c&&(t[c--]=t[h])}t[h]=f,jt[a+1]=h+1,wt[a+1]=wt[a],wt[a++]=h,wt[a]-jt[a]>wt[a-1]-jt[a-1]&&(m=jt[a],jt[a]=jt[a-1],jt[a-1]=m,m=wt[a],wt[a]=wt[a-1],wt[a-1]=m)}else a--;return t}Bu.inplaceQuickSortIndices=Sx});var em=V((IO,tm)=>{var Cx=pe(),Cs=ne(),Kp=An().createTupleComparator,Jp=xs(),_x=Hu().inplaceQuickSortIndices;function Wu(r,t,e,i){var s,a=0,h;for(s=0;s<r;s++)h=t[s][e]-i[s],a+=h*h;return a}function Lx(r,t){var e=t.length,i=new Array(r),s=new Array(e),a,h=Cs.getPointerArray(e),c=new h(e),f,m,y,b=!0;for(f=0;f<r;f++){for(a=new Float64Array(e),m=0;m<e;m++)y=t[m],a[m]=y[1][f],b&&(s[m]=y[0],c[m]=m);b=!1,i[f]=a}return{axes:i,ids:c,labels:s}}function Zp(r,t,e,i){for(var s=i.length,a=Cs.getPointerArray(s+1),h=new a(s),c=new a(s),f=new a(s),m=[[0,0,e.length,-1,0]],y,b,_,S,I,M,F,j,B=0;m.length!==0;)y=m.pop(),j=y[0],M=y[1],F=y[2],b=y[3],_=y[4],_x(t[j],e,M,F),s=F-M,S=M+(s>>>1),I=e[S],h[B]=I,b>-1&&(_===0?c[b]=B+1:f[b]=B+1),j=(j+1)%r,S!==M&&S!==F-1&&m.push([j,S+1,F,B,1]),S!==M&&m.push([j,M,S,B,0]),B++;return{axes:t,labels:i,pivots:h,lefts:c,rights:f}}function ze(r,t){this.dimensions=r,this.visited=0,this.axes=t.axes,this.labels=t.labels,this.pivots=t.pivots,this.lefts=t.lefts,this.rights=t.rights,this.size=this.labels.length}ze.prototype.nearestNeighbor=function(r){var t=1/0,e=null,i=this.dimensions,s=this.axes,a=this.pivots,h=this.lefts,c=this.rights,f=0;function m(y,b){f++;var _=h[b],S=c[b],I=a[b],M=Wu(i,s,I,r);if(!(M<t&&(e=I,t=M,M===0))){var F=s[y][I]-r[y];y=(y+1)%i,F>0?_!==0&&m(y,_-1):S!==0&&m(y,S-1),F*F<t&&(F>0?S!==0&&m(y,S-1):_!==0&&m(y,_-1))}}return m(0,0),this.visited=f,this.labels[e]};var Ex=Kp(3),Ox=Kp(2);ze.prototype.kNearestNeighbors=function(r,t){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");if(r=Math.min(r,this.size),r===1)return[this.nearestNeighbor(t)];var e=new Jp(Array,Ex,r),i=this.dimensions,s=this.axes,a=this.pivots,h=this.lefts,c=this.rights,f=0;function m(_,S){var I=h[S],M=c[S],F=a[S],j=Wu(i,s,F,t);e.push([j,f++,F]);var B=t[_],Z=s[_][F],ht=B-Z;_=(_+1)%i,B<Z?I!==0&&m(_,I-1):M!==0&&m(_,M-1),(ht*ht<e.peek()[0]||e.size<r)&&(B<Z?M!==0&&m(_,M-1):I!==0&&m(_,I-1))}m(0,0),this.visited=f;for(var y=e.consume(),b=0;b<y.length;b++)y[b]=this.labels[y[b][2]];return y};ze.prototype.linearKNearestNeighbors=function(r,t){if(r<=0)throw new Error("mnemonist/kd-tree.kNearestNeighbors: k should be a positive number.");r=Math.min(r,this.size);var e=new Jp(Array,Ox,r),i,s,a;for(i=0,s=this.size;i<s;i++)a=Wu(this.dimensions,this.axes,this.pivots[i],t),e.push([a,i]);var h=e.consume();for(i=0;i<h.length;i++)h[i]=this.labels[this.pivots[h[i][1]]];return h};ze.prototype.inspect=function(){var r=new Map;r.dimensions=this.dimensions,Object.defineProperty(r,"constructor",{value:ze,enumerable:!1});var t,e,i;for(t=0;t<this.size;t++){for(i=new Array(this.dimensions),e=0;e<this.dimensions;e++)i[e]=this.axes[e][t];r.set(this.labels[t],i)}return r};typeof Symbol!="undefined"&&(ze.prototype[Symbol.for("nodejs.util.inspect.custom")]=ze.prototype.inspect);ze.from=function(r,t){var e=Cx.toArray(r),i=Lx(t,e),s=Zp(t,i.axes,i.ids,i.labels);return new ze(t,s)};ze.fromAxes=function(r,t){t||(t=Cs.indices(r[0].length));var e=r.length,i=Zp(r.length,r,Cs.indices(t.length),t);return new ze(e,i)};tm.exports=ze});var nm=V((MO,im)=>{var rm=Nt(),Ax=mt();function yt(){this.clear()}yt.prototype.clear=function(){this.head=null,this.tail=null,this.size=0};yt.prototype.first=function(){return this.head?this.head.item:void 0};yt.prototype.peek=yt.prototype.first;yt.prototype.last=function(){return this.tail?this.tail.item:void 0};yt.prototype.push=function(r){var t={item:r,next:null};return this.head?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),this.size++,this.size};yt.prototype.unshift=function(r){var t={item:r,next:null};return this.head?(this.head.next||(this.tail=this.head),t.next=this.head,this.head=t):(this.head=t,this.tail=t),this.size++,this.size};yt.prototype.shift=function(){if(this.size){var r=this.head;return this.head=r.next,this.size--,r.item}};yt.prototype.forEach=function(r,t){if(this.size){t=arguments.length>1?t:this;for(var e=this.head,i=0;e;)r.call(t,e.item,i,this),e=e.next,i++}};yt.prototype.toArray=function(){if(!this.size)return[];for(var r=new Array(this.size),t=0,e=this.size,i=this.head;t<e;t++)r[t]=i.item,i=i.next;return r};yt.prototype.values=function(){var r=this.head;return new rm(function(){if(!r)return{done:!0};var t=r.item;return r=r.next,{value:t,done:!1}})};yt.prototype.entries=function(){var r=this.head,t=0;return new rm(function(){if(!r)return{done:!0};var e=r.item;return r=r.next,t++,{value:[t-1,e],done:!1}})};typeof Symbol!="undefined"&&(yt.prototype[Symbol.iterator]=yt.prototype.values);yt.prototype.toString=function(){return this.toArray().join(",")};yt.prototype.toJSON=function(){return this.toArray()};yt.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:yt,enumerable:!1}),r};typeof Symbol!="undefined"&&(yt.prototype[Symbol.for("nodejs.util.inspect.custom")]=yt.prototype.inspect);yt.from=function(r){var t=new yt;return Ax(r,function(e){t.push(e)}),t};im.exports=yt});var _s=V((DO,om)=>{var qu=Nt(),Ix=mt(),Mx=ne(),Dx=pe();function Et(r,t,e){if(arguments.length<2&&(e=r,r=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=Mx.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof r=="function"?new r(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items={}}Et.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};Et.prototype.splayOnTop=function(r){var t=this.head;if(this.head===r)return this;var e=this.backward[r],i=this.forward[r];return this.tail===r?this.tail=e:this.backward[i]=e,this.forward[e]=i,this.backward[t]=r,this.head=r,this.forward[r]=t,this};Et.prototype.set=function(r,t){var e=this.items[r];if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};Et.prototype.setpop=function(r,t){var e=null,i=null,s=this.items[r];return typeof s!="undefined"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?s=this.size++:(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],delete this.items[i]),this.items[r]=s,this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};Et.prototype.has=function(r){return r in this.items};Et.prototype.get=function(r){var t=this.items[r];if(typeof t!="undefined")return this.splayOnTop(t),this.V[t]};Et.prototype.peek=function(r){var t=this.items[r];if(typeof t!="undefined")return this.V[t]};Et.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.size,s=this.head,a=this.K,h=this.V,c=this.forward;e<i;)r.call(t,h[s],a[s],this),s=c[s],e++};Et.prototype.keys=function(){var r=0,t=this.size,e=this.head,i=this.K,s=this.forward;return new qu(function(){if(r>=t)return{done:!0};var a=i[e];return r++,r<t&&(e=s[e]),{done:!1,value:a}})};Et.prototype.values=function(){var r=0,t=this.size,e=this.head,i=this.V,s=this.forward;return new qu(function(){if(r>=t)return{done:!0};var a=i[e];return r++,r<t&&(e=s[e]),{done:!1,value:a}})};Et.prototype.entries=function(){var r=0,t=this.size,e=this.head,i=this.K,s=this.V,a=this.forward;return new qu(function(){if(r>=t)return{done:!0};var h=i[e],c=s[e];return r++,r<t&&(e=a[e]),{done:!1,value:[h,c]}})};typeof Symbol!="undefined"&&(Et.prototype[Symbol.iterator]=Et.prototype.entries);Et.prototype.inspect=function(){for(var r=new Map,t=this.entries(),e;e=t.next(),!e.done;)r.set(e.value[0],e.value[1]);return Object.defineProperty(r,"constructor",{value:Et,enumerable:!1}),r};typeof Symbol!="undefined"&&(Et.prototype[Symbol.for("nodejs.util.inspect.custom")]=Et.prototype.inspect);Et.from=function(r,t,e,i){if(arguments.length<2){if(i=Dx.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new Et(t,e,i);return Ix(r,function(a,h){s.set(h,a)}),s};om.exports=Et});var am=V((kO,sm)=>{var Bi=_s(),kx=mt(),Fx=ne(),Rx=pe();function fr(r,t,e){arguments.length<2?Bi.call(this,r):Bi.call(this,r,t,e);var i=Fx.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for($u in Bi.prototype)fr.prototype[$u]=Bi.prototype[$u];var $u;typeof Symbol!="undefined"&&(fr.prototype[Symbol.iterator]=Bi.prototype[Symbol.iterator]);fr.prototype.clear=function(){Bi.prototype.clear.call(this),this.deletedSize=0};fr.prototype.set=function(r,t){var e=this.items[r];if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?(this.deletedSize>0?e=this.deleted[--this.deletedSize]:e=this.size,this.size++):(e=this.tail,this.tail=this.backward[e],delete this.items[this.K[e]]),this.items[r]=e,this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};fr.prototype.setpop=function(r,t){var e=null,i=null,s=this.items[r];return typeof s!="undefined"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?(this.deletedSize>0?s=this.deleted[--this.deletedSize]:s=this.size,this.size++):(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],delete this.items[i]),this.items[r]=s,this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};fr.prototype.delete=function(r){var t=this.items[r];if(typeof t=="undefined")return!1;if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var e=this.backward[t],i=this.forward[t];return this.head===t&&(this.head=i),this.tail===t&&(this.tail=e),this.forward[e]=i,this.backward[i]=e,this.size--,this.deleted[this.deletedSize++]=t,!0};fr.prototype.remove=function(r,t=void 0){var e=this.items[r];if(typeof e=="undefined")return t;var i=this.V[e];if(delete this.items[r],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var s=this.backward[e],a=this.forward[e];return this.head===e&&(this.head=a),this.tail===e&&(this.tail=s),this.forward[s]=a,this.backward[a]=s,this.size--,this.deleted[this.deletedSize++]=e,i};fr.from=function(r,t,e,i){if(arguments.length<2){if(i=Rx.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new fr(t,e,i);return kx(r,function(a,h){s.set(h,a)}),s};sm.exports=fr});var Yu=V((FO,um)=>{var Hi=_s(),zx=mt(),Vx=ne(),Nx=pe();function $t(r,t,e){if(arguments.length<2&&(e=r,r=null,t=null),this.capacity=e,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-map: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-map: capacity should be a finite positive integer.");var i=Vx.getPointerArray(e);this.forward=new i(e),this.backward=new i(e),this.K=typeof r=="function"?new r(e):new Array(e),this.V=typeof t=="function"?new t(e):new Array(e),this.size=0,this.head=0,this.tail=0,this.items=new Map}$t.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items.clear()};$t.prototype.set=function(r,t){var e=this.items.get(r);if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?e=this.size++:(e=this.tail,this.tail=this.backward[e],this.items.delete(this.K[e])),this.items.set(r,e),this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};$t.prototype.setpop=function(r,t){var e=null,i=null,s=this.items.get(r);return typeof s!="undefined"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?s=this.size++:(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],this.items.delete(i)),this.items.set(r,s),this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};$t.prototype.has=function(r){return this.items.has(r)};$t.prototype.get=function(r){var t=this.items.get(r);if(typeof t!="undefined")return this.splayOnTop(t),this.V[t]};$t.prototype.peek=function(r){var t=this.items.get(r);if(typeof t!="undefined")return this.V[t]};$t.prototype.splayOnTop=Hi.prototype.splayOnTop;$t.prototype.forEach=Hi.prototype.forEach;$t.prototype.keys=Hi.prototype.keys;$t.prototype.values=Hi.prototype.values;$t.prototype.entries=Hi.prototype.entries;typeof Symbol!="undefined"&&($t.prototype[Symbol.iterator]=$t.prototype.entries);$t.prototype.inspect=Hi.prototype.inspect;$t.from=function(r,t,e,i){if(arguments.length<2){if(i=Nx.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new $t(t,e,i);return zx(r,function(a,h){s.set(h,a)}),s};um.exports=$t});var lm=V((RO,hm)=>{var Wi=Yu(),jx=mt(),Gx=ne(),Ux=pe();function pr(r,t,e){arguments.length<2?Wi.call(this,r):Wi.call(this,r,t,e);var i=Gx.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(Qu in Wi.prototype)pr.prototype[Qu]=Wi.prototype[Qu];var Qu;typeof Symbol!="undefined"&&(pr.prototype[Symbol.iterator]=Wi.prototype[Symbol.iterator]);pr.prototype.clear=function(){Wi.prototype.clear.call(this),this.deletedSize=0};pr.prototype.set=function(r,t){var e=this.items.get(r);if(typeof e!="undefined"){this.splayOnTop(e),this.V[e]=t;return}this.size<this.capacity?(this.deletedSize>0?e=this.deleted[--this.deletedSize]:e=this.size,this.size++):(e=this.tail,this.tail=this.backward[e],this.items.delete(this.K[e])),this.items.set(r,e),this.K[e]=r,this.V[e]=t,this.forward[e]=this.head,this.backward[this.head]=e,this.head=e};pr.prototype.setpop=function(r,t){var e=null,i=null,s=this.items.get(r);return typeof s!="undefined"?(this.splayOnTop(s),e=this.V[s],this.V[s]=t,{evicted:!1,key:r,value:e}):(this.size<this.capacity?(this.deletedSize>0?s=this.deleted[--this.deletedSize]:s=this.size,this.size++):(s=this.tail,this.tail=this.backward[s],e=this.V[s],i=this.K[s],this.items.delete(i)),this.items.set(r,s),this.K[s]=r,this.V[s]=t,this.forward[s]=this.head,this.backward[this.head]=s,this.head=s,i?{evicted:!0,key:i,value:e}:null)};pr.prototype.delete=function(r){var t=this.items.get(r);if(typeof t=="undefined")return!1;if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var e=this.backward[t],i=this.forward[t];return this.head===t&&(this.head=i),this.tail===t&&(this.tail=e),this.forward[e]=i,this.backward[i]=e,this.size--,this.deleted[this.deletedSize++]=t,!0};pr.prototype.remove=function(r,t=void 0){var e=this.items.get(r);if(typeof e=="undefined")return t;var i=this.V[e];if(this.items.delete(r),this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var s=this.backward[e],a=this.forward[e];return this.head===e&&(this.head=a),this.tail===e&&(this.tail=s),this.forward[s]=a,this.backward[a]=s,this.size--,this.deleted[this.deletedSize++]=e,i};pr.from=function(r,t,e,i){if(arguments.length<2){if(i=Ux.guessLength(r),typeof i!="number")throw new Error("mnemonist/lru-map.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=t,t=null,e=null);var s=new pr(t,e,i);return jx(r,function(a,h){s.set(h,a)}),s};hm.exports=pr});var fm=V((zO,cm)=>{var Bx=Nt(),Hx=mt(),Wx=xs(),qx=function(r,t){return r[1]>t[1]?-1:r[1]<t[1]?1:0};function et(){this.items=new Map,Object.defineProperty(this.items,"constructor",{value:et,enumerable:!1}),this.clear()}et.prototype.clear=function(){this.size=0,this.dimension=0,this.items.clear()};et.prototype.add=function(r,t){if(t===0)return this;if(t<0)return this.remove(r,-t);if(t=t||1,typeof t!="number")throw new Error("mnemonist/multi-set.add: given count should be a number.");this.size+=t;let e=this.items.get(r);return e===void 0?this.dimension++:t+=e,this.items.set(r,t),this};et.prototype.set=function(r,t){var e;if(typeof t!="number")throw new Error("mnemonist/multi-set.set: given count should be a number.");return t<=0?(e=this.items.get(r),typeof e!="undefined"&&(this.size-=e,this.dimension--),this.items.delete(r),this):(t=t||1,e=this.items.get(r),typeof e=="number"?this.items.set(r,e+t):(this.dimension++,this.items.set(r,t)),this.size+=t,this)};et.prototype.has=function(r){return this.items.has(r)};et.prototype.delete=function(r){var t=this.items.get(r);return t===0?!1:(this.size-=t,this.dimension--,this.items.delete(r),!0)};et.prototype.remove=function(r,t){if(t!==0){if(t<0)return this.add(r,-t);if(t=t||1,typeof t!="number")throw new Error("mnemonist/multi-set.remove: given count should be a number.");var e=this.items.get(r);if(typeof e!="undefined"){var i=Math.max(0,e-t);i===0?(this.items.delete(r),this.size-=e,this.dimension--):(this.items.set(r,i),this.size-=t)}}};et.prototype.edit=function(r,t){var e=this.multiplicity(r);if(e!==0){var i=this.multiplicity(t);return this.items.set(t,e+i),this.items.delete(r),this}};et.prototype.multiplicity=function(r){var t=this.items.get(r);return typeof t=="undefined"?0:t};et.prototype.get=et.prototype.multiplicity;et.prototype.count=et.prototype.multiplicity;et.prototype.frequency=function(r){if(this.size===0)return 0;var t=this.multiplicity(r);return t/this.size};et.prototype.top=function(r){if(typeof r!="number"||r<=0)throw new Error("mnemonist/multi-set.top: n must be a number > 0.");for(var t=new Wx(Array,qx,r),e=this.items.entries(),i;i=e.next(),!i.done;)t.push(i.value);return t.consume()};et.prototype.forEach=function(r,t){t=arguments.length>1?t:this;var e;this.items.forEach(function(i,s){for(e=0;e<i;e++)r.call(t,s,s)})};et.prototype.forEachMultiplicity=function(r,t){t=arguments.length>1?t:this,this.items.forEach(r,t)};et.prototype.keys=function(){return this.items.keys()};et.prototype.values=function(){var r=this.items.entries(),t=!1,e,i,s,a;return new Bx(function h(){if(!t){if(e=r.next(),e.done)return{done:!0};t=!0,i=e.value[0],s=e.value[1],a=0}return a>=s?(t=!1,h()):(a++,{done:!1,value:i})})};et.prototype.multiplicities=function(){return this.items.entries()};typeof Symbol!="undefined"&&(et.prototype[Symbol.iterator]=et.prototype.values);et.prototype.inspect=function(){return this.items};typeof Symbol!="undefined"&&(et.prototype[Symbol.for("nodejs.util.inspect.custom")]=et.prototype.inspect);et.prototype.toJSON=function(){return this.items};et.from=function(r){var t=new et;return Hx(r,function(e){t.add(e)}),t};et.isSubset=function(r,t){var e=r.multiplicities(),i,s,a;if(r===t)return!0;if(r.dimension>t.dimension)return!1;for(;i=e.next(),!i.done;)if(s=i.value[0],a=i.value[1],t.multiplicity(s)<a)return!1;return!0};et.isSuperset=function(r,t){return et.isSubset(t,r)};cm.exports=et});var vm=V((VO,ym)=>{var $x=Nt(),Yx=mt();function Qx(r,t,e){return((Math.pow(r,2)-Math.pow(Math.abs(t-e),2))/2|0)+r+1}function Xx(r,t){for(var e=0,i=0,s=t+1;i<s;i++)e+=Qx(r,t,i);return e}function Kx(r,t){return r.length>t.length?-1:r.length<t.length?1:r<t?-1:r>t?1:0}function pm(r,t){var e=r+1,i=t/e|0,s=i+1,a,h,c=t-i*e,f=e-c,m=new Array(r+1);for(a=0;a<f;a++)m[a]=[a*i,i];var y=(a-1)*i+i;for(h=0;h<c;h++)m[a+h]=[y+h*s,s];return m}function mm(r,t){var e=t.length,i=r+1,s=e/i|0,a=s+1,h,c,f,m=e-s*i,y=i-m,b=new Array(r+1);for(c=0;c<y;c++)h=c*s,b[c]=t.slice(h,h+s);var _=(c-1)*s+s;for(f=0;f<m;f++)h=_+f*a,b[c+f]=t.slice(h,h+a);return b}function Jx(r,t,e){if(t===0)return 0;var i=e.length,s=r+1,a=i/s|0,h=a+1,c=i-a*s,f=s-c;if(t<=f-1)return t*a;var m=t-f;return f*a+m*h}function dm(r,t,e,i,s,a){var h=s-e,c=s+e,f=r-e,m=s+t-f,y=s+t+f,b=i-a;return[Math.max(0,h,m),Math.min(c,y,b)]}function gm(r,t,e,i,s,a){var h=t.length,c=h-e,f=dm(r,c,i,h,s,a),m=f[0],y=f[1],b="",_=[],S,I,M;for(I=m,M=y+1;I<M;I++)S=t.slice(I,I+a),S!==b&&(_.push(S),b=S);return _}function Ct(r,t){if(typeof r!="function")throw new Error("mnemonist/passjoin-index: `levenshtein` should be a function returning edit distance between two strings.");if(typeof t!="number"||t<1)throw new Error("mnemonist/passjoin-index: `k` should be a number > 0");this.levenshtein=r,this.k=t,this.clear()}Ct.prototype.clear=function(){this.size=0,this.strings=[],this.invertedIndices={}};Ct.prototype.add=function(r){var t=r.length,e=this.size;this.strings.push(r),this.size++;var i=mm(this.k,r),s=this.invertedIndices[t];typeof s=="undefined"&&(s={},this.invertedIndices[t]=s);var a,h,c,f,m;for(f=0,m=i.length;f<m;f++)a=i[f],c=a+f,h=s[c],typeof h=="undefined"?(h=[e],s[c]=h):h.push(e);return this};Ct.prototype.search=function(r){var t=r.length,e=this.k,i=new Set,s,a,h,c,f,m,y,b,_,S,I,M,F,j,B;for(b=Math.max(0,t-e),_=t+e+1;b<_;b++){var Z=this.invertedIndices[b];if(typeof Z!="undefined"){for(y=pm(e,b),S=0,I=y.length;S<I;S++)for(h=y[S][0],c=y[S][1],m=gm(e,r,b,S,h,c),m.length||(m=[""]),M=0,F=m.length;M<F;M++)if(f=m[M]+S,s=Z[f],typeof s!="undefined")for(j=0,B=s.length;j<B;j++)a=this.strings[s[j]],(t<=e&&b<=e||!i.has(a)&&this.levenshtein(r,a)<=e)&&i.add(a)}}return i};Ct.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.strings.length;e<i;e++)r.call(t,this.strings[e],e,this)};Ct.prototype.values=function(){var r=this.strings,t=r.length,e=0;return new $x(function(){if(e>=t)return{done:!0};var i=r[e];return e++,{value:i,done:!1}})};typeof Symbol!="undefined"&&(Ct.prototype[Symbol.iterator]=Ct.prototype.values);Ct.prototype.inspect=function(){var r=this.strings.slice();return Object.defineProperty(r,"constructor",{value:Ct,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ct.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ct.prototype.inspect);Ct.from=function(r,t,e){var i=new Ct(t,e);return Yx(r,function(s){i.add(s)}),i};Ct.countKeys=Xx;Ct.comparator=Kx;Ct.partition=pm;Ct.segments=mm;Ct.segmentPos=Jx;Ct.multiMatchAwareInterval=dm;Ct.multiMatchAwareSubstrings=gm;ym.exports=Ct});var Pm=V((NO,wm)=>{var bm=Nt(),Zx=mt();function _t(){this.clear()}_t.prototype.clear=function(){this.items=[],this.offset=0,this.size=0};_t.prototype.enqueue=function(r){return this.items.push(r),++this.size};_t.prototype.dequeue=function(){if(this.size){var r=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,r}};_t.prototype.peek=function(){if(this.size)return this.items[this.offset]};_t.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.offset,i=0,s=this.items.length;e<s;e++,i++)r.call(t,this.items[e],i,this)};_t.prototype.toArray=function(){return this.items.slice(this.offset)};_t.prototype.values=function(){var r=this.items,t=this.offset;return new bm(function(){if(t>=r.length)return{done:!0};var e=r[t];return t++,{value:e,done:!1}})};_t.prototype.entries=function(){var r=this.items,t=this.offset,e=0;return new bm(function(){if(t>=r.length)return{done:!0};var i=r[t];return t++,{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(_t.prototype[Symbol.iterator]=_t.prototype.values);_t.prototype.toString=function(){return this.toArray().join(",")};_t.prototype.toJSON=function(){return this.toArray()};_t.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:_t,enumerable:!1}),r};typeof Symbol!="undefined"&&(_t.prototype[Symbol.for("nodejs.util.inspect.custom")]=_t.prototype.inspect);_t.from=function(r){var t=new _t;return Zx(r,function(e){t.enqueue(e)}),t};_t.of=function(){return _t.from(arguments)};wm.exports=_t});var Sm=V((jO,xm)=>{var Tm=Nt(),t1=mt();function Lt(){this.clear()}Lt.prototype.clear=function(){this.items=[],this.size=0};Lt.prototype.push=function(r){return this.items.push(r),++this.size};Lt.prototype.pop=function(){if(this.size!==0)return this.size--,this.items.pop()};Lt.prototype.peek=function(){return this.items[this.size-1]};Lt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0,i=this.items.length;e<i;e++)r.call(t,this.items[i-e-1],e,this)};Lt.prototype.toArray=function(){for(var r=new Array(this.size),t=this.size-1,e=this.size;e--;)r[e]=this.items[t-e];return r};Lt.prototype.values=function(){var r=this.items,t=r.length,e=0;return new Tm(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return e++,{value:i,done:!1}})};Lt.prototype.entries=function(){var r=this.items,t=r.length,e=0;return new Tm(function(){if(e>=t)return{done:!0};var i=r[t-e-1];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(Lt.prototype[Symbol.iterator]=Lt.prototype.values);Lt.prototype.toString=function(){return this.toArray().join(",")};Lt.prototype.toJSON=function(){return this.toArray()};Lt.prototype.inspect=function(){var r=this.toArray();return Object.defineProperty(r,"constructor",{value:Lt,enumerable:!1}),r};typeof Symbol!="undefined"&&(Lt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Lt.prototype.inspect);Lt.from=function(r){var t=new Lt;return t1(r,function(e){t.push(e)}),t};Lt.of=function(){return Lt.from(arguments)};xm.exports=Lt});var Cm=V(Ft=>{Ft.intersection=function(){if(arguments.length<2)throw new Error("mnemonist/Set.intersection: needs at least two arguments.");var r=new Set,t=1/0,e=null,i,s,a=arguments.length;for(s=0;s<a;s++){if(i=arguments[s],i.size===0)return r;i.size<t&&(t=i.size,e=i)}for(var h=e.values(),c,f,m,y;c=h.next(),!c.done;){for(f=c.value,m=!0,s=0;s<a;s++)if(y=arguments[s],y!==e&&!y.has(f)){m=!1;break}m&&r.add(f)}return r};Ft.union=function(){if(arguments.length<2)throw new Error("mnemonist/Set.union: needs at least two arguments.");var r=new Set,t,e=arguments.length,i,s;for(t=0;t<e;t++)for(i=arguments[t].values();s=i.next(),!s.done;)r.add(s.value);return r};Ft.difference=function(r,t){if(!r.size)return new Set;if(!t.size)return new Set(r);for(var e=new Set,i=r.values(),s;s=i.next(),!s.done;)t.has(s.value)||e.add(s.value);return e};Ft.symmetricDifference=function(r,t){for(var e=new Set,i=r.values(),s;s=i.next(),!s.done;)t.has(s.value)||e.add(s.value);for(i=t.values();s=i.next(),!s.done;)r.has(s.value)||e.add(s.value);return e};Ft.isSubset=function(r,t){var e=r.values(),i;if(r===t)return!0;if(r.size>t.size)return!1;for(;i=e.next(),!i.done;)if(!t.has(i.value))return!1;return!0};Ft.isSuperset=function(r,t){return Ft.isSubset(t,r)};Ft.add=function(r,t){for(var e=t.values(),i;i=e.next(),!i.done;)r.add(i.value)};Ft.subtract=function(r,t){for(var e=t.values(),i;i=e.next(),!i.done;)r.delete(i.value)};Ft.intersect=function(r,t){for(var e=r.values(),i;i=e.next(),!i.done;)t.has(i.value)||r.delete(i.value)};Ft.disjunct=function(r,t){for(var e=r.values(),i,s=[];i=e.next(),!i.done;)t.has(i.value)&&s.push(i.value);for(e=t.values();i=e.next(),!i.done;)r.has(i.value)||r.add(i.value);for(var a=0,h=s.length;a<h;a++)r.delete(s[a])};Ft.intersectionSize=function(r,t){var e;if(r.size>t.size&&(e=r,r=t,t=e),r.size===0)return 0;if(r===t)return r.size;for(var i=r.values(),s,a=0;s=i.next(),!s.done;)t.has(s.value)&&a++;return a};Ft.unionSize=function(r,t){var e=Ft.intersectionSize(r,t);return r.size+t.size-e};Ft.jaccard=function(r,t){var e=Ft.intersectionSize(r,t);if(e===0)return 0;var i=r.size+t.size-e;return e/i};Ft.overlap=function(r,t){var e=Ft.intersectionSize(r,t);return e===0?0:e/Math.min(r.size,t.size)}});var Lm=V((UO,_m)=>{var e1=Nt(),r1=ne().getPointerArray;function Se(r){var t=r1(r);this.start=0,this.size=0,this.capacity=r,this.dense=new t(r),this.sparse=new t(r)}Se.prototype.clear=function(){this.start=0,this.size=0};Se.prototype.has=function(r){if(this.size===0)return!1;var t=this.sparse[r],e=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;return e&&this.dense[t]===r};Se.prototype.enqueue=function(r){var t=this.sparse[r];if(this.size!==0){var e=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;if(e&&this.dense[t]===r)return this}return t=(this.start+this.size)%this.capacity,this.dense[t]=r,this.sparse[r]=t,this.size++,this};Se.prototype.dequeue=function(){if(this.size!==0){var r=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var t=this.dense[r];return this.sparse[t]=this.capacity,t}};Se.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=this.capacity,i=this.size,s=this.start,a=0;a<i;)r.call(t,this.dense[s],a,this),s++,a++,s===e&&(s=0)};Se.prototype.values=function(){var r=this.dense,t=this.capacity,e=this.size,i=this.start,s=0;return new e1(function(){if(s>=e)return{done:!0};var a=r[i];return i++,s++,i===t&&(i=0),{value:a,done:!1}})};typeof Symbol!="undefined"&&(Se.prototype[Symbol.iterator]=Se.prototype.values);Se.prototype.inspect=function(){var r=[];return this.forEach(function(t){r.push(t)}),Object.defineProperty(r,"constructor",{value:Se,enumerable:!1}),r.capacity=this.capacity,r};typeof Symbol!="undefined"&&(Se.prototype[Symbol.for("nodejs.util.inspect.custom")]=Se.prototype.inspect);_m.exports=Se});var Om=V((BO,Em)=>{var Xu=Nt(),i1=ne().getPointerArray;function Zt(r,t){arguments.length<2&&(t=r,r=Array);var e=i1(t);this.size=0,this.length=t,this.dense=new e(t),this.sparse=new e(t),this.vals=new r(t)}Zt.prototype.clear=function(){this.size=0};Zt.prototype.has=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r};Zt.prototype.get=function(r){var t=this.sparse[r];if(t<this.size&&this.dense[t]===r)return this.vals[t]};Zt.prototype.set=function(r,t){var e=this.sparse[r];return e<this.size&&this.dense[e]===r?(this.vals[e]=t,this):(this.dense[this.size]=r,this.sparse[r]=this.size,this.vals[this.size]=t,this.size++,this)};Zt.prototype.delete=function(r){var t=this.sparse[r];return t>=this.size||this.dense[t]!==r?!1:(t=this.dense[this.size-1],this.dense[this.sparse[r]]=t,this.sparse[t]=this.sparse[r],this.size--,!0)};Zt.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e=0;e<this.size;e++)r.call(t,this.vals[e],this.dense[e])};Zt.prototype.keys=function(){var r=this.size,t=this.dense,e=0;return new Xu(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};Zt.prototype.values=function(){var r=this.size,t=this.vals,e=0;return new Xu(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};Zt.prototype.entries=function(){var r=this.size,t=this.dense,e=this.vals,i=0;return new Xu(function(){if(i<r){var s=[t[i],e[i]];return i++,{value:s}}return{done:!0}})};typeof Symbol!="undefined"&&(Zt.prototype[Symbol.iterator]=Zt.prototype.entries);Zt.prototype.inspect=function(){for(var r=new Map,t=0;t<this.size;t++)r.set(this.dense[t],this.vals[t]);return Object.defineProperty(r,"constructor",{value:Zt,enumerable:!1}),r.length=this.length,this.vals.constructor!==Array&&(r.type=this.vals.constructor.name),r};typeof Symbol!="undefined"&&(Zt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Zt.prototype.inspect);Em.exports=Zt});var Im=V((HO,Am)=>{var n1=Nt(),o1=ne().getPointerArray;function Ce(r){var t=o1(r);this.size=0,this.length=r,this.dense=new t(r),this.sparse=new t(r)}Ce.prototype.clear=function(){this.size=0};Ce.prototype.has=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r};Ce.prototype.add=function(r){var t=this.sparse[r];return t<this.size&&this.dense[t]===r?this:(this.dense[this.size]=r,this.sparse[r]=this.size,this.size++,this)};Ce.prototype.delete=function(r){var t=this.sparse[r];return t>=this.size||this.dense[t]!==r?!1:(t=this.dense[this.size-1],this.dense[this.sparse[r]]=t,this.sparse[t]=this.sparse[r],this.size--,!0)};Ce.prototype.forEach=function(r,t){t=arguments.length>1?t:this;for(var e,i=0;i<this.size;i++)e=this.dense[i],r.call(t,e,e)};Ce.prototype.values=function(){var r=this.size,t=this.dense,e=0;return new n1(function(){if(e<r){var i=t[e];return e++,{value:i}}return{done:!0}})};typeof Symbol!="undefined"&&(Ce.prototype[Symbol.iterator]=Ce.prototype.values);Ce.prototype.inspect=function(){for(var r=new Set,t=0;t<this.size;t++)r.add(this.dense[t]);return Object.defineProperty(r,"constructor",{value:Ce,enumerable:!1}),r.length=this.length,r};typeof Symbol!="undefined"&&(Ce.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ce.prototype.inspect);Am.exports=Ce});var Rm=V((WO,Fm)=>{var s1=mt(),a1=2,u1=2,h1=new Set([0,1,2]),l1={0:"Returns only the top suggestion",1:"Returns suggestions with the smallest edit distance",2:"Returns every suggestion (no early termination)"};function Ls(r){var t=new Set;return typeof r=="number"&&t.add(r),{suggestions:t,count:0}}function Mm(r,t,e){return{term:r||"",distance:t||0,count:e||0}}function km(r,t,e,i){i=i||new Set,t++;var s,a=r.length,h;if(a>1)for(h=0;h<a;h++)s=r.substring(0,h)+r.substring(h+1),i.has(s)||(i.add(s),t<e&&km(s,t,e,i));return i}function c1(r,t,e,i,s,a){var h=e.suggestions.values().next().value;t<2&&e.suggestions.size>0&&r[h].length-a.length>i.length-a.length&&(e.suggestions=new Set,e.count=0),(t===2||!e.suggestions.size||r[h].length-a.length>=i.length-a.length)&&e.suggestions.add(s)}function Dm(r,t){var e=r.length,i=t.length,s=[[]],a=e+i,h=new Map,c,f,m;for(s[0][0]=a,c=0;c<=e;c++)s[c+1]||(s[c+1]=[]),s[c+1][1]=c,s[c+1][0]=a;for(m=0;m<=i;m++)s[1][m+1]=m,s[0][m+1]=a;var y=r+t,b;for(c=0,f=y.length;c<f;c++)b=y[c],h.has(b)||h.set(b,0);for(c=1;c<=e;c++){var _=0;for(m=1;m<=i;m++){var S=h.get(t[m-1]),I=_;r[c-1]===t[m-1]?(s[c+1][m+1]=s[c][m],_=m):s[c+1][m+1]=Math.min(s[c][m],s[c+1][m],s[c][m+1])+1,s[c+1][m+1]=Math.min(s[c+1][m+1],s[S][I]+(c-S-1)+1+(m-I-1))}h.set(r[c-1],c)}return s[e+1][i+1]}function f1(r,t,e,i,s,a){var h=a.length;if(h-i>s)return[];for(var c=[a],f=new Set,m=new Set,y=[],b,_;c.length>0&&(b=c.shift(),!(e<2&&y.length>0&&h-b.length>y[0].distance));){if(_=r[b],_!==void 0){if(typeof _=="number"&&(_=Ls(_)),_.count>0&&!m.has(b)){m.add(b);var S=Mm(b,h-b.length,_.count);if(y.push(S),e<2&&h-b.length===0)break}_.suggestions.forEach(j=>{var B=t[j];if(!m.has(B)){m.add(B);var Z=0;if(a!==B)if(B.length===b.length)Z=h-b.length;else if(h===b.length)Z=B.length-b.length;else{for(var ht=0,Ot=0,Ve=B.length;ht<Ve&&ht<h&&B[ht]===a[ht];)ht++;for(;Ot<Ve-ht&&Ot<h&&B[Ve-Ot-1]===a[h-Ot-1];)Ot++;ht>0||Ot>0?Z=Dm(B.substr(ht,Ve-ht-Ot),a.substr(ht,h-ht-Ot)):Z=Dm(B,a)}if(e<2&&y.length>0&&y[0].distance>Z&&(y=[]),!(e<2&&y.length>0&&Z>y[0].distance)&&Z<=i){var _e=r[B];_e!==void 0&&y.push(Mm(B,Z,_e.count))}}})}if(h-b.length<i){if(e<2&&y.length>0&&h-b.length>=y[0].distance)continue;for(var I=0,M=b.length;I<M;I++){var F=b.substring(0,I)+b.substring(I+1);f.has(F)||(f.add(F),c.push(F))}}}return e===0?y.slice(0,1):y}function mr(r){if(r=r||{},this.clear(),this.maxDistance=typeof r.maxDistance=="number"?r.maxDistance:a1,this.verbosity=typeof r.verbosity=="number"?r.verbosity:u1,typeof this.maxDistance!="number"||this.maxDistance<=0)throw Error("mnemonist/SymSpell.constructor: invalid `maxDistance` option. Should be a integer greater than 0.");if(!h1.has(this.verbosity))throw Error("mnemonist/SymSpell.constructor: invalid `verbosity` option. Should be either 0, 1 or 2.")}mr.prototype.clear=function(){this.size=0,this.dictionary=Object.create(null),this.maxLength=0,this.words=[]};mr.prototype.add=function(r){var t=this.dictionary[r];if(t!==void 0?(typeof t=="number"&&(t=Ls(t),this.dictionary[r]=t),t.count++):(t=Ls(),t.count++,this.dictionary[r]=t,r.length>this.maxLength&&(this.maxLength=r.length)),t.count===1){var e=this.words.length;this.words.push(r);var i=km(r,0,this.maxDistance);i.forEach(s=>{var a=this.dictionary[s];a!==void 0?(typeof a=="number"&&(a=Ls(a),this.dictionary[s]=a),a.suggestions.has(e)||c1(this.words,this.verbosity,a,r,e,s)):this.dictionary[s]=e})}return this.size++,this};mr.prototype.search=function(r){return f1(this.dictionary,this.words,this.verbosity,this.maxDistance,this.maxLength,r)};mr.prototype.inspect=function(){var r=[];r.size=this.size,r.maxDistance=this.maxDistance,r.verbosity=this.verbosity,r.behavior=l1[this.verbosity];for(var t in this.dictionary)typeof this.dictionary[t]=="object"&&this.dictionary[t].count&&r.push([t,this.dictionary[t].count]);return Object.defineProperty(r,"constructor",{value:mr,enumerable:!1}),r};typeof Symbol!="undefined"&&(mr.prototype[Symbol.for("nodejs.util.inspect.custom")]=mr.prototype.inspect);mr.from=function(r,t){var e=new mr(t);return s1(r,function(i){e.add(i)}),e};Fm.exports=mr});var Ku=V((qO,zm)=>{var p1=mt(),qi=Nt(),Gt="\0";function vt(r){this.mode=r===Array?"array":"string",this.clear()}vt.prototype.clear=function(){this.root={},this.size=0};vt.prototype.set=function(r,t){for(var e=this.root,i,s=0,a=r.length;s<a;s++)i=r[s],e=e[i]||(e[i]={});return Gt in e||this.size++,e[Gt]=t,this};vt.prototype.update=function(r,t){for(var e=this.root,i,s=0,a=r.length;s<a;s++)i=r[s],e=e[i]||(e[i]={});return Gt in e||this.size++,e[Gt]=t(e[Gt]),this};vt.prototype.get=function(r){var t=this.root,e,i,s;for(i=0,s=r.length;i<s;i++)if(e=r[i],t=t[e],typeof t=="undefined")return;if(Gt in t)return t[Gt]};vt.prototype.delete=function(r){var t=this.root,e=null,i=null,s,a,h,c;for(h=0,c=r.length;h<c;h++){if(a=r[h],s=t,t=t[a],typeof t=="undefined")return!1;e!==null?Object.keys(t).length>1&&(e=null,i=null):Object.keys(t).length<2&&(e=s,i=a)}return Gt in t?(this.size--,e?delete e[i]:delete t[Gt],!0):!1};vt.prototype.has=function(r){for(var t=this.root,e,i=0,s=r.length;i<s;i++)if(e=r[i],t=t[e],typeof t=="undefined")return!1;return Gt in t};vt.prototype.find=function(r){var t=typeof r=="string",e=this.root,i=[],s,a,h;for(a=0,h=r.length;a<h;a++)if(s=r[a],e=e[s],typeof e=="undefined")return i;for(var c=[e],f=[r],m;c.length;){r=f.pop(),e=c.pop();for(m in e){if(m===Gt){i.push([r,e[Gt]]);continue}c.push(e[m]),f.push(t?r+m:r.concat(m))}}return i};vt.prototype.values=function(r){var t=this.root,e=[],i,s,a;if(r){for(s=0,a=r.length;s<a;s++)if(i=r[s],t=t[i],typeof t=="undefined")return qi.empty()}return e.push(t),new qi(function(){for(var h,c=!1,f;e.length;){h=e.pop();for(f in h){if(f===Gt){c=!0;continue}e.push(h[f])}if(c)return{done:!1,value:h[Gt]}}return{done:!0}})};vt.prototype.prefixes=function(r){var t=this.root,e=[],i=[],s,a,h,c=this.mode==="string";if(r){for(a=0,h=r.length;a<h;a++)if(s=r[a],t=t[s],typeof t=="undefined")return qi.empty()}else r=c?"":[];return e.push(t),i.push(r),new qi(function(){for(var f,m,y=!1,b;e.length;){f=e.pop(),m=i.pop();for(b in f){if(b===Gt){y=!0;continue}e.push(f[b]),i.push(c?m+b:m.concat(b))}if(y)return{done:!1,value:m}}return{done:!0}})};vt.prototype.keys=vt.prototype.prefixes;vt.prototype.entries=function(r){var t=this.root,e=[],i=[],s,a,h,c=this.mode==="string";if(r){for(a=0,h=r.length;a<h;a++)if(s=r[a],t=t[s],typeof t=="undefined")return qi.empty()}else r=c?"":[];return e.push(t),i.push(r),new qi(function(){for(var f,m,y=!1,b;e.length;){f=e.pop(),m=i.pop();for(b in f){if(b===Gt){y=!0;continue}e.push(f[b]),i.push(c?m+b:m.concat(b))}if(y)return{done:!1,value:[m,f[Gt]]}}return{done:!0}})};typeof Symbol!="undefined"&&(vt.prototype[Symbol.iterator]=vt.prototype.entries);vt.prototype.inspect=function(){for(var r=new Array(this.size),t=this.entries(),e,i=0;e=t.next(),!e.done;)r[i++]=e.value;return Object.defineProperty(r,"constructor",{value:vt,enumerable:!1}),r};typeof Symbol!="undefined"&&(vt.prototype[Symbol.for("nodejs.util.inspect.custom")]=vt.prototype.inspect);vt.prototype.toJSON=function(){return this.root};vt.from=function(r){var t=new vt;return p1(r,function(e,i){t.set(i,e)}),t};vt.SENTINEL=Gt;zm.exports=vt});var jm=V(($O,Nm)=>{var m1=mt(),Vm=Ku(),Es="\0";function Ut(r){this.mode=r===Array?"array":"string",this.clear()}for(Ju in Vm.prototype)Ut.prototype[Ju]=Vm.prototype[Ju];var Ju;delete Ut.prototype.set;delete Ut.prototype.get;delete Ut.prototype.values;delete Ut.prototype.entries;Ut.prototype.add=function(r){for(var t=this.root,e,i=0,s=r.length;i<s;i++)e=r[i],t=t[e]||(t[e]={});return Es in t||this.size++,t[Es]=!0,this};Ut.prototype.find=function(r){var t=typeof r=="string",e=this.root,i=[],s,a,h;for(a=0,h=r.length;a<h;a++)if(s=r[a],e=e[s],typeof e=="undefined")return i;for(var c=[e],f=[r],m;c.length;){r=f.pop(),e=c.pop();for(m in e){if(m===Es){i.push(r);continue}c.push(e[m]),f.push(t?r+m:r.concat(m))}}return i};typeof Symbol!="undefined"&&(Ut.prototype[Symbol.iterator]=Ut.prototype.keys);Ut.prototype.inspect=function(){for(var r=new Set,t=this.keys(),e;e=t.next(),!e.done;)r.add(e.value);return Object.defineProperty(r,"constructor",{value:Ut,enumerable:!1}),r};typeof Symbol!="undefined"&&(Ut.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ut.prototype.inspect);Ut.prototype.toJSON=function(){return this.root};Ut.from=function(r){var t=new Ut;return m1(r,function(e){t.add(e)}),t};Ut.SENTINEL=Es;Nm.exports=Ut});var Hm=V((YO,Bm)=>{var Gm=Nt(),d1=mt(),g1=pe(),Um=ne(),y1=function(r){return Math.max(1,Math.ceil(r*1.5))},v1=function(r){var t=Um.getPointerArray(r);return new t(r)};function J(r,t){if(arguments.length<1)throw new Error("mnemonist/vector: expecting at least a byte array constructor.");var e=t||0,i=y1,s=0,a=!1;typeof t=="object"&&(e=t.initialCapacity||0,s=t.initialLength||0,i=t.policy||i,a=t.factory===!0),this.factory=a?r:null,this.ArrayClass=r,this.length=s,this.capacity=Math.max(s,e),this.policy=i,this.array=new r(this.capacity)}J.prototype.set=function(r,t){if(this.length<r)throw new Error("Vector("+this.ArrayClass.name+").set: index out of bounds.");return this.array[r]=t,this};J.prototype.get=function(r){if(!(this.length<r))return this.array[r]};J.prototype.applyPolicy=function(r){var t=this.policy(r||this.capacity);if(typeof t!="number"||t<0)throw new Error("mnemonist/vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(t<=this.capacity)throw new Error("mnemonist/vector.applyPolicy: policy returned a less or equal capacity to allocate.");return t};J.prototype.reallocate=function(r){if(r===this.capacity)return this;var t=this.array;if(r<this.length&&(this.length=r),r>this.capacity)if(this.factory===null?this.array=new this.ArrayClass(r):this.array=this.factory(r),Um.isTypedArray(this.array))this.array.set(t,0);else for(var e=0,i=this.length;e<i;e++)this.array[e]=t[e];else this.array=t.slice(0,r);return this.capacity=r,this};J.prototype.grow=function(r){var t;if(typeof r=="number"){if(this.capacity>=r)return this;for(t=this.capacity;t<r;)t=this.applyPolicy(t);return this.reallocate(t),this}return t=this.applyPolicy(),this.reallocate(t),this};J.prototype.resize=function(r){return r===this.length?this:r<this.length?(this.length=r,this):(this.length=r,this.reallocate(r),this)};J.prototype.push=function(r){return this.capacity===this.length&&this.grow(),this.array[this.length++]=r,this.length};J.prototype.pop=function(){if(this.length!==0)return this.array[--this.length]};J.prototype.values=function(){var r=this.array,t=this.length,e=0;return new Gm(function(){if(e>=t)return{done:!0};var i=r[e];return e++,{value:i,done:!1}})};J.prototype.entries=function(){var r=this.array,t=this.length,e=0;return new Gm(function(){if(e>=t)return{done:!0};var i=r[e];return{value:[e++,i],done:!1}})};typeof Symbol!="undefined"&&(J.prototype[Symbol.iterator]=J.prototype.values);J.prototype.inspect=function(){var r=this.array.slice(0,this.length);return r.type=this.array.constructor.name,r.items=this.length,r.capacity=this.capacity,Object.defineProperty(r,"constructor",{value:J,enumerable:!1}),r};typeof Symbol!="undefined"&&(J.prototype[Symbol.for("nodejs.util.inspect.custom")]=J.prototype.inspect);J.from=function(r,t,e){if(arguments.length<3&&(e=g1.guessLength(r),typeof e!="number"))throw new Error("mnemonist/vector.from: could not guess iterable length. Please provide desired capacity as last argument.");var i=new J(t,e);return d1(r,function(s){i.push(s)}),i};function dr(r){var t=function(i){J.call(this,r,i)};for(var e in J.prototype)J.prototype.hasOwnProperty(e)&&(t.prototype[e]=J.prototype[e]);return t.from=function(i,s){return J.from(i,r,s)},typeof Symbol!="undefined"&&(t.prototype[Symbol.iterator]=t.prototype.values),t}J.Int8Vector=dr(Int8Array);J.Uint8Vector=dr(Uint8Array);J.Uint8ClampedVector=dr(Uint8ClampedArray);J.Int16Vector=dr(Int16Array);J.Uint16Vector=dr(Uint16Array);J.Int32Vector=dr(Int32Array);J.Uint32Vector=dr(Uint32Array);J.Float32Vector=dr(Float32Array);J.Float64Vector=dr(Float64Array);J.PointerVector=dr(v1);Bm.exports=J});var qm=V((QO,Wm)=>{var b1=pe(),w1=ne(),P1=Hu().inplaceQuickSortIndices,T1=Uu().lowerBoundIndices,x1=Ts(),S1=w1.getPointerArray;function C1(r,t){return r.distance<t.distance?1:r.distance>t.distance?-1:0}function _1(r,t,e){for(var i=e.length,s=S1(i),a=0,h=new s(i),c=new s(i),f=new s(i),m=new Float64Array(i),y=[0,0,i],b=new Float64Array(i),_,S,I,M,F,j,B,Z,ht;y.length;)if(F=y.pop(),M=y.pop(),_=y.pop(),S=e[F-1],F--,ht=F-M,h[_]=S,ht!==0){if(ht===1){B=r(t[S],t[e[M]]),m[_]=B,a++,f[_]=a,h[a]=e[M];continue}for(Z=M;Z<F;Z++)b[e[Z]]=r(t[S],t[e[Z]]);P1(b,e,M,F),I=M+ht/2-1,I===(I|0)?B=(b[e[I]]+b[e[I+1]])/2:B=b[e[Math.ceil(I)]],m[_]=B,j=T1(b,e,B,M,F),F-j>0&&(a++,f[_]=a,y.push(a,j,F)),j-M>0&&(a++,c[_]=a,y.push(a,M,j))}return{nodes:h,lefts:c,rights:f,mus:m}}function Er(r,t){if(typeof r!="function")throw new Error("mnemonist/VPTree.constructor: given `distance` must be a function.");if(!t)throw new Error("mnemonist/VPTree.constructor: you must provide items to the tree. A VPTree cannot be updated after its creation.");this.distance=r,this.heap=new x1(C1),this.D=0;var e=b1.toArrayWithIndices(t);this.items=e[0];var i=e[1];this.size=i.length;var s=_1(r,this.items,i);this.nodes=s.nodes,this.lefts=s.lefts,this.rights=s.rights,this.mus=s.mus}Er.prototype.nearestNeighbors=function(r,t){var e=this.heap,i=[0],s=1/0,a,h,c,f,m,y,b;for(this.D=0;i.length;)a=i.pop(),h=this.nodes[a],c=this.items[h],b=this.distance(c,t),this.D++,b<s&&(e.push({distance:b,item:c}),e.size>r&&e.pop(),e.size>=r&&(s=e.peek().distance)),f=this.lefts[a],m=this.rights[a],!(!f&&!m)&&(y=this.mus[a],b<y?(f&&b<y+s&&i.push(f),m&&b>=y-s&&i.push(m)):(m&&b>=y-s&&i.push(m),f&&b<y+s&&i.push(f)));for(var _=new Array(e.size),S=e.size-1;S>=0;S--)_[S]=e.pop();return _};Er.prototype.neighbors=function(r,t){var e=[],i=[0],s,a,h,c,f,m,y;for(this.D=0;i.length;)s=i.pop(),a=this.nodes[s],h=this.items[a],y=this.distance(h,t),this.D++,y<=r&&e.push({distance:y,item:h}),c=this.lefts[s],f=this.rights[s],!(!c&&!f)&&(m=this.mus[s],y<m?(c&&y<m+r&&i.push(c),f&&y>=m-r&&i.push(f)):(f&&y>=m-r&&i.push(f),c&&y<m+r&&i.push(c)));return e};Er.prototype.inspect=function(){var r=this.items.slice();return Object.defineProperty(r,"constructor",{value:Er,enumerable:!1}),r};typeof Symbol!="undefined"&&(Er.prototype[Symbol.for("nodejs.util.inspect.custom")]=Er.prototype.inspect);Er.from=function(r,t){return new Er(t,r)};Wm.exports=Er});var Qm=V((XO,Ym)=>{var Zu=Ts(),th=ms(),$m=Wf();Ym.exports={BiMap:Xf(),BitSet:ip(),BitVector:ap(),BloomFilter:pp(),BKTree:dp(),CircularBuffer:wp(),DefaultMap:Tp(),DefaultWeakMap:Sp(),FixedDeque:Du(),StaticDisjointSet:_p(),FibonacciHeap:th,MinFibonacciHeap:th.MinFibonacciHeap,MaxFibonacciHeap:th.MaxFibonacciHeap,FixedReverseHeap:xs(),FuzzyMap:Mp(),FuzzyMultiMap:Rp(),HashedArrayTree:Np(),Heap:Zu,MinHeap:Zu.MinHeap,MaxHeap:Zu.MaxHeap,StaticIntervalTree:Bp(),InvertedIndex:Xp(),KDTree:em(),LinkedList:nm(),LRUCache:_s(),LRUCacheWithDelete:am(),LRUMap:Yu(),LRUMapWithDelete:lm(),MultiMap:Vu(),MultiSet:fm(),PassjoinIndex:vm(),Queue:Pm(),FixedStack:ju(),Stack:Sm(),SuffixArray:$m,GeneralizedSuffixArray:$m.GeneralizedSuffixArray,Set:Cm(),SparseQueueSet:Lm(),SparseMap:Om(),SparseSet:Im(),SymSpell:Rm(),Trie:jm(),TrieMap:Ku(),Vector:Hm(),VPTree:qm()}});var x=class r{static get ZERO(){return new r(0,0)}static get ONE(){return new r(1,1)}static get UP(){return new r(0,-1)}static get DOWN(){return new r(0,1)}static get LEFT(){return new r(-1,0)}static get RIGHT(){return new r(1,0)}static get UP_LEFT(){return new r(-1,-1)}static get UP_RIGHT(){return new r(1,-1)}static get DOWN_RIGHT(){return new r(1,1)}static get DOWN_LEFT(){return new r(-1,1)}constructor(t,e){typeof t=="number"?(this.x=t,this.y=e||0):(this.x=t.x,this.y=t.y)}clone(){return new r(this.x,this.y)}add(t){return new r(this.x+t.x,this.y+t.y)}multiply(t){return new r(this.x*t.x,this.y*t.y)}divide(t){return new r(this.x/t.x,this.y/t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}equals(t){return this.x===t.x&&this.y===t.y}abs(){return new r(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}modulo(t){return new r(this.x%t.x,this.y%t.y)}scalarModulo(t){return new r(this.x%t,this.y%t)}scalarMult(t){return new r(this.x*t,this.y*t)}toPosition(){return{x:this.x,y:this.y}}toString(){return`${this.x}#${this.y}`}};var z=class{static equal(t,e){return t.position.x===e.position.x&&t.position.y===e.position.y&&t.layer===e.layer}static copyOver(t,e){e.position.x=t.position.x,e.position.y=t.position.y,e.layer=t.layer}static clone(t){return{position:t.position.clone(),layer:t.layer}}static toString(t){return`${t.position.toString()}#${t.layer}`}static toInternal(t){return{position:new x(t.position.x,t.position.y),layer:t.charLayer}}static fromInternal(t){return{position:t.position.toPosition(),charLayer:t.layer}}};var le=(m=>(m.NONE="none",m.LEFT="left",m.UP_LEFT="up-left",m.UP="up",m.UP_RIGHT="up-right",m.RIGHT="right",m.DOWN_RIGHT="down-right",m.DOWN="down",m.DOWN_LEFT="down-left",m))(le||{}),uT={up:"down",down:"up",left:"right",right:"left",none:"none","up-left":"down-right","up-right":"down-left","down-right":"up-left","down-left":"up-right"},hT={up:x.UP,down:x.DOWN,left:x.LEFT,right:x.RIGHT,none:x.ZERO,"up-left":x.UP_LEFT,"up-right":x.UP_RIGHT,"down-right":x.DOWN_RIGHT,"down-left":x.DOWN_LEFT},Pn={up:0,"up-right":1,right:2,"down-right":3,down:4,"down-left":5,left:6,"up-left":7,none:NaN},Xc=["up","up-right","right","down-right","down","down-left","left","up-left"],lT=["down-left","down-right","up-right","up-left"];function Tn(){return["up","down","left","right","none","up-left","up-right","down-right","down-left"]}function ni(r){return lT.includes(r)}function Kc(r,t=1){return r==="none"?"none":Xc[(Pn[r]+8-Math.abs(t)%8)%8]}function Ro(r,t=1){return r==="none"?"none":Xc[(Pn[r]+t)%8]}function Pe(r){return hT[r]}function Jc(r){return uT[r]}function Ht(r,t){if(r.x===t.x){if(r.y>t.y)return"up";if(r.y<t.y)return"down"}else if(r.y===t.y){if(r.x>t.x)return"left";if(r.x<t.x)return"right"}else if(r.x>t.x){if(r.y<t.y)return"down-left";if(r.y>t.y)return"up-left"}else if(r.x<t.x){if(r.y<t.y)return"down-right";if(r.y>t.y)return"up-right"}return"none"}var Ii=(e=>(e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT",e))(Ii||{});function jr(r){return typeof r=="string"&&Tn().includes(r)}var fu=function(r,t){return fu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])},fu(r,t)};function Gr(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");fu(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Zc(r,t,e,i){function s(a){return a instanceof e?a:new e(function(h){h(a)})}return new(e||(e=Promise))(function(a,h){function c(y){try{m(i.next(y))}catch(b){h(b)}}function f(y){try{m(i.throw(y))}catch(b){h(b)}}function m(y){y.done?a(y.value):s(y.value).then(c,f)}m((i=i.apply(r,t||[])).next())})}function zo(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,s,a,h;return h={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function c(m){return function(y){return f([m,y])}}function f(m){if(i)throw new TypeError("Generator is already executing.");for(;h&&(h=0,m[0]&&(e=0)),e;)try{if(i=1,s&&(a=m[0]&2?s.return:m[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,m[1])).done)return a;switch(s=0,a&&(m=[m[0]&2,a.value]),m[0]){case 0:case 1:a=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,s=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(m[0]===6||m[0]===2)){e=0;continue}if(m[0]===3&&(!a||m[1]>a[0]&&m[1]<a[3])){e.label=m[1];break}if(m[0]===6&&e.label<a[1]){e.label=a[1],a=m;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(m);break}a[2]&&e.ops.pop(),e.trys.pop();continue}m=t.call(r,e)}catch(y){m=[6,y],s=0}finally{i=a=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function _r(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function er(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),s,a=[],h;try{for(;(t===void 0||t-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(c){h={error:c}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(h)throw h.error}}return a}function rr(r,t,e){if(e||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))}function oi(r){return this instanceof oi?(this.v=r,this):new oi(r)}function tf(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(r,t||[]),s,a=[];return s={},c("next"),c("throw"),c("return",h),s[Symbol.asyncIterator]=function(){return this},s;function h(S){return function(I){return Promise.resolve(I).then(S,b)}}function c(S,I){i[S]&&(s[S]=function(M){return new Promise(function(F,j){a.push([S,M,F,j])>1||f(S,M)})},I&&(s[S]=I(s[S])))}function f(S,I){try{m(i[S](I))}catch(M){_(a[0][3],M)}}function m(S){S.value instanceof oi?Promise.resolve(S.value.v).then(y,b):_(a[0][2],S)}function y(S){f("next",S)}function b(S){f("throw",S)}function _(S,I){S(I),a.shift(),a.length&&f(a[0][0],a[0][1])}}function ef(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof _r=="function"?_r(r):r[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(a){e[a]=r[a]&&function(h){return new Promise(function(c,f){h=r[a](h),s(c,f,h.done,h.value)})}}function s(a,h,c,f){Promise.resolve(f).then(function(m){a({value:m,done:c})},h)}}function tt(r){return typeof r=="function"}function Vo(r){var t=function(i){Error.call(i),i.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var No=Vo(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(i,s){return s+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function xn(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var Mi=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,i,s,a;if(!this.closed){this.closed=!0;var h=this._parentage;if(h)if(this._parentage=null,Array.isArray(h))try{for(var c=_r(h),f=c.next();!f.done;f=c.next()){var m=f.value;m.remove(this)}}catch(M){t={error:M}}finally{try{f&&!f.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}else h.remove(this);var y=this.initialTeardown;if(tt(y))try{y()}catch(M){a=M instanceof No?M.errors:[M]}var b=this._finalizers;if(b){this._finalizers=null;try{for(var _=_r(b),S=_.next();!S.done;S=_.next()){var I=S.value;try{rf(I)}catch(M){a=a!=null?a:[],M instanceof No?a=rr(rr([],er(a)),er(M.errors)):a.push(M)}}}catch(M){i={error:M}}finally{try{S&&!S.done&&(s=_.return)&&s.call(_)}finally{if(i)throw i.error}}}if(a)throw new No(a)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)rf(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&xn(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&xn(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}();var pu=Mi.EMPTY;function jo(r){return r instanceof Mi||r&&"closed"in r&&tt(r.remove)&&tt(r.add)&&tt(r.unsubscribe)}function rf(r){tt(r)?r():r.unsubscribe()}var We={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Di={setTimeout:function(r,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];var s=Di.delegate;return s!=null&&s.setTimeout?s.setTimeout.apply(s,rr([r,t],er(e))):setTimeout.apply(void 0,rr([r,t],er(e)))},clearTimeout:function(r){var t=Di.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Go(r){Di.setTimeout(function(){var t=We.onUnhandledError;if(t)t(r);else throw r})}function Sn(){}var nf=function(){return mu("C",void 0,void 0)}();function of(r){return mu("E",void 0,r)}function sf(r){return mu("N",r,void 0)}function mu(r,t,e){return{kind:r,value:t,error:e}}var si=null;function ki(r){if(We.useDeprecatedSynchronousErrorHandling){var t=!si;if(t&&(si={errorThrown:!1,error:null}),r(),t){var e=si,i=e.errorThrown,s=e.error;if(si=null,i)throw s}}else r()}function af(r){We.useDeprecatedSynchronousErrorHandling&&si&&(si.errorThrown=!0,si.error=r)}var Cn=function(r){Gr(t,r);function t(e){var i=r.call(this)||this;return i.isStopped=!1,e?(i.destination=e,jo(e)&&e.add(i)):i.destination=mT,i}return t.create=function(e,i,s){return new Bo(e,i,s)},t.prototype.next=function(e){this.isStopped?gu(sf(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?gu(of(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?gu(nf,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Mi);var cT=Function.prototype.bind;function du(r,t){return cT.call(r,t)}var fT=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){Uo(i)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){Uo(i)}else Uo(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Uo(e)}},r}(),Bo=function(r){Gr(t,r);function t(e,i,s){var a=r.call(this)||this,h;if(tt(e)||!e)h={next:e!=null?e:void 0,error:i!=null?i:void 0,complete:s!=null?s:void 0};else{var c;a&&We.useDeprecatedNextContext?(c=Object.create(e),c.unsubscribe=function(){return a.unsubscribe()},h={next:e.next&&du(e.next,c),error:e.error&&du(e.error,c),complete:e.complete&&du(e.complete,c)}):h=e}return a.destination=new fT(h),a}return t}(Cn);function Uo(r){We.useDeprecatedSynchronousErrorHandling?af(r):Go(r)}function pT(r){throw r}function gu(r,t){var e=We.onStoppedNotification;e&&Di.setTimeout(function(){return e(r,t)})}var mT={closed:!0,next:Sn,error:pT,complete:Sn};var Fi=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ho(r){return r}function yu(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return vu(r)}function vu(r){return r.length===0?Ho:r.length===1?r[0]:function(e){return r.reduce(function(i,s){return s(i)},e)}}var Vt=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var s=this,a=gT(t)?t:new Bo(t,e,i);return ki(function(){var h=s,c=h.operator,f=h.source;a.add(c?c.call(a,f):f?s._subscribe(a):s._trySubscribe(a))}),a},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var i=this;return e=uf(e),new e(function(s,a){var h=new Bo({next:function(c){try{t(c)}catch(f){a(f),h.unsubscribe()}},error:a,complete:s});i.subscribe(h)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Fi]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vu(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=uf(t),new t(function(i,s){var a;e.subscribe(function(h){return a=h},function(h){return s(h)},function(){return i(a)})})},r.create=function(t){return new r(t)},r}();function uf(r){var t;return(t=r!=null?r:We.Promise)!==null&&t!==void 0?t:Promise}function dT(r){return r&&tt(r.next)&&tt(r.error)&&tt(r.complete)}function gT(r){return r&&r instanceof Cn||dT(r)&&jo(r)}function yT(r){return tt(r==null?void 0:r.lift)}function Xt(r){return function(t){if(yT(t))return t.lift(function(e){try{return r(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Te(r,t,e,i,s){return new vT(r,t,e,i,s)}var vT=function(r){Gr(t,r);function t(e,i,s,a,h,c){var f=r.call(this,e)||this;return f.onFinalize=h,f.shouldUnsubscribe=c,f._next=i?function(m){try{i(m)}catch(y){e.error(y)}}:r.prototype._next,f._error=a?function(m){try{a(m)}catch(y){e.error(y)}finally{this.unsubscribe()}}:r.prototype._error,f._complete=s?function(){try{s()}catch(m){e.error(m)}finally{this.unsubscribe()}}:r.prototype._complete,f}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;r.prototype.unsubscribe.call(this),!i&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(Cn);var hf=Vo(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var nt=function(r){Gr(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new lf(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new hf},t.prototype.next=function(e){var i=this;ki(function(){var s,a;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var h=_r(i.currentObservers),c=h.next();!c.done;c=h.next()){var f=c.value;f.next(e)}}catch(m){s={error:m}}finally{try{c&&!c.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}}})},t.prototype.error=function(e){var i=this;ki(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var s=i.observers;s.length;)s.shift().error(e)}})},t.prototype.complete=function(){var e=this;ki(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,s=this,a=s.hasError,h=s.isStopped,c=s.observers;return a||h?pu:(this.currentObservers=null,c.push(e),new Mi(function(){i.currentObservers=null,xn(c,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,s=i.hasError,a=i.thrownError,h=i.isStopped;s?e.error(a):h&&e.complete()},t.prototype.asObservable=function(){var e=new Vt;return e.source=this,e},t.create=function(e,i){return new lf(e,i)},t}(Vt);var lf=function(r){Gr(t,r);function t(e,i){var s=r.call(this)||this;return s.destination=e,s.source=i,s}return t.prototype.next=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.next)===null||s===void 0||s.call(i,e)},t.prototype.error=function(e){var i,s;(s=(i=this.destination)===null||i===void 0?void 0:i.error)===null||s===void 0||s.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,s;return(s=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&s!==void 0?s:pu},t}(nt);var Wo=new Vt(function(r){return r.complete()});function cf(r){return r&&tt(r.schedule)}function ff(r){return r[r.length-1]}function qo(r){return cf(ff(r))?r.pop():void 0}function $o(r,t){return typeof ff(r)=="number"?r.pop():t}var Yo=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Qo(r){return tt(r==null?void 0:r.then)}function Xo(r){return tt(r[Fi])}function Ko(r){return Symbol.asyncIterator&&tt(r==null?void 0:r[Symbol.asyncIterator])}function Jo(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function bT(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Zo=bT();function ts(r){return tt(r==null?void 0:r[Zo])}function es(r){return tf(this,arguments,function(){var e,i,s,a;return zo(this,function(h){switch(h.label){case 0:e=r.getReader(),h.label=1;case 1:h.trys.push([1,,9,10]),h.label=2;case 2:return[4,oi(e.read())];case 3:return i=h.sent(),s=i.value,a=i.done,a?[4,oi(void 0)]:[3,5];case 4:return[2,h.sent()];case 5:return[4,oi(s)];case 6:return[4,h.sent()];case 7:return h.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function rs(r){return tt(r==null?void 0:r.getReader)}function ce(r){if(r instanceof Vt)return r;if(r!=null){if(Xo(r))return wT(r);if(Yo(r))return PT(r);if(Qo(r))return TT(r);if(Ko(r))return pf(r);if(ts(r))return xT(r);if(rs(r))return ST(r)}throw Jo(r)}function wT(r){return new Vt(function(t){var e=r[Fi]();if(tt(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function PT(r){return new Vt(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}function TT(r){return new Vt(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Go)})}function xT(r){return new Vt(function(t){var e,i;try{for(var s=_r(r),a=s.next();!a.done;a=s.next()){var h=a.value;if(t.next(h),t.closed)return}}catch(c){e={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}t.complete()})}function pf(r){return new Vt(function(t){CT(r,t).catch(function(e){return t.error(e)})})}function ST(r){return pf(es(r))}function CT(r,t){var e,i,s,a;return Zc(this,void 0,void 0,function(){var h,c;return zo(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),e=ef(r),f.label=1;case 1:return[4,e.next()];case 2:if(i=f.sent(),!!i.done)return[3,4];if(h=i.value,t.next(h),t.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=f.sent(),s={error:c},[3,11];case 6:return f.trys.push([6,,9,10]),i&&!i.done&&(a=e.return)?[4,a.call(e)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Fe(r,t,e,i,s){i===void 0&&(i=0),s===void 0&&(s=!1);var a=t.schedule(function(){e(),s?r.add(this.schedule(null,i)):this.unsubscribe()},i);if(r.add(a),!s)return a}function is(r,t){return t===void 0&&(t=0),Xt(function(e,i){e.subscribe(Te(i,function(s){return Fe(i,r,function(){return i.next(s)},t)},function(){return Fe(i,r,function(){return i.complete()},t)},function(s){return Fe(i,r,function(){return i.error(s)},t)}))})}function ns(r,t){return t===void 0&&(t=0),Xt(function(e,i){i.add(r.schedule(function(){return e.subscribe(i)},t))})}function mf(r,t){return ce(r).pipe(ns(t),is(t))}function df(r,t){return ce(r).pipe(ns(t),is(t))}function gf(r,t){return new Vt(function(e){var i=0;return t.schedule(function(){i===r.length?e.complete():(e.next(r[i++]),e.closed||this.schedule())})})}function yf(r,t){return new Vt(function(e){var i;return Fe(e,t,function(){i=r[Zo](),Fe(e,t,function(){var s,a,h;try{s=i.next(),a=s.value,h=s.done}catch(c){e.error(c);return}h?e.complete():e.next(a)},0,!0)}),function(){return tt(i==null?void 0:i.return)&&i.return()}})}function os(r,t){if(!r)throw new Error("Iterable cannot be null");return new Vt(function(e){Fe(e,t,function(){var i=r[Symbol.asyncIterator]();Fe(e,t,function(){i.next().then(function(s){s.done?e.complete():e.next(s.value)})},0,!0)})})}function vf(r,t){return os(es(r),t)}function bf(r,t){if(r!=null){if(Xo(r))return mf(r,t);if(Yo(r))return gf(r,t);if(Qo(r))return df(r,t);if(Ko(r))return os(r,t);if(ts(r))return yf(r,t);if(rs(r))return vf(r,t)}throw Jo(r)}function ss(r,t){return t?bf(r,t):ce(r)}function ir(r,t){return Xt(function(e,i){var s=0;e.subscribe(Te(i,function(a){i.next(r.call(t,a,s++))}))})}function wf(r,t,e,i,s,a,h,c){var f=[],m=0,y=0,b=!1,_=function(){b&&!f.length&&!m&&t.complete()},S=function(M){return m<i?I(M):f.push(M)},I=function(M){a&&t.next(M),m++;var F=!1;ce(e(M,y++)).subscribe(Te(t,function(j){s==null||s(j),a?S(j):t.next(j)},function(){F=!0},void 0,function(){if(F)try{m--;for(var j=function(){var B=f.shift();h?Fe(t,h,function(){return I(B)}):I(B)};f.length&&m<i;)j();_()}catch(B){t.error(B)}}))};return r.subscribe(Te(t,S,function(){b=!0,_()})),function(){c==null||c()}}function bu(r,t,e){return e===void 0&&(e=1/0),tt(t)?bu(function(i,s){return ir(function(a,h){return t(i,a,s,h)})(ce(r(i,s)))},e):(typeof t=="number"&&(e=t),Xt(function(i,s){return wf(i,s,r,e)}))}function as(r){return r===void 0&&(r=1/0),bu(Ho,r)}function wu(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=qo(r),i=$o(r,1/0),s=r;return s.length?s.length===1?ce(s[0]):as(i)(ss(s,e)):Wo}var _T=Array.isArray;function Pf(r){return r.length===1&&_T(r[0])?r[0]:r}function Wt(r,t){return Xt(function(e,i){var s=0;e.subscribe(Te(i,function(a){return r.call(t,a,s++)&&i.next(a)}))})}function fe(r){return r<=0?function(){return Wo}:Xt(function(t,e){var i=0;t.subscribe(Te(e,function(s){++i<=r&&(e.next(s),r<=i&&e.complete())}))})}function Tf(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=qo(r),i=$o(r,1/0);return r=Pf(r),Xt(function(s,a){as(i)(ss(rr([s],er(r)),e)).subscribe(a)})}function Pu(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return Tf.apply(void 0,rr([],er(r)))}function Mt(r){return Xt(function(t,e){ce(r).subscribe(Te(e,function(){return e.complete()},Sn)),!e.closed&&t.subscribe(e)})}var Ur=1e3,us=class{constructor(t,e){this.id=t;this.movementDirection="none";this._tilePos={position:new x(0,0),layer:void 0};this.movementStarted$=new nt;this.movementStopped$=new nt;this.directionChanged$=new nt;this.positionChangeStarted$=new nt;this.positionChangeFinished$=new nt;this.tilePositionSet$=new nt;this.autoMovementSet$=new nt;this.lastMovementImpulse="none";this.facingDirection="down";this.depthChanged$=new nt;this.movementProgress=0;var i,s,a;this.tilemap=e.tilemap,this.speed=e.speed,this.collidesWithTilesInternal=e.collidesWithTiles,this._tilePos.layer=e.charLayer,this.ignoreMissingTiles=(i=e.ignoreMissingTiles)!=null?i:!1,this.collisionGroups=new Set(e.collisionGroups||[]),this.ignoreCollisionGroups=new Set(e.ignoreCollisionGroups||[]),this.labels=new Set(e.labels||[]),this.numberOfDirections=e.numberOfDirections,e.facingDirection&&this.turnTowards(e.facingDirection),this.tileWidth=(s=e.tileWidth)!=null?s:1,this.tileHeight=(a=e.tileHeight)!=null?a:1}getId(){return this.id}getSpeed(){return this.speed}setSpeed(t){this.speed=t}setMovement(t){this.autoMovementSet$.next(t),this.movement=t}getMovement(){return this.movement}collidesWithTiles(){return this.collidesWithTilesInternal}setCollidesWithTiles(t){this.collidesWithTilesInternal=t}getIgnoreMissingTiles(){return this.ignoreMissingTiles}setIgnoreMissingTiles(t){this.ignoreMissingTiles=t}setTilePosition(t){this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(it({},t)),this.fire(this.positionChangeStarted$,this.tilePos,t),this.fire(this.positionChangeFinished$,this.tilePos,t),this.movementDirection="none",this.lastMovementImpulse="none",this.tilePos=t,this.movementProgress=0}getTilePos(){return this.tilePos}getNextTilePos(){if(!this.isMoving())return this.tilePos;let t=this.tilePos.layer,e=this.tilePosInDirection(this.tilePos.position,this.movementDirection),i=this.tilemap.getTransition(e,this.tilePos.layer);return i&&(t=i),{position:this.tilePosInDirection(this.tilePos.position,this.movementDirection),layer:t}}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}move(t){this.lastMovementImpulse=t,t!="none"&&(this.isMoving()||(this.isBlockingDirection(t)?this.changeFacingDirection(t):this.startMoving(t)))}update(t){var e;(e=this.movement)==null||e.update(t),this.isMoving()&&this.updateCharacterPosition(t),this.lastMovementImpulse="none"}getMovementDirection(){return this.movementDirection}isBlockingDirection(t){if(t=="none")return!1;let e=this.tilePosInDirection(this.getNextTilePos().position,t),i=this.tilemap.getTransition(e,this.getNextTilePos().layer)||this.getNextTilePos().layer;return this.collidesWithTilesInternal&&this.isTileBlocking(t,i)?!0:this.isCharBlocking(t,i)}isTileBlocking(t,e){return this.someCharTile((i,s)=>{let a=this.tilePosInDirection(new x(i,s),t);return this.tilemap.hasBlockingTile(a,e,Jc(t),this.ignoreMissingTiles)})}isCharBlocking(t,e){return this.someCharTile((i,s)=>{let a=this.tilePosInDirection(new x(i,s),t);return this.tilemap.hasBlockingChar(a,e,this.getCollisionGroups(),new Set([this.getId()]),this.ignoreCollisionGroups)})}isMoving(){return this.movementDirection!="none"}turnTowards(t){this.isMoving()||t!="none"&&this.changeFacingDirection(t)}changeFacingDirection(t){this.facingDirection!==t&&(this.facingDirection=t,this.directionChanged$.next(t))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(Pe(this.facingDirection))}addCollisionGroup(t){this.collisionGroups.add(t)}setCollisionGroups(t){this.collisionGroups=new Set(t)}setIgnoreCollisionGroups(t){this.ignoreCollisionGroups=new Set(t)}getCollisionGroups(){return Array.from(this.collisionGroups)}getIgnoreCollisionGroups(){return Array.from(this.ignoreCollisionGroups)}hasCollisionGroup(t){return this.collisionGroups.has(t)}removeCollisionGroup(t){this.collisionGroups.delete(t)}removeAllCollisionGroups(){this.collisionGroups.clear()}addLabels(t){for(let e of t)this.labels.add(e)}getLabels(){return[...this.labels.values()]}hasLabel(t){return this.labels.has(t)}clearLabels(){this.labels.clear()}removeLabels(t){for(let e of t)this.labels.delete(e)}getNumberOfDirections(){return this.numberOfDirections}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}depthChanged(){return this.depthChanged$}getMovementProgress(){return this.movementProgress}setMovementProgress(t){let e=Math.max(0,Math.min(Ur,t));this.movementProgress=e}hasWalkedHalfATile(){return this.movementProgress>Ur/2}willCrossTileBorderThisUpdate(t){return this.movementProgress+this.maxProgressForDelta(t)>=Ur}updateCharacterPosition(t){let e=this.willCrossTileBorderThisUpdate(t),s=1-(e?Ur-this.movementProgress:this.maxProgressForDelta(t))/this.maxProgressForDelta(t);this.movementProgress=Math.min(this.movementProgress+this.maxProgressForDelta(t),Ur),e&&(this.movementProgress=0,this.shouldContinueMoving()?(this.fire(this.positionChangeFinished$,this.tilePos,this.getNextTilePos()),this.tilePos=this.getNextTilePos(),this.startMoving(this.lastMovementImpulse),s>0&&this.updateCharacterPosition(t*s)):this.stopMoving())}maxProgressForDelta(t){let i=t/1e3;return Math.floor(i*this.speed*Ur)}get tilePos(){return z.clone(this._tilePos)}set tilePos(t){z.copyOver(t,this._tilePos)}startMoving(t){t!=="none"&&(t!=this.movementDirection&&this.movementStarted$.next(t),this.movementDirection=t,this.facingDirection=t,this.fire(this.positionChangeStarted$,this.tilePos,this.getNextTilePos()))}tilePosInDirection(t,e){return t.add(Pe(this.tilemap.toMapDirection(e)))}shouldContinueMoving(){return this.lastMovementImpulse!=="none"&&!this.isBlockingDirection(this.lastMovementImpulse)}stopMoving(){if(this.movementDirection==="none")return;let t=this.tilePos,e=this.getNextTilePos(),i=this.movementDirection;this.tilePos=this.getNextTilePos(),this.movementDirection="none",this.movementStopped$.next(i),this.fire(this.positionChangeFinished$,t,e)}fire(t,{position:e,layer:i},{position:s,layer:a}){t.next({exitTile:e,enterTile:s,exitLayer:i,enterLayer:a})}someCharTile(t){let e=this.getNextTilePos().position;for(let i=e.x;i<e.x+this.getTileWidth();i++)for(let s=e.y;s<e.y+this.getTileHeight();s++)if(t(i,s))return!0;return!1}};var ai=class ai{constructor(t,e){this.walkingAnimationMapping=t;this.charsInRow=e;this.lastFootLeft=!1;this.directionToFrameRow={down:0,"down-left":1,"down-right":2,left:1,right:2,up:3,"up-left":1,"up-right":2};this._isEnabled=!0;this.frameChange$=new nt;this.setWalkingAnimationMapping(t)}frameChange(){return this.frameChange$}setIsEnabled(t){this._isEnabled=t}isEnabled(){return this._isEnabled}updateCharacterFrame(t,e,i){this._isEnabled&&(e?this.setStandingFrameDuringWalk(t,i):this.setWalkingFrame(t))}setStandingFrame(t){this._isEnabled&&this._setStandingFrame(t)}setWalkingAnimationMapping(t){this.walkingAnimationMapping=t,this._isEnabled=this.walkingAnimationMapping!==void 0}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharsInRow(){return this.charsInRow}setStandingFrameDuringWalk(t,e){this.isCurrentFrameStanding(t,e)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(t)}setWalkingFrame(t){let e=this.framesOfDirection(t);e&&this.frameChange$.next(this.lastFootLeft?e.rightFoot:e.leftFoot)}_setStandingFrame(t){let e=this.framesOfDirection(t);e&&this.frameChange$.next(e.standing)}isCurrentFrameStanding(t,e){var i;return e===((i=this.framesOfDirection(t))==null?void 0:i.standing)}framesOfDirection(t){return typeof this.walkingAnimationMapping=="number"?this.getFramesForCharIndex(t,this.walkingAnimationMapping):this.getFramesForAnimationMapping(t)}getFramesForAnimationMapping(t){if(this.walkingAnimationMapping)return this.walkingAnimationMapping[t]||this.walkingAnimationMapping[this.fallbackDirection(t)]}fallbackDirection(t){switch(t){case"down-left":return"left";case"down-right":return"right";case"up-left":return"left";case"up-right":return"right"}return t}getFramesForCharIndex(t,e){var m;let i=Math.floor(e/this.charsInRow),s=e%this.charsInRow,a=this.charsInRow*ai.FRAMES_CHAR_ROW,h=ai.FRAMES_CHAR_ROW*s,c=((m=this.directionToFrameRow[t])!=null?m:0)+i*ai.FRAMES_CHAR_COL,f=h+c*a;return{rightFoot:f,standing:f+1,leftFoot:f+2}}};ai.FRAMES_CHAR_ROW=3,ai.FRAMES_CHAR_COL=4;var _n=ai;var ui=class{static shiftPad(t,e){let i=Math.floor(t),a=`${i}`.padStart(e,"0").length;return i/Math.pow(10,a)}};var xt=class r{static vec2str(t){return`${t.x}#${t.y}`}static equal(t,e){return r.vec2str(t)==r.vec2str(e)}static manhattanDistance(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i+s}static chebyshevDistance(t,e){let i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return Math.max(i,s)}static scalarMult(t,e){return t.clone().multiply(new x(e,e))}};var Re=class Re{constructor(t){this.tilemap=t;this.charLayerDepths=new Map;this.setLayerDepths()}getTileWidth(){var e,i;let t=(i=(e=this.tilemap.layers[0])==null?void 0:e.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileWidth*t}getTileHeight(){var e,i;let t=(i=(e=this.tilemap.layers[0])==null?void 0:e.tilemapLayer.scale)!=null?i:1;return this.tilemap.tileHeight*t}getDepthOfCharLayer(t){var e;return(e=this.charLayerDepths.get(t))!=null?e:0}tilePosToPixelPos(t){return this.isIsometric()?xt.scalarMult(this.getTileSize(),.5).multiply(new x(t.x-t.y,t.x+t.y)):t.clone().multiply(this.getTileSize())}getTileDistance(t){if(this.isIsometric())switch(t){case"down-left":case"down-right":case"up-left":case"up-right":return xt.scalarMult(this.getTileSize(),.5);default:return this.getTileSize()}return this.getTileSize()}getTileSize(){return new x(this.getTileWidth(),this.getTileHeight())}isIsometric(){return this.tilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()}isLayerAlwaysOnTop(t){return this.hasLayerProp(t,Re.ALWAYS_TOP_PROP_NAME)}isCharLayer(t){return this.hasLayerProp(t,Re.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let t=[],e=-1,i=this.tilemap.layers.filter(a=>this.isLayerAlwaysOnTop(a));this.tilemap.layers.filter(a=>!this.isLayerAlwaysOnTop(a)).forEach(a=>{this.hasLayerProp(a,Re.HEIGHT_SHIFT_PROP_NAME)?(this.createHeightShiftLayers(a,e),t.push(a.tilemapLayer)):this.setDepth(a,++e)}),this.charLayerDepths.set(void 0,e),i.forEach((a,h)=>{a.tilemapLayer.setDepth(h+1+e)}),t.forEach(a=>a.destroy())}setDepth(t,e){t.tilemapLayer.setDepth(e),this.isCharLayer(t)&&this.charLayerDepths.set(this.getLayerProp(t,Re.CHAR_LAYER_PROP_NAME),e)}createHeightShiftLayers(t,e){let i=this.getLayerProp(t,Re.HEIGHT_SHIFT_PROP_NAME);isNaN(i)&&(i=0);let s=1;for(let a=0;a<t.height;a++){let h=this.copyLayer(t,a);if(h){h.scale=t.tilemapLayer.scale;let c=this.isIsometric()?this.getTileHeight()/2:this.getTileHeight();h.setDepth(e+ui.shiftPad((a+i)*c+s,Re.Z_INDEX_PADDING))}}}getLayerProp(t,e){let s=t.properties.find(a=>a.name==e);return s==null?void 0:s.value}hasLayerProp(t,e){return this.getLayerProp(t,e)!=null}copyLayer(t,e){let i=`${t.name}#${e}`,s=this.tilemap.createBlankLayer(i,t.tilemapLayer.tileset);if(s){if(s.name=i,this.isIsometric())for(let a=e;a>=0;a--){let h=e-a;s.putTileAt(t.data[a][h],h,a)}else for(let a=0;a<t.width;a++)s.putTileAt(t.data[e][a],a,e);return s}}};Re.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",Re.CHAR_LAYER_PROP_NAME="ge_charLayer",Re.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",Re.Z_INDEX_PADDING=7;var hi=Re;var hs=class{constructor(t,e,i,s,a){this.charData=t;this.scene=e;this.tilemap=i;this.geHeadless=a;this.customOffset=new x(0,0);this.cachedContainerHeight=0;this.newSpriteSet$=new nt;this.destroy$=new nt;var h,c;this.layerOverlaySprite=s&&t.sprite?this.scene.add.sprite(0,0,t.sprite.texture):void 0,this.walkingAnimationMapping=t.walkingAnimationMapping,this.customOffset=new x(t.offsetX||0,t.offsetY||0),this.sprite=t.sprite,this.container=t.container,this.cachedContainerHeight=(c=(h=t.container)==null?void 0:h.getBounds().height)!=null?c:0,this.geHeadless.directionChanged().pipe(Wt(({charId:f})=>f===this.charData.id)).subscribe(({direction:f})=>{var m;(m=this.animation)==null||m.setStandingFrame(f)}),this.sprite&&(this.sprite.setOrigin(0,0),this.resetAnimation(this.sprite),this.updateOverlaySprite(),this.updateGridChar())}destroy(){this.destroy$.next(),this.destroy$.complete(),this.newSpriteSet$.complete()}setSprite(t){t?(this.sprite&&(t.x=this.sprite.x,t.y=this.sprite.y),this.sprite=t,this.newSpriteSet$.next(),this.layerOverlaySprite=this.layerOverlaySprite?this.scene.add.sprite(0,0,this.sprite.texture):void 0,this.updateOverlaySprite(),this.resetAnimation(this.sprite),this.updateDepth()):(this.layerOverlaySprite=void 0,this.sprite=void 0)}getSprite(){return this.sprite}getLayerOverlaySprite(){return this.layerOverlaySprite}setContainer(t){var e;this.container=t,this.cachedContainerHeight=(e=t==null?void 0:t.getBounds().height)!=null?e:0}getContainer(){return this.container}getOffsetX(){return this.customOffset.x}setOffsetX(t){this.customOffset.x=t}getOffsetY(){return this.customOffset.y}setOffsetY(t){this.customOffset.y=t}getWalkingAnimationMapping(){return this.walkingAnimationMapping}turnTowards(t){var e;this.geHeadless.isMoving(this.charData.id)||t!="none"&&(this.geHeadless.turnTowards(this.charData.id,t),(e=this.animation)==null||e.setStandingFrame(t))}getAnimation(){return this.animation}setAnimation(t){this.animation=t}update(t){this.updateGridChar()}getEngineOffset(){var i,s,a,h;if(!this.sprite)return x.ZERO;let t=this.tilemap.getTileWidth()/2-Math.floor(((s=(i=this.sprite)==null?void 0:i.displayWidth)!=null?s:0)/2),e=-((h=(a=this.sprite)==null?void 0:a.displayHeight)!=null?h:0)+this.tilemap.getTileHeight();return new x(t,e)}updatePixelPos(){let t=new x(this.geHeadless.getPosition(this.charData.id)),e=this.geHeadless.getMovementProgress(this.charData.id)/1e3,s=this.tilemap.tilePosToPixelPos(t).add(this.getEngineOffset()).add(this.customOffset).add(Pe(this.geHeadless.getFacingDirection(this.charData.id)).multiply(this.tilemap.getTileDistance(this.geHeadless.getFacingDirection(this.charData.id)).scalarMult(e))),a=this.getGameObj();a&&(a.x=Math.floor(s.x),a.y=Math.floor(s.y))}getGameObj(){return this.container||this.sprite}updateGridChar(){var t;if(this.updatePixelPos(),this.sprite&&this.geHeadless.isMoving(this.charData.id)){let e=this.geHeadless.getMovementProgress(this.charData.id)>Ur/2;(t=this.getAnimation())==null||t.updateCharacterFrame(this.geHeadless.getFacingDirection(this.charData.id),e,Number(this.sprite.frame.name))}this.updateDepth()}resetAnimation(t){let e=new _n(this.walkingAnimationMapping,t.texture.source[0].width/t.width/_n.FRAMES_CHAR_ROW);this.setAnimation(e),e.frameChange().pipe(Mt(this.newSpriteSet$)).subscribe(i=>{t==null||t.setFrame(i)}),e.setIsEnabled(this.walkingAnimationMapping!==void 0),e.setStandingFrame(this.geHeadless.getFacingDirection(this.charData.id))}updateOverlaySprite(){if(!this.layerOverlaySprite||!this.sprite)return;this.layerOverlaySprite.scale=this.sprite.scale;let t=this.tilemap.getTileHeight()/this.layerOverlaySprite.scale;this.layerOverlaySprite.setCrop(0,0,this.layerOverlaySprite.displayWidth,this.sprite.height-t),this.layerOverlaySprite.setOrigin(0,0)}updateDepth(){if(!this.getGameObj())return;let e=new x(this.geHeadless.getPosition(this.charData.id)),i=this.geHeadless.getCharLayer(this.charData.id);this.container?this.setContainerDepth(this.container,{position:e,layer:i}):this.sprite&&this.setSpriteDepth(this.sprite,{position:e,layer:i});let s=this.getLayerOverlaySprite();if(s){let a=new x(we(it({},e),{y:e.y-1}));this.setSpriteDepth(s,{position:a,layer:i})}}setSpriteDepth(t,e){t.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(e))+this.getPaddedPixelDepthSprite(t))}setContainerDepth(t,e){t.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(e))+this.getPaddedPixelDepthContainer(t))}getPaddedPixelDepthContainer(t){return ui.shiftPad(t.y+this.cachedContainerHeight,hi.Z_INDEX_PADDING)}getPaddedPixelDepthSprite(t){return ui.shiftPad(t.y+t.displayHeight,hi.Z_INDEX_PADDING)}getTransitionLayer(t){if(t.layer)return this.geHeadless.getTransition(t.position,t.layer)||t.layer}};var ls=(s=>(s.DONT_BLOCK="DONT_BLOCK",s.BLOCK_TWO_TILES="BLOCK_TWO_TILES",s.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",s.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND",s))(ls||{});var Ri=(s=>(s.STOP="STOP",s.CLOSEST_REACHABLE="CLOSEST_REACHABLE",s.RETRY="RETRY",s.ALTERNATIVE_TARGETS="ALTERNATIVE_TARGETS",s))(Ri||{});var cs=class{distance(t,e){return xt.manhattanDistance(t,e)}direction(t,e){if(xt.equal(t,e))return"none";let i=t.clone().subtract(e);return Math.abs(i.x)>Math.abs(i.y)?i.x>0?"left":"right":i.y>0?"up":"down"}neighbors(t){return[new x(t.x,t.y+1),new x(t.x+1,t.y),new x(t.x-1,t.y),new x(t.x,t.y-1)]}getDirections(){return["up","right","down","left"]}};var fs=class{distance(t,e){return xt.chebyshevDistance(t,e)}neighbors(t){let e=[new x(t.x,t.y+1),new x(t.x+1,t.y),new x(t.x-1,t.y),new x(t.x,t.y-1)],i=[new x(t.x+1,t.y+1),new x(t.x+1,t.y-1),new x(t.x-1,t.y+1),new x(t.x-1,t.y-1)];return[...e,...i]}direction(t,e){return e.x>t.x?e.y>t.y?"down-right":e.y<t.y?"up-right":"right":e.x<t.x?e.y>t.y?"down-left":e.y<t.y?"up-left":"left":e.y<t.y?"up":e.y>t.y?"down":"none"}getDirections(){return["up","right","down","left","down-left","down-right","up-right","up-left"]}};var qe=class{static create(t){switch(t){case 4:return new cs;case 8:return new fs}}};var Ln=class{constructor(t,e,i){this.backoffMs=t;this.maxRetries=e;this.onFinished=i;this.retries=0;this.elapsed=0}retry(t,e){this.shouldRetry()?(this.elapsed+=t,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,e())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}getBackoffMs(){return this.backoffMs}shouldRetry(){return this.maxRetries===-1||this.retries<this.maxRetries}};var En=(i=>(i.WAIT="WAIT",i.RETRY="RETRY",i.STOP="STOP",i))(En||{});var nr=class{constructor(t,{shortestPathAlgorithm:e="BFS",pathWidth:i=1,pathHeight:s=1,numberOfDirections:a=4,isPositionAllowed:h=(F,j)=>!0,collisionGroups:c=[],ignoredChars:f=[],ignoreTiles:m=!1,ignoreMapBounds:y=!1,ignoreBlockedTarget:b=!1,maxPathLength:_=1/0,ignoreLayers:S=!1,considerCosts:I=!1,calculateClosestToTarget:M=!0}={}){this.gridTilemap=t;this.options={shortestPathAlgorithm:e,pathWidth:i,pathHeight:s,numberOfDirections:a,isPositionAllowed:h,collisionGroups:c,ignoredChars:f,ignoreTiles:m,ignoreMapBounds:y,ignoreBlockedTarget:b,maxPathLength:_,ignoreLayers:S,considerCosts:I,calculateClosestToTarget:M},this.ignoredCharsSet=new Set(f)}findShortestPath(t,e){this.options.ignoreLayers&&(this.gridTilemap.fixCacheLayer(t.layer),e.layer=t.layer);let i=this.findShortestPathImpl(t,e);return this.gridTilemap.unfixCacheLayers(),i}getNeighbors(t,e){var h;return qe.create((h=this.options.numberOfDirections)!=null?h:4).neighbors(t.position).map(c=>{let f=t.layer;return this.options.ignoreLayers||(f=this.gridTilemap.getTransition(c,t.layer)),{position:c,layer:f||t.layer}}).filter(c=>!this.isBlocking(t,c)||this.options.ignoreBlockedTarget&&z.equal(c,e))}getTransition(t,e){if(!this.options.ignoreLayers)return this.gridTilemap.getTransition(t,e)}getCosts(t,e){if(!this.options.considerCosts)return 1;let i=Ht(e.position,t);return this.gridTilemap.getTileCosts(e,i)}isBlocking(t,e){return!(this.options.ignoreMapBounds||this.gridTilemap.isInRange(e.position))||!this.options.isPositionAllowed(e.position,e.layer)||!this.options.ignoreTiles&&this.hasBlockingTileFrom(t,e,this.options.pathWidth,this.options.pathHeight,this.options.ignoreMapBounds,this.gridTilemap)?!0:this.hasBlockingCharFrom(t,e,this.options.pathWidth,this.options.pathHeight,this.options.collisionGroups,this.ignoredCharsSet,this.gridTilemap)}distance(t,e){return(this.options.numberOfDirections===4?xt.manhattanDistance:xt.chebyshevDistance)(t,e)}getTilePosInDir(t,e){return this.options.ignoreLayers?{position:t.position.add(Pe(this.gridTilemap.toMapDirection(e))),layer:t.layer}:this.gridTilemap.getTilePosInDirection(t,e)}getReverseNeighbors(t,e){var c;let s=qe.create((c=this.options.numberOfDirections)!=null?c:4).neighbors(t.position),a;if(!this.options.ignoreLayers){let f=this.gridTilemap.getReverseTransitions(t.position,t.layer);a=f?[...f]:void 0}return s.map(f=>a?a.map(m=>({position:f,layer:m||t.layer})):[{position:f,layer:t.layer}]).flat().filter(f=>!this.isBlocking(f,t)||this.options.ignoreBlockedTarget&&z.equal(t,e))}hasBlockingCharFrom(t,e,i,s,a,h,c){if(i===1&&s===1)return c.hasBlockingChar(e.position,e.layer,a,h);let f=y=>c.hasBlockingChar(y,e.layer,a,h),m=Ht(t.position,e.position);return this.isBlockingMultiTile(t,m,i,s,f)}hasBlockingTileFrom(t,e,i,s,a,h){if(i===1&&s===1)return h.hasBlockingTile(e.position,e.layer,Ht(e.position,t.position),a);let c=Ht(t.position,e.position),f=m=>h.hasBlockingTile(m,e.layer,c,a);return this.isBlockingMultiTile(t,c,i,s,f)}isBlockingMultiTile(t,e,i,s,a){let h={src:new x(t.position.x+i,t.position.y),dest:new x(t.position.x+i,t.position.y+s-1)},c={src:new x(t.position.x-1,t.position.y),dest:new x(t.position.x-1,t.position.y+s-1)},f={src:new x(t.position.x,t.position.y-1),dest:new x(t.position.x+i-1,t.position.y-1)},m={src:new x(t.position.x,t.position.y+s),dest:new x(t.position.x+i-1,t.position.y+s)};switch(e){case"right":return this.checkLine(h,a);case"left":return this.checkLine(c,a);case"up":return this.checkLine(f,a);case"down":return this.checkLine(m,a);case"up-left":return this.checkLine({src:f.src,dest:new x(f.dest.x-1,f.dest.y)},a)||this.checkLine({src:new x(c.src.x,c.src.y-1),dest:new x(c.dest.x,c.dest.y-1)},a);case"up-right":return this.checkLine({src:new x(f.src.x+1,f.src.y),dest:f.dest},a)||this.checkLine({src:new x(h.src.x,h.src.y-1),dest:new x(h.dest.x,h.dest.y-1)},a);case"down-left":return this.checkLine({src:new x(c.src.x,c.src.y+1),dest:new x(c.dest.x,c.dest.y+1)},a)||this.checkLine({src:m.src,dest:new x(m.dest.x-1,m.dest.y)},a);case"down-right":return this.checkLine({src:new x(m.src.x+1,m.src.y),dest:m.dest},a)||this.checkLine({src:new x(h.src.x,h.src.y+1),dest:new x(h.dest.x,h.dest.y+1)},a)}return!1}checkLine(t,e){for(let i=t.src.x;i<=t.dest.x;i++)for(let s=t.src.y;s<=t.dest.y;s++)if(e(new x(i,s)))return!0;return!1}};var kf=Qc(ms(),1);var ds=class extends nr{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"A_STAR"}}shortestPathBfs(t,e){let i=new Map,s=new Map,a=new Map,h=new kf.MinFibonacciHeap((y,b)=>In(a,y)-In(a,b)),c=t,f=this.distance(t.position,e.position),m=0;for(h.push(t),s.set(z.toString(t),0),a.set(z.toString(t),this.distance(t.position,e.position));h.size>0;){let y=h.pop();if(!y)break;m++;let b=this.distance(y.position,e.position);if(b<f&&(f=b,c=y),Df(y,e))return{previous:i,closestToTarget:c,steps:m,maxPathLengthReached:!1};if(In(s,y)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:c,steps:m,maxPathLengthReached:!0};for(let _ of this.getNeighbors(y,e)){let S=In(s,y)+this.getCosts(y.position,_),I=z.toString(_);(!s.has(I)||S<In(s,_))&&(i.set(I,y),s.set(I,S),a.set(I,S+this.distance(_.position,e.position)),h.push(_))}}return{previous:i,closestToTarget:c,steps:m,maxPathLengthReached:!1}}returnPath(t,e,i){let s=[],a=i;for(s.push(a);!Df(a,e);){if(a=t.get(z.toString(a)),!a)return[];s.push(a)}return s.reverse()}};function In(r,t){var e;return(e=r.get(z.toString(t)))!=null?e:Number.MAX_VALUE}function Df(r,t){return xt.equal(r.position,t.position)?r.layer===t.layer:!1}var gs=class{constructor(t){this.data=t}},Lr=class{constructor(){this.sizeInternal=0}dequeue(){if(this.tail===void 0)return;this.sizeInternal--;let t=this.tail.data;return this.tail.prev===void 0?(this.tail=void 0,this.head=void 0,t):(this.tail.prev.next=void 0,this.tail=this.tail.prev,t)}enqueue(t){if(this.sizeInternal++,this.head===void 0){this.head=new gs(t),this.tail=this.head;return}let e=new gs(t);e.next=this.head,this.head.prev=e,this.head=e}peek(){return this.tail?this.tail.data:void 0}peekAll(){let t=[],e=this.tail;for(;e;)t.push(e.data),e=e.prev;return t}clear(){this.head=void 0,this.tail=void 0,this.sizeInternal=0}peekEnd(){var t;return(t=this.head)==null?void 0:t.data}size(){return this.sizeInternal}};var zi=class extends nr{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BFS"}}equal(t,e){return xt.equal(t.position,e.position)?t.layer===e.layer:!1}shortestPathBfs(t,e){let i=new Map,s=new Set,a=new Lr,h=t,c=this.distance(t.position,e.position),f=0;for(a.enqueue({node:t,dist:0}),s.add(z.toString(t));a.size()>0;){let m=a.dequeue();if(f++,!m)break;let{node:y,dist:b}=m;if(b>this.options.maxPathLength)return{previous:new Map,closestToTarget:h,steps:f,maxPathLengthReached:!0};let _=this.distance(y.position,e.position);if(_<c&&(c=_,h=y),this.equal(y,e))return{previous:i,closestToTarget:h,steps:f,maxPathLengthReached:!1};for(let S of this.getNeighbors(y,e))s.has(z.toString(S))||(i.set(z.toString(S),y),a.enqueue({node:S,dist:b+1}),s.add(z.toString(S)))}return{previous:i,closestToTarget:h,steps:f,maxPathLengthReached:!1}}returnPath(t,e,i){let s=[],a=i;for(s.push(a);!this.equal(a,e);){if(a=t.get(z.toString(a)),!a)return[];s.push(a)}return s.reverse()}};var ys=class{constructor(){this.previous=new Map;this.visited=new Map;this.queue=new Lr;this.minMatching=1/0;this.lastDist=0}isNewFrontier(){let t=this.queue.peek();return!!(t&&t.dist>this.lastDist)}step(t,e,i){var s;this.lastDist=i;for(let a of t){let h=z.toString(a);if(!this.visited.has(h)){this.previous.set(h,e),this.queue.enqueue({node:a,dist:i+1}),this.visited.set(h,i+1);let c=(s=this.otherBfs)==null?void 0:s.visited.get(h);c!==void 0&&c<this.minMatching&&(this.minMatching=c,this.minMatchingNode=a)}}}},vs=class extends nr{findShortestPathImpl(t,e){let i=this.shortestPathBfs(t,e);return{path:this.returnPath(i.previous,i.previous2,i.matchingPos,t,e),closestToTarget:i.closestToTarget,steps:i.steps,maxPathLengthReached:i.maxPathLengthReached,algorithmUsed:"BIDIRECTIONAL_SEARCH"}}equal(t,e){return xt.equal(t.position,e.position)?t.layer===e.layer:!1}shortestPathBfs(t,e){var f;if(z.equal(t,e))return{previous:new Map,previous2:new Map,closestToTarget:t,steps:0,maxPathLengthReached:!1};let i=new ys,s=new ys,a=0;i.otherBfs=s,s.otherBfs=i;let h=t,c=this.distance(t.position,e.position);for(i.queue.enqueue({node:t,dist:0}),s.queue.enqueue({node:e,dist:0}),i.visited.set(z.toString(t),0),s.visited.set(z.toString(e),0);this.shouldStop(i.queue.size()>0,s.queue.size()>0);){let m=i.queue.dequeue();if(!m)break;let{node:y,dist:b}=m;if(b+1+(((f=s.queue.peek())==null?void 0:f.dist)||0)>this.options.maxPathLength)return{previous:i.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(h),steps:a,maxPathLengthReached:!0};let _=this.distance(y.position,e.position);if(_<c&&(c=_,h=y),a++,i.step(this.getNeighbors(y,e),y,b),i.isNewFrontier()&&i.minMatchingNode)return{previous:i.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(e),matchingPos:i.minMatchingNode,steps:a,maxPathLengthReached:!1};let S=s.queue.dequeue();if(!S)continue;let{node:I,dist:M}=S;if(a++,s.step(this.getReverseNeighbors(I,e),I,M),s.isNewFrontier()&&s.minMatchingNode)return{previous:i.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(e),matchingPos:s.minMatchingNode,steps:a,maxPathLengthReached:!1}}return{previous:i.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(h),steps:a,maxPathLengthReached:!1}}shouldStop(t,e){return this.options.calculateClosestToTarget?t||e:t&&e}maybeClosestToTarget(t){return this.options.calculateClosestToTarget?t:void 0}returnPath(t,e,i,s,a){if(i){let h=this.getPathFromPrev(t,s,i).reverse(),c=this.getPathFromPrev(e,a,i);return h.pop(),[...h,...c]}else return this.getPathFromPrev(t,s,a).reverse()}getPathFromPrev(t,e,i){let s=[],a=i;for(s.push(a);!this.equal(a,e);){if(a=t.get(z.toString(a)),!a)return[];s.push(a)}return s}};var eh=Qc(Qm(),1);var $i=class extends nr{constructor(e,i={}){super(e,i);this.openSet=new eh.MinFibonacciHeap;this.g=new Map;this.f=new Map;this.closestToTarget={position:new x(0,0),layer:void 0};this.smallestDistToTarget=0;this.steps=0;this.visits=[];this.maxFrontierSize=0;this.maxJumpSize=0}findShortestPathImpl(e,i){this.maxJumpSize=this.distance(e.position,i.position);let s=this.shortestPath(e,i);return{path:this.returnPath(s.previous,e,i),closestToTarget:s.closestToTarget,steps:s.steps,maxPathLengthReached:s.maxPathLengthReached,algorithmUsed:"JPS"}}shortestPath(e,i){this.steps=0;let s=new Map;this.g=new Map,this.f=new Map,this.closestToTarget=e,this.smallestDistToTarget=this.distance(e.position,i.position),this.openSet=new eh.MinFibonacciHeap((h,c)=>Fn(this.f,h)-Fn(this.f,c)),this.openSet.push(e);let a=z.toString(e);for(this.g.set(a,0),this.f.set(a,this.distance(e.position,i.position)),this.maxFrontierSize=Math.max(this.maxFrontierSize,this.openSet.size);this.openSet.size>0;){let h=this.openSet.pop();if(!h)break;if(this.steps++,z.equal(h,i))return{previous:s,closestToTarget:i,steps:this.steps,maxPathLengthReached:!1};if(Fn(this.g,h)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!0};this.updateClosestToTarget(h,i);for(let c of this.getNeighborsInternal(h,s.get(z.toString(h)),i)){let f=z.toString(c.p),m=Fn(this.g,h)+c.dist;(!this.g.has(f)||m<Fn(this.g,c.p))&&(s.set(f,h),this.g.set(f,m),this.f.set(f,m+this.distance(c.p.position,i.position)),this.openSet.push(c.p))}}return{previous:s,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!1}}updateClosestToTarget(e,i){let s=this.distance(e.position,i.position);s<this.smallestDistToTarget&&(this.smallestDistToTarget=s,this.closestToTarget=e)}addIfNotBlocked(e,i,s){this.blockOrTrans(i,s)||e.push(s)}blockOrTrans(e,i){return this.isBlocking(e,i)||this.getTransition(i.position,i.layer)!==void 0}getNeighborsInternal(e,i,s){if(!i||e.layer!==i.layer)return this.getNeighbors(e,s).map(c=>({p:c,dist:1}));let a=this.prune(i,e).filter(c=>!this.isBlockingIgnoreTarget(e,c,s)).map(c=>{let f=this.getTransition(c.position,e.layer);return{position:c.position,layer:f||e.layer}}),h=[];for(let c of a)if(this.isHorizontal(e.position,c.position))h.push({p:c,dist:1});else{let f=this.jump(e,c,s,1,Ht(e.position,c.position));f&&h.push(f)}return h}isBlockingIgnoreTarget(e,i,s){return this.isBlocking(e,i)&&!(this.options.ignoreBlockedTarget&&z.equal(i,s))}jump(e,i,s,a,h){if(!this.isBlockingIgnoreTarget(e,i,s))return z.equal(i,s)?{p:i,dist:a}:a>=this.maxJumpSize?{p:i,dist:a}:this.getTransition(i.position,e.layer)!==void 0?{p:i,dist:a}:this.hasForced(e,i)?{p:i,dist:a}:(this.updateClosestToTarget(i,s),this.jump(i,this.getTilePosInDir(i,h),s,a+1,h))}isHorizontal(e,i){return e.y===i.y}getForced(e,i,s,a,h,c){let f=[],m=e;return(this.blockOrTrans(m,s)||this.blockOrTrans(s,a))&&this.addIfNotBlocked(f,i,a),(this.blockOrTrans(m,h)||this.blockOrTrans(h,c))&&this.addIfNotBlocked(f,i,c),f}hasForced(e,i){let{topLeft:s,downLeft:a,top:h,bottom:c}=this.normalizedPositions(e,i);return!!((this.blockOrTrans(e,a)||this.blockOrTrans(a,c))&&!this.blockOrTrans(i,c)||(this.blockOrTrans(e,s)||this.blockOrTrans(s,h))&&!this.blockOrTrans(i,h))}prune(e,i){let{right:s,top:a,bottom:h,downLeft:c,topLeft:f}=this.normalizedPositions(e,i);return this.isHorizontal(e.position,i.position)?[s,a,h]:[s,...this.getForced(e,i,c,h,f,a)]}normalizedPositions(e,i){return e.position.x<i.position.x?{topLeft:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},downLeft:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},top:{position:new x(i.position.x,i.position.y-1),layer:i.layer},bottom:{position:new x(i.position.x,i.position.y+1),layer:i.layer},right:{position:new x(i.position.x+1,i.position.y),layer:i.layer}}:e.position.x>i.position.x?{topLeft:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},downLeft:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},top:{position:new x(i.position.x,i.position.y+1),layer:i.layer},bottom:{position:new x(i.position.x,i.position.y-1),layer:i.layer},right:{position:new x(i.position.x-1,i.position.y),layer:i.layer}}:e.position.y<i.position.y?{topLeft:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},downLeft:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},top:{position:new x(i.position.x+1,i.position.y),layer:i.layer},bottom:{position:new x(i.position.x-1,i.position.y),layer:i.layer},right:{position:new x(i.position.x,i.position.y+1),layer:i.layer}}:{topLeft:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},downLeft:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},top:{position:new x(i.position.x-1,i.position.y),layer:i.layer},bottom:{position:new x(i.position.x+1,i.position.y),layer:i.layer},right:{position:new x(i.position.x,i.position.y-1),layer:i.layer}}}posInDir(e,i){return{position:e.position.add(Pe(i)),layer:e.layer}}returnPath(e,i,s){let a=[],h=s;for(a.push(h);!z.equal(h,i);){let c=e.get(z.toString(h));if(!c)return[];this.distance(c.position,h.position)>1?this.fillPath(h,c,a):a.push(c),h=c}return a.reverse()}fillPath(e,i,s){let a=e;do{let h=Ht(a.position,i.position);a=this.getTilePosInDir(a,h),s.push(a)}while(!xt.equal(a.position,i.position))}};function Fn(r,t){var e;return(e=r.get(z.toString(t)))!=null?e:Number.MAX_VALUE}var Os=class{constructor(t,e,i,s={}){this.character=t;this.gridTilemap=e;this.charToFollow=i;let a={distance:0,noPathFoundStrategy:"STOP",maxPathLength:1/0,shortestPathAlgorithm:"BIDIRECTIONAL_SEARCH",ignoreLayers:!1,considerCosts:s.considerCosts||!1,facingDirection:"none",isPositionAllowedFn:()=>!0,ignoredChars:[]};this.options=it(it({},a),s),this.options.considerCosts&&this.options.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.options.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.options.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1"),this.character=t,this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(Mt(this.character.autoMovementSet().pipe(Wt(h=>h!==this),fe(1)))).subscribe(({enterTile:h,enterLayer:c})=>{this.updateTarget(h,c)})}update(t){var e;(e=this.targetMovement)==null||e.update(t)}getInfo(){return{type:"Follow",config:{charToFollow:this.charToFollow.getId(),distance:this.options.distance,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,facingDirection:this.options.facingDirection,shortestPathAlgorithm:this.options.shortestPathAlgorithm,considerCosts:this.options.considerCosts,isPositionAllowedFn:this.options.isPositionAllowedFn,ignoredChars:this.options.ignoredChars}}}getFacingPos(){let t=Pn[this.options.facingDirection]+Pn[this.charToFollow.getFacingDirection()],e=Ro("up",t),i={x:this.charToFollow.getTilePos().position.x,y:this.charToFollow.getTilePos().position.y};return e==="right"?i.x+=this.charToFollow.getTileWidth()-1:e==="down"?i.y+=this.charToFollow.getTileWidth()-1:e==="down-left"?i.y+=this.charToFollow.getTileWidth()-1:e==="down-right"?(i.y+=this.charToFollow.getTileWidth()-1,i.x+=this.charToFollow.getTileWidth()-1):e==="up-right"&&(i.x+=this.charToFollow.getTileWidth()-1),this.gridTilemap.getTilePosInDirection({position:new x(i),layer:this.charToFollow.getTilePos().layer},e).position}updateTarget(t,e){let i=this.options.facingDirection!=="none"&&this.options.distance===0;i&&(t=this.getFacingPos()),this.targetMovement=new Yi(this.character,this.gridTilemap,{position:new x(t),layer:e},{distance:i?0:this.options.distance+1,config:{algorithm:this.options.shortestPathAlgorithm,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,considerCosts:this.options.considerCosts,ignoredChars:[this.charToFollow.getId(),...this.options.ignoredChars],isPositionAllowedFn:this.options.isPositionAllowedFn}})}};var Rn=class{static getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}};var As=class{constructor(t,e=0,i=-1){this.character=t;this.delay=e;this.radius=i;this.stepSize=0;this.delayLeft=this.delay,this.initialRow=t.getNextTilePos().position.y,this.initialCol=t.getNextTilePos().position.x,this.randomizeStepSize(),this.stepsWalked=0,this.currentMovementDirection="none",this.character.positionChangeStarted().pipe(Mt(this.character.autoMovementSet().pipe(Wt(s=>s!==this),fe(1)))).subscribe(()=>{this.stepsWalked++}),this.distanceUtils=qe.create(t.getNumberOfDirections())}update(t){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=t,this.delayLeft<=0){this.delayLeft=this.delay;let e=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(e),this.currentMovementDirection=e,this.randomizeStepSize()}}getInfo(){return{type:"Random",config:{delay:this.delay,radius:this.radius}}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!=="none"&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return this.distanceUtils.getDirections().filter(e=>!this.character.isBlockingDirection(e)).filter(e=>this.isWithinRadius(e))}isWithinRadius(t){return this.radius==-1?!0:this.getDist(t)<=this.radius}getDist(t){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(Pe(t)),new x(this.initialCol,this.initialRow))}getFreeRandomDirection(){let t=this.getFreeDirections();return t.length==0?"none":t[Rn.getRandomInt(t.length)]}randomizeStepSize(){this.stepSize=Rn.getRandomInt(this.radius)+1}};function Xm(r,t){return r.filter(e=>{var i,s,a,h,c,f;return(i=t.labels)!=null&&i.withAllLabels?(s=t.labels)==null?void 0:s.withAllLabels.every(m=>e.hasLabel(m)):(a=t.labels)!=null&&a.withOneOfLabels?(h=t.labels)==null?void 0:h.withOneOfLabels.some(m=>e.hasLabel(m)):(c=t.labels)!=null&&c.withNoneLabels?!((f=t.labels)!=null&&f.withNoneLabels.some(m=>e.hasLabel(m))):!0})}var Is="2.45.4";var Ms=class{constructor(t,e){this.collistionStrategy=t;this.collisionGroupRelation=e;this.tilePosToCharacters=new rh;this.charRemoved$=new nt}isCharBlockingAt(t,e,i,s=new Set,a=new Set){if(i.length===0)return!1;let h=this.tilePosToCharacters.get(t,e);return!!(h&&h.size>0&&[...h].filter(c=>!s.has(c.getId())).filter(c=>!this.doIntersect(c.getCollisionGroups(),a)).some(c=>i.some(f=>c.getCollisionGroups().some(m=>this.collidesWith(f,m)))))}doIntersect(t,e){for(let i of t)if(e.has(i))return!0;return!1}collidesWith(t,e){return this.collisionGroupRelation?(this.collisionGroupRelation.get(t)||new Set).has(e):t===e}getCharactersAt(t,e){return this.tilePosToCharacters.get(t,e)||new Set}addCharacter(t){this.addTilePositions(t.getTilePos(),t),this.addTilePositions(t.getNextTilePos(),t),this.addPositionChangeSub(t),this.addPositionChangeFinishedSub(t),this.addTilePosSetSub(t)}removeCharacter(t){let e=t.getId();this.charRemoved$.next(e),this.deleteTilePositions(t.getTilePos(),t),this.deleteTilePositions(t.getNextTilePos(),t)}add(t,e,i){let s=this.tilePosToCharacters.get(t,e);s||this.tilePosToCharacters.set(t,e,new Set([i])),s==null||s.add(i)}addTilePosSetSub(t){t.tilePositionSet().pipe(Mt(this.charRemoved(t.getId()))).subscribe(e=>{this.deleteTilePositions(t.getNextTilePos(),t),this.addTilePositions(e,t)})}charRemoved(t){var e;return(e=this.charRemoved$)==null?void 0:e.pipe(fe(1),Wt(i=>i==t))}addPositionChangeSub(t){t.positionChangeStarted().pipe(Mt(this.charRemoved(t.getId())),this.posChangeToLayerPos()).subscribe(e=>{this.collistionStrategy==="BLOCK_ONE_TILE_AHEAD"&&this.deleteTilePositions(e.exit,t),this.addTilePositions(e.enter,t)})}addPositionChangeFinishedSub(t){t.positionChangeFinished().pipe(Mt(this.charRemoved(t.getId())),this.posChangeToLayerPos()).subscribe(e=>{this.deleteTilePositions(e.exit,t),this.addTilePositions(e.enter,t)})}addTilePositions(t,e){this.forEachCharTile(t,e,(i,s)=>{this.add(new x(i,s),t.layer,e)})}deleteTilePositions(t,e){this.forEachCharTile(t,e,(i,s)=>{var a;(a=this.tilePosToCharacters.get(new x(i,s),t.layer))==null||a.delete(e)})}forEachCharTile(t,e,i){let s=t.position;for(let a=s.x;a<s.x+e.getTileWidth();a++)for(let h=s.y;h<s.y+e.getTileHeight();h++)i(a,h)}posChangeToLayerPos(){return yu(ir(t=>({enter:{position:new x(t.enterTile),layer:t.enterLayer},exit:{position:new x(t.exitTile),layer:t.exitLayer}})))}posToString(t,e){return`${t.x}#${t.y}#${e}`}},rh=class{constructor(){this.memo=new Map}set(t,e,i){let s=this.memo.get(t.x);s||(s=new Map,this.memo.set(t.x,s));let a=s.get(t.y);a||(a=new Map,s.set(t.y,a)),a.set(e,i)}get(t,e){let i=this.memo.get(t.x);if(!i)return;let s=i.get(t.y);if(s)return s.get(e)}};var $r=class{constructor(t,e,i,s){this.x=t;this.y=e;this.width=i;this.height=s}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}};var Qi="ge_charLayer";var Km=0,E1=1,ih={none:1,left:2,"up-left":3,up:4,"up-right":5,right:6,"down-right":7,down:8,"down-left":9},ks=class{constructor(t,e){this.tilemap=t;this.gridTilemap=e;this.tileCollisionCache=new Map}fixLayer(t){this.fixedLayer=this.tileCollisionCache.get(t)}unfixLayers(){this.fixedLayer=void 0}rebuild(t){t||(t=new $r(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()));let e=this.tilemap.getLayers().filter(i=>i.isCharLayer());for(let i of[...e,void 0]){let s=this.tileCollisionCache.get(i==null?void 0:i.getName());if(s===void 0){s=new Array(this.tilemap.getWidth());for(let a=0;a<this.tilemap.getWidth();a++)s[a]=new Array(this.tilemap.getHeight());this.tileCollisionCache.set(i==null?void 0:i.getName(),s)}for(let a=t.getY();a<t.getY()+t.getHeight();a++)for(let h=t.getX();h<t.getX()+t.getWidth();h++){let c=0;!this.gridTilemap.hasNoTileUncached(new x(h,a),i==null?void 0:i.getName())&&(c=nh(c,0));for(let y of Tn())this.gridTilemap.hasBlockingTileUncached(new x(h,a),i==null?void 0:i.getName(),y,!0)&&(c=nh(c,ih[y]));this.gridTilemap.hasBlockingTileUncached(new x(h,a),i==null?void 0:i.getName(),void 0,!0)&&(c=nh(c,ih[1])),s[h][a]=c}}}hasTileAt(t,e,i){var h;let s=this.fixedLayer||this.tileCollisionCache.get(i),a=(h=s==null?void 0:s[t])==null?void 0:h[e];if(a!==void 0)return Ds(a,Km)}isBlockingFrom(t,e,i,s,a){var f;let h=this.fixedLayer||this.tileCollisionCache.get(i),c=(f=h==null?void 0:h[t])==null?void 0:f[e];if(c!==void 0)return!a&&!Ds(c,Km)?!0:s===void 0?Ds(c,E1):Ds(c,ih[s])}};function nh(r,t){return r|1<<t}function Ds(r,t){return(r>>t&1)==1}var Jm="ge_cost",Rs=class Rs{constructor(t,e,i,s=void 0,a=!1){this.tilemap=t;this.collisionTilePropertyName=e;this.useTileCollisionCache=a;this.characters=new Map;this.transitions=new Map;this.reverseTransitions=new Map;this.collidesPropNames=new Map;this.tileCostPropNames=new Map;this.collisionRelevantLayersFrameCache=new Map;this.charBlockCache=new Ms(i,s);for(let h of Tn())this.collidesPropNames.set(h,Rs.ONE_WAY_COLLIDE_PROP_PREFIX+h),this.tileCostPropNames.set(h,`${Jm}_${h}`);this.useTileCollisionCache&&(this.tileCollisionCache=new ks(t,this),this.tileCollisionCache.rebuild())}fixCacheLayer(t){var e;(e=this.tileCollisionCache)==null||e.fixLayer(t)}unfixCacheLayers(){var t;(t=this.tileCollisionCache)==null||t.unfixLayers()}addCharacter(t){this.characters.set(t.getId(),t);let e=t.getNextTilePos().layer;e===void 0?t.setTilePosition(we(it({},t.getNextTilePos()),{layer:this.getLowestCharLayer()})):this.getCharLayerNames().includes(e)||console.warn(`Char layer '${e}' of character '${t.getId()}' is unknown.`),this.charBlockCache.addCharacter(t)}removeCharacter(t){let e=this.characters.get(t);e&&(this.charBlockCache.removeCharacter(e),this.characters.delete(t))}getCharacters(){return[...this.characters.values()]}getCharactersAt(t,e){return this.charBlockCache.getCharactersAt(t,e)}rebuildTileCollisionCache(t){var e;(e=this.tileCollisionCache)==null||e.rebuild(t)}hasBlockingTileUncached(t,e,i,s){if(!s&&this.hasNoTileUncached(t,e))return!0;let a=this.getCollisionRelevantLayers(e);for(let h of a)if(this.isLayerBlockingAt(h.getName(),t,i))return!0;return!1}hasBlockingTile(t,e,i,s){var h;let a=(h=this.tileCollisionCache)==null?void 0:h.isBlockingFrom(t.x,t.y,e,i,s);return a!==void 0?a:this.hasBlockingTileUncached(t,e,i,s)}getTransition(t,e){let i=this.transitions.get(t.toString());if(i)return i.get(e)}getReverseTransitions(t,e){let i=this.reverseTransitions.get(t.toString());if(i)return i.get(e)}setTransition(t,e,i){var s,a,h,c,f;this.transitions.has(t.toString())||this.transitions.set(t.toString(),new Map),this.reverseTransitions.has(t.toString())||this.reverseTransitions.set(t.toString(),new Map),(s=this.transitions.get(t.toString()))==null||s.set(e,i),(a=this.reverseTransitions.get(t.toString()))!=null&&a.has(i)||(h=this.reverseTransitions.get(t.toString()))==null||h.set(i,new Set),(f=(c=this.reverseTransitions.get(t.toString()))==null?void 0:c.get(i))==null||f.add(e)}getTransitions(){return new Map([...this.transitions].map(([t,e])=>[t,new Map(e)]))}getTileCosts(t,e){let i=this.getCollisionRelevantLayers(t.layer),s=1;for(let a of i)s=Math.max(s,this.getTileCostsForLayer(we(it({},t),{layer:a.getName()}),e));return s}getTileCostsForLayer(t,e){let i=this.tilemap.getTileAt(t.position.x,t.position.y,t.layer);return e&&(i==null?void 0:i.getProperty(this.tileCostPropNames.get(e)||""))||(i==null?void 0:i.getProperty(Jm))||1}hasNoTileUncached(t,e){return!this.getCollisionRelevantLayers(e).some(s=>this.tilemap.hasTileAt(t.x,t.y,s.getName()))}hasNoTile(t,e){var s;let i=(s=this.tileCollisionCache)==null?void 0:s.hasTileAt(t.x,t.y,e);return i!==void 0?i:this.hasNoTileUncached(t,e)}hasBlockingChar(t,e,i,s=new Set,a=new Set){return this.charBlockCache.isCharBlockingAt(t,e,i,s,a)}isInRange(t){return new $r(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()).isInRange(t)}toMapDirection(t){return this.isIsometric()?Kc(t):t}fromMapDirection(t){return this.isIsometric()?Ro(t):t}isIsometric(){return this.tilemap.getOrientation()==="isometric"}getTilePosInDirection(t,e){let i=t.position.add(Pe(this.toMapDirection(e))),s=this.getTransition(i,t.layer)||t.layer;return{position:i,layer:s}}invalidateFrameCache(){this.collisionRelevantLayersFrameCache.clear()}isLayerBlockingAt(t,e,i){let s=this.tilemap.getTileAt(e.x,e.y,t);return s?!!(s.getProperty(this.collisionTilePropertyName)||i&&s.getProperty(this.collidesPropNames.get(i)||"")):!1}getCharLayerIndexes(){return this.tilemap.getLayers().map((t,e)=>({layer:t,index:e})).filter(({layer:t})=>t.isCharLayer()).map(({index:t})=>t)}findPrevAndCharLayer(t){let e=this.getCharLayerIndexes(),i=this.tilemap.getLayers(),s=e.findIndex(a=>i[a].getProperty(Qi)==t);return s==0?{prevIndex:-1,charLayerIndex:e[s]}:{prevIndex:e[s-1],charLayerIndex:e[s]}}getCollisionRelevantLayers(t){if(!t)return this.tilemap.getLayers();let e=this.collisionRelevantLayersFrameCache.get(t);if(e)return e;let{prevIndex:i,charLayerIndex:s}=this.findPrevAndCharLayer(t),a=this.tilemap.getLayers().slice(i+1,s+1);return this.collisionRelevantLayersFrameCache.set(t,a),a}getLowestCharLayer(){for(let t of this.tilemap.getLayers())if(t.isCharLayer())return t.getProperty(Qi)}getCharLayerNames(){return this.tilemap.getLayers().filter(t=>t.isCharLayer()).map(t=>t.getProperty(Qi)).filter(O1)}};Rs.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_";var Fs=Rs;function O1(r){return r!=null}var oh=(e=>(e.REMOVED="REMOVED",e.ADDED="ADDED",e))(oh||{});var Zm=(i=>(i.WAIT="WAIT",i.SKIP="SKIP",i.STOP="STOP",i))(Zm||{}),zs=class{constructor(t,e){this.character=t;this.tilemap=e;this.queue=new Lr;this.finished$=new nt;this.pathBlockedWaitElapsed=0;this.distanceUtils=qe.create(t.getNumberOfDirections()),this.character.autoMovementSet().pipe(Wt(i=>i!==this),fe(1)).subscribe(()=>{this.queue.size()>0&&this.finishMovementTerminated(),this.finished$.complete()})}update(t){(!this.character.isMoving()||this.character.willCrossTileBorderThisUpdate(t))&&this.queue.size()>0&&this.moveCharOnPath(t)}getInfo(){return{type:"Queue"}}enqueue(t,e={}){var s,a,h;let i={pathBlockedStrategy:(s=e.pathBlockedStrategy)!=null?s:"STOP",pathBlockedWaitTimeoutMs:(e==null?void 0:e.pathBlockedWaitTimeoutMs)||-1,ignoreInvalidPositions:(a=e.ignoreInvalidPositions)!=null?a:!1,skipInvalidPositions:(h=e.skipInvalidPositions)!=null?h:!1};for(let c of t){let f={command:c,config:i};if(jr(c)){this.queue.enqueue(f);continue}let m=this.queue.peekEnd(),y=m==null?void 0:m.command;if(y||(y=this.character.getNextTilePos()),jr(y)){this.queue.enqueue(f);continue}let b=this.distanceUtils.distance(y.position,c.position)===1;(!e.ignoreInvalidPositions||b)&&this.queue.enqueue(f)}}peekAll(){return this.queue.peekAll()}size(){return this.queue.size()}finished(){return this.finished$}clear(){this.queue.clear()}moveCharOnPath(t){let e=this.queue.peek();if(!e)return;let i=e.command,s=e.config;if(jr(i)&&(i=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),i)),s.skipInvalidPositions){if(i=this.getNextValidPosition(),!i){this.finishInvalidNextPos(i);return}}else if(!this.isNeighborPos(i)){this.finishInvalidNextPos(i);return}if(this.character.isBlockingDirection(Ht(this.character.getNextTilePos().position,i.position))){if(s.pathBlockedStrategy==="STOP")this.finishPathBlocked(i);else if(s.pathBlockedStrategy==="SKIP"){this.queue.dequeue(),this.moveCharOnPath(t);return}else s.pathBlockedStrategy==="WAIT"&&s.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=t,this.pathBlockedWaitElapsed>=s.pathBlockedWaitTimeoutMs&&this.finishBlockedWaitTimeout(i,s.pathBlockedWaitTimeoutMs));return}this.pathBlockedWaitElapsed=0,this.queue.dequeue(),this.character.move(this.getDir(this.character.getNextTilePos().position,i.position)),this.isLastMovement()&&this.finish("SUCCESS","",i)}getNextValidPosition(){var t;for(;this.queue.size()>0;){let e=(t=this.queue.peek())==null?void 0:t.command;if(jr(e)&&(e=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),e)),e&&this.isNeighborPos(e))return e;this.queue.dequeue()}}isLastMovement(){return this.queue.size()===0}isNeighborPos(t){let e=this.distanceUtils.distance(this.character.getNextTilePos().position,t.position)===1,i=this.tilemap.getTransition(t.position,this.character.getNextTilePos().layer);if(this.character.getNextTilePos().layer!==t.layer)return e&&i===t.layer;let s=i!==void 0&&i!==t.layer;return e&&!s}finishMovementTerminated(){this.finish("MOVEMENT_TERMINATED","New automatic movement has been set to character.")}finishInvalidNextPos(t){t?this.finish("INVALID_NEXT_POS",`Position ${this.posToStr(t)} is not reachable from ${this.posToStr(this.character.getNextTilePos())}.`):this.finish("INVALID_NEXT_POS",`No enqueued position is reachable from ${this.posToStr(this.character.getNextTilePos())}.`)}finishPathBlocked(t){this.finish("PATH_BLOCKED",`Position ${this.posToStr(t)} is blocked.`)}finishBlockedWaitTimeout(t,e){this.finish("PATH_BLOCKED_WAIT_TIMEOUT",`Position ${this.posToStr(t)} is blocked and the wait timeout of ${e} ms has been exceeded.`)}finish(t,e="",i=this.character.getNextTilePos()){this.queue=new Lr,this.finished$.next({position:i.position,result:t,description:e,layer:i.layer})}getDir(t,e){return this.tilemap.fromMapDirection(Ht(t,e))}posToStr(t){return`(${t.position.x}, ${t.position.y}, ${t.layer})`}};var Vs=class{constructor(t=!0){this.isCreatedInternal=!1;t&&console.log(`Using GridEngine v${Is}`)}getCharLayer(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getTilePos().layer}getTransition(t,e){var i;return this.initGuard(),(i=this.gridTilemap)==null?void 0:i.getTransition(new x(t),e)}setTransition(t,e,i){var s;return this.initGuard(),(s=this.gridTilemap)==null?void 0:s.setTransition(new x(t),e,i)}create(t,e){this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(e);this.config=i,this.movementStopped$=new nt,this.movementStarted$=new nt,this.directionChanged$=new nt,this.positionChangeStarted$=new nt,this.positionChangeFinished$=new nt,this.queueMovementFinished$=new nt,this.charRemoved$=new nt,this.charAdded$=new nt,this.gridTilemap=new Fs(t,this.config.collisionTilePropertyName,this.config.characterCollisionStrategy,this.recordToMap(this.config.collisionGroupRelation),this.config.cacheTileCollisions),this.addCharacters()}recordToMap(t){return t?new Map(Object.entries(t).map(([i,s])=>[i,new Set(s)])):void 0}getPosition(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getTilePos().position}move(t,e){this.moveChar(t,e)}moveRandomly(t,e=0,i=-1){var h;this.initGuard();let s=(h=this.gridCharacters)==null?void 0:h.get(t);if(!s)throw this.createCharUnknownErr(t);let a=new As(s,e,i);s.setMovement(a)}getMovement(t){var s;this.initGuard();let e=(s=this.gridCharacters)==null?void 0:s.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getMovement();return i?i.getInfo():{type:"None"}}moveTo(t,e,i){var c;let s=this.assembleMoveToConfig(i);this.initGuard();let a=(c=this.gridCharacters)==null?void 0:c.get(t);if(!a)throw this.createCharUnknownErr(t);if(!this.gridTilemap)throw this.createUninitializedErr();let h=new Yi(a,this.gridTilemap,{position:new x(e),layer:(i==null?void 0:i.targetLayer)||a.getNextTilePos().layer},{distance:0,config:s});return a.setMovement(h),h.finishedObs().pipe(ir(f=>({charId:t,position:f.position,result:f.result,description:f.description,layer:f.layer})))}stopMovement(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.setMovement(void 0)}setSpeed(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setSpeed(e)}getSpeed(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getSpeed()}collidesWithTiles(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.collidesWithTiles()}update(t,e){var i;if(this.isCreatedInternal&&this.gridCharacters)for(let[s,a]of this.gridCharacters)a.update(e);(i=this.gridTilemap)==null||i.invalidateFrameCache()}addCharacter(t){var a,h,c,f,m;if(!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let e={speed:t.speed||4,tilemap:this.gridTilemap,collidesWithTiles:!0,collisionGroups:["geDefault"],ignoreCollisionGroups:[],charLayer:t.charLayer,facingDirection:t.facingDirection,labels:t.labels,numberOfDirections:(a=t.numberOfDirections)!=null?a:this.config.numberOfDirections,tileWidth:t.tileWidth,tileHeight:t.tileHeight};typeof t.collides=="boolean"?t.collides===!1&&(e.collidesWithTiles=!1,e.collisionGroups=[]):t.collides!==void 0&&(t.collides.collidesWithTiles===!1&&(e.collidesWithTiles=!1),t.collides.collisionGroups&&(e.collisionGroups=t.collides.collisionGroups),t.collides.ignoreCollisionGroups&&(e.ignoreCollisionGroups=t.collides.ignoreCollisionGroups),e.ignoreMissingTiles=(c=(h=t.collides)==null?void 0:h.ignoreMissingTiles)!=null?c:!1);let i=new us(t.id,e);t.startPosition&&i.setTilePosition({position:new x(t.startPosition),layer:i.getTilePos().layer}),(f=this.gridCharacters)==null||f.set(t.id,i),this.gridTilemap.addCharacter(i);let s=i.getId();i.movementStopped().pipe(Mt(this.charRemoved(s))).subscribe(y=>{var b;(b=this.movementStopped$)==null||b.next({charId:s,direction:y})}),i.movementStarted().pipe(Mt(this.charRemoved(s))).subscribe(y=>{var b;(b=this.movementStarted$)==null||b.next({charId:s,direction:y})}),i.directionChanged().pipe(Mt(this.charRemoved(s))).subscribe(y=>{var b;(b=this.directionChanged$)==null||b.next({charId:s,direction:y})}),i.positionChangeStarted().pipe(Mt(this.charRemoved(s))).subscribe(y=>{var b;(b=this.positionChangeStarted$)==null||b.next(it({charId:s},y))}),i.positionChangeFinished().pipe(Mt(this.charRemoved(s))).subscribe(y=>{var b;(b=this.positionChangeFinished$)==null||b.next(it({charId:s},y))}),(m=this.charAdded$)==null||m.next(s)}hasCharacter(t){var e;return this.initGuard(),!!((e=this.gridCharacters)!=null&&e.has(t))}removeCharacter(t){var i,s,a,h;if(this.initGuard(),!((i=this.gridCharacters)==null?void 0:i.get(t)))throw this.createCharUnknownErr(t);(s=this.gridTilemap)==null||s.removeCharacter(t),(a=this.gridCharacters)==null||a.delete(t),(h=this.charRemoved$)==null||h.next(t)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters)for(let t of this.gridCharacters.keys())this.removeCharacter(t)}getAllCharacters(t){if(this.initGuard(),!this.gridCharacters)return[];let e=[...this.gridCharacters.values()];return(t?Xm(e,t):e).map(s=>s.getId())}getLabels(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getLabels()}addLabels(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.addLabels(e)}removeLabels(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.removeLabels(e)}clearLabels(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.clearLabels()}follow(t,e,i,s){var m,y,b,_,S,I,M,F,j;let a;i===void 0?a={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(a={distance:i,closestPointIfBlocked:!1},s&&(a.closestPointIfBlocked=!0)):a=i,this.initGuard();let h=(m=this.gridCharacters)==null?void 0:m.get(t),c=(y=this.gridCharacters)==null?void 0:y.get(e);if(!h)throw this.createCharUnknownErr(t);if(!c)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let f=new Os(h,this.gridTilemap,c,{distance:(b=a.distance)!=null?b:0,noPathFoundStrategy:a.closestPointIfBlocked?"CLOSEST_REACHABLE":"STOP",maxPathLength:(_=a.maxPathLength)!=null?_:1/0,shortestPathAlgorithm:(S=a.algorithm)!=null?S:"BIDIRECTIONAL_SEARCH",ignoreLayers:!!a.ignoreLayers,facingDirection:(I=a.facingDirection)!=null?I:"none",considerCosts:(M=a.considerCosts)!=null?M:!1,isPositionAllowedFn:(F=a.isPositionAllowedFn)!=null?F:()=>!0,ignoredChars:(j=a.ignoredChars)!=null?j:[]});h.setMovement(f)}isMoving(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.isMoving()}getFacingDirection(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getFacingDirection()}getFacingPosition(t){var s;this.initGuard();let e=(s=this.gridCharacters)==null?void 0:s.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getFacingPosition();return{x:i.x,y:i.y}}turnTowards(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);return i.turnTowards(e)}getCharactersAt(t,e){if(this.initGuard(),!this.gridTilemap)return[];let i=this.gridTilemap.getCharactersAt(new x(t),e);return Array.from(i).map(s=>s.getId())}setPosition(t,e,i){var a;this.initGuard();let s=(a=this.gridCharacters)==null?void 0:a.get(t);if(!s)throw this.createCharUnknownErr(t);i||s.setTilePosition({position:new x(e),layer:s.getTilePos().layer}),s.setTilePosition({position:new x(e),layer:i})}isBlocked(t,e,i=["geDefault"]){var a,h;this.initGuard();let s=new x(t);return!!((a=this.gridTilemap)!=null&&a.hasBlockingTile(s,e)||(h=this.gridTilemap)!=null&&h.hasBlockingChar(s,e,i))}isTileBlocked(t,e){var i;return this.initGuard(),!!((i=this.gridTilemap)!=null&&i.hasBlockingTile(new x(t),e))}getCollisionGroups(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getCollisionGroups()||[]}setCollisionGroups(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setCollisionGroups(e)}getIgnoreCollisionGroups(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getIgnoreCollisionGroups()||[]}setIgnoreCollisionGroups(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setIgnoreCollisionGroups(e)}getTilePosInDirection(t,e,i){if(!this.gridTilemap)throw this.createUninitializedErr();let s=this.gridTilemap.getTilePosInDirection({position:new x(t),layer:e},i);return{position:s.position.toPosition(),charLayer:s.layer}}findShortestPath(t,e,i={}){if(!this.gridTilemap)throw this.createUninitializedErr();let s=i.shortestPathAlgorithm||"BFS";i.considerCosts&&s!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${s}'. It can only be used with A* algorithm.`);let a=i.pathWidth!==void 0&&i.pathWidth!==1,h=i.pathHeight!==void 0&&i.pathHeight!==1;(a||h)&&s==="JPS"&&console.warn("GridEngine: Pathfinding options 'pathWidth' and 'pathHeight' > 1 cannot be used with algorithm 'JPS'.");let f=new Xi(this.gridTilemap).findShortestPath(z.toInternal(t),z.toInternal(e),we(it({},i),{shortestPathAlgorithm:s}));return{path:f.path.map(z.fromInternal),closestToTarget:f.closestToTarget?z.fromInternal(f.closestToTarget):void 0,reachedMaxPathLength:!1,steps:f.steps}}steppedOn(t,e,i){return this.positionChangeFinished().pipe(Wt(s=>t.includes(s.charId)&&e.some(a=>a.x===s.enterTile.x&&a.y===s.enterTile.y)&&(i===void 0||i.includes(s.enterLayer))))}characterShifted(){if(!this.charAdded$||!this.charRemoved$)throw this.createUninitializedErr();return this.charAdded$.pipe(ir(t=>({charId:t,action:"ADDED"})),Pu(this.charRemoved$.pipe(ir(t=>({charId:t,action:"REMOVED"})))))}movementStarted(){if(!this.movementStarted$)throw this.createUninitializedErr();return this.movementStarted$}movementStopped(){if(!this.movementStopped$)throw this.createUninitializedErr();return this.movementStopped$}directionChanged(){if(!this.directionChanged$)throw this.createUninitializedErr();return this.directionChanged$}positionChangeStarted(){if(!this.positionChangeStarted$)throw this.createUninitializedErr();return this.positionChangeStarted$}positionChangeFinished(){if(!this.positionChangeFinished$)throw this.createUninitializedErr();return this.positionChangeFinished$}getMovementProgress(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getMovementProgress()}rebuildTileCollisionCache(t,e,i,s){var a;(a=this.gridTilemap)==null||a.rebuildTileCollisionCache(new $r(t,e,i,s))}addQueueMovements(t,e,i){var h,c;this.initGuard();let s=(h=this.gridCharacters)==null?void 0:h.get(t);if(!s)throw this.createCharUnknownErr(t);if(!this.gridTilemap)throw this.createUninitializedErr();let a;((c=s==null?void 0:s.getMovement())==null?void 0:c.getInfo().type)==="Queue"?a=s.getMovement():(a=new zs(s,this.gridTilemap),s.setMovement(a),a.finished().pipe(Mt(wu(this.charRemoved(t),s.autoMovementSet()))).subscribe(f=>{var m;(m=this.queueMovementFinished$)==null||m.next(it({charId:t},f))})),a.enqueue(e.map(f=>jr(f)?f:{position:new x(f.position),layer:f.charLayer}),i)}queueMovementFinished(){if(!this.queueMovementFinished$)throw this.createUninitializedErr();return this.queueMovementFinished$}getEnqueuedMovements(t){var i,s;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return((s=e.getMovement())==null?void 0:s.getInfo().type)==="Queue"?e.getMovement().peekAll().map(h=>({command:jr(h.command)?h.command:z.fromInternal(h.command),config:h.config})):[]}clearEnqueuedMovements(t){var i,s;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);((s=e.getMovement())==null?void 0:s.getInfo().type)==="Queue"&&e.getMovement().clear()}getTileCost(t,e,i){var s,a;return this.initGuard(),(a=(s=this.gridTilemap)==null?void 0:s.getTileCosts({position:new x(t),layer:e},i))!=null?a:1}getState(){let t=[];if(this.gridCharacters)for(let[e,i]of this.gridCharacters.entries())t.push({id:e,position:z.fromInternal(i.getTilePos()),facingDirection:i.getFacingDirection(),speed:i.getSpeed(),labels:i.getLabels(),movementProgress:i.getMovementProgress(),collisionConfig:{collisionGroups:i.getCollisionGroups(),ignoreCollisionGroups:i.getIgnoreCollisionGroups(),collidesWithTiles:i.collidesWithTiles(),ignoreMissingTiles:i.getIgnoreMissingTiles()}});return{characters:t}}setState(t){if(this.gridCharacters)for(let e of t.characters){let i=this.gridCharacters.get(e.id);if(i){let s=i.getTilePos();z.equal(s,z.toInternal(e.position))||i.setTilePosition(z.toInternal(e.position)),i.setSpeed(e.speed),i.turnTowards(e.facingDirection),e.collisionConfig.collisionGroups&&i.setCollisionGroups(e.collisionConfig.collisionGroups),e.collisionConfig.collidesWithTiles!==void 0&&i.setCollidesWithTiles(e.collisionConfig.collidesWithTiles),e.collisionConfig.ignoreMissingTiles!==void 0&&i.setIgnoreMissingTiles(e.collisionConfig.ignoreMissingTiles),i.setMovementProgress(e.movementProgress),i.clearLabels(),i.addLabels(e.labels)}}}charRemoved(t){var e;if(!this.charRemoved$)throw this.createUninitializedErr();return(e=this.charRemoved$)==null?void 0:e.pipe(fe(1),Wt(i=>i==t))}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var t;(t=this.config)==null||t.characters.forEach(e=>this.addCharacter(e))}moveChar(t,e){var s,a,h;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);if(i.getNumberOfDirections()===4){if(!((a=this.gridTilemap)!=null&&a.isIsometric())&&ni(e)){console.warn(`GridEngine: Character '${t}' can't be moved '${e}' in 4 direction mode.`);return}else if((h=this.gridTilemap)!=null&&h.isIsometric()&&!ni(e)){console.warn(`GridEngine: Character '${t}' can't be moved '${e}' in 4 direction isometric mode.`);return}}i.move(e)}createCharUnknownErr(t){return new Error(`Character unknown: ${t}`)}assembleMoveToConfig(t={}){let e=we(it({},t),{noPathFoundStrategy:"STOP",pathBlockedStrategy:"WAIT"});return t!=null&&t.noPathFoundStrategy&&(Object.values(Ri).includes(t.noPathFoundStrategy)?e.noPathFoundStrategy=t.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${t.noPathFoundStrategy}'. Falling back to 'STOP'`)),t!=null&&t.pathBlockedStrategy&&(Object.values(En).includes(t.pathBlockedStrategy)?e.pathBlockedStrategy=t.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${t.pathBlockedStrategy}'. Falling back to 'WAIT'`)),e}setConfigDefaults(t){return it({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",cacheTileCollisions:!1},t)}};var Ns=class extends $i{constructor(e,i={}){super(e,i);this.jumpCache=new js}findShortestPathImpl(e,i){return this.jumpCache=new js,super.findShortestPathImpl(e,i)}getNeighborsInternal(e,i,s){if(!i||e.layer!==i.layer)return this.getNeighbors(e,s).map(c=>({p:c,dist:1}));let a=this.prune(i,e).map(c=>{let f=this.getTransition(c.position,e.layer);return{position:c.position,layer:f||e.layer}}),h=[];for(let c of a){let f=this.jump(e,c,s,1,Ht(e.position,c.position));f&&(f.dist=this.distance(e.position,f.p.position),h.push(f))}return h}getForced(e,i){let s=[],{topLeft:a,downLeft:h,top:c,bottom:f,topRight:m,downRight:y}=this.normalizedPositions(e,i),b=Ht(e.position,i.position);return ni(b)?(this.blockOrTrans(e,a)&&(this.addIfNotBlocked(s,i,c),this.addIfNotBlocked(s,i,m),this.blockOrTrans(h,a)&&this.addIfNotBlocked(s,i,a)),this.blockOrTrans(e,h)&&(this.addIfNotBlocked(s,i,f),this.addIfNotBlocked(s,i,y),this.blockOrTrans(a,h)&&this.addIfNotBlocked(s,i,h)),this.blockOrTrans(a,c)&&this.addIfNotBlocked(s,i,c),this.blockOrTrans(h,f)&&this.addIfNotBlocked(s,i,f),this.blockOrTrans(a,m)&&this.addIfNotBlocked(s,i,m),this.blockOrTrans(h,y)&&this.addIfNotBlocked(s,i,y)):((this.blockOrTrans(e,c)||this.blockOrTrans(c,m))&&this.addIfNotBlocked(s,i,m),(this.blockOrTrans(e,f)||this.blockOrTrans(f,y))&&this.addIfNotBlocked(s,i,y),this.blockOrTrans(e,a)&&this.blockOrTrans(e,c)&&(this.addIfNotBlocked(s,i,c),this.addIfNotBlocked(s,i,a)),this.blockOrTrans(e,h)&&this.blockOrTrans(e,f)&&(this.addIfNotBlocked(s,i,f),this.addIfNotBlocked(s,i,h)),this.blockOrTrans(a,c)&&this.blockOrTrans(e,c)&&this.addIfNotBlocked(s,i,c),this.blockOrTrans(h,f)&&this.blockOrTrans(e,f)&&this.addIfNotBlocked(s,i,f)),s}hasForced(e,i){let{topLeft:s,downLeft:a,top:h,bottom:c,topRight:f,downRight:m}=this.normalizedPositions(e,i),y=Ht(e.position,i.position);if(ni(y)){if(this.blockOrTrans(e,s)&&(!this.blockOrTrans(i,h)||!this.blockOrTrans(i,f)||this.blockOrTrans(a,s)&&!this.blockOrTrans(i,s))||this.blockOrTrans(e,a)&&(!this.blockOrTrans(i,c)||!this.blockOrTrans(i,m)||this.blockOrTrans(s,a)&&!this.blockOrTrans(i,a))||this.blockOrTrans(s,h)&&!this.blockOrTrans(i,h)||this.blockOrTrans(a,c)&&!this.blockOrTrans(i,c)||this.blockOrTrans(s,f)&&!this.blockOrTrans(i,f)||this.blockOrTrans(a,m)&&!this.blockOrTrans(i,m))return!0}else if((this.blockOrTrans(e,h)||this.blockOrTrans(h,f))&&!this.blockOrTrans(i,f)||(this.blockOrTrans(e,c)||this.blockOrTrans(c,m))&&!this.blockOrTrans(i,m)||this.blockOrTrans(e,s)&&this.blockOrTrans(e,h)&&(!this.blockOrTrans(i,h)||!this.blockOrTrans(i,s))||this.blockOrTrans(e,a)&&this.blockOrTrans(e,c)&&(!this.blockOrTrans(i,c)||!this.blockOrTrans(i,a))||this.blockOrTrans(s,h)&&this.blockOrTrans(e,h)&&!this.blockOrTrans(i,h)||this.blockOrTrans(a,c)&&this.blockOrTrans(e,c)&&!this.blockOrTrans(i,c))return!0;return!1}prune(e,i){let{top:s,right:a,topRight:h,downRight:c,bottom:f}=this.normalizedPositions(e,i),m=this.getForced(e,i),y=Ht(e.position,i.position);return ni(y)?[s,a,h,c,f,...m]:[a,...m]}jump(e,i,s,a,h){let c=this.jumpCache.get(e,i);if(c!==null)return c;if(this.isBlocking(e,i)&&!(z.equal(i,s)&&this.options.ignoreBlockedTarget)){this.jumpCache.set(e,i,void 0);return}if(z.equal(i,s))return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(a>=this.maxJumpSize)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.getTransition(i.position,e.layer)!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.hasForced(e,i))return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.updateClosestToTarget(i,s),h==="up-left"){if(this.jump(i,this.getTilePosInDir(i,"up"),s,a+1,"up")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.jump(i,this.getTilePosInDir(i,"left"),s,a+1,"left")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0}}else if(h==="down-left"){if(this.jump(i,this.getTilePosInDir(i,"down"),s,a+1,"down")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.jump(i,this.getTilePosInDir(i,"left"),s,a+1,"left")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0}}else if(h==="up-right"){if(this.jump(i,this.getTilePosInDir(i,"up"),s,a+1,"up")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.jump(i,this.getTilePosInDir(i,"right"),s,a+1,"right")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0}}else if(h==="down-right"){if(this.jump(i,this.getTilePosInDir(i,"down"),s,a+1,"down")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0};if(this.jump(i,this.getTilePosInDir(i,"right"),s,a+1,"right")!==void 0)return this.jumpCache.set(e,i,{p:i,dist:0}),{p:i,dist:0}}let f=this.jump(i,this.getTilePosInDir(i,h),s,a+1,h);return this.jumpCache.set(e,i,f),f}normalizedPositions(e,i){return e.position.x<i.position.x&&e.position.y===i.position.y?{topLeft:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},downLeft:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},top:{position:new x(i.position.x,i.position.y-1),layer:i.layer},bottom:{position:new x(i.position.x,i.position.y+1),layer:i.layer},right:{position:new x(i.position.x+1,i.position.y),layer:i.layer},topRight:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},downRight:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer}}:e.position.x>i.position.x&&e.position.y===i.position.y?{topLeft:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},downLeft:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},top:{position:new x(i.position.x,i.position.y+1),layer:i.layer},bottom:{position:new x(i.position.x,i.position.y-1),layer:i.layer},right:{position:new x(i.position.x-1,i.position.y),layer:i.layer},topRight:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},downRight:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer}}:e.position.y<i.position.y&&e.position.x===i.position.x?{topLeft:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},downLeft:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},top:{position:new x(i.position.x+1,i.position.y),layer:i.layer},bottom:{position:new x(i.position.x-1,i.position.y),layer:i.layer},right:{position:new x(i.position.x,i.position.y+1),layer:i.layer},topRight:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},downRight:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer}}:e.position.y>i.position.y&&e.position.x===i.position.x?{topLeft:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},downLeft:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},top:{position:new x(i.position.x-1,i.position.y),layer:i.layer},bottom:{position:new x(i.position.x+1,i.position.y),layer:i.layer},right:{position:new x(i.position.x,i.position.y-1),layer:i.layer},topRight:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},downRight:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer}}:e.position.y<i.position.y&&e.position.x<i.position.x?{topLeft:{position:new x(i.position.x,i.position.y-1),layer:i.layer},downLeft:{position:new x(i.position.x-1,i.position.y),layer:i.layer},top:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},bottom:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},right:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},topRight:{position:new x(i.position.x+1,i.position.y),layer:i.layer},downRight:{position:new x(i.position.x,i.position.y+1),layer:i.layer}}:e.position.y<i.position.y&&e.position.x>i.position.x?{topLeft:{position:new x(i.position.x+1,i.position.y),layer:i.layer},downLeft:{position:new x(i.position.x,i.position.y-1),layer:i.layer},top:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},bottom:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},right:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},topRight:{position:new x(i.position.x,i.position.y+1),layer:i.layer},downRight:{position:new x(i.position.x-1,i.position.y),layer:i.layer}}:e.position.y>i.position.y&&e.position.x<i.position.x?{topLeft:{position:new x(i.position.x-1,i.position.y),layer:i.layer},downLeft:{position:new x(i.position.x,i.position.y+1),layer:i.layer},top:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},bottom:{position:new x(i.position.x+1,i.position.y+1),layer:i.layer},right:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},topRight:{position:new x(i.position.x,i.position.y-1),layer:i.layer},downRight:{position:new x(i.position.x+1,i.position.y),layer:i.layer}}:{topLeft:{position:new x(i.position.x,i.position.y+1),layer:i.layer},downLeft:{position:new x(i.position.x+1,i.position.y),layer:i.layer},top:{position:new x(i.position.x-1,i.position.y+1),layer:i.layer},bottom:{position:new x(i.position.x+1,i.position.y-1),layer:i.layer},right:{position:new x(i.position.x-1,i.position.y-1),layer:i.layer},topRight:{position:new x(i.position.x-1,i.position.y),layer:i.layer},downRight:{position:new x(i.position.x,i.position.y-1),layer:i.layer}}}},js=class{constructor(){this.memo=new Map}set(t,e,i){let s=this.memo.get(t.position.x);s||(s=new Map,this.memo.set(t.position.x,s));let a=s.get(t.position.y);a||(a=new Map,s.set(t.position.y,a));let h=a.get(t.layer);h||(h=new Map,a.set(t.layer,h));let c=h.get(e.position.x);c||(c=new Map,h.set(e.position.x,c));let f=c.get(e.position.y);f||(f=new Map,c.set(e.position.y,f)),f.get(e.layer)||(i===void 0?f.set(e.layer,null):f.set(e.layer,i))}get(t,e){let i=this.memo.get(t.position.x);if(!i)return null;let s=i.get(t.position.y);if(!s)return null;let a=s.get(t.layer);if(!a)return null;let h=a.get(e.position.x);if(!h)return null;let c=h.get(e.position.y);if(!c)return null;let f=c.get(e.layer);return f===void 0?null:f===null?void 0:f}};var Xi=class{constructor(t){this.gridTilemap=t}findShortestPath(t,e,i={}){return A1(i.shortestPathAlgorithm||"BIDIRECTIONAL_SEARCH",this.gridTilemap,i).findShortestPath(t,e)}};function A1(r,t,e){switch(r){case"BIDIRECTIONAL_SEARCH":return new vs(t,e);case"A_STAR":return new ds(t,e);case"JPS":return e.numberOfDirections===8?new Ns(t,e):new $i(t,e)}return new zi(t,e)}var sh=(f=>(f.SUCCESS="SUCCESS",f.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",f.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",f.PATH_BLOCKED="PATH_BLOCKED",f.NO_PATH_FOUND="NO_PATH_FOUND",f.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",f.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED",f.MAX_PATH_LENGTH_REACHED="MAX_PATH_LENGTH_REACHED",f))(sh||{}),Yi=class{constructor(t,e,i,{config:s,ignoreBlockedTarget:a=!1,distance:h=0}={}){this.character=t;this.tilemap=e;this.targetPos=i;this.shortestPath=[];this.distOffset=0;this.posOnPath=0;this.stopped=!1;this.pathBlockedWaitElapsed=0;this.isPositionAllowed=()=>!0;this.shortestPathAlgorithm="BIDIRECTIONAL_SEARCH";this.maxPathLength=1/0;this.considerCosts=!1;this.ignoredChars=[];this.isBlocking=(t,e)=>t?new zi(this.tilemap,this.getPathfindingOptions()).isBlocking(this.character.getTilePos(),{position:t,layer:e}):!0;var c,f;this.shortestPathAlgorithm=(c=s==null?void 0:s.algorithm)!=null?c:this.shortestPathAlgorithm,this.ignoreBlockedTarget=a,this.distance=h,this.noPathFoundStrategy=(s==null?void 0:s.noPathFoundStrategy)||"STOP",this.pathBlockedStrategy=(s==null?void 0:s.pathBlockedStrategy)||"WAIT",this.noPathFoundRetryable=new Ln((s==null?void 0:s.noPathFoundRetryBackoffMs)||200,(s==null?void 0:s.noPathFoundMaxRetries)||-1,()=>{this.stop("NO_PATH_FOUND_MAX_RETRIES_EXCEEDED")}),this.pathBlockedRetryable=new Ln((s==null?void 0:s.pathBlockedRetryBackoffMs)||200,(s==null?void 0:s.pathBlockedMaxRetries)||-1,()=>{this.stop("PATH_BLOCKED_MAX_RETRIES_EXCEEDED")}),s!=null&&s.isPositionAllowedFn&&(this.isPositionAllowed=s.isPositionAllowedFn),s!=null&&s.maxPathLength&&(this.maxPathLength=s.maxPathLength),this.alternativeTargets=s==null?void 0:s.alternativeTargets,this.noPathFoundAlternativeTargetsFallbackStrategy=s==null?void 0:s.noPathFoundAlternativeTargetsFallbackStrategy,s!=null&&s.considerCosts&&this.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1"),this.considerCosts=(s==null?void 0:s.considerCosts)||!1,this.ignoreLayers=!!(s!=null&&s.ignoreLayers),this.distanceUtils=qe.create(t.getNumberOfDirections()),this.pathBlockedWaitTimeoutMs=(s==null?void 0:s.pathBlockedWaitTimeoutMs)||-1,this.ignoredChars=(f=s==null?void 0:s.ignoredChars)!=null?f:[],this.finished$=new nt,this.setCharacter(t)}setPathBlockedStrategy(t){this.pathBlockedStrategy=t}getPathBlockedStrategy(){return this.pathBlockedStrategy}setCharacter(t){this.character=t,this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(Wt(e=>e!==this),fe(1)).subscribe(()=>{this.stop("MOVEMENT_TERMINATED")})}getPathfindingOptions(){return{shortestPathAlgorithm:this.shortestPathAlgorithm,pathWidth:this.character.getTileWidth(),pathHeight:this.character.getTileHeight(),numberOfDirections:this.character.getNumberOfDirections(),isPositionAllowed:this.isPositionAllowed,collisionGroups:this.character.getCollisionGroups(),ignoredChars:[this.character.getId(),...this.ignoredChars],ignoreTiles:!this.character.collidesWithTiles(),ignoreMapBounds:this.character.getIgnoreMissingTiles(),ignoreBlockedTarget:this.ignoreBlockedTarget,maxPathLength:this.maxPathLength,ignoreLayers:this.ignoreLayers,considerCosts:this.considerCosts,calculateClosestToTarget:!0}}update(t){var e,i,s,a;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy==="RETRY"?this.noPathFoundRetryable.retry(t,()=>this.calcShortestPath()):this.noPathFoundStrategy==="STOP"&&this.stop("NO_PATH_FOUND")),this.updatePosOnPath(),this.isBlocking((e=this.nextTileOnPath())==null?void 0:e.position,(i=this.character)==null?void 0:i.getNextTilePos().layer)?this.applyPathBlockedStrategy(t):this.pathBlockedWaitElapsed=0,this.hasArrived()?(this.stop("SUCCESS"),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking((s=this.nextTileOnPath())==null?void 0:s.position,(a=this.character)==null?void 0:a.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}getInfo(){return{type:"Target",state:{pathAhead:this.shortestPath.slice(this.posOnPath).map(t=>z.fromInternal(t))},config:{algorithm:this.shortestPathAlgorithm,ignoreBlockedTarget:this.ignoreBlockedTarget,distance:this.distance,targetPos:z.fromInternal(this.targetPos),noPathFoundStrategy:this.noPathFoundStrategy,pathBlockedStrategy:this.pathBlockedStrategy,noPathFoundRetryBackoffMs:this.noPathFoundRetryable.getBackoffMs(),noPathFoundMaxRetries:this.noPathFoundRetryable.getMaxRetries()}}}resultToReason(t){switch(t){case"SUCCESS":return"Successfully arrived.";case"MOVEMENT_TERMINATED":return"Movement of character has been replaced before destination was reached.";case"PATH_BLOCKED":return"PathBlockedStrategy STOP: Path blocked.";case"NO_PATH_FOUND_MAX_RETRIES_EXCEEDED":return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case"NO_PATH_FOUND":return"NoPathFoundStrategy STOP: No path found.";case"PATH_BLOCKED_MAX_RETRIES_EXCEEDED":return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case"PATH_BLOCKED_WAIT_TIMEOUT":return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(t){this.pathBlockedStrategy==="RETRY"?this.pathBlockedRetryable.retry(t,()=>{let e=this.getShortestPath();e.path.length>0&&this.calcShortestPath(e)}):this.pathBlockedStrategy==="STOP"?this.stop("PATH_BLOCKED"):this.pathBlockedStrategy==="WAIT"&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=t,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop("PATH_BLOCKED_WAIT_TIMEOUT"))}moveCharOnPath(){let t=this.nextTileOnPath();if(!t)return;let e=this.getDir(this.character.getNextTilePos().position,t.position);this.character.move(e)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(t){this.finished$.next({position:this.character.getTilePos().position,result:t,description:this.resultToReason(t),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let t=this.shortestPath[this.posOnPath+1],e=this.getDir(this.character.getNextTilePos().position,t.position);this.character.turnTowards(e)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let t=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=t.position.x||this.character.getNextTilePos().position.y!=t.position.y);)this.posOnPath++,t=this.shortestPath[this.posOnPath]}noPathFound(){return this.shortestPath.length===0}calcShortestPath(t){t=t!=null?t:this.getShortestPath(),this.posOnPath=0,this.shortestPath=t.path,this.distOffset=t.distOffset}getShortestPath(){var a;let t=new Xi(this.tilemap),{path:e,closestToTarget:i}=t.findShortestPath(this.character.getNextTilePos(),this.targetPos,this.getPathfindingOptions());if(e.length==0){if(this.noPathFoundStrategy==="CLOSEST_REACHABLE"){if(!i)throw Error("ClosestToTarget should never be undefined in TargetMovement.");return this.pathToAlternativeTarget(i,t)}else if(this.noPathFoundStrategy==="ALTERNATIVE_TARGETS"){for(let h of(a=this.alternativeTargets)!=null?a:[]){let{path:c,distOffset:f}=this.pathToAlternativeTarget(z.toInternal(h),t);if(c.length>0)return{path:c,distOffset:f}}return this.noPathFoundStrategy=this.noPathFoundAlternativeTargetsFallbackStrategy||"STOP",this.getShortestPath()}}return{path:e,distOffset:0}}pathToAlternativeTarget(t,e){let i=e.findShortestPath(this.character.getNextTilePos(),t,this.getPathfindingOptions()).path,s=this.distanceUtils.distance(t.position,this.targetPos.position);return{path:i,distOffset:s}}getDir(t,e){return this.tilemap.fromMapDirection(this.distanceUtils.direction(t,e))}};var I1=Object.create,ed=Object.defineProperty,M1=Object.getOwnPropertyDescriptor,D1=Object.getOwnPropertyNames,k1=Object.getPrototypeOf,F1=Object.prototype.hasOwnProperty,R1=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),z1=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of D1(t))!F1.call(r,s)&&s!==e&&ed(r,s,{get:()=>t[s],enumerable:!(i=M1(t,s))||i.enumerable});return r},uh=(r,t,e)=>(e=r!=null?I1(k1(r)):{},z1(t||!r||!r.__esModule?ed(e,"default",{value:r,enumerable:!0}):e,r)),hh=R1((r,t)=>{(function(){var e,i="4.17.21",s=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",c="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",m=500,y="__lodash_placeholder__",b=1,_=2,S=4,I=1,M=2,F=1,j=2,B=4,Z=8,ht=16,Ot=32,Ve=64,_e=128,Ki=256,Bs=512,od=30,sd="...",ad=800,ud=16,mh=1,hd=2,ld=3,Yr=1/0,Or=9007199254740991,cd=17976931348623157e292,Un=NaN,Ke=4294967295,fd=Ke-1,pd=Ke>>>1,md=[["ary",_e],["bind",F],["bindKey",j],["curry",Z],["curryRight",ht],["flip",Bs],["partial",Ot],["partialRight",Ve],["rearg",Ki]],gi="[object Arguments]",Bn="[object Array]",dd="[object AsyncFunction]",Ji="[object Boolean]",Zi="[object Date]",gd="[object DOMException]",Hn="[object Error]",Wn="[object Function]",dh="[object GeneratorFunction]",Ne="[object Map]",tn="[object Number]",yd="[object Null]",gr="[object Object]",gh="[object Promise]",vd="[object Proxy]",en="[object RegExp]",je="[object Set]",rn="[object String]",qn="[object Symbol]",bd="[object Undefined]",nn="[object WeakMap]",wd="[object WeakSet]",on="[object ArrayBuffer]",yi="[object DataView]",Hs="[object Float32Array]",Ws="[object Float64Array]",qs="[object Int8Array]",$s="[object Int16Array]",Ys="[object Int32Array]",Qs="[object Uint8Array]",Xs="[object Uint8ClampedArray]",Ks="[object Uint16Array]",Js="[object Uint32Array]",Pd=/\b__p \+= '';/g,Td=/\b(__p \+=) '' \+/g,xd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,yh=/&(?:amp|lt|gt|quot|#39);/g,vh=/[&<>"']/g,Sd=RegExp(yh.source),Cd=RegExp(vh.source),_d=/<%-([\s\S]+?)%>/g,Ld=/<%([\s\S]+?)%>/g,bh=/<%=([\s\S]+?)%>/g,Ed=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Od=/^\w*$/,Ad=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Zs=/[\\^$.*+?()[\]{}|]/g,Id=RegExp(Zs.source),ta=/^\s+/,Md=/\s/,Dd=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,kd=/\{\n\/\* \[wrapped with (.+)\] \*/,Fd=/,? & /,Rd=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,zd=/[()=,{}\[\]\/\s]/,Vd=/\\(\\)?/g,Nd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wh=/\w*$/,jd=/^[-+]0x[0-9a-f]+$/i,Gd=/^0b[01]+$/i,Ud=/^\[object .+?Constructor\]$/,Bd=/^0o[0-7]+$/i,Hd=/^(?:0|[1-9]\d*)$/,Wd=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$n=/($^)/,qd=/['\n\r\u2028\u2029\\]/g,Yn="\\ud800-\\udfff",$d="\\u0300-\\u036f",Yd="\\ufe20-\\ufe2f",Qd="\\u20d0-\\u20ff",Ph=$d+Yd+Qd,Th="\\u2700-\\u27bf",xh="a-z\\xdf-\\xf6\\xf8-\\xff",Xd="\\xac\\xb1\\xd7\\xf7",Kd="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jd="\\u2000-\\u206f",Zd=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Sh="A-Z\\xc0-\\xd6\\xd8-\\xde",Ch="\\ufe0e\\ufe0f",_h=Xd+Kd+Jd+Zd,ea="['\u2019]",tg="["+Yn+"]",Lh="["+_h+"]",Qn="["+Ph+"]",Eh="\\d+",eg="["+Th+"]",Oh="["+xh+"]",Ah="[^"+Yn+_h+Eh+Th+xh+Sh+"]",ra="\\ud83c[\\udffb-\\udfff]",rg="(?:"+Qn+"|"+ra+")",Ih="[^"+Yn+"]",ia="(?:\\ud83c[\\udde6-\\uddff]){2}",na="[\\ud800-\\udbff][\\udc00-\\udfff]",vi="["+Sh+"]",Mh="\\u200d",Dh="(?:"+Oh+"|"+Ah+")",ig="(?:"+vi+"|"+Ah+")",kh="(?:"+ea+"(?:d|ll|m|re|s|t|ve))?",Fh="(?:"+ea+"(?:D|LL|M|RE|S|T|VE))?",Rh=rg+"?",zh="["+Ch+"]?",ng="(?:"+Mh+"(?:"+[Ih,ia,na].join("|")+")"+zh+Rh+")*",og="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sg="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Vh=zh+Rh+ng,ag="(?:"+[eg,ia,na].join("|")+")"+Vh,ug="(?:"+[Ih+Qn+"?",Qn,ia,na,tg].join("|")+")",hg=RegExp(ea,"g"),lg=RegExp(Qn,"g"),oa=RegExp(ra+"(?="+ra+")|"+ug+Vh,"g"),cg=RegExp([vi+"?"+Oh+"+"+kh+"(?="+[Lh,vi,"$"].join("|")+")",ig+"+"+Fh+"(?="+[Lh,vi+Dh,"$"].join("|")+")",vi+"?"+Dh+"+"+kh,vi+"+"+Fh,sg,og,Eh,ag].join("|"),"g"),fg=RegExp("["+Mh+Yn+Ph+Ch+"]"),pg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,mg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],dg=-1,ft={};ft[Hs]=ft[Ws]=ft[qs]=ft[$s]=ft[Ys]=ft[Qs]=ft[Xs]=ft[Ks]=ft[Js]=!0,ft[gi]=ft[Bn]=ft[on]=ft[Ji]=ft[yi]=ft[Zi]=ft[Hn]=ft[Wn]=ft[Ne]=ft[tn]=ft[gr]=ft[en]=ft[je]=ft[rn]=ft[nn]=!1;var lt={};lt[gi]=lt[Bn]=lt[on]=lt[yi]=lt[Ji]=lt[Zi]=lt[Hs]=lt[Ws]=lt[qs]=lt[$s]=lt[Ys]=lt[Ne]=lt[tn]=lt[gr]=lt[en]=lt[je]=lt[rn]=lt[qn]=lt[Qs]=lt[Xs]=lt[Ks]=lt[Js]=!0,lt[Hn]=lt[Wn]=lt[nn]=!1;var gg={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},yg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},vg={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},bg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},wg=parseFloat,Pg=parseInt,Nh=typeof global=="object"&&global&&global.Object===Object&&global,Tg=typeof self=="object"&&self&&self.Object===Object&&self,Rt=Nh||Tg||Function("return this")(),sa=typeof r=="object"&&r&&!r.nodeType&&r,Qr=sa&&typeof t=="object"&&t&&!t.nodeType&&t,jh=Qr&&Qr.exports===sa,aa=jh&&Nh.process,Le=function(){try{var P=Qr&&Qr.require&&Qr.require("util").types;return P||aa&&aa.binding&&aa.binding("util")}catch(L){}}(),Gh=Le&&Le.isArrayBuffer,Uh=Le&&Le.isDate,Bh=Le&&Le.isMap,Hh=Le&&Le.isRegExp,Wh=Le&&Le.isSet,qh=Le&&Le.isTypedArray;function me(P,L,C){switch(C.length){case 0:return P.call(L);case 1:return P.call(L,C[0]);case 2:return P.call(L,C[0],C[1]);case 3:return P.call(L,C[0],C[1],C[2])}return P.apply(L,C)}function xg(P,L,C,k){for(var H=-1,rt=P==null?0:P.length;++H<rt;){var At=P[H];L(k,At,C(At),P)}return k}function Ee(P,L){for(var C=-1,k=P==null?0:P.length;++C<k&&L(P[C],C,P)!==!1;);return P}function Sg(P,L){for(var C=P==null?0:P.length;C--&&L(P[C],C,P)!==!1;);return P}function $h(P,L){for(var C=-1,k=P==null?0:P.length;++C<k;)if(!L(P[C],C,P))return!1;return!0}function Ar(P,L){for(var C=-1,k=P==null?0:P.length,H=0,rt=[];++C<k;){var At=P[C];L(At,C,P)&&(rt[H++]=At)}return rt}function Xn(P,L){var C=P==null?0:P.length;return!!C&&bi(P,L,0)>-1}function ua(P,L,C){for(var k=-1,H=P==null?0:P.length;++k<H;)if(C(L,P[k]))return!0;return!1}function pt(P,L){for(var C=-1,k=P==null?0:P.length,H=Array(k);++C<k;)H[C]=L(P[C],C,P);return H}function Ir(P,L){for(var C=-1,k=L.length,H=P.length;++C<k;)P[H+C]=L[C];return P}function ha(P,L,C,k){var H=-1,rt=P==null?0:P.length;for(k&&rt&&(C=P[++H]);++H<rt;)C=L(C,P[H],H,P);return C}function Cg(P,L,C,k){var H=P==null?0:P.length;for(k&&H&&(C=P[--H]);H--;)C=L(C,P[H],H,P);return C}function la(P,L){for(var C=-1,k=P==null?0:P.length;++C<k;)if(L(P[C],C,P))return!0;return!1}var _g=ca("length");function Lg(P){return P.split("")}function Eg(P){return P.match(Rd)||[]}function Yh(P,L,C){var k;return C(P,function(H,rt,At){if(L(H,rt,At))return k=rt,!1}),k}function Kn(P,L,C,k){for(var H=P.length,rt=C+(k?1:-1);k?rt--:++rt<H;)if(L(P[rt],rt,P))return rt;return-1}function bi(P,L,C){return L===L?jg(P,L,C):Kn(P,Qh,C)}function Og(P,L,C,k){for(var H=C-1,rt=P.length;++H<rt;)if(k(P[H],L))return H;return-1}function Qh(P){return P!==P}function Xh(P,L){var C=P==null?0:P.length;return C?pa(P,L)/C:Un}function ca(P){return function(L){return L==null?e:L[P]}}function fa(P){return function(L){return P==null?e:P[L]}}function Kh(P,L,C,k,H){return H(P,function(rt,At,ut){C=k?(k=!1,rt):L(C,rt,At,ut)}),C}function Ag(P,L){var C=P.length;for(P.sort(L);C--;)P[C]=P[C].value;return P}function pa(P,L){for(var C,k=-1,H=P.length;++k<H;){var rt=L(P[k]);rt!==e&&(C=C===e?rt:C+rt)}return C}function ma(P,L){for(var C=-1,k=Array(P);++C<P;)k[C]=L(C);return k}function Ig(P,L){return pt(L,function(C){return[C,P[C]]})}function Jh(P){return P&&P.slice(0,rl(P)+1).replace(ta,"")}function de(P){return function(L){return P(L)}}function da(P,L){return pt(L,function(C){return P[C]})}function sn(P,L){return P.has(L)}function Zh(P,L){for(var C=-1,k=P.length;++C<k&&bi(L,P[C],0)>-1;);return C}function tl(P,L){for(var C=P.length;C--&&bi(L,P[C],0)>-1;);return C}function Mg(P,L){for(var C=P.length,k=0;C--;)P[C]===L&&++k;return k}var Dg=fa(gg),kg=fa(yg);function Fg(P){return"\\"+bg[P]}function Rg(P,L){return P==null?e:P[L]}function wi(P){return fg.test(P)}function zg(P){return pg.test(P)}function Vg(P){for(var L,C=[];!(L=P.next()).done;)C.push(L.value);return C}function ga(P){var L=-1,C=Array(P.size);return P.forEach(function(k,H){C[++L]=[H,k]}),C}function el(P,L){return function(C){return P(L(C))}}function Mr(P,L){for(var C=-1,k=P.length,H=0,rt=[];++C<k;){var At=P[C];(At===L||At===y)&&(P[C]=y,rt[H++]=C)}return rt}function Jn(P){var L=-1,C=Array(P.size);return P.forEach(function(k){C[++L]=k}),C}function Ng(P){var L=-1,C=Array(P.size);return P.forEach(function(k){C[++L]=[k,k]}),C}function jg(P,L,C){for(var k=C-1,H=P.length;++k<H;)if(P[k]===L)return k;return-1}function Gg(P,L,C){for(var k=C+1;k--;)if(P[k]===L)return k;return k}function Pi(P){return wi(P)?Bg(P):_g(P)}function Ge(P){return wi(P)?Hg(P):Lg(P)}function rl(P){for(var L=P.length;L--&&Md.test(P.charAt(L)););return L}var Ug=fa(vg);function Bg(P){for(var L=oa.lastIndex=0;oa.test(P);)++L;return L}function Hg(P){return P.match(oa)||[]}function Wg(P){return P.match(cg)||[]}var qg=function P(L){L=L==null?Rt:Dr.defaults(Rt.Object(),L,Dr.pick(Rt,mg));var C=L.Array,k=L.Date,H=L.Error,rt=L.Function,At=L.Math,ut=L.Object,ya=L.RegExp,$g=L.String,Oe=L.TypeError,Zn=C.prototype,Yg=rt.prototype,Ti=ut.prototype,to=L["__core-js_shared__"],eo=Yg.toString,st=Ti.hasOwnProperty,Qg=0,il=function(){var n=/[^.]+$/.exec(to&&to.keys&&to.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),ro=Ti.toString,Xg=eo.call(ut),Kg=Rt._,Jg=ya("^"+eo.call(st).replace(Zs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),io=jh?L.Buffer:e,kr=L.Symbol,no=L.Uint8Array,nl=io?io.allocUnsafe:e,oo=el(ut.getPrototypeOf,ut),ol=ut.create,sl=Ti.propertyIsEnumerable,so=Zn.splice,al=kr?kr.isConcatSpreadable:e,an=kr?kr.iterator:e,Xr=kr?kr.toStringTag:e,ao=function(){try{var n=ei(ut,"defineProperty");return n({},"",{}),n}catch(o){}}(),Zg=L.clearTimeout!==Rt.clearTimeout&&L.clearTimeout,ty=k&&k.now!==Rt.Date.now&&k.now,ey=L.setTimeout!==Rt.setTimeout&&L.setTimeout,uo=At.ceil,ho=At.floor,va=ut.getOwnPropertySymbols,ry=io?io.isBuffer:e,ul=L.isFinite,iy=Zn.join,ny=el(ut.keys,ut),It=At.max,Yt=At.min,oy=k.now,sy=L.parseInt,hl=At.random,ay=Zn.reverse,ba=ei(L,"DataView"),un=ei(L,"Map"),wa=ei(L,"Promise"),xi=ei(L,"Set"),hn=ei(L,"WeakMap"),ln=ei(ut,"create"),lo=hn&&new hn,Si={},uy=ri(ba),hy=ri(un),ly=ri(wa),cy=ri(xi),fy=ri(hn),co=kr?kr.prototype:e,cn=co?co.valueOf:e,ll=co?co.toString:e;function d(n){if(bt(n)&&!W(n)&&!(n instanceof X)){if(n instanceof Ae)return n;if(st.call(n,"__wrapped__"))return cc(n)}return new Ae(n)}var Ci=function(){function n(){}return function(o){if(!gt(o))return{};if(ol)return ol(o);n.prototype=o;var u=new n;return n.prototype=e,u}}();function fo(){}function Ae(n,o){this.__wrapped__=n,this.__actions__=[],this.__chain__=!!o,this.__index__=0,this.__values__=e}d.templateSettings={escape:_d,evaluate:Ld,interpolate:bh,variable:"",imports:{_:d}},d.prototype=fo.prototype,d.prototype.constructor=d,Ae.prototype=Ci(fo.prototype),Ae.prototype.constructor=Ae;function X(n){this.__wrapped__=n,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ke,this.__views__=[]}function py(){var n=new X(this.__wrapped__);return n.__actions__=se(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=se(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=se(this.__views__),n}function my(){if(this.__filtered__){var n=new X(this);n.__dir__=-1,n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function dy(){var n=this.__wrapped__.value(),o=this.__dir__,u=W(n),l=o<0,p=u?n.length:0,g=Lv(0,p,this.__views__),v=g.start,w=g.end,T=w-v,E=l?w:v-1,O=this.__iteratees__,A=O.length,D=0,R=Yt(T,this.__takeCount__);if(!u||!l&&p==T&&R==T)return kl(n,this.__actions__);var G=[];t:for(;T--&&D<R;){E+=o;for(var $=-1,U=n[E];++$<A;){var Q=O[$],K=Q.iteratee,ve=Q.type,re=K(U);if(ve==hd)U=re;else if(!re){if(ve==mh)continue t;break t}}G[D++]=U}return G}X.prototype=Ci(fo.prototype),X.prototype.constructor=X;function Kr(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var l=n[o];this.set(l[0],l[1])}}function gy(){this.__data__=ln?ln(null):{},this.size=0}function yy(n){var o=this.has(n)&&delete this.__data__[n];return this.size-=o?1:0,o}function vy(n){var o=this.__data__;if(ln){var u=o[n];return u===f?e:u}return st.call(o,n)?o[n]:e}function by(n){var o=this.__data__;return ln?o[n]!==e:st.call(o,n)}function wy(n,o){var u=this.__data__;return this.size+=this.has(n)?0:1,u[n]=ln&&o===e?f:o,this}Kr.prototype.clear=gy,Kr.prototype.delete=yy,Kr.prototype.get=vy,Kr.prototype.has=by,Kr.prototype.set=wy;function yr(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var l=n[o];this.set(l[0],l[1])}}function Py(){this.__data__=[],this.size=0}function Ty(n){var o=this.__data__,u=po(o,n);if(u<0)return!1;var l=o.length-1;return u==l?o.pop():so.call(o,u,1),--this.size,!0}function xy(n){var o=this.__data__,u=po(o,n);return u<0?e:o[u][1]}function Sy(n){return po(this.__data__,n)>-1}function Cy(n,o){var u=this.__data__,l=po(u,n);return l<0?(++this.size,u.push([n,o])):u[l][1]=o,this}yr.prototype.clear=Py,yr.prototype.delete=Ty,yr.prototype.get=xy,yr.prototype.has=Sy,yr.prototype.set=Cy;function vr(n){var o=-1,u=n==null?0:n.length;for(this.clear();++o<u;){var l=n[o];this.set(l[0],l[1])}}function _y(){this.size=0,this.__data__={hash:new Kr,map:new(un||yr),string:new Kr}}function Ly(n){var o=_o(this,n).delete(n);return this.size-=o?1:0,o}function Ey(n){return _o(this,n).get(n)}function Oy(n){return _o(this,n).has(n)}function Ay(n,o){var u=_o(this,n),l=u.size;return u.set(n,o),this.size+=u.size==l?0:1,this}vr.prototype.clear=_y,vr.prototype.delete=Ly,vr.prototype.get=Ey,vr.prototype.has=Oy,vr.prototype.set=Ay;function Jr(n){var o=-1,u=n==null?0:n.length;for(this.__data__=new vr;++o<u;)this.add(n[o])}function Iy(n){return this.__data__.set(n,f),this}function My(n){return this.__data__.has(n)}Jr.prototype.add=Jr.prototype.push=Iy,Jr.prototype.has=My;function Ue(n){var o=this.__data__=new yr(n);this.size=o.size}function Dy(){this.__data__=new yr,this.size=0}function ky(n){var o=this.__data__,u=o.delete(n);return this.size=o.size,u}function Fy(n){return this.__data__.get(n)}function Ry(n){return this.__data__.has(n)}function zy(n,o){var u=this.__data__;if(u instanceof yr){var l=u.__data__;if(!un||l.length<s-1)return l.push([n,o]),this.size=++u.size,this;u=this.__data__=new vr(l)}return u.set(n,o),this.size=u.size,this}Ue.prototype.clear=Dy,Ue.prototype.delete=ky,Ue.prototype.get=Fy,Ue.prototype.has=Ry,Ue.prototype.set=zy;function cl(n,o){var u=W(n),l=!u&&ii(n),p=!u&&!l&&Nr(n),g=!u&&!l&&!p&&Oi(n),v=u||l||p||g,w=v?ma(n.length,$g):[],T=w.length;for(var E in n)(o||st.call(n,E))&&!(v&&(E=="length"||p&&(E=="offset"||E=="parent")||g&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||Tr(E,T)))&&w.push(E);return w}function fl(n){var o=n.length;return o?n[Ia(0,o-1)]:e}function Vy(n,o){return Lo(se(n),Zr(o,0,n.length))}function Ny(n){return Lo(se(n))}function Pa(n,o,u){(u!==e&&!Be(n[o],u)||u===e&&!(o in n))&&br(n,o,u)}function fn(n,o,u){var l=n[o];(!(st.call(n,o)&&Be(l,u))||u===e&&!(o in n))&&br(n,o,u)}function po(n,o){for(var u=n.length;u--;)if(Be(n[u][0],o))return u;return-1}function jy(n,o,u,l){return Fr(n,function(p,g,v){o(l,p,u(p),v)}),l}function pl(n,o){return n&&Ze(o,zt(o),n)}function Gy(n,o){return n&&Ze(o,ue(o),n)}function br(n,o,u){o=="__proto__"&&ao?ao(n,o,{configurable:!0,enumerable:!0,value:u,writable:!0}):n[o]=u}function Ta(n,o){for(var u=-1,l=o.length,p=C(l),g=n==null;++u<l;)p[u]=g?e:ru(n,o[u]);return p}function Zr(n,o,u){return n===n&&(u!==e&&(n=n<=u?n:u),o!==e&&(n=n>=o?n:o)),n}function Ie(n,o,u,l,p,g){var v,w=o&b,T=o&_,E=o&S;if(u&&(v=p?u(n,l,p,g):u(n)),v!==e)return v;if(!gt(n))return n;var O=W(n);if(O){if(v=Ov(n),!w)return se(n,v)}else{var A=Qt(n),D=A==Wn||A==dh;if(Nr(n))return zl(n,w);if(A==gr||A==gi||D&&!p){if(v=T||D?{}:rc(n),!w)return T?vv(n,Gy(v,n)):yv(n,pl(v,n))}else{if(!lt[A])return p?n:{};v=Av(n,A,w)}}g||(g=new Ue);var R=g.get(n);if(R)return R;g.set(n,v),Ic(n)?n.forEach(function(U){v.add(Ie(U,o,u,U,n,g))}):Oc(n)&&n.forEach(function(U,Q){v.set(Q,Ie(U,o,u,Q,n,g))});var G=E?T?Ua:Ga:T?ue:zt,$=O?e:G(n);return Ee($||n,function(U,Q){$&&(Q=U,U=n[Q]),fn(v,Q,Ie(U,o,u,Q,n,g))}),v}function Uy(n){var o=zt(n);return function(u){return ml(u,n,o)}}function ml(n,o,u){var l=u.length;if(n==null)return!l;for(n=ut(n);l--;){var p=u[l],g=o[p],v=n[p];if(v===e&&!(p in n)||!g(v))return!1}return!0}function dl(n,o,u){if(typeof n!="function")throw new Oe(h);return bn(function(){n.apply(e,u)},o)}function pn(n,o,u,l){var p=-1,g=Xn,v=!0,w=n.length,T=[],E=o.length;if(!w)return T;u&&(o=pt(o,de(u))),l?(g=ua,v=!1):o.length>=s&&(g=sn,v=!1,o=new Jr(o));t:for(;++p<w;){var O=n[p],A=u==null?O:u(O);if(O=l||O!==0?O:0,v&&A===A){for(var D=E;D--;)if(o[D]===A)continue t;T.push(O)}else g(o,A,l)||T.push(O)}return T}var Fr=Ul(Je),gl=Ul(Sa,!0);function By(n,o){var u=!0;return Fr(n,function(l,p,g){return u=!!o(l,p,g),u}),u}function mo(n,o,u){for(var l=-1,p=n.length;++l<p;){var g=n[l],v=o(g);if(v!=null&&(w===e?v===v&&!ye(v):u(v,w)))var w=v,T=g}return T}function Hy(n,o,u,l){var p=n.length;for(u=q(u),u<0&&(u=-u>p?0:p+u),l=l===e||l>p?p:q(l),l<0&&(l+=p),l=u>l?0:Dc(l);u<l;)n[u++]=o;return n}function yl(n,o){var u=[];return Fr(n,function(l,p,g){o(l,p,g)&&u.push(l)}),u}function Bt(n,o,u,l,p){var g=-1,v=n.length;for(u||(u=Mv),p||(p=[]);++g<v;){var w=n[g];o>0&&u(w)?o>1?Bt(w,o-1,u,l,p):Ir(p,w):l||(p[p.length]=w)}return p}var xa=Bl(),vl=Bl(!0);function Je(n,o){return n&&xa(n,o,zt)}function Sa(n,o){return n&&vl(n,o,zt)}function go(n,o){return Ar(o,function(u){return xr(n[u])})}function ti(n,o){o=zr(o,n);for(var u=0,l=o.length;n!=null&&u<l;)n=n[tr(o[u++])];return u&&u==l?n:e}function bl(n,o,u){var l=o(n);return W(n)?l:Ir(l,u(n))}function te(n){return n==null?n===e?bd:yd:Xr&&Xr in ut(n)?_v(n):Nv(n)}function Ca(n,o){return n>o}function Wy(n,o){return n!=null&&st.call(n,o)}function qy(n,o){return n!=null&&o in ut(n)}function $y(n,o,u){return n>=Yt(o,u)&&n<It(o,u)}function _a(n,o,u){for(var l=u?ua:Xn,p=n[0].length,g=n.length,v=g,w=C(g),T=1/0,E=[];v--;){var O=n[v];v&&o&&(O=pt(O,de(o))),T=Yt(O.length,T),w[v]=!u&&(o||p>=120&&O.length>=120)?new Jr(v&&O):e}O=n[0];var A=-1,D=w[0];t:for(;++A<p&&E.length<T;){var R=O[A],G=o?o(R):R;if(R=u||R!==0?R:0,!(D?sn(D,G):l(E,G,u))){for(v=g;--v;){var $=w[v];if(!($?sn($,G):l(n[v],G,u)))continue t}D&&D.push(G),E.push(R)}}return E}function Yy(n,o,u,l){return Je(n,function(p,g,v){o(l,u(p),g,v)}),l}function mn(n,o,u){o=zr(o,n),n=sc(n,o);var l=n==null?n:n[tr(De(o))];return l==null?e:me(l,n,u)}function wl(n){return bt(n)&&te(n)==gi}function Qy(n){return bt(n)&&te(n)==on}function Xy(n){return bt(n)&&te(n)==Zi}function dn(n,o,u,l,p){return n===o?!0:n==null||o==null||!bt(n)&&!bt(o)?n!==n&&o!==o:Ky(n,o,u,l,dn,p)}function Ky(n,o,u,l,p,g){var v=W(n),w=W(o),T=v?Bn:Qt(n),E=w?Bn:Qt(o);T=T==gi?gr:T,E=E==gi?gr:E;var O=T==gr,A=E==gr,D=T==E;if(D&&Nr(n)){if(!Nr(o))return!1;v=!0,O=!1}if(D&&!O)return g||(g=new Ue),v||Oi(n)?Zl(n,o,u,l,p,g):Sv(n,o,T,u,l,p,g);if(!(u&I)){var R=O&&st.call(n,"__wrapped__"),G=A&&st.call(o,"__wrapped__");if(R||G){var $=R?n.value():n,U=G?o.value():o;return g||(g=new Ue),p($,U,u,l,g)}}return D?(g||(g=new Ue),Cv(n,o,u,l,p,g)):!1}function Jy(n){return bt(n)&&Qt(n)==Ne}function La(n,o,u,l){var p=u.length,g=p,v=!l;if(n==null)return!g;for(n=ut(n);p--;){var w=u[p];if(v&&w[2]?w[1]!==n[w[0]]:!(w[0]in n))return!1}for(;++p<g;){w=u[p];var T=w[0],E=n[T],O=w[1];if(v&&w[2]){if(E===e&&!(T in n))return!1}else{var A=new Ue;if(l)var D=l(E,O,T,n,o,A);if(!(D===e?dn(O,E,I|M,l,A):D))return!1}}return!0}function Pl(n){if(!gt(n)||kv(n))return!1;var o=xr(n)?Jg:Ud;return o.test(ri(n))}function Zy(n){return bt(n)&&te(n)==en}function tv(n){return bt(n)&&Qt(n)==je}function ev(n){return bt(n)&&Do(n.length)&&!!ft[te(n)]}function Tl(n){return typeof n=="function"?n:n==null?he:typeof n=="object"?W(n)?Cl(n[0],n[1]):Sl(n):Hc(n)}function Ea(n){if(!vn(n))return ny(n);var o=[];for(var u in ut(n))st.call(n,u)&&u!="constructor"&&o.push(u);return o}function rv(n){if(!gt(n))return Vv(n);var o=vn(n),u=[];for(var l in n)l=="constructor"&&(o||!st.call(n,l))||u.push(l);return u}function Oa(n,o){return n<o}function xl(n,o){var u=-1,l=ae(n)?C(n.length):[];return Fr(n,function(p,g,v){l[++u]=o(p,g,v)}),l}function Sl(n){var o=Ha(n);return o.length==1&&o[0][2]?nc(o[0][0],o[0][1]):function(u){return u===n||La(u,n,o)}}function Cl(n,o){return qa(n)&&ic(o)?nc(tr(n),o):function(u){var l=ru(u,n);return l===e&&l===o?iu(u,n):dn(o,l,I|M)}}function yo(n,o,u,l,p){n!==o&&xa(o,function(g,v){if(p||(p=new Ue),gt(g))iv(n,o,v,u,yo,l,p);else{var w=l?l(Ya(n,v),g,v+"",n,o,p):e;w===e&&(w=g),Pa(n,v,w)}},ue)}function iv(n,o,u,l,p,g,v){var w=Ya(n,u),T=Ya(o,u),E=v.get(T);if(E){Pa(n,u,E);return}var O=g?g(w,T,u+"",n,o,v):e,A=O===e;if(A){var D=W(T),R=!D&&Nr(T),G=!D&&!R&&Oi(T);O=T,D||R||G?W(w)?O=w:Pt(w)?O=se(w):R?(A=!1,O=zl(T,!0)):G?(A=!1,O=Vl(T,!0)):O=[]:wn(T)||ii(T)?(O=w,ii(w)?O=kc(w):(!gt(w)||xr(w))&&(O=rc(T))):A=!1}A&&(v.set(T,O),p(O,T,l,g,v),v.delete(T)),Pa(n,u,O)}function _l(n,o){var u=n.length;if(u)return o+=o<0?u:0,Tr(o,u)?n[o]:e}function Ll(n,o,u){o.length?o=pt(o,function(g){return W(g)?function(v){return ti(v,g.length===1?g[0]:g)}:g}):o=[he];var l=-1;o=pt(o,de(N()));var p=xl(n,function(g,v,w){var T=pt(o,function(E){return E(g)});return{criteria:T,index:++l,value:g}});return Ag(p,function(g,v){return gv(g,v,u)})}function nv(n,o){return El(n,o,function(u,l){return iu(n,l)})}function El(n,o,u){for(var l=-1,p=o.length,g={};++l<p;){var v=o[l],w=ti(n,v);u(w,v)&&gn(g,zr(v,n),w)}return g}function ov(n){return function(o){return ti(o,n)}}function Aa(n,o,u,l){var p=l?Og:bi,g=-1,v=o.length,w=n;for(n===o&&(o=se(o)),u&&(w=pt(n,de(u)));++g<v;)for(var T=0,E=o[g],O=u?u(E):E;(T=p(w,O,T,l))>-1;)w!==n&&so.call(w,T,1),so.call(n,T,1);return n}function Ol(n,o){for(var u=n?o.length:0,l=u-1;u--;){var p=o[u];if(u==l||p!==g){var g=p;Tr(p)?so.call(n,p,1):ka(n,p)}}return n}function Ia(n,o){return n+ho(hl()*(o-n+1))}function sv(n,o,u,l){for(var p=-1,g=It(uo((o-n)/(u||1)),0),v=C(g);g--;)v[l?g:++p]=n,n+=u;return v}function Ma(n,o){var u="";if(!n||o<1||o>Or)return u;do o%2&&(u+=n),o=ho(o/2),o&&(n+=n);while(o);return u}function Y(n,o){return Qa(oc(n,o,he),n+"")}function av(n){return fl(Ai(n))}function uv(n,o){var u=Ai(n);return Lo(u,Zr(o,0,u.length))}function gn(n,o,u,l){if(!gt(n))return n;o=zr(o,n);for(var p=-1,g=o.length,v=g-1,w=n;w!=null&&++p<g;){var T=tr(o[p]),E=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return n;if(p!=v){var O=w[T];E=l?l(O,T,w):e,E===e&&(E=gt(O)?O:Tr(o[p+1])?[]:{})}fn(w,T,E),w=w[T]}return n}var Al=lo?function(n,o){return lo.set(n,o),n}:he,hv=ao?function(n,o){return ao(n,"toString",{configurable:!0,enumerable:!1,value:ou(o),writable:!0})}:he;function lv(n){return Lo(Ai(n))}function Me(n,o,u){var l=-1,p=n.length;o<0&&(o=-o>p?0:p+o),u=u>p?p:u,u<0&&(u+=p),p=o>u?0:u-o>>>0,o>>>=0;for(var g=C(p);++l<p;)g[l]=n[l+o];return g}function cv(n,o){var u;return Fr(n,function(l,p,g){return u=o(l,p,g),!u}),!!u}function vo(n,o,u){var l=0,p=n==null?l:n.length;if(typeof o=="number"&&o===o&&p<=pd){for(;l<p;){var g=l+p>>>1,v=n[g];v!==null&&!ye(v)&&(u?v<=o:v<o)?l=g+1:p=g}return p}return Da(n,o,he,u)}function Da(n,o,u,l){var p=0,g=n==null?0:n.length;if(g===0)return 0;o=u(o);for(var v=o!==o,w=o===null,T=ye(o),E=o===e;p<g;){var O=ho((p+g)/2),A=u(n[O]),D=A!==e,R=A===null,G=A===A,$=ye(A);if(v)var U=l||G;else E?U=G&&(l||D):w?U=G&&D&&(l||!R):T?U=G&&D&&!R&&(l||!$):R||$?U=!1:U=l?A<=o:A<o;U?p=O+1:g=O}return Yt(g,fd)}function Il(n,o){for(var u=-1,l=n.length,p=0,g=[];++u<l;){var v=n[u],w=o?o(v):v;if(!u||!Be(w,T)){var T=w;g[p++]=v===0?0:v}}return g}function Ml(n){return typeof n=="number"?n:ye(n)?Un:+n}function ge(n){if(typeof n=="string")return n;if(W(n))return pt(n,ge)+"";if(ye(n))return ll?ll.call(n):"";var o=n+"";return o=="0"&&1/n==-Yr?"-0":o}function Rr(n,o,u){var l=-1,p=Xn,g=n.length,v=!0,w=[],T=w;if(u)v=!1,p=ua;else if(g>=s){var E=o?null:Tv(n);if(E)return Jn(E);v=!1,p=sn,T=new Jr}else T=o?[]:w;t:for(;++l<g;){var O=n[l],A=o?o(O):O;if(O=u||O!==0?O:0,v&&A===A){for(var D=T.length;D--;)if(T[D]===A)continue t;o&&T.push(A),w.push(O)}else p(T,A,u)||(T!==w&&T.push(A),w.push(O))}return w}function ka(n,o){return o=zr(o,n),n=sc(n,o),n==null||delete n[tr(De(o))]}function Dl(n,o,u,l){return gn(n,o,u(ti(n,o)),l)}function bo(n,o,u,l){for(var p=n.length,g=l?p:-1;(l?g--:++g<p)&&o(n[g],g,n););return u?Me(n,l?0:g,l?g+1:p):Me(n,l?g+1:0,l?p:g)}function kl(n,o){var u=n;return u instanceof X&&(u=u.value()),ha(o,function(l,p){return p.func.apply(p.thisArg,Ir([l],p.args))},u)}function Fa(n,o,u){var l=n.length;if(l<2)return l?Rr(n[0]):[];for(var p=-1,g=C(l);++p<l;)for(var v=n[p],w=-1;++w<l;)w!=p&&(g[p]=pn(g[p]||v,n[w],o,u));return Rr(Bt(g,1),o,u)}function Fl(n,o,u){for(var l=-1,p=n.length,g=o.length,v={};++l<p;){var w=l<g?o[l]:e;u(v,n[l],w)}return v}function Ra(n){return Pt(n)?n:[]}function za(n){return typeof n=="function"?n:he}function zr(n,o){return W(n)?n:qa(n,o)?[n]:lc(ot(n))}var fv=Y;function Vr(n,o,u){var l=n.length;return u=u===e?l:u,!o&&u>=l?n:Me(n,o,u)}var Rl=Zg||function(n){return Rt.clearTimeout(n)};function zl(n,o){if(o)return n.slice();var u=n.length,l=nl?nl(u):new n.constructor(u);return n.copy(l),l}function Va(n){var o=new n.constructor(n.byteLength);return new no(o).set(new no(n)),o}function pv(n,o){var u=o?Va(n.buffer):n.buffer;return new n.constructor(u,n.byteOffset,n.byteLength)}function mv(n){var o=new n.constructor(n.source,wh.exec(n));return o.lastIndex=n.lastIndex,o}function dv(n){return cn?ut(cn.call(n)):{}}function Vl(n,o){var u=o?Va(n.buffer):n.buffer;return new n.constructor(u,n.byteOffset,n.length)}function Nl(n,o){if(n!==o){var u=n!==e,l=n===null,p=n===n,g=ye(n),v=o!==e,w=o===null,T=o===o,E=ye(o);if(!w&&!E&&!g&&n>o||g&&v&&T&&!w&&!E||l&&v&&T||!u&&T||!p)return 1;if(!l&&!g&&!E&&n<o||E&&u&&p&&!l&&!g||w&&u&&p||!v&&p||!T)return-1}return 0}function gv(n,o,u){for(var l=-1,p=n.criteria,g=o.criteria,v=p.length,w=u.length;++l<v;){var T=Nl(p[l],g[l]);if(T){if(l>=w)return T;var E=u[l];return T*(E=="desc"?-1:1)}}return n.index-o.index}function jl(n,o,u,l){for(var p=-1,g=n.length,v=u.length,w=-1,T=o.length,E=It(g-v,0),O=C(T+E),A=!l;++w<T;)O[w]=o[w];for(;++p<v;)(A||p<g)&&(O[u[p]]=n[p]);for(;E--;)O[w++]=n[p++];return O}function Gl(n,o,u,l){for(var p=-1,g=n.length,v=-1,w=u.length,T=-1,E=o.length,O=It(g-w,0),A=C(O+E),D=!l;++p<O;)A[p]=n[p];for(var R=p;++T<E;)A[R+T]=o[T];for(;++v<w;)(D||p<g)&&(A[R+u[v]]=n[p++]);return A}function se(n,o){var u=-1,l=n.length;for(o||(o=C(l));++u<l;)o[u]=n[u];return o}function Ze(n,o,u,l){var p=!u;u||(u={});for(var g=-1,v=o.length;++g<v;){var w=o[g],T=l?l(u[w],n[w],w,u,n):e;T===e&&(T=n[w]),p?br(u,w,T):fn(u,w,T)}return u}function yv(n,o){return Ze(n,Wa(n),o)}function vv(n,o){return Ze(n,tc(n),o)}function wo(n,o){return function(u,l){var p=W(u)?xg:jy,g=o?o():{};return p(u,n,N(l,2),g)}}function _i(n){return Y(function(o,u){var l=-1,p=u.length,g=p>1?u[p-1]:e,v=p>2?u[2]:e;for(g=n.length>3&&typeof g=="function"?(p--,g):e,v&&ee(u[0],u[1],v)&&(g=p<3?e:g,p=1),o=ut(o);++l<p;){var w=u[l];w&&n(o,w,l,g)}return o})}function Ul(n,o){return function(u,l){if(u==null)return u;if(!ae(u))return n(u,l);for(var p=u.length,g=o?p:-1,v=ut(u);(o?g--:++g<p)&&l(v[g],g,v)!==!1;);return u}}function Bl(n){return function(o,u,l){for(var p=-1,g=ut(o),v=l(o),w=v.length;w--;){var T=v[n?w:++p];if(u(g[T],T,g)===!1)break}return o}}function bv(n,o,u){var l=o&F,p=yn(n);function g(){var v=this&&this!==Rt&&this instanceof g?p:n;return v.apply(l?u:this,arguments)}return g}function Hl(n){return function(o){o=ot(o);var u=wi(o)?Ge(o):e,l=u?u[0]:o.charAt(0),p=u?Vr(u,1).join(""):o.slice(1);return l[n]()+p}}function Li(n){return function(o){return ha(Uc(Gc(o).replace(hg,"")),n,"")}}function yn(n){return function(){var o=arguments;switch(o.length){case 0:return new n;case 1:return new n(o[0]);case 2:return new n(o[0],o[1]);case 3:return new n(o[0],o[1],o[2]);case 4:return new n(o[0],o[1],o[2],o[3]);case 5:return new n(o[0],o[1],o[2],o[3],o[4]);case 6:return new n(o[0],o[1],o[2],o[3],o[4],o[5]);case 7:return new n(o[0],o[1],o[2],o[3],o[4],o[5],o[6])}var u=Ci(n.prototype),l=n.apply(u,o);return gt(l)?l:u}}function wv(n,o,u){var l=yn(n);function p(){for(var g=arguments.length,v=C(g),w=g,T=Ei(p);w--;)v[w]=arguments[w];var E=g<3&&v[0]!==T&&v[g-1]!==T?[]:Mr(v,T);if(g-=E.length,g<u)return Ql(n,o,Po,p.placeholder,e,v,E,e,e,u-g);var O=this&&this!==Rt&&this instanceof p?l:n;return me(O,this,v)}return p}function Wl(n){return function(o,u,l){var p=ut(o);if(!ae(o)){var g=N(u,3);o=zt(o),u=function(w){return g(p[w],w,p)}}var v=n(o,u,l);return v>-1?p[g?o[v]:v]:e}}function ql(n){return Pr(function(o){var u=o.length,l=u,p=Ae.prototype.thru;for(n&&o.reverse();l--;){var g=o[l];if(typeof g!="function")throw new Oe(h);if(p&&!v&&Co(g)=="wrapper")var v=new Ae([],!0)}for(l=v?l:u;++l<u;){g=o[l];var w=Co(g),T=w=="wrapper"?Ba(g):e;T&&$a(T[0])&&T[1]==(_e|Z|Ot|Ki)&&!T[4].length&&T[9]==1?v=v[Co(T[0])].apply(v,T[3]):v=g.length==1&&$a(g)?v[w]():v.thru(g)}return function(){var E=arguments,O=E[0];if(v&&E.length==1&&W(O))return v.plant(O).value();for(var A=0,D=u?o[A].apply(this,E):O;++A<u;)D=o[A].call(this,D);return D}})}function Po(n,o,u,l,p,g,v,w,T,E){var O=o&_e,A=o&F,D=o&j,R=o&(Z|ht),G=o&Bs,$=D?e:yn(n);function U(){for(var Q=arguments.length,K=C(Q),ve=Q;ve--;)K[ve]=arguments[ve];if(R)var re=Ei(U),be=Mg(K,re);if(l&&(K=jl(K,l,p,R)),g&&(K=Gl(K,g,v,R)),Q-=be,R&&Q<E){var Tt=Mr(K,re);return Ql(n,o,Po,U.placeholder,u,K,Tt,w,T,E-Q)}var He=A?u:this,Cr=D?He[n]:n;return Q=K.length,w?K=jv(K,w):G&&Q>1&&K.reverse(),O&&T<Q&&(K.length=T),this&&this!==Rt&&this instanceof U&&(Cr=$||yn(Cr)),Cr.apply(He,K)}return U}function $l(n,o){return function(u,l){return Yy(u,n,o(l),{})}}function To(n,o){return function(u,l){var p;if(u===e&&l===e)return o;if(u!==e&&(p=u),l!==e){if(p===e)return l;typeof u=="string"||typeof l=="string"?(u=ge(u),l=ge(l)):(u=Ml(u),l=Ml(l)),p=n(u,l)}return p}}function Na(n){return Pr(function(o){return o=pt(o,de(N())),Y(function(u){var l=this;return n(o,function(p){return me(p,l,u)})})})}function xo(n,o){o=o===e?" ":ge(o);var u=o.length;if(u<2)return u?Ma(o,n):o;var l=Ma(o,uo(n/Pi(o)));return wi(o)?Vr(Ge(l),0,n).join(""):l.slice(0,n)}function Pv(n,o,u,l){var p=o&F,g=yn(n);function v(){for(var w=-1,T=arguments.length,E=-1,O=l.length,A=C(O+T),D=this&&this!==Rt&&this instanceof v?g:n;++E<O;)A[E]=l[E];for(;T--;)A[E++]=arguments[++w];return me(D,p?u:this,A)}return v}function Yl(n){return function(o,u,l){return l&&typeof l!="number"&&ee(o,u,l)&&(u=l=e),o=Sr(o),u===e?(u=o,o=0):u=Sr(u),l=l===e?o<u?1:-1:Sr(l),sv(o,u,l,n)}}function So(n){return function(o,u){return typeof o=="string"&&typeof u=="string"||(o=ke(o),u=ke(u)),n(o,u)}}function Ql(n,o,u,l,p,g,v,w,T,E){var O=o&Z,A=O?v:e,D=O?e:v,R=O?g:e,G=O?e:g;o|=O?Ot:Ve,o&=~(O?Ve:Ot),o&B||(o&=~(F|j));var $=[n,o,p,R,A,G,D,w,T,E],U=u.apply(e,$);return $a(n)&&ac(U,$),U.placeholder=l,uc(U,n,o)}function ja(n){var o=At[n];return function(u,l){if(u=ke(u),l=l==null?0:Yt(q(l),292),l&&ul(u)){var p=(ot(u)+"e").split("e"),g=o(p[0]+"e"+(+p[1]+l));return p=(ot(g)+"e").split("e"),+(p[0]+"e"+(+p[1]-l))}return o(u)}}var Tv=xi&&1/Jn(new xi([,-0]))[1]==Yr?function(n){return new xi(n)}:uu;function Xl(n){return function(o){var u=Qt(o);return u==Ne?ga(o):u==je?Ng(o):Ig(o,n(o))}}function wr(n,o,u,l,p,g,v,w){var T=o&j;if(!T&&typeof n!="function")throw new Oe(h);var E=l?l.length:0;if(E||(o&=~(Ot|Ve),l=p=e),v=v===e?v:It(q(v),0),w=w===e?w:q(w),E-=p?p.length:0,o&Ve){var O=l,A=p;l=p=e}var D=T?e:Ba(n),R=[n,o,u,l,p,O,A,g,v,w];if(D&&zv(R,D),n=R[0],o=R[1],u=R[2],l=R[3],p=R[4],w=R[9]=R[9]===e?T?0:n.length:It(R[9]-E,0),!w&&o&(Z|ht)&&(o&=~(Z|ht)),!o||o==F)var G=bv(n,o,u);else o==Z||o==ht?G=wv(n,o,w):(o==Ot||o==(F|Ot))&&!p.length?G=Pv(n,o,u,l):G=Po.apply(e,R);var $=D?Al:ac;return uc($(G,R),n,o)}function Kl(n,o,u,l){return n===e||Be(n,Ti[u])&&!st.call(l,u)?o:n}function Jl(n,o,u,l,p,g){return gt(n)&&gt(o)&&(g.set(o,n),yo(n,o,e,Jl,g),g.delete(o)),n}function xv(n){return wn(n)?e:n}function Zl(n,o,u,l,p,g){var v=u&I,w=n.length,T=o.length;if(w!=T&&!(v&&T>w))return!1;var E=g.get(n),O=g.get(o);if(E&&O)return E==o&&O==n;var A=-1,D=!0,R=u&M?new Jr:e;for(g.set(n,o),g.set(o,n);++A<w;){var G=n[A],$=o[A];if(l)var U=v?l($,G,A,o,n,g):l(G,$,A,n,o,g);if(U!==e){if(U)continue;D=!1;break}if(R){if(!la(o,function(Q,K){if(!sn(R,K)&&(G===Q||p(G,Q,u,l,g)))return R.push(K)})){D=!1;break}}else if(!(G===$||p(G,$,u,l,g))){D=!1;break}}return g.delete(n),g.delete(o),D}function Sv(n,o,u,l,p,g,v){switch(u){case yi:if(n.byteLength!=o.byteLength||n.byteOffset!=o.byteOffset)return!1;n=n.buffer,o=o.buffer;case on:return!(n.byteLength!=o.byteLength||!g(new no(n),new no(o)));case Ji:case Zi:case tn:return Be(+n,+o);case Hn:return n.name==o.name&&n.message==o.message;case en:case rn:return n==o+"";case Ne:var w=ga;case je:var T=l&I;if(w||(w=Jn),n.size!=o.size&&!T)return!1;var E=v.get(n);if(E)return E==o;l|=M,v.set(n,o);var O=Zl(w(n),w(o),l,p,g,v);return v.delete(n),O;case qn:if(cn)return cn.call(n)==cn.call(o)}return!1}function Cv(n,o,u,l,p,g){var v=u&I,w=Ga(n),T=w.length,E=Ga(o),O=E.length;if(T!=O&&!v)return!1;for(var A=T;A--;){var D=w[A];if(!(v?D in o:st.call(o,D)))return!1}var R=g.get(n),G=g.get(o);if(R&&G)return R==o&&G==n;var $=!0;g.set(n,o),g.set(o,n);for(var U=v;++A<T;){D=w[A];var Q=n[D],K=o[D];if(l)var ve=v?l(K,Q,D,o,n,g):l(Q,K,D,n,o,g);if(!(ve===e?Q===K||p(Q,K,u,l,g):ve)){$=!1;break}U||(U=D=="constructor")}if($&&!U){var re=n.constructor,be=o.constructor;re!=be&&"constructor"in n&&"constructor"in o&&!(typeof re=="function"&&re instanceof re&&typeof be=="function"&&be instanceof be)&&($=!1)}return g.delete(n),g.delete(o),$}function Pr(n){return Qa(oc(n,e,mc),n+"")}function Ga(n){return bl(n,zt,Wa)}function Ua(n){return bl(n,ue,tc)}var Ba=lo?function(n){return lo.get(n)}:uu;function Co(n){for(var o=n.name+"",u=Si[o],l=st.call(Si,o)?u.length:0;l--;){var p=u[l],g=p.func;if(g==null||g==n)return p.name}return o}function Ei(n){var o=st.call(d,"placeholder")?d:n;return o.placeholder}function N(){var n=d.iteratee||su;return n=n===su?Tl:n,arguments.length?n(arguments[0],arguments[1]):n}function _o(n,o){var u=n.__data__;return Dv(o)?u[typeof o=="string"?"string":"hash"]:u.map}function Ha(n){for(var o=zt(n),u=o.length;u--;){var l=o[u],p=n[l];o[u]=[l,p,ic(p)]}return o}function ei(n,o){var u=Rg(n,o);return Pl(u)?u:e}function _v(n){var o=st.call(n,Xr),u=n[Xr];try{n[Xr]=e;var l=!0}catch(g){}var p=ro.call(n);return l&&(o?n[Xr]=u:delete n[Xr]),p}var Wa=va?function(n){return n==null?[]:(n=ut(n),Ar(va(n),function(o){return sl.call(n,o)}))}:hu,tc=va?function(n){for(var o=[];n;)Ir(o,Wa(n)),n=oo(n);return o}:hu,Qt=te;(ba&&Qt(new ba(new ArrayBuffer(1)))!=yi||un&&Qt(new un)!=Ne||wa&&Qt(wa.resolve())!=gh||xi&&Qt(new xi)!=je||hn&&Qt(new hn)!=nn)&&(Qt=function(n){var o=te(n),u=o==gr?n.constructor:e,l=u?ri(u):"";if(l)switch(l){case uy:return yi;case hy:return Ne;case ly:return gh;case cy:return je;case fy:return nn}return o});function Lv(n,o,u){for(var l=-1,p=u.length;++l<p;){var g=u[l],v=g.size;switch(g.type){case"drop":n+=v;break;case"dropRight":o-=v;break;case"take":o=Yt(o,n+v);break;case"takeRight":n=It(n,o-v);break}}return{start:n,end:o}}function Ev(n){var o=n.match(kd);return o?o[1].split(Fd):[]}function ec(n,o,u){o=zr(o,n);for(var l=-1,p=o.length,g=!1;++l<p;){var v=tr(o[l]);if(!(g=n!=null&&u(n,v)))break;n=n[v]}return g||++l!=p?g:(p=n==null?0:n.length,!!p&&Do(p)&&Tr(v,p)&&(W(n)||ii(n)))}function Ov(n){var o=n.length,u=new n.constructor(o);return o&&typeof n[0]=="string"&&st.call(n,"index")&&(u.index=n.index,u.input=n.input),u}function rc(n){return typeof n.constructor=="function"&&!vn(n)?Ci(oo(n)):{}}function Av(n,o,u){var l=n.constructor;switch(o){case on:return Va(n);case Ji:case Zi:return new l(+n);case yi:return pv(n,u);case Hs:case Ws:case qs:case $s:case Ys:case Qs:case Xs:case Ks:case Js:return Vl(n,u);case Ne:return new l;case tn:case rn:return new l(n);case en:return mv(n);case je:return new l;case qn:return dv(n)}}function Iv(n,o){var u=o.length;if(!u)return n;var l=u-1;return o[l]=(u>1?"& ":"")+o[l],o=o.join(u>2?", ":" "),n.replace(Dd,`{
/* [wrapped with `+o+`] */
`)}function Mv(n){return W(n)||ii(n)||!!(al&&n&&n[al])}function Tr(n,o){var u=typeof n;return o=o!=null?o:Or,!!o&&(u=="number"||u!="symbol"&&Hd.test(n))&&n>-1&&n%1==0&&n<o}function ee(n,o,u){if(!gt(u))return!1;var l=typeof o;return(l=="number"?ae(u)&&Tr(o,u.length):l=="string"&&o in u)?Be(u[o],n):!1}function qa(n,o){if(W(n))return!1;var u=typeof n;return u=="number"||u=="symbol"||u=="boolean"||n==null||ye(n)?!0:Od.test(n)||!Ed.test(n)||o!=null&&n in ut(o)}function Dv(n){var o=typeof n;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?n!=="__proto__":n===null}function $a(n){var o=Co(n),u=d[o];if(typeof u!="function"||!(o in X.prototype))return!1;if(n===u)return!0;var l=Ba(u);return!!l&&n===l[0]}function kv(n){return!!il&&il in n}var Fv=to?xr:lu;function vn(n){var o=n&&n.constructor,u=typeof o=="function"&&o.prototype||Ti;return n===u}function ic(n){return n===n&&!gt(n)}function nc(n,o){return function(u){return u==null?!1:u[n]===o&&(o!==e||n in ut(u))}}function Rv(n){var o=Io(n,function(l){return u.size===m&&u.clear(),l}),u=o.cache;return o}function zv(n,o){var u=n[1],l=o[1],p=u|l,g=p<(F|j|_e),v=l==_e&&u==Z||l==_e&&u==Ki&&n[7].length<=o[8]||l==(_e|Ki)&&o[7].length<=o[8]&&u==Z;if(!(g||v))return n;l&F&&(n[2]=o[2],p|=u&F?0:B);var w=o[3];if(w){var T=n[3];n[3]=T?jl(T,w,o[4]):w,n[4]=T?Mr(n[3],y):o[4]}return w=o[5],w&&(T=n[5],n[5]=T?Gl(T,w,o[6]):w,n[6]=T?Mr(n[5],y):o[6]),w=o[7],w&&(n[7]=w),l&_e&&(n[8]=n[8]==null?o[8]:Yt(n[8],o[8])),n[9]==null&&(n[9]=o[9]),n[0]=o[0],n[1]=p,n}function Vv(n){var o=[];if(n!=null)for(var u in ut(n))o.push(u);return o}function Nv(n){return ro.call(n)}function oc(n,o,u){return o=It(o===e?n.length-1:o,0),function(){for(var l=arguments,p=-1,g=It(l.length-o,0),v=C(g);++p<g;)v[p]=l[o+p];p=-1;for(var w=C(o+1);++p<o;)w[p]=l[p];return w[o]=u(v),me(n,this,w)}}function sc(n,o){return o.length<2?n:ti(n,Me(o,0,-1))}function jv(n,o){for(var u=n.length,l=Yt(o.length,u),p=se(n);l--;){var g=o[l];n[l]=Tr(g,u)?p[g]:e}return n}function Ya(n,o){if(!(o==="constructor"&&typeof n[o]=="function")&&o!="__proto__")return n[o]}var ac=hc(Al),bn=ey||function(n,o){return Rt.setTimeout(n,o)},Qa=hc(hv);function uc(n,o,u){var l=o+"";return Qa(n,Iv(l,Gv(Ev(l),u)))}function hc(n){var o=0,u=0;return function(){var l=oy(),p=ud-(l-u);if(u=l,p>0){if(++o>=ad)return arguments[0]}else o=0;return n.apply(e,arguments)}}function Lo(n,o){var u=-1,l=n.length,p=l-1;for(o=o===e?l:o;++u<o;){var g=Ia(u,p),v=n[g];n[g]=n[u],n[u]=v}return n.length=o,n}var lc=Rv(function(n){var o=[];return n.charCodeAt(0)===46&&o.push(""),n.replace(Ad,function(u,l,p,g){o.push(p?g.replace(Vd,"$1"):l||u)}),o});function tr(n){if(typeof n=="string"||ye(n))return n;var o=n+"";return o=="0"&&1/n==-Yr?"-0":o}function ri(n){if(n!=null){try{return eo.call(n)}catch(o){}try{return n+""}catch(o){}}return""}function Gv(n,o){return Ee(md,function(u){var l="_."+u[0];o&u[1]&&!Xn(n,l)&&n.push(l)}),n.sort()}function cc(n){if(n instanceof X)return n.clone();var o=new Ae(n.__wrapped__,n.__chain__);return o.__actions__=se(n.__actions__),o.__index__=n.__index__,o.__values__=n.__values__,o}function Uv(n,o,u){(u?ee(n,o,u):o===e)?o=1:o=It(q(o),0);var l=n==null?0:n.length;if(!l||o<1)return[];for(var p=0,g=0,v=C(uo(l/o));p<l;)v[g++]=Me(n,p,p+=o);return v}function Bv(n){for(var o=-1,u=n==null?0:n.length,l=0,p=[];++o<u;){var g=n[o];g&&(p[l++]=g)}return p}function Hv(){var n=arguments.length;if(!n)return[];for(var o=C(n-1),u=arguments[0],l=n;l--;)o[l-1]=arguments[l];return Ir(W(u)?se(u):[u],Bt(o,1))}var Wv=Y(function(n,o){return Pt(n)?pn(n,Bt(o,1,Pt,!0)):[]}),qv=Y(function(n,o){var u=De(o);return Pt(u)&&(u=e),Pt(n)?pn(n,Bt(o,1,Pt,!0),N(u,2)):[]}),$v=Y(function(n,o){var u=De(o);return Pt(u)&&(u=e),Pt(n)?pn(n,Bt(o,1,Pt,!0),e,u):[]});function Yv(n,o,u){var l=n==null?0:n.length;return l?(o=u||o===e?1:q(o),Me(n,o<0?0:o,l)):[]}function Qv(n,o,u){var l=n==null?0:n.length;return l?(o=u||o===e?1:q(o),o=l-o,Me(n,0,o<0?0:o)):[]}function Xv(n,o){return n&&n.length?bo(n,N(o,3),!0,!0):[]}function Kv(n,o){return n&&n.length?bo(n,N(o,3),!0):[]}function Jv(n,o,u,l){var p=n==null?0:n.length;return p?(u&&typeof u!="number"&&ee(n,o,u)&&(u=0,l=p),Hy(n,o,u,l)):[]}function fc(n,o,u){var l=n==null?0:n.length;if(!l)return-1;var p=u==null?0:q(u);return p<0&&(p=It(l+p,0)),Kn(n,N(o,3),p)}function pc(n,o,u){var l=n==null?0:n.length;if(!l)return-1;var p=l-1;return u!==e&&(p=q(u),p=u<0?It(l+p,0):Yt(p,l-1)),Kn(n,N(o,3),p,!0)}function mc(n){var o=n==null?0:n.length;return o?Bt(n,1):[]}function Zv(n){var o=n==null?0:n.length;return o?Bt(n,Yr):[]}function tb(n,o){var u=n==null?0:n.length;return u?(o=o===e?1:q(o),Bt(n,o)):[]}function eb(n){for(var o=-1,u=n==null?0:n.length,l={};++o<u;){var p=n[o];l[p[0]]=p[1]}return l}function dc(n){return n&&n.length?n[0]:e}function rb(n,o,u){var l=n==null?0:n.length;if(!l)return-1;var p=u==null?0:q(u);return p<0&&(p=It(l+p,0)),bi(n,o,p)}function ib(n){var o=n==null?0:n.length;return o?Me(n,0,-1):[]}var nb=Y(function(n){var o=pt(n,Ra);return o.length&&o[0]===n[0]?_a(o):[]}),ob=Y(function(n){var o=De(n),u=pt(n,Ra);return o===De(u)?o=e:u.pop(),u.length&&u[0]===n[0]?_a(u,N(o,2)):[]}),sb=Y(function(n){var o=De(n),u=pt(n,Ra);return o=typeof o=="function"?o:e,o&&u.pop(),u.length&&u[0]===n[0]?_a(u,e,o):[]});function ab(n,o){return n==null?"":iy.call(n,o)}function De(n){var o=n==null?0:n.length;return o?n[o-1]:e}function ub(n,o,u){var l=n==null?0:n.length;if(!l)return-1;var p=l;return u!==e&&(p=q(u),p=p<0?It(l+p,0):Yt(p,l-1)),o===o?Gg(n,o,p):Kn(n,Qh,p,!0)}function hb(n,o){return n&&n.length?_l(n,q(o)):e}var lb=Y(gc);function gc(n,o){return n&&n.length&&o&&o.length?Aa(n,o):n}function cb(n,o,u){return n&&n.length&&o&&o.length?Aa(n,o,N(u,2)):n}function fb(n,o,u){return n&&n.length&&o&&o.length?Aa(n,o,e,u):n}var pb=Pr(function(n,o){var u=n==null?0:n.length,l=Ta(n,o);return Ol(n,pt(o,function(p){return Tr(p,u)?+p:p}).sort(Nl)),l});function mb(n,o){var u=[];if(!(n&&n.length))return u;var l=-1,p=[],g=n.length;for(o=N(o,3);++l<g;){var v=n[l];o(v,l,n)&&(u.push(v),p.push(l))}return Ol(n,p),u}function Xa(n){return n==null?n:ay.call(n)}function db(n,o,u){var l=n==null?0:n.length;return l?(u&&typeof u!="number"&&ee(n,o,u)?(o=0,u=l):(o=o==null?0:q(o),u=u===e?l:q(u)),Me(n,o,u)):[]}function gb(n,o){return vo(n,o)}function yb(n,o,u){return Da(n,o,N(u,2))}function vb(n,o){var u=n==null?0:n.length;if(u){var l=vo(n,o);if(l<u&&Be(n[l],o))return l}return-1}function bb(n,o){return vo(n,o,!0)}function wb(n,o,u){return Da(n,o,N(u,2),!0)}function Pb(n,o){var u=n==null?0:n.length;if(u){var l=vo(n,o,!0)-1;if(Be(n[l],o))return l}return-1}function Tb(n){return n&&n.length?Il(n):[]}function xb(n,o){return n&&n.length?Il(n,N(o,2)):[]}function Sb(n){var o=n==null?0:n.length;return o?Me(n,1,o):[]}function Cb(n,o,u){return n&&n.length?(o=u||o===e?1:q(o),Me(n,0,o<0?0:o)):[]}function _b(n,o,u){var l=n==null?0:n.length;return l?(o=u||o===e?1:q(o),o=l-o,Me(n,o<0?0:o,l)):[]}function Lb(n,o){return n&&n.length?bo(n,N(o,3),!1,!0):[]}function Eb(n,o){return n&&n.length?bo(n,N(o,3)):[]}var Ob=Y(function(n){return Rr(Bt(n,1,Pt,!0))}),Ab=Y(function(n){var o=De(n);return Pt(o)&&(o=e),Rr(Bt(n,1,Pt,!0),N(o,2))}),Ib=Y(function(n){var o=De(n);return o=typeof o=="function"?o:e,Rr(Bt(n,1,Pt,!0),e,o)});function Mb(n){return n&&n.length?Rr(n):[]}function Db(n,o){return n&&n.length?Rr(n,N(o,2)):[]}function kb(n,o){return o=typeof o=="function"?o:e,n&&n.length?Rr(n,e,o):[]}function Ka(n){if(!(n&&n.length))return[];var o=0;return n=Ar(n,function(u){if(Pt(u))return o=It(u.length,o),!0}),ma(o,function(u){return pt(n,ca(u))})}function yc(n,o){if(!(n&&n.length))return[];var u=Ka(n);return o==null?u:pt(u,function(l){return me(o,e,l)})}var Fb=Y(function(n,o){return Pt(n)?pn(n,o):[]}),Rb=Y(function(n){return Fa(Ar(n,Pt))}),zb=Y(function(n){var o=De(n);return Pt(o)&&(o=e),Fa(Ar(n,Pt),N(o,2))}),Vb=Y(function(n){var o=De(n);return o=typeof o=="function"?o:e,Fa(Ar(n,Pt),e,o)}),Nb=Y(Ka);function jb(n,o){return Fl(n||[],o||[],fn)}function Gb(n,o){return Fl(n||[],o||[],gn)}var Ub=Y(function(n){var o=n.length,u=o>1?n[o-1]:e;return u=typeof u=="function"?(n.pop(),u):e,yc(n,u)});function vc(n){var o=d(n);return o.__chain__=!0,o}function Bb(n,o){return o(n),n}function Eo(n,o){return o(n)}var Hb=Pr(function(n){var o=n.length,u=o?n[0]:0,l=this.__wrapped__,p=function(g){return Ta(g,n)};return o>1||this.__actions__.length||!(l instanceof X)||!Tr(u)?this.thru(p):(l=l.slice(u,+u+(o?1:0)),l.__actions__.push({func:Eo,args:[p],thisArg:e}),new Ae(l,this.__chain__).thru(function(g){return o&&!g.length&&g.push(e),g}))});function Wb(){return vc(this)}function qb(){return new Ae(this.value(),this.__chain__)}function $b(){this.__values__===e&&(this.__values__=Mc(this.value()));var n=this.__index__>=this.__values__.length,o=n?e:this.__values__[this.__index__++];return{done:n,value:o}}function Yb(){return this}function Qb(n){for(var o,u=this;u instanceof fo;){var l=cc(u);l.__index__=0,l.__values__=e,o?p.__wrapped__=l:o=l;var p=l;u=u.__wrapped__}return p.__wrapped__=n,o}function Xb(){var n=this.__wrapped__;if(n instanceof X){var o=n;return this.__actions__.length&&(o=new X(this)),o=o.reverse(),o.__actions__.push({func:Eo,args:[Xa],thisArg:e}),new Ae(o,this.__chain__)}return this.thru(Xa)}function Kb(){return kl(this.__wrapped__,this.__actions__)}var Jb=wo(function(n,o,u){st.call(n,u)?++n[u]:br(n,u,1)});function Zb(n,o,u){var l=W(n)?$h:By;return u&&ee(n,o,u)&&(o=e),l(n,N(o,3))}function t0(n,o){var u=W(n)?Ar:yl;return u(n,N(o,3))}var e0=Wl(fc),r0=Wl(pc);function i0(n,o){return Bt(Oo(n,o),1)}function n0(n,o){return Bt(Oo(n,o),Yr)}function o0(n,o,u){return u=u===e?1:q(u),Bt(Oo(n,o),u)}function bc(n,o){var u=W(n)?Ee:Fr;return u(n,N(o,3))}function wc(n,o){var u=W(n)?Sg:gl;return u(n,N(o,3))}var s0=wo(function(n,o,u){st.call(n,u)?n[u].push(o):br(n,u,[o])});function a0(n,o,u,l){n=ae(n)?n:Ai(n),u=u&&!l?q(u):0;var p=n.length;return u<0&&(u=It(p+u,0)),ko(n)?u<=p&&n.indexOf(o,u)>-1:!!p&&bi(n,o,u)>-1}var u0=Y(function(n,o,u){var l=-1,p=typeof o=="function",g=ae(n)?C(n.length):[];return Fr(n,function(v){g[++l]=p?me(o,v,u):mn(v,o,u)}),g}),h0=wo(function(n,o,u){br(n,u,o)});function Oo(n,o){var u=W(n)?pt:xl;return u(n,N(o,3))}function l0(n,o,u,l){return n==null?[]:(W(o)||(o=o==null?[]:[o]),u=l?e:u,W(u)||(u=u==null?[]:[u]),Ll(n,o,u))}var c0=wo(function(n,o,u){n[u?0:1].push(o)},function(){return[[],[]]});function f0(n,o,u){var l=W(n)?ha:Kh,p=arguments.length<3;return l(n,N(o,4),u,p,Fr)}function p0(n,o,u){var l=W(n)?Cg:Kh,p=arguments.length<3;return l(n,N(o,4),u,p,gl)}function m0(n,o){var u=W(n)?Ar:yl;return u(n,Mo(N(o,3)))}function d0(n){var o=W(n)?fl:av;return o(n)}function g0(n,o,u){(u?ee(n,o,u):o===e)?o=1:o=q(o);var l=W(n)?Vy:uv;return l(n,o)}function y0(n){var o=W(n)?Ny:lv;return o(n)}function v0(n){if(n==null)return 0;if(ae(n))return ko(n)?Pi(n):n.length;var o=Qt(n);return o==Ne||o==je?n.size:Ea(n).length}function b0(n,o,u){var l=W(n)?la:cv;return u&&ee(n,o,u)&&(o=e),l(n,N(o,3))}var w0=Y(function(n,o){if(n==null)return[];var u=o.length;return u>1&&ee(n,o[0],o[1])?o=[]:u>2&&ee(o[0],o[1],o[2])&&(o=[o[0]]),Ll(n,Bt(o,1),[])}),Ao=ty||function(){return Rt.Date.now()};function P0(n,o){if(typeof o!="function")throw new Oe(h);return n=q(n),function(){if(--n<1)return o.apply(this,arguments)}}function Pc(n,o,u){return o=u?e:o,o=n&&o==null?n.length:o,wr(n,_e,e,e,e,e,o)}function Tc(n,o){var u;if(typeof o!="function")throw new Oe(h);return n=q(n),function(){return--n>0&&(u=o.apply(this,arguments)),n<=1&&(o=e),u}}var Ja=Y(function(n,o,u){var l=F;if(u.length){var p=Mr(u,Ei(Ja));l|=Ot}return wr(n,l,o,u,p)}),xc=Y(function(n,o,u){var l=F|j;if(u.length){var p=Mr(u,Ei(xc));l|=Ot}return wr(o,l,n,u,p)});function Sc(n,o,u){o=u?e:o;var l=wr(n,Z,e,e,e,e,e,o);return l.placeholder=Sc.placeholder,l}function Cc(n,o,u){o=u?e:o;var l=wr(n,ht,e,e,e,e,e,o);return l.placeholder=Cc.placeholder,l}function _c(n,o,u){var l,p,g,v,w,T,E=0,O=!1,A=!1,D=!0;if(typeof n!="function")throw new Oe(h);o=ke(o)||0,gt(u)&&(O=!!u.leading,A="maxWait"in u,g=A?It(ke(u.maxWait)||0,o):g,D="trailing"in u?!!u.trailing:D);function R(Tt){var He=l,Cr=p;return l=p=e,E=Tt,v=n.apply(Cr,He),v}function G(Tt){return E=Tt,w=bn(Q,o),O?R(Tt):v}function $(Tt){var He=Tt-T,Cr=Tt-E,Wc=o-He;return A?Yt(Wc,g-Cr):Wc}function U(Tt){var He=Tt-T,Cr=Tt-E;return T===e||He>=o||He<0||A&&Cr>=g}function Q(){var Tt=Ao();if(U(Tt))return K(Tt);w=bn(Q,$(Tt))}function K(Tt){return w=e,D&&l?R(Tt):(l=p=e,v)}function ve(){w!==e&&Rl(w),E=0,l=T=p=w=e}function re(){return w===e?v:K(Ao())}function be(){var Tt=Ao(),He=U(Tt);if(l=arguments,p=this,T=Tt,He){if(w===e)return G(T);if(A)return Rl(w),w=bn(Q,o),R(T)}return w===e&&(w=bn(Q,o)),v}return be.cancel=ve,be.flush=re,be}var T0=Y(function(n,o){return dl(n,1,o)}),x0=Y(function(n,o,u){return dl(n,ke(o)||0,u)});function S0(n){return wr(n,Bs)}function Io(n,o){if(typeof n!="function"||o!=null&&typeof o!="function")throw new Oe(h);var u=function(){var l=arguments,p=o?o.apply(this,l):l[0],g=u.cache;if(g.has(p))return g.get(p);var v=n.apply(this,l);return u.cache=g.set(p,v)||g,v};return u.cache=new(Io.Cache||vr),u}Io.Cache=vr;function Mo(n){if(typeof n!="function")throw new Oe(h);return function(){var o=arguments;switch(o.length){case 0:return!n.call(this);case 1:return!n.call(this,o[0]);case 2:return!n.call(this,o[0],o[1]);case 3:return!n.call(this,o[0],o[1],o[2])}return!n.apply(this,o)}}function C0(n){return Tc(2,n)}var _0=fv(function(n,o){o=o.length==1&&W(o[0])?pt(o[0],de(N())):pt(Bt(o,1),de(N()));var u=o.length;return Y(function(l){for(var p=-1,g=Yt(l.length,u);++p<g;)l[p]=o[p].call(this,l[p]);return me(n,this,l)})}),Za=Y(function(n,o){var u=Mr(o,Ei(Za));return wr(n,Ot,e,o,u)}),Lc=Y(function(n,o){var u=Mr(o,Ei(Lc));return wr(n,Ve,e,o,u)}),L0=Pr(function(n,o){return wr(n,Ki,e,e,e,o)});function E0(n,o){if(typeof n!="function")throw new Oe(h);return o=o===e?o:q(o),Y(n,o)}function O0(n,o){if(typeof n!="function")throw new Oe(h);return o=o==null?0:It(q(o),0),Y(function(u){var l=u[o],p=Vr(u,0,o);return l&&Ir(p,l),me(n,this,p)})}function A0(n,o,u){var l=!0,p=!0;if(typeof n!="function")throw new Oe(h);return gt(u)&&(l="leading"in u?!!u.leading:l,p="trailing"in u?!!u.trailing:p),_c(n,o,{leading:l,maxWait:o,trailing:p})}function I0(n){return Pc(n,1)}function M0(n,o){return Za(za(o),n)}function D0(){if(!arguments.length)return[];var n=arguments[0];return W(n)?n:[n]}function k0(n){return Ie(n,S)}function F0(n,o){return o=typeof o=="function"?o:e,Ie(n,S,o)}function R0(n){return Ie(n,b|S)}function z0(n,o){return o=typeof o=="function"?o:e,Ie(n,b|S,o)}function V0(n,o){return o==null||ml(n,o,zt(o))}function Be(n,o){return n===o||n!==n&&o!==o}var N0=So(Ca),j0=So(function(n,o){return n>=o}),ii=wl(function(){return arguments}())?wl:function(n){return bt(n)&&st.call(n,"callee")&&!sl.call(n,"callee")},W=C.isArray,G0=Gh?de(Gh):Qy;function ae(n){return n!=null&&Do(n.length)&&!xr(n)}function Pt(n){return bt(n)&&ae(n)}function U0(n){return n===!0||n===!1||bt(n)&&te(n)==Ji}var Nr=ry||lu,B0=Uh?de(Uh):Xy;function H0(n){return bt(n)&&n.nodeType===1&&!wn(n)}function W0(n){if(n==null)return!0;if(ae(n)&&(W(n)||typeof n=="string"||typeof n.splice=="function"||Nr(n)||Oi(n)||ii(n)))return!n.length;var o=Qt(n);if(o==Ne||o==je)return!n.size;if(vn(n))return!Ea(n).length;for(var u in n)if(st.call(n,u))return!1;return!0}function q0(n,o){return dn(n,o)}function $0(n,o,u){u=typeof u=="function"?u:e;var l=u?u(n,o):e;return l===e?dn(n,o,e,u):!!l}function tu(n){if(!bt(n))return!1;var o=te(n);return o==Hn||o==gd||typeof n.message=="string"&&typeof n.name=="string"&&!wn(n)}function Y0(n){return typeof n=="number"&&ul(n)}function xr(n){if(!gt(n))return!1;var o=te(n);return o==Wn||o==dh||o==dd||o==vd}function Ec(n){return typeof n=="number"&&n==q(n)}function Do(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=Or}function gt(n){var o=typeof n;return n!=null&&(o=="object"||o=="function")}function bt(n){return n!=null&&typeof n=="object"}var Oc=Bh?de(Bh):Jy;function Q0(n,o){return n===o||La(n,o,Ha(o))}function X0(n,o,u){return u=typeof u=="function"?u:e,La(n,o,Ha(o),u)}function K0(n){return Ac(n)&&n!=+n}function J0(n){if(Fv(n))throw new H(a);return Pl(n)}function Z0(n){return n===null}function tw(n){return n==null}function Ac(n){return typeof n=="number"||bt(n)&&te(n)==tn}function wn(n){if(!bt(n)||te(n)!=gr)return!1;var o=oo(n);if(o===null)return!0;var u=st.call(o,"constructor")&&o.constructor;return typeof u=="function"&&u instanceof u&&eo.call(u)==Xg}var eu=Hh?de(Hh):Zy;function ew(n){return Ec(n)&&n>=-Or&&n<=Or}var Ic=Wh?de(Wh):tv;function ko(n){return typeof n=="string"||!W(n)&&bt(n)&&te(n)==rn}function ye(n){return typeof n=="symbol"||bt(n)&&te(n)==qn}var Oi=qh?de(qh):ev;function rw(n){return n===e}function iw(n){return bt(n)&&Qt(n)==nn}function nw(n){return bt(n)&&te(n)==wd}var ow=So(Oa),sw=So(function(n,o){return n<=o});function Mc(n){if(!n)return[];if(ae(n))return ko(n)?Ge(n):se(n);if(an&&n[an])return Vg(n[an]());var o=Qt(n),u=o==Ne?ga:o==je?Jn:Ai;return u(n)}function Sr(n){if(!n)return n===0?n:0;if(n=ke(n),n===Yr||n===-Yr){var o=n<0?-1:1;return o*cd}return n===n?n:0}function q(n){var o=Sr(n),u=o%1;return o===o?u?o-u:o:0}function Dc(n){return n?Zr(q(n),0,Ke):0}function ke(n){if(typeof n=="number")return n;if(ye(n))return Un;if(gt(n)){var o=typeof n.valueOf=="function"?n.valueOf():n;n=gt(o)?o+"":o}if(typeof n!="string")return n===0?n:+n;n=Jh(n);var u=Gd.test(n);return u||Bd.test(n)?Pg(n.slice(2),u?2:8):jd.test(n)?Un:+n}function kc(n){return Ze(n,ue(n))}function aw(n){return n?Zr(q(n),-Or,Or):n===0?n:0}function ot(n){return n==null?"":ge(n)}var uw=_i(function(n,o){if(vn(o)||ae(o)){Ze(o,zt(o),n);return}for(var u in o)st.call(o,u)&&fn(n,u,o[u])}),Fc=_i(function(n,o){Ze(o,ue(o),n)}),Fo=_i(function(n,o,u,l){Ze(o,ue(o),n,l)}),hw=_i(function(n,o,u,l){Ze(o,zt(o),n,l)}),lw=Pr(Ta);function cw(n,o){var u=Ci(n);return o==null?u:pl(u,o)}var fw=Y(function(n,o){n=ut(n);var u=-1,l=o.length,p=l>2?o[2]:e;for(p&&ee(o[0],o[1],p)&&(l=1);++u<l;)for(var g=o[u],v=ue(g),w=-1,T=v.length;++w<T;){var E=v[w],O=n[E];(O===e||Be(O,Ti[E])&&!st.call(n,E))&&(n[E]=g[E])}return n}),pw=Y(function(n){return n.push(e,Jl),me(Rc,e,n)});function mw(n,o){return Yh(n,N(o,3),Je)}function dw(n,o){return Yh(n,N(o,3),Sa)}function gw(n,o){return n==null?n:xa(n,N(o,3),ue)}function yw(n,o){return n==null?n:vl(n,N(o,3),ue)}function vw(n,o){return n&&Je(n,N(o,3))}function bw(n,o){return n&&Sa(n,N(o,3))}function ww(n){return n==null?[]:go(n,zt(n))}function Pw(n){return n==null?[]:go(n,ue(n))}function ru(n,o,u){var l=n==null?e:ti(n,o);return l===e?u:l}function Tw(n,o){return n!=null&&ec(n,o,Wy)}function iu(n,o){return n!=null&&ec(n,o,qy)}var xw=$l(function(n,o,u){o!=null&&typeof o.toString!="function"&&(o=ro.call(o)),n[o]=u},ou(he)),Sw=$l(function(n,o,u){o!=null&&typeof o.toString!="function"&&(o=ro.call(o)),st.call(n,o)?n[o].push(u):n[o]=[u]},N),Cw=Y(mn);function zt(n){return ae(n)?cl(n):Ea(n)}function ue(n){return ae(n)?cl(n,!0):rv(n)}function _w(n,o){var u={};return o=N(o,3),Je(n,function(l,p,g){br(u,o(l,p,g),l)}),u}function Lw(n,o){var u={};return o=N(o,3),Je(n,function(l,p,g){br(u,p,o(l,p,g))}),u}var Ew=_i(function(n,o,u){yo(n,o,u)}),Rc=_i(function(n,o,u,l){yo(n,o,u,l)}),Ow=Pr(function(n,o){var u={};if(n==null)return u;var l=!1;o=pt(o,function(g){return g=zr(g,n),l||(l=g.length>1),g}),Ze(n,Ua(n),u),l&&(u=Ie(u,b|_|S,xv));for(var p=o.length;p--;)ka(u,o[p]);return u});function Aw(n,o){return zc(n,Mo(N(o)))}var Iw=Pr(function(n,o){return n==null?{}:nv(n,o)});function zc(n,o){if(n==null)return{};var u=pt(Ua(n),function(l){return[l]});return o=N(o),El(n,u,function(l,p){return o(l,p[0])})}function Mw(n,o,u){o=zr(o,n);var l=-1,p=o.length;for(p||(p=1,n=e);++l<p;){var g=n==null?e:n[tr(o[l])];g===e&&(l=p,g=u),n=xr(g)?g.call(n):g}return n}function Dw(n,o,u){return n==null?n:gn(n,o,u)}function kw(n,o,u,l){return l=typeof l=="function"?l:e,n==null?n:gn(n,o,u,l)}var Vc=Xl(zt),Nc=Xl(ue);function Fw(n,o,u){var l=W(n),p=l||Nr(n)||Oi(n);if(o=N(o,4),u==null){var g=n&&n.constructor;p?u=l?new g:[]:gt(n)?u=xr(g)?Ci(oo(n)):{}:u={}}return(p?Ee:Je)(n,function(v,w,T){return o(u,v,w,T)}),u}function Rw(n,o){return n==null?!0:ka(n,o)}function zw(n,o,u){return n==null?n:Dl(n,o,za(u))}function Vw(n,o,u,l){return l=typeof l=="function"?l:e,n==null?n:Dl(n,o,za(u),l)}function Ai(n){return n==null?[]:da(n,zt(n))}function Nw(n){return n==null?[]:da(n,ue(n))}function jw(n,o,u){return u===e&&(u=o,o=e),u!==e&&(u=ke(u),u=u===u?u:0),o!==e&&(o=ke(o),o=o===o?o:0),Zr(ke(n),o,u)}function Gw(n,o,u){return o=Sr(o),u===e?(u=o,o=0):u=Sr(u),n=ke(n),$y(n,o,u)}function Uw(n,o,u){if(u&&typeof u!="boolean"&&ee(n,o,u)&&(o=u=e),u===e&&(typeof o=="boolean"?(u=o,o=e):typeof n=="boolean"&&(u=n,n=e)),n===e&&o===e?(n=0,o=1):(n=Sr(n),o===e?(o=n,n=0):o=Sr(o)),n>o){var l=n;n=o,o=l}if(u||n%1||o%1){var p=hl();return Yt(n+p*(o-n+wg("1e-"+((p+"").length-1))),o)}return Ia(n,o)}var Bw=Li(function(n,o,u){return o=o.toLowerCase(),n+(u?jc(o):o)});function jc(n){return nu(ot(n).toLowerCase())}function Gc(n){return n=ot(n),n&&n.replace(Wd,Dg).replace(lg,"")}function Hw(n,o,u){n=ot(n),o=ge(o);var l=n.length;u=u===e?l:Zr(q(u),0,l);var p=u;return u-=o.length,u>=0&&n.slice(u,p)==o}function Ww(n){return n=ot(n),n&&Cd.test(n)?n.replace(vh,kg):n}function qw(n){return n=ot(n),n&&Id.test(n)?n.replace(Zs,"\\$&"):n}var $w=Li(function(n,o,u){return n+(u?"-":"")+o.toLowerCase()}),Yw=Li(function(n,o,u){return n+(u?" ":"")+o.toLowerCase()}),Qw=Hl("toLowerCase");function Xw(n,o,u){n=ot(n),o=q(o);var l=o?Pi(n):0;if(!o||l>=o)return n;var p=(o-l)/2;return xo(ho(p),u)+n+xo(uo(p),u)}function Kw(n,o,u){n=ot(n),o=q(o);var l=o?Pi(n):0;return o&&l<o?n+xo(o-l,u):n}function Jw(n,o,u){n=ot(n),o=q(o);var l=o?Pi(n):0;return o&&l<o?xo(o-l,u)+n:n}function Zw(n,o,u){return u||o==null?o=0:o&&(o=+o),sy(ot(n).replace(ta,""),o||0)}function tP(n,o,u){return(u?ee(n,o,u):o===e)?o=1:o=q(o),Ma(ot(n),o)}function eP(){var n=arguments,o=ot(n[0]);return n.length<3?o:o.replace(n[1],n[2])}var rP=Li(function(n,o,u){return n+(u?"_":"")+o.toLowerCase()});function iP(n,o,u){return u&&typeof u!="number"&&ee(n,o,u)&&(o=u=e),u=u===e?Ke:u>>>0,u?(n=ot(n),n&&(typeof o=="string"||o!=null&&!eu(o))&&(o=ge(o),!o&&wi(n))?Vr(Ge(n),0,u):n.split(o,u)):[]}var nP=Li(function(n,o,u){return n+(u?" ":"")+nu(o)});function oP(n,o,u){return n=ot(n),u=u==null?0:Zr(q(u),0,n.length),o=ge(o),n.slice(u,u+o.length)==o}function sP(n,o,u){var l=d.templateSettings;u&&ee(n,o,u)&&(o=e),n=ot(n),o=Fo({},o,l,Kl);var p=Fo({},o.imports,l.imports,Kl),g=zt(p),v=da(p,g),w,T,E=0,O=o.interpolate||$n,A="__p += '",D=ya((o.escape||$n).source+"|"+O.source+"|"+(O===bh?Nd:$n).source+"|"+(o.evaluate||$n).source+"|$","g"),R="//# sourceURL="+(st.call(o,"sourceURL")?(o.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++dg+"]")+`
`;n.replace(D,function(U,Q,K,ve,re,be){return K||(K=ve),A+=n.slice(E,be).replace(qd,Fg),Q&&(w=!0,A+=`' +
__e(`+Q+`) +
'`),re&&(T=!0,A+=`';
`+re+`;
__p += '`),K&&(A+=`' +
((__t = (`+K+`)) == null ? '' : __t) +
'`),E=be+U.length,U}),A+=`';
`;var G=st.call(o,"variable")&&o.variable;if(!G)A=`with (obj) {
`+A+`
}
`;else if(zd.test(G))throw new H(c);A=(T?A.replace(Pd,""):A).replace(Td,"$1").replace(xd,"$1;"),A="function("+(G||"obj")+`) {
`+(G?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(T?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+A+`return __p
}`;var $=Bc(function(){return rt(g,R+"return "+A).apply(e,v)});if($.source=A,tu($))throw $;return $}function aP(n){return ot(n).toLowerCase()}function uP(n){return ot(n).toUpperCase()}function hP(n,o,u){if(n=ot(n),n&&(u||o===e))return Jh(n);if(!n||!(o=ge(o)))return n;var l=Ge(n),p=Ge(o),g=Zh(l,p),v=tl(l,p)+1;return Vr(l,g,v).join("")}function lP(n,o,u){if(n=ot(n),n&&(u||o===e))return n.slice(0,rl(n)+1);if(!n||!(o=ge(o)))return n;var l=Ge(n),p=tl(l,Ge(o))+1;return Vr(l,0,p).join("")}function cP(n,o,u){if(n=ot(n),n&&(u||o===e))return n.replace(ta,"");if(!n||!(o=ge(o)))return n;var l=Ge(n),p=Zh(l,Ge(o));return Vr(l,p).join("")}function fP(n,o){var u=od,l=sd;if(gt(o)){var p="separator"in o?o.separator:p;u="length"in o?q(o.length):u,l="omission"in o?ge(o.omission):l}n=ot(n);var g=n.length;if(wi(n)){var v=Ge(n);g=v.length}if(u>=g)return n;var w=u-Pi(l);if(w<1)return l;var T=v?Vr(v,0,w).join(""):n.slice(0,w);if(p===e)return T+l;if(v&&(w+=T.length-w),eu(p)){if(n.slice(w).search(p)){var E,O=T;for(p.global||(p=ya(p.source,ot(wh.exec(p))+"g")),p.lastIndex=0;E=p.exec(O);)var A=E.index;T=T.slice(0,A===e?w:A)}}else if(n.indexOf(ge(p),w)!=w){var D=T.lastIndexOf(p);D>-1&&(T=T.slice(0,D))}return T+l}function pP(n){return n=ot(n),n&&Sd.test(n)?n.replace(yh,Ug):n}var mP=Li(function(n,o,u){return n+(u?" ":"")+o.toUpperCase()}),nu=Hl("toUpperCase");function Uc(n,o,u){return n=ot(n),o=u?e:o,o===e?zg(n)?Wg(n):Eg(n):n.match(o)||[]}var Bc=Y(function(n,o){try{return me(n,e,o)}catch(u){return tu(u)?u:new H(u)}}),dP=Pr(function(n,o){return Ee(o,function(u){u=tr(u),br(n,u,Ja(n[u],n))}),n});function gP(n){var o=n==null?0:n.length,u=N();return n=o?pt(n,function(l){if(typeof l[1]!="function")throw new Oe(h);return[u(l[0]),l[1]]}):[],Y(function(l){for(var p=-1;++p<o;){var g=n[p];if(me(g[0],this,l))return me(g[1],this,l)}})}function yP(n){return Uy(Ie(n,b))}function ou(n){return function(){return n}}function vP(n,o){return n==null||n!==n?o:n}var bP=ql(),wP=ql(!0);function he(n){return n}function su(n){return Tl(typeof n=="function"?n:Ie(n,b))}function PP(n){return Sl(Ie(n,b))}function TP(n,o){return Cl(n,Ie(o,b))}var xP=Y(function(n,o){return function(u){return mn(u,n,o)}}),SP=Y(function(n,o){return function(u){return mn(n,u,o)}});function au(n,o,u){var l=zt(o),p=go(o,l);u==null&&!(gt(o)&&(p.length||!l.length))&&(u=o,o=n,n=this,p=go(o,zt(o)));var g=!(gt(u)&&"chain"in u)||!!u.chain,v=xr(n);return Ee(p,function(w){var T=o[w];n[w]=T,v&&(n.prototype[w]=function(){var E=this.__chain__;if(g||E){var O=n(this.__wrapped__),A=O.__actions__=se(this.__actions__);return A.push({func:T,args:arguments,thisArg:n}),O.__chain__=E,O}return T.apply(n,Ir([this.value()],arguments))})}),n}function CP(){return Rt._===this&&(Rt._=Kg),this}function uu(){}function _P(n){return n=q(n),Y(function(o){return _l(o,n)})}var LP=Na(pt),EP=Na($h),OP=Na(la);function Hc(n){return qa(n)?ca(tr(n)):ov(n)}function AP(n){return function(o){return n==null?e:ti(n,o)}}var IP=Yl(),MP=Yl(!0);function hu(){return[]}function lu(){return!1}function DP(){return{}}function kP(){return""}function FP(){return!0}function RP(n,o){if(n=q(n),n<1||n>Or)return[];var u=Ke,l=Yt(n,Ke);o=N(o),n-=Ke;for(var p=ma(l,o);++u<n;)o(u);return p}function zP(n){return W(n)?pt(n,tr):ye(n)?[n]:se(lc(ot(n)))}function VP(n){var o=++Qg;return ot(n)+o}var NP=To(function(n,o){return n+o},0),jP=ja("ceil"),GP=To(function(n,o){return n/o},1),UP=ja("floor");function BP(n){return n&&n.length?mo(n,he,Ca):e}function HP(n,o){return n&&n.length?mo(n,N(o,2),Ca):e}function WP(n){return Xh(n,he)}function qP(n,o){return Xh(n,N(o,2))}function $P(n){return n&&n.length?mo(n,he,Oa):e}function YP(n,o){return n&&n.length?mo(n,N(o,2),Oa):e}var QP=To(function(n,o){return n*o},1),XP=ja("round"),KP=To(function(n,o){return n-o},0);function JP(n){return n&&n.length?pa(n,he):0}function ZP(n,o){return n&&n.length?pa(n,N(o,2)):0}return d.after=P0,d.ary=Pc,d.assign=uw,d.assignIn=Fc,d.assignInWith=Fo,d.assignWith=hw,d.at=lw,d.before=Tc,d.bind=Ja,d.bindAll=dP,d.bindKey=xc,d.castArray=D0,d.chain=vc,d.chunk=Uv,d.compact=Bv,d.concat=Hv,d.cond=gP,d.conforms=yP,d.constant=ou,d.countBy=Jb,d.create=cw,d.curry=Sc,d.curryRight=Cc,d.debounce=_c,d.defaults=fw,d.defaultsDeep=pw,d.defer=T0,d.delay=x0,d.difference=Wv,d.differenceBy=qv,d.differenceWith=$v,d.drop=Yv,d.dropRight=Qv,d.dropRightWhile=Xv,d.dropWhile=Kv,d.fill=Jv,d.filter=t0,d.flatMap=i0,d.flatMapDeep=n0,d.flatMapDepth=o0,d.flatten=mc,d.flattenDeep=Zv,d.flattenDepth=tb,d.flip=S0,d.flow=bP,d.flowRight=wP,d.fromPairs=eb,d.functions=ww,d.functionsIn=Pw,d.groupBy=s0,d.initial=ib,d.intersection=nb,d.intersectionBy=ob,d.intersectionWith=sb,d.invert=xw,d.invertBy=Sw,d.invokeMap=u0,d.iteratee=su,d.keyBy=h0,d.keys=zt,d.keysIn=ue,d.map=Oo,d.mapKeys=_w,d.mapValues=Lw,d.matches=PP,d.matchesProperty=TP,d.memoize=Io,d.merge=Ew,d.mergeWith=Rc,d.method=xP,d.methodOf=SP,d.mixin=au,d.negate=Mo,d.nthArg=_P,d.omit=Ow,d.omitBy=Aw,d.once=C0,d.orderBy=l0,d.over=LP,d.overArgs=_0,d.overEvery=EP,d.overSome=OP,d.partial=Za,d.partialRight=Lc,d.partition=c0,d.pick=Iw,d.pickBy=zc,d.property=Hc,d.propertyOf=AP,d.pull=lb,d.pullAll=gc,d.pullAllBy=cb,d.pullAllWith=fb,d.pullAt=pb,d.range=IP,d.rangeRight=MP,d.rearg=L0,d.reject=m0,d.remove=mb,d.rest=E0,d.reverse=Xa,d.sampleSize=g0,d.set=Dw,d.setWith=kw,d.shuffle=y0,d.slice=db,d.sortBy=w0,d.sortedUniq=Tb,d.sortedUniqBy=xb,d.split=iP,d.spread=O0,d.tail=Sb,d.take=Cb,d.takeRight=_b,d.takeRightWhile=Lb,d.takeWhile=Eb,d.tap=Bb,d.throttle=A0,d.thru=Eo,d.toArray=Mc,d.toPairs=Vc,d.toPairsIn=Nc,d.toPath=zP,d.toPlainObject=kc,d.transform=Fw,d.unary=I0,d.union=Ob,d.unionBy=Ab,d.unionWith=Ib,d.uniq=Mb,d.uniqBy=Db,d.uniqWith=kb,d.unset=Rw,d.unzip=Ka,d.unzipWith=yc,d.update=zw,d.updateWith=Vw,d.values=Ai,d.valuesIn=Nw,d.without=Fb,d.words=Uc,d.wrap=M0,d.xor=Rb,d.xorBy=zb,d.xorWith=Vb,d.zip=Nb,d.zipObject=jb,d.zipObjectDeep=Gb,d.zipWith=Ub,d.entries=Vc,d.entriesIn=Nc,d.extend=Fc,d.extendWith=Fo,au(d,d),d.add=NP,d.attempt=Bc,d.camelCase=Bw,d.capitalize=jc,d.ceil=jP,d.clamp=jw,d.clone=k0,d.cloneDeep=R0,d.cloneDeepWith=z0,d.cloneWith=F0,d.conformsTo=V0,d.deburr=Gc,d.defaultTo=vP,d.divide=GP,d.endsWith=Hw,d.eq=Be,d.escape=Ww,d.escapeRegExp=qw,d.every=Zb,d.find=e0,d.findIndex=fc,d.findKey=mw,d.findLast=r0,d.findLastIndex=pc,d.findLastKey=dw,d.floor=UP,d.forEach=bc,d.forEachRight=wc,d.forIn=gw,d.forInRight=yw,d.forOwn=vw,d.forOwnRight=bw,d.get=ru,d.gt=N0,d.gte=j0,d.has=Tw,d.hasIn=iu,d.head=dc,d.identity=he,d.includes=a0,d.indexOf=rb,d.inRange=Gw,d.invoke=Cw,d.isArguments=ii,d.isArray=W,d.isArrayBuffer=G0,d.isArrayLike=ae,d.isArrayLikeObject=Pt,d.isBoolean=U0,d.isBuffer=Nr,d.isDate=B0,d.isElement=H0,d.isEmpty=W0,d.isEqual=q0,d.isEqualWith=$0,d.isError=tu,d.isFinite=Y0,d.isFunction=xr,d.isInteger=Ec,d.isLength=Do,d.isMap=Oc,d.isMatch=Q0,d.isMatchWith=X0,d.isNaN=K0,d.isNative=J0,d.isNil=tw,d.isNull=Z0,d.isNumber=Ac,d.isObject=gt,d.isObjectLike=bt,d.isPlainObject=wn,d.isRegExp=eu,d.isSafeInteger=ew,d.isSet=Ic,d.isString=ko,d.isSymbol=ye,d.isTypedArray=Oi,d.isUndefined=rw,d.isWeakMap=iw,d.isWeakSet=nw,d.join=ab,d.kebabCase=$w,d.last=De,d.lastIndexOf=ub,d.lowerCase=Yw,d.lowerFirst=Qw,d.lt=ow,d.lte=sw,d.max=BP,d.maxBy=HP,d.mean=WP,d.meanBy=qP,d.min=$P,d.minBy=YP,d.stubArray=hu,d.stubFalse=lu,d.stubObject=DP,d.stubString=kP,d.stubTrue=FP,d.multiply=QP,d.nth=hb,d.noConflict=CP,d.noop=uu,d.now=Ao,d.pad=Xw,d.padEnd=Kw,d.padStart=Jw,d.parseInt=Zw,d.random=Uw,d.reduce=f0,d.reduceRight=p0,d.repeat=tP,d.replace=eP,d.result=Mw,d.round=XP,d.runInContext=P,d.sample=d0,d.size=v0,d.snakeCase=rP,d.some=b0,d.sortedIndex=gb,d.sortedIndexBy=yb,d.sortedIndexOf=vb,d.sortedLastIndex=bb,d.sortedLastIndexBy=wb,d.sortedLastIndexOf=Pb,d.startCase=nP,d.startsWith=oP,d.subtract=KP,d.sum=JP,d.sumBy=ZP,d.template=sP,d.times=RP,d.toFinite=Sr,d.toInteger=q,d.toLength=Dc,d.toLower=aP,d.toNumber=ke,d.toSafeInteger=aw,d.toString=ot,d.toUpper=uP,d.trim=hP,d.trimEnd=lP,d.trimStart=cP,d.truncate=fP,d.unescape=pP,d.uniqueId=VP,d.upperCase=mP,d.upperFirst=nu,d.each=bc,d.eachRight=wc,d.first=dc,au(d,function(){var n={};return Je(d,function(o,u){st.call(d.prototype,u)||(n[u]=o)}),n}(),{chain:!1}),d.VERSION=i,Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){d[n].placeholder=d}),Ee(["drop","take"],function(n,o){X.prototype[n]=function(u){u=u===e?1:It(q(u),0);var l=this.__filtered__&&!o?new X(this):this.clone();return l.__filtered__?l.__takeCount__=Yt(u,l.__takeCount__):l.__views__.push({size:Yt(u,Ke),type:n+(l.__dir__<0?"Right":"")}),l},X.prototype[n+"Right"]=function(u){return this.reverse()[n](u).reverse()}}),Ee(["filter","map","takeWhile"],function(n,o){var u=o+1,l=u==mh||u==ld;X.prototype[n]=function(p){var g=this.clone();return g.__iteratees__.push({iteratee:N(p,3),type:u}),g.__filtered__=g.__filtered__||l,g}}),Ee(["head","last"],function(n,o){var u="take"+(o?"Right":"");X.prototype[n]=function(){return this[u](1).value()[0]}}),Ee(["initial","tail"],function(n,o){var u="drop"+(o?"":"Right");X.prototype[n]=function(){return this.__filtered__?new X(this):this[u](1)}}),X.prototype.compact=function(){return this.filter(he)},X.prototype.find=function(n){return this.filter(n).head()},X.prototype.findLast=function(n){return this.reverse().find(n)},X.prototype.invokeMap=Y(function(n,o){return typeof n=="function"?new X(this):this.map(function(u){return mn(u,n,o)})}),X.prototype.reject=function(n){return this.filter(Mo(N(n)))},X.prototype.slice=function(n,o){n=q(n);var u=this;return u.__filtered__&&(n>0||o<0)?new X(u):(n<0?u=u.takeRight(-n):n&&(u=u.drop(n)),o!==e&&(o=q(o),u=o<0?u.dropRight(-o):u.take(o-n)),u)},X.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},X.prototype.toArray=function(){return this.take(Ke)},Je(X.prototype,function(n,o){var u=/^(?:filter|find|map|reject)|While$/.test(o),l=/^(?:head|last)$/.test(o),p=d[l?"take"+(o=="last"?"Right":""):o],g=l||/^find/.test(o);p&&(d.prototype[o]=function(){var v=this.__wrapped__,w=l?[1]:arguments,T=v instanceof X,E=w[0],O=T||W(v),A=function(Q){var K=p.apply(d,Ir([Q],w));return l&&D?K[0]:K};O&&u&&typeof E=="function"&&E.length!=1&&(T=O=!1);var D=this.__chain__,R=!!this.__actions__.length,G=g&&!D,$=T&&!R;if(!g&&O){v=$?v:new X(this);var U=n.apply(v,w);return U.__actions__.push({func:Eo,args:[A],thisArg:e}),new Ae(U,D)}return G&&$?n.apply(this,w):(U=this.thru(A),G?l?U.value()[0]:U.value():U)})}),Ee(["pop","push","shift","sort","splice","unshift"],function(n){var o=Zn[n],u=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",l=/^(?:pop|shift)$/.test(n);d.prototype[n]=function(){var p=arguments;if(l&&!this.__chain__){var g=this.value();return o.apply(W(g)?g:[],p)}return this[u](function(v){return o.apply(W(v)?v:[],p)})}}),Je(X.prototype,function(n,o){var u=d[o];if(u){var l=u.name+"";st.call(Si,l)||(Si[l]=[]),Si[l].push({name:o,func:u})}}),Si[Po(e,j).name]=[{name:"wrapper",func:e}],X.prototype.clone=py,X.prototype.reverse=my,X.prototype.value=dy,d.prototype.at=Hb,d.prototype.chain=Wb,d.prototype.commit=qb,d.prototype.next=$b,d.prototype.plant=Qb,d.prototype.reverse=Xb,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Kb,d.prototype.first=d.prototype.head,an&&(d.prototype[an]=Yb),d},Dr=qg();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Rt._=Dr,define(function(){return Dr})):Qr?((Qr.exports=Dr)._=Dr,sa._=Dr):Rt._=Dr}).call(r)}),rd=class extends Set{constructor(r,t=!1){super(r),this.valuesAsFlags=t}};function zn(r){if(r instanceof Map)return Object.fromEntries([...r.entries()].map(([t,e])=>[t,zn(e)]));if(r instanceof Set)return Array.from(r.values()).map(zn);if(r instanceof rd)return{values:[...r.values()],valuesAsFlags:r.valuesAsFlags};if(typeof r=="object"){let t={};return Object.entries(r).forEach(([e,i])=>{t[e]=zn(i)}),t}else return r}var cM=uh(hh(),1);var V1=uh(hh(),1);function mi(r,t){if(typeof r!="object")throw new Error(`Cannot merge into non-object objectToMergeWith. Received: ${JSON.stringify(r)}`);if(typeof t!="object")throw new Error(`Cannot merge using non-object objectToMergeWith. Received: ${JSON.stringify(t)}`);let e=(0,V1.cloneDeep)(r);for(let[i,s]of Object.entries(t))typeof s!="object"||s instanceof Set||e[i]===void 0?e[i]=s:e[i]=mi(e[i],s);return e}function id(r,t){if(!(r===void 0||typeof r!="object"))for(let e of Object.keys(r)){if(e===t)return r[e];let i=r[e];if(typeof i=="object"){let s=id(i,t);if(s!==void 0)return s}}}var ah="@composite:",N1="@inherit:",j1=class{constructor(r,t,e){this.tiledClassToMembersMap=r,this.enumNameToValuesMap=t,this.parserOptions=e,this.memoiser=new Map}flattenMembers(r,t){return this.memoiser.has(r)?{[r]:this.memoiser.get(r)}:(this.memoiser.set(r,t.reduce((e,i)=>it(it({},e),this.flattenMemberProperty(i)),{})),{[r]:this.memoiser.get(r)})}flattenMemberProperty(r){var e;let t=(e=r.propertyType)!=null?e:r.propertytype;if(r.type==="class"){if(!this.memoiser.has(t)){let a=this.tiledClassToMembersMap.get(t).reduce((h,c)=>mi(this.flattenMemberProperty(c),h),{});this.memoiser.set(t,a)}let i=this.memoiser.get(t),s=mi(i,this.flattenValue(r.value,i));return this.checkIfShouldFlatten(r.name)?s:{[r.name.replace(ah,"")]:s}}else return this.enumNameToValuesMap.has(t)?this.enumNameToValuesMap.get(t).valuesAsFlags?{[r.name]:new Set(r.value.split(",").filter(i=>i!==""))}:{[r.name]:r.value}:{[r.name]:r.value}}get memoisedFlattenedProperties(){return this.memoiser}flattenValue(r,t){return Object.entries(r).reduce((e,[i,s])=>{if(typeof s!="object")return id(t,i)instanceof Set?mi({[i]:new Set(s.split(",").filter(a=>a!==""))},e):mi({[i]:s},e);if(this.checkIfShouldFlatten(i))return mi(this.flattenValue(s,t),e);{let a=i.replace(ah,"");return mi({[a]:this.flattenValue(s,t)},e)}},{})}checkIfShouldFlatten(r){var t;return((t=this.parserOptions)==null?void 0:t.defaultComposite)===!0?r.startsWith(N1):!r.startsWith(ah)}},td=uh(hh(),1),G1=class{constructor(r){this.flattener=r}flattenPropertiesOnObject(r){var t,e,i,s;return we(it(it({},this.flattener.memoisedFlattenedProperties.get((t=r.class)!=null?t:r.type)),(e=r.properties)==null?void 0:e.reduce((a,h)=>it(it({},a),this.flattener.flattenMemberProperty(h)),{})),{name:r.name,id:r.id,class:(s=(i=r.class)!=null?i:r.type)!=null?s:null,x:r.x,y:r.y})}flattenPropertiesOnTile(r){var t,e,i,s;return we(it(it({},this.flattener.memoisedFlattenedProperties.get((t=r.class)!=null?t:r.type)),(e=r.properties)==null?void 0:e.reduce((a,h)=>it(it({},a),this.flattener.flattenMemberProperty(h)),{})),{id:r.id,class:(s=(i=r.class)!=null?i:r.type)!=null?s:null})}getCustomTypesMap(){return new Map([...this.flattener.memoisedFlattenedProperties.entries()].map(([r,t])=>[r,(0,td.cloneDeep)(t)]))}getEnumsMap(){return new Map([...this.flattener.enumNameToValuesMap.entries()].map(([r,t])=>[r,(0,td.cloneDeep)(t)]))}toJSON(){return JSON.stringify({customTypes:zn(this.getCustomTypesMap()),enums:zn(this.getEnumsMap())},null,4)}};function U1(r,t){let e=new Map(r.propertyTypes.filter(a=>a.type==="enum").map(a=>[a.name,new rd(a.values,a.valuesAsFlags)])),i=new Map(r.propertyTypes.filter(a=>a.type==="class").map(a=>[a.name,a.members])),s=new j1(i,e,t);return i.forEach((a,h)=>{s.flattenMembers(h,a)}),new G1(s)}var nd={parse:U1};var di=class{constructor(t,e){this.phaserTile=t;this.tiledProject=e}getProperty(t){var s,a;let e={};if(this.tiledProject){let h=nd.parse(this.tiledProject),c=this.getType();if(c){let f=(s=h.getCustomTypesMap())==null?void 0:s.get(c);if(f)for(let[m,y]of Object.entries(f))e[m]=y}}return(a=this.phaserTile.properties[t])!=null?a:e[t]}hasProperty(t){return this.getProperty(t)!=null}getType(){var t,e;return(e=(t=this.phaserTile.tileset)==null?void 0:t.tileData[this.phaserTile.index-1])==null?void 0:e.type}};var Vn=class{constructor(t,e){this.phaserTilemapLayer=t;this.tiledProject=e}getName(){return this.phaserTilemapLayer.layer.name}getProperty(t){let e=this.phaserTilemapLayer.layer.properties,i=e==null?void 0:e.find(s=>s.name==t);return i==null?void 0:i.value}hasProperty(t){return this.getProperty(t)!=null}isCharLayer(){return this.hasProperty(Qi)}getData(){return this.phaserTilemapLayer.layer.data.map(t=>t.map(e=>new di(e,this.tiledProject)))}};var Gs=class{constructor(t,e){this.phaserTilemap=t;this.tiledProject=e;for(let i of this.phaserTilemap.layers)if(i.tilemapLayer==null)throw new Error(`Error initializing tilemap. Layer '${i.name}' has no 'tilemapLayer'. This can happen if you call 'createLayer' with the wrong layer ID.`)}getTileWidth(){return this.phaserTilemap.tileWidth}getTileHeight(){return this.phaserTilemap.tileHeight}getWidth(){return this.phaserTilemap.width}getHeight(){return this.phaserTilemap.height}getOrientation(){return this.phaserTilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()?"isometric":"orthogonal"}getLayers(){return this.phaserTilemap.layers.map(t=>new Vn(t.tilemapLayer,this.tiledProject))}hasTileAt(t,e,i){return!!this.phaserTilemap.hasTileAt(t,e,i)}getTileAt(t,e,i){let s=this.phaserTilemap.getTileAt(t,e,!1,i);if(s)return new di(s,this.tiledProject)}};var lh=class{constructor(t,e="orthogonal",i="ge_collide"){this.map=t;this.orientation=e;this.layerMap=new Map;this.layers=[];let s=-1,a=-1;Object.entries(t).map(([h,c])=>{var _;let f=(_=c.data[0])==null?void 0:_.length,m=c.data.length;if(s!==-1&&s!==f||a!==-1&&a!==m)throw new Error("All tilemap layers must have the same dimensions.");s=f,a=m;let y=[];for(let S=0;S<c.data.length;S++){let I=[];for(let M=0;M<c.data[S].length;M++){let F=new fh(c.data[S][M]===1,i);I.push(F)}y.push(I)}let b=new ch(h,y,c.isCharLayer);this.layers.push(b),this.layerMap.set(h,b)})}getWidth(){var t,e;return((e=(t=Object.values(this.map)[0])==null?void 0:t.data[0])==null?void 0:e.length)||0}getHeight(){var t;return((t=Object.values(this.map)[0])==null?void 0:t.data.length)||0}getOrientation(){return this.orientation}getLayers(){return this.layers}hasTileAt(t,e,i){return!i||!this.layerMap.get(i)?!1:t>=0&&t<this.getWidth()&&e>=0&&e<this.getHeight()}getTileAt(t,e,i){if(!i)return;let s=this.layerMap.get(i);if(s)return s.getData()[e][t]}},ch=class{constructor(t,e,i=!1){this.name=t;this.tiles=e;this.isCharLayerInternal=i}getName(){return this.name}getProperty(t){if(t==="ge_charLayer"&&this.isCharLayerInternal)return this.name}hasProperty(t){return t==="ge_charLayer"&&this.isCharLayerInternal}getData(){return this.tiles}isCharLayer(){return this.isCharLayerInternal}},fh=class{constructor(t,e){this.isBlocking=t;this.collisionPropertyName=e}getProperty(t){return t===this.collisionPropertyName?this.isBlocking:!1}hasProperty(t){return t===this.collisionPropertyName}};var Nn=class{constructor(t,e){this.props={};var a;let i=t.find(h=>{var m;if(!h.tiles)return!1;let c=(m=h.firstgid)!=null?m:0;return!!h.tiles.find(y=>y.id+c===e)});if(!i)return;let s=(a=i.tiles)==null?void 0:a.find(h=>{var c;return h.id+((c=i.firstgid)!=null?c:0)===e});if(s!=null&&s.properties)for(let h of s.properties)h.name&&(this.props[h.name]=h.value)}getProperty(t){return this.props[t]}hasProperty(t){return this.props[t]!==void 0}};var jn=class{constructor(t,e){this.layer=e;this.data=[];if(this.data=[],this.layer.data)for(let i=0;i<(this.layer.height||0);i++){let s=[];for(let a=0;a<(this.layer.width||0);a++){let h=this.layer.data[i*(this.layer.width||0)+a];h!==void 0?s.push(new Nn(t,h)):s.push(void 0)}this.data.push(s)}}getName(){return this.layer.name}getProperty(t){var e,i;return(i=(e=this.layer.properties)==null?void 0:e.find(s=>s.name===t))==null?void 0:i.value}hasProperty(t){return this.getProperty(t)!==void 0}getData(){return this.data}isCharLayer(){return this.hasProperty("ge_charLayer")}};var ph=class{constructor(t){this.rawTilemap=t;this.layers=[];var e;this.layers=(e=this.rawTilemap.layers)==null?void 0:e.map(i=>new jn(this.rawTilemap.tilesets,i))}hasTileAt(t,e,i){if(t<0||t>=this.rawTilemap.width||e<0||e>=this.rawTilemap.height||!this.rawTilemap.layers)return!1;let s=this.rawTilemap.layers.find(h=>h.name===i);if(!s)return!1;let a=e*this.rawTilemap.width+t;return s.data[a]>0}getTileAt(t,e,i){if(t<0||t>=this.rawTilemap.width||e<0||e>=this.rawTilemap.height||!this.rawTilemap.layers)return;let s=this.layers.find(a=>a.getName()===i);if(s)return s.getData()[e][t]}getOrientation(){return this.rawTilemap.orientation}getLayers(){return this.layers}getWidth(){return this.rawTilemap.width}getHeight(){return this.rawTilemap.height}};var Gn=class Gn{constructor(t){this.scene=t;this.geHeadless=new Vs(!1);this.isCreatedInternal=!1;Gn.welcomeMessagePrinted||(console.log(`Using GridEngine Phaser Plugin v${Is}`),Gn.welcomeMessagePrinted=!0),this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this)}getCharLayer(t){return this.geHeadless.getCharLayer(t)}getTransition(t,e){return this.geHeadless.getTransition(t,e)}setTransition(t,e,i){this.geHeadless.setTransition(t,e,i)}create(t,e){this.geHeadless.create(new Gs(t,e.tiledProject),e),this.isCreatedInternal=!0,this.gridCharacters=new Map;let i=this.setConfigDefaults(e);this.config=i,this.gridTilemap=new hi(t),this.addCharacters()}getPosition(t){return this.geHeadless.getPosition(t)}move(t,e){this.geHeadless.move(t,e)}moveRandomly(t,e=0,i=-1){this.geHeadless.moveRandomly(t,e,i)}getMovement(t){return this.geHeadless.getMovement(t)}moveTo(t,e,i){return this.geHeadless.moveTo(t,e,i)}stopMovement(t){this.geHeadless.stopMovement(t)}setSpeed(t,e){this.geHeadless.setSpeed(t,e)}getSpeed(t){return this.geHeadless.getSpeed(t)}setContainer(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setContainer(e)}getContainer(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getContainer()}getOffsetX(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getOffsetX()}setOffsetX(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setOffsetX(e)}getOffsetY(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getOffsetY()}setOffsetY(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.setOffsetY(e)}collidesWithTiles(t){return this.geHeadless.collidesWithTiles(t)}getWalkingAnimationMapping(t){var s;this.initGuard();let e=(s=this.gridCharacters)==null?void 0:s.get(t);if(!e)throw this.createCharUnknownErr(t);let i=e.getAnimation();return i==null?void 0:i.getWalkingAnimationMapping()}hasLayerOverlay(){var t;return this.initGuard(),!!((t=this.config)!=null&&t.layerOverlay)}setWalkingAnimationMapping(t,e){var a;this.initGuard();let i=(a=this.gridCharacters)==null?void 0:a.get(t);if(!i)throw this.createCharUnknownErr(t);let s=i.getAnimation();s==null||s.setWalkingAnimationMapping(e)}update(t,e){if(this.isCreatedInternal&&this.gridCharacters)for(let[i,s]of this.gridCharacters)s.update(e);this.geHeadless.update(t,e)}addCharacter(t){this.geHeadless.addCharacter(t),this.addCharacterInternal(t)}hasCharacter(t){return this.geHeadless.hasCharacter(t)}removeCharacter(t){var i,s;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);e.destroy(),(s=this.gridCharacters)==null||s.delete(t),this.geHeadless.removeCharacter(t)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters){for(let t of this.gridCharacters.keys())this.removeCharacter(t);this.geHeadless.removeAllCharacters()}}getAllCharacters(t){return this.geHeadless.getAllCharacters(t)}getLabels(t){return this.geHeadless.getLabels(t)}addLabels(t,e){this.geHeadless.addLabels(t,e)}removeLabels(t,e){this.geHeadless.removeLabels(t,e)}clearLabels(t){this.geHeadless.clearLabels(t)}follow(t,e,i,s){let a;i===void 0?a={distance:0,closestPointIfBlocked:!1}:typeof i=="number"?(a={distance:i,closestPointIfBlocked:!1},s&&(a.closestPointIfBlocked=!0)):a=i,this.geHeadless.follow(t,e,a)}isMoving(t){return this.geHeadless.isMoving(t)}getFacingDirection(t){return this.geHeadless.getFacingDirection(t)}getFacingPosition(t){return this.geHeadless.getFacingPosition(t)}turnTowards(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);i.turnTowards(e),this.geHeadless.turnTowards(t,e)}getCharactersAt(t,e){return this.geHeadless.getCharactersAt(t,e)}setPosition(t,e,i){this.geHeadless.setPosition(t,e,i)}getSprite(t){var i;this.initGuard();let e=(i=this.gridCharacters)==null?void 0:i.get(t);if(!e)throw this.createCharUnknownErr(t);return e.getSprite()}setSprite(t,e){var s;this.initGuard();let i=(s=this.gridCharacters)==null?void 0:s.get(t);if(!i)throw this.createCharUnknownErr(t);e.setOrigin(0,0),i.setSprite(e)}isBlocked(t,e,i=["geDefault"]){return this.geHeadless.isBlocked(t,e,i)}isTileBlocked(t,e){return this.geHeadless.isTileBlocked(t,e)}getCollisionGroups(t){return this.geHeadless.getCollisionGroups(t)}setCollisionGroups(t,e){this.geHeadless.setCollisionGroups(t,e)}getIgnoreCollisionGroups(t){return this.geHeadless.getIgnoreCollisionGroups(t)}setIgnoreCollisionGroups(t,e){this.geHeadless.setIgnoreCollisionGroups(t,e)}getTilePosInDirection(t,e,i){return this.geHeadless.getTilePosInDirection(t,e,i)}findShortestPath(t,e,i={}){return this.geHeadless.findShortestPath(t,e,i)}steppedOn(t,e,i){return this.geHeadless.steppedOn(t,e,i)}characterShifted(){return this.geHeadless.characterShifted()}movementStarted(){return this.geHeadless.movementStarted()}movementStopped(){return this.geHeadless.movementStopped()}directionChanged(){return this.geHeadless.directionChanged()}positionChangeStarted(){return this.geHeadless.positionChangeStarted()}positionChangeFinished(){return this.geHeadless.positionChangeFinished()}getMovementProgress(t){return this.geHeadless.getMovementProgress(t)}rebuildTileCollisionCache(t,e,i,s){this.geHeadless.rebuildTileCollisionCache(t,e,i,s)}addQueueMovements(t,e,i){this.geHeadless.addQueueMovements(t,e,i)}getEnqueuedMovements(t){return this.geHeadless.getEnqueuedMovements(t)}queueMovementFinished(){return this.geHeadless.queueMovementFinished()}clearEnqueuedMovements(t){return this.geHeadless.clearEnqueuedMovements(t)}getState(){return{characters:this.geHeadless.getState().characters.map(t=>we(it({},t),{offsetX:this.getOffsetX(t.id),offsetY:this.getOffsetY(t.id)}))}}setState(t){if(this.geHeadless.setState(t),this.gridCharacters)for(let e of t.characters){let i=this.gridCharacters.get(e.id);i&&(i.setOffsetX(e.offsetX),i.setOffsetY(e.offsetY))}}getTileCost(t,e,i){return this.initGuard(),this.geHeadless.getTileCost(t,e,i)}setConfigDefaults(t){return it({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",layerOverlay:!1,cacheTileCollisions:!1},t)}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var t;(t=this.config)==null||t.characters.forEach(e=>this.addCharacterInternal(e))}createCharUnknownErr(t){return new Error(`Character unknown: ${t}`)}addCharacterInternal(t){var i;if(this.initGuard(),!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let e=new hs(t,this.scene,this.gridTilemap,this.config.layerOverlay,this.geHeadless);(i=this.gridCharacters)==null||i.set(t.id,e)}};Gn.welcomeMessagePrinted=!1;var Us=Gn;var ID=Us;export{lh as ArrayTilemap,oh as CharacterShiftAction,ls as CollisionStrategy,le as Direction,Us as GridEngine,Vs as GridEngineHeadless,sh as MoveToResult,Ri as NoPathFoundStrategy,Ii as NumberOfDirections,En as PathBlockedStrategy,di as PhaserTile,Vn as PhaserTileLayer,Gs as PhaserTilemap,Zm as QueuedPathBlockedStrategy,jn as TiledLayer,Nn as TiledTile,ph as TiledTilemap,ID as default,Ht as directionFromPos};
/*! Bundled license information:

tiled-property-flattener/dist/tiled_property_flattener.min.js:
  (*! Bundled license information:
  
  lodash/lodash.js:
    (**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     *)
  *)
*/
