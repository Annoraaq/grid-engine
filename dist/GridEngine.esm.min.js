var Lb=Object.create;var oa=Object.defineProperty,Sb=Object.defineProperties,Ob=Object.getOwnPropertyDescriptor,Eb=Object.getOwnPropertyDescriptors,Db=Object.getOwnPropertyNames,yc=Object.getOwnPropertySymbols,Ib=Object.getPrototypeOf,bc=Object.prototype.hasOwnProperty,Mb=Object.prototype.propertyIsEnumerable;var vc=(a,e,r)=>e in a?oa(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r,K=(a,e)=>{for(var r in e||(e={}))bc.call(e,r)&&vc(a,r,e[r]);if(yc)for(var r of yc(e))Mb.call(e,r)&&vc(a,r,e[r]);return a},Bt=(a,e)=>Sb(a,Eb(e));var de=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports);var Ab=(a,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Db(e))!bc.call(a,s)&&s!==r&&oa(a,s,{get:()=>e[s],enumerable:!(o=Ob(e,s))||o.enumerable});return a};var Fo=(a,e,r)=>(r=a!=null?Lb(Ib(a)):{},Ab(e||!a||!a.__esModule?oa(r,"default",{value:a,enumerable:!0}):r,a));var ga=de(Oi=>{var Jb=function(a,e){return a<e?-1:a>e?1:0},Zb=function(a,e){return a<e?1:a>e?-1:0};function tP(a){return function(e,r){return a(r,e)}}function eP(a){return a===2?function(e,r){return e[0]<r[0]?-1:e[0]>r[0]?1:e[1]<r[1]?-1:e[1]>r[1]?1:0}:function(e,r){for(var o=0;o<a;){if(e[o]<r[o])return-1;if(e[o]>r[o])return 1;o++}return 0}}Oi.DEFAULT_COMPARATOR=Jb;Oi.DEFAULT_REVERSE_COMPARATOR=Zb;Oi.reverseComparator=tP;Oi.createTupleComparator=eP});var Wc=de(da=>{da.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer!="undefined";da.SYMBOL_SUPPORT=typeof Symbol!="undefined"});var Ei=de((IC,$c)=>{var zc=Wc(),rP=zc.ARRAY_BUFFER_SUPPORT,iP=zc.SYMBOL_SUPPORT;$c.exports=function(e,r){var o,s,u,h,p;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof r!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||rP&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(u=0,h=e.length;u<h;u++)r(e[u],u);return}if(typeof e.forEach=="function"){e.forEach(r);return}if(iP&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(o=e,u=0;p=o.next(),p.done!==!0;)r(p.value,u),u++;return}for(s in e)e.hasOwnProperty(s)&&r(e[s],s)}});var th=de((MC,Zc)=>{var qc=ga(),Yc=Ei(),Xc=qc.DEFAULT_COMPARATOR,oP=qc.reverseComparator;function Ot(a){if(this.clear(),this.comparator=a||Xc,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.")}Ot.prototype.clear=function(){this.root=null,this.min=null,this.size=0};function nP(a){return{item:a,degree:0}}function Qc(a,e){a.root?(e.right=a.root.right,e.left=a.root,a.root.right.left=e,a.root.right=e):a.root=e}Ot.prototype.push=function(a){var e=nP(a);return e.left=e,e.right=e,Qc(this,e),(!this.min||this.comparator(e.item,this.min.item)<=0)&&(this.min=e),++this.size};Ot.prototype.peek=function(){return this.min?this.min.item:void 0};function Kc(a){for(var e=[],r=a,o=!1;!(r===a&&o);)r===a&&(o=!0),e.push(r),r=r.right;return e}function Jc(a,e){a.root===e&&(a.root=e.right),e.left.right=e.right,e.right.left=e.left}function sP(a,e){a.child?(e.right=a.child.right,e.left=a.child,a.child.right.left=e,a.child.right=e):a.child=e}function aP(a,e,r){Jc(a,e),e.left=e,e.right=e,sP(r,e),r.degree++,e.parent=r}function uP(a){var e=new Array(a.size),r=Kc(a.root),o,s,u,h,p,g;for(o=0,s=r.length;o<s;o++){for(u=r[o],p=u.degree;e[p];)h=e[p],a.comparator(u.item,h.item)>0&&(g=u,u=h,h=g),aP(a,h,u),e[p]=null,p++;e[p]=u}for(o=0;o<a.size;o++)e[o]&&a.comparator(e[o].item,a.min.item)<=0&&(a.min=e[o])}Ot.prototype.pop=function(){if(this.size){var a=this.min;if(a.child){var e=Kc(a.child),r,o,s;for(o=0,s=e.length;o<s;o++)r=e[o],Qc(this,r),delete r.parent}return Jc(this,a),a===a.right?(this.min=null,this.root=null):(this.min=a.right,uP(this)),this.size--,a.item}};Ot.prototype.inspect=function(){var a={size:this.size};return this.min&&"item"in this.min&&(a.top=this.min.item),Object.defineProperty(a,"constructor",{value:Ot,enumerable:!1}),a};typeof Symbol!="undefined"&&(Ot.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ot.prototype.inspect);function mn(a){if(this.clear(),this.comparator=a||Xc,typeof this.comparator!="function")throw new Error("mnemonist/FibonacciHeap.constructor: given comparator should be a function.");this.comparator=oP(this.comparator)}mn.prototype=Ot.prototype;Ot.from=function(a,e){var r=new Ot(e);return Yc(a,function(o){r.push(o)}),r};mn.from=function(a,e){var r=new mn(e);return Yc(a,function(o){r.push(o)}),r};Ot.MinFibonacciHeap=Ot;Ot.MaxFibonacciHeap=mn;Zc.exports=Ot});var ya=de(Te=>{var lP=Math.pow(2,8)-1,cP=Math.pow(2,16)-1,hP=Math.pow(2,32)-1,fP=Math.pow(2,7)-1,pP=Math.pow(2,15)-1,mP=Math.pow(2,31)-1;Te.getPointerArray=function(a){var e=a-1;if(e<=lP)return Uint8Array;if(e<=cP)return Uint16Array;if(e<=hP)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")};Te.getSignedPointerArray=function(a){var e=a-1;return e<=fP?Int8Array:e<=pP?Int16Array:e<=mP?Int32Array:Float64Array};Te.getNumberType=function(a){return a===(a|0)?Math.sign(a)===-1?a<=127&&a>=-128?Int8Array:a<=32767&&a>=-32768?Int16Array:Int32Array:a<=255?Uint8Array:a<=65535?Uint16Array:Uint32Array:Float64Array};var gP={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};Te.getMinimalRepresentation=function(a,e){var r=null,o=0,s,u,h,p,g;for(p=0,g=a.length;p<g;p++)h=e?e(a[p]):a[p],u=Te.getNumberType(h),s=gP[u.name],s>o&&(o=s,r=u);return r};Te.isTypedArray=function(a){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView(a)};Te.concat=function(){var a=0,e,r,o;for(e=0,o=arguments.length;e<o;e++)a+=arguments[e].length;var s=new arguments[0].constructor(a);for(e=0,r=0;e<o;e++)s.set(arguments[e],r),r+=arguments[e].length;return s};Te.indices=function(a){for(var e=Te.getPointerArray(a),r=new e(a),o=0;o<a;o++)r[o]=o;return r}});var ba=de(Di=>{var eh=Ei(),rh=ya();function dP(a){return Array.isArray(a)||rh.isTypedArray(a)}function va(a){if(typeof a.length=="number")return a.length;if(typeof a.size=="number")return a.size}function yP(a){var e=va(a),r=typeof e=="number"?new Array(e):[],o=0;return eh(a,function(s){r[o++]=s}),r}function vP(a){var e=va(a),r=typeof e=="number"?rh.getPointerArray(e):Array,o=typeof e=="number"?new Array(e):[],s=typeof e=="number"?new r(e):[],u=0;return eh(a,function(h){o[u]=h,s[u]=u++}),[o,s]}Di.isArrayLike=dP;Di.guessLength=va;Di.toArray=yP;Di.toArrayWithIndices=vP});var ah=de((FC,sh)=>{var gn=Ei(),ih=ga(),xe=ba(),yn=ih.DEFAULT_COMPARATOR,Pa=ih.reverseComparator;function Ta(a,e,r,o){for(var s=e[o],u,h;o>r;){if(u=o-1>>1,h=e[u],a(s,h)<0){e[o]=h,o=u;continue}break}e[o]=s}function Ii(a,e,r){for(var o=e.length,s=r,u=e[r],h=2*r+1,p;h<o;)p=h+1,p<o&&a(e[h],e[p])>=0&&(h=p),e[r]=e[h],r=h,h=2*r+1;e[r]=u,Ta(a,e,s,r)}function oh(a,e,r){e.push(r),Ta(a,e,0,e.length-1)}function xa(a,e){var r=e.pop();if(e.length!==0){var o=e[0];return e[0]=r,Ii(a,e,0),o}return r}function Wr(a,e,r){if(e.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var o=e[0];return e[0]=r,Ii(a,e,0),o}function nh(a,e,r){var o;return e.length!==0&&a(e[0],r)<0&&(o=e[0],e[0]=r,r=o,Ii(a,e,0)),r}function vr(a,e){for(var r=e.length,o=r>>1,s=o;--s>=0;)Ii(a,e,s)}function wa(a,e){for(var r=e.length,o=0,s=new Array(r);o<r;)s[o++]=xa(a,e);return s}function bP(a,e,r){arguments.length===2&&(r=e,e=a,a=yn);var o=Pa(a),s,u,h,p=1/0,g;if(e===1){if(xe.isArrayLike(r)){for(s=0,u=r.length;s<u;s++)h=r[s],(p===1/0||a(h,p)<0)&&(p=h);return g=new r.constructor(1),g[0]=p,g}return gn(r,function(L){(p===1/0||a(L,p)<0)&&(p=L)}),[p]}if(xe.isArrayLike(r)){if(e>=r.length)return r.slice().sort(a);for(g=r.slice(0,e),vr(o,g),s=e,u=r.length;s<u;s++)o(r[s],g[0])>0&&Wr(o,g,r[s]);return g.sort(a)}var T=xe.guessLength(r);return T!==null&&T<e&&(e=T),g=new Array(e),s=0,gn(r,function(L){s<e?g[s]=L:(s===e&&vr(o,g),o(L,g[0])>0&&Wr(o,g,L)),s++}),g.length>s&&(g.length=s),g.sort(a)}function PP(a,e,r){arguments.length===2&&(r=e,e=a,a=yn);var o=Pa(a),s,u,h,p=-1/0,g;if(e===1){if(xe.isArrayLike(r)){for(s=0,u=r.length;s<u;s++)h=r[s],(p===-1/0||a(h,p)>0)&&(p=h);return g=new r.constructor(1),g[0]=p,g}return gn(r,function(L){(p===-1/0||a(L,p)>0)&&(p=L)}),[p]}if(xe.isArrayLike(r)){if(e>=r.length)return r.slice().sort(o);for(g=r.slice(0,e),vr(a,g),s=e,u=r.length;s<u;s++)a(r[s],g[0])>0&&Wr(a,g,r[s]);return g.sort(o)}var T=xe.guessLength(r);return T!==null&&T<e&&(e=T),g=new Array(e),s=0,gn(r,function(L){s<e?g[s]=L:(s===e&&vr(a,g),a(L,g[0])>0&&Wr(a,g,L)),s++}),g.length>s&&(g.length=s),g.sort(o)}function et(a){if(this.clear(),this.comparator=a||yn,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}et.prototype.clear=function(){this.items=[],this.size=0};et.prototype.push=function(a){return oh(this.comparator,this.items,a),++this.size};et.prototype.peek=function(){return this.items[0]};et.prototype.pop=function(){return this.size!==0&&this.size--,xa(this.comparator,this.items)};et.prototype.replace=function(a){return Wr(this.comparator,this.items,a)};et.prototype.pushpop=function(a){return nh(this.comparator,this.items,a)};et.prototype.consume=function(){return this.size=0,wa(this.comparator,this.items)};et.prototype.toArray=function(){return wa(this.comparator,this.items.slice())};et.prototype.inspect=function(){var a=this.toArray();return Object.defineProperty(a,"constructor",{value:et,enumerable:!1}),a};typeof Symbol!="undefined"&&(et.prototype[Symbol.for("nodejs.util.inspect.custom")]=et.prototype.inspect);function dn(a){if(this.clear(),this.comparator=a||yn,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=Pa(this.comparator)}dn.prototype=et.prototype;et.from=function(a,e){var r=new et(e),o;return xe.isArrayLike(a)?o=a.slice():o=xe.toArray(a),vr(r.comparator,o),r.items=o,r.size=o.length,r};dn.from=function(a,e){var r=new dn(e),o;return xe.isArrayLike(a)?o=a.slice():o=xe.toArray(a),vr(r.comparator,o),r.items=o,r.size=o.length,r};et.siftUp=Ii;et.siftDown=Ta;et.push=oh;et.pop=xa;et.replace=Wr;et.pushpop=nh;et.heapify=vr;et.consume=wa;et.nsmallest=bP;et.nlargest=PP;et.MinHeap=et;et.MaxHeap=dn;sh.exports=et});var fh=de((kC,hh)=>{var uh="";function lh(a,e,r){for(var o=e.length,s=[],u=o,h=-1,p,g=0,T;u--;)h=Math.max(a[e[u]+r],h);for(T=h>>24&&32||h>>16&&24||h>>8&&16||8;g<T;g+=4){for(u=16;u--;)s[u]=[];for(u=o;u--;)s[a[e[u]+r]>>g&15].push(e[u]);for(p=0;p<16;p++)for(h=s[p].length;h--;)e[++u]=s[p][h]}}function TP(a,e,r,o){return a[r]-a[o]||(r%3===2?a[r+1]-a[o+1]||e[r+2]-e[o+2]:e[r+1]-e[o+1])}function Ca(a,e){var r=[],o=[],s=2*e/3|0,u=e-s,h=s+1>>1,p=s,g=0,T,L=[],D=[];if(e===1)return[0];for(;p--;)r[p]=(p*3>>1)+1;for(p=3;p--;)lh(a,r,p);for(g=o[(r[0]/3|0)+(r[0]%3===1?0:h)]=1,p=1;p<s;p++)(a[r[p]]!==a[r[p-1]]||a[r[p]+1]!==a[r[p-1]+1]||a[r[p]+2]!==a[r[p-1]+2])&&g++,o[(r[p]/3|0)+(r[p]%3===1?0:h)]=g;if(g<s)for(o=Ca(o,s),p=s;p--;)r[p]=o[p]<h?o[p]*3+1:(o[p]-h)*3+2;for(p=s;p--;)L[r[p]]=p;for(L[e]=-1,L[e+1]=-2,o=e%3===1?[e-1]:[],p=0;p<s;p++)r[p]%3===1&&o.push(r[p]-1);for(lh(a,o,0),p=0,g=0,T=0;p<s&&g<u;)D[T++]=TP(a,L,r[p],o[g])<0?r[p++]:o[g++];for(;p<s;)D[T++]=r[p++];for(;g<u;)D[T++]=o[g++];return D}function ch(a){var e=a.length,r=e%3,o=new Array(e+r),s,u;if(typeof a!="string"){var h=Object.create(null);for(u=0;u<e;u++)h[a[u]]||(h[a[u]]=!0);var p=Object.create(null),g=Object.keys(h).sort();for(u=0,s=g.length;u<s;u++)p[g[u]]=u+1;for(u=0;u<e;u++)o[u]=p[a[u]]}else for(u=0;u<e;u++)o[u]=a.charCodeAt(u);for(u=e;u<e+r;u++)o[u]=0;return o}function Je(a){this.hasArbitrarySequence=typeof a!="string",this.string=a,this.length=a.length,this.array=Ca(ch(a),this.length)}Je.prototype.toString=function(){return this.array.join(",")};Je.prototype.toJSON=function(){return this.array};Je.prototype.inspect=function(){for(var a=new Array(this.length),e=0;e<this.length;e++)a[e]=this.string.slice(this.array[e]);return Object.defineProperty(a,"constructor",{value:Je,enumerable:!1}),a};typeof Symbol!="undefined"&&(Je.prototype[Symbol.for("nodejs.util.inspect.custom")]=Je.prototype.inspect);function Ze(a){if(this.hasArbitrarySequence=typeof a[0]!="string",this.size=a.length,this.hasArbitrarySequence){this.text=[];for(var e=0,r=this.size;e<r;e++)this.text.push.apply(this.text,a[e]),e<r-1&&this.text.push(uh)}else this.text=a.join(uh);this.firstLength=a[0].length,this.length=this.text.length,this.array=Ca(ch(this.text),this.length)}Ze.prototype.longestCommonSubsequence=function(){var a=this.hasArbitrarySequence?[]:"",e,r,o,s,u;for(r=1;r<this.length;r++)if(s=this.array[r],u=this.array[r-1],!(s<this.firstLength&&u<this.firstLength)&&!(s>this.firstLength&&u>this.firstLength)){for(e=Math.min(this.length-s,this.length-u),o=0;o<e;o++)if(this.text[s+o]!==this.text[u+o]){e=o;break}e>a.length&&(a=this.text.slice(s,s+e))}return a};Ze.prototype.toString=function(){return this.array.join(",")};Ze.prototype.toJSON=function(){return this.array};Ze.prototype.inspect=function(){for(var a=new Array(this.length),e=0;e<this.length;e++)a[e]=this.text.slice(this.array[e]);return Object.defineProperty(a,"constructor",{value:Ze,enumerable:!1}),a};typeof Symbol!="undefined"&&(Ze.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ze.prototype.inspect);Je.GeneralizedSuffixArray=Ze;hh.exports=Je});var mh=de((VC,ph)=>{function we(a){if(typeof a!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=a}typeof Symbol!="undefined"&&(we.prototype[Symbol.iterator]=function(){return this});we.of=function(){var a=arguments,e=a.length,r=0;return new we(function(){return r>=e?{done:!0}:{done:!1,value:a[r++]}})};we.empty=function(){var a=new we(function(){return{done:!0}});return a};we.fromSequence=function(a){var e=0,r=a.length;return new we(function(){return e>=r?{done:!0}:{done:!1,value:a[e++]}})};we.is=function(a){return a instanceof we?!0:typeof a=="object"&&a!==null&&typeof a.next=="function"};ph.exports=we});var vh=de((GC,yh)=>{var gh=mh(),xP=Ei(),wP=ba(),dh=ya(),CP=function(a){return Math.max(1,Math.ceil(a*1.5))},_P=function(a){var e=dh.getPointerArray(a);return new e(a)};function q(a,e){if(arguments.length<1)throw new Error("mnemonist/vector: expecting at least a byte array constructor.");var r=e||0,o=CP,s=0,u=!1;typeof e=="object"&&(r=e.initialCapacity||0,s=e.initialLength||0,o=e.policy||o,u=e.factory===!0),this.factory=u?a:null,this.ArrayClass=a,this.length=s,this.capacity=Math.max(s,r),this.policy=o,this.array=new a(this.capacity)}q.prototype.set=function(a,e){if(this.length<a)throw new Error("Vector("+this.ArrayClass.name+").set: index out of bounds.");return this.array[a]=e,this};q.prototype.get=function(a){if(!(this.length<a))return this.array[a]};q.prototype.applyPolicy=function(a){var e=this.policy(a||this.capacity);if(typeof e!="number"||e<0)throw new Error("mnemonist/vector.applyPolicy: policy returned an invalid value (expecting a positive integer).");if(e<=this.capacity)throw new Error("mnemonist/vector.applyPolicy: policy returned a less or equal capacity to allocate.");return e};q.prototype.reallocate=function(a){if(a===this.capacity)return this;var e=this.array;if(a<this.length&&(this.length=a),a>this.capacity)if(this.factory===null?this.array=new this.ArrayClass(a):this.array=this.factory(a),dh.isTypedArray(this.array))this.array.set(e,0);else for(var r=0,o=this.length;r<o;r++)this.array[r]=e[r];else this.array=e.slice(0,a);return this.capacity=a,this};q.prototype.grow=function(a){var e;if(typeof a=="number"){if(this.capacity>=a)return this;for(e=this.capacity;e<a;)e=this.applyPolicy(e);return this.reallocate(e),this}return e=this.applyPolicy(),this.reallocate(e),this};q.prototype.resize=function(a){return a===this.length?this:a<this.length?(this.length=a,this):(this.length=a,this.reallocate(a),this)};q.prototype.push=function(a){return this.capacity===this.length&&this.grow(),this.array[this.length++]=a,this.length};q.prototype.pop=function(){if(this.length!==0)return this.array[--this.length]};q.prototype.values=function(){var a=this.array,e=this.length,r=0;return new gh(function(){if(r>=e)return{done:!0};var o=a[r];return r++,{value:o,done:!1}})};q.prototype.entries=function(){var a=this.array,e=this.length,r=0;return new gh(function(){if(r>=e)return{done:!0};var o=a[r];return{value:[r++,o],done:!1}})};typeof Symbol!="undefined"&&(q.prototype[Symbol.iterator]=q.prototype.values);q.prototype.inspect=function(){var a=this.array.slice(0,this.length);return a.type=this.array.constructor.name,a.items=this.length,a.capacity=this.capacity,Object.defineProperty(a,"constructor",{value:q,enumerable:!1}),a};typeof Symbol!="undefined"&&(q.prototype[Symbol.for("nodejs.util.inspect.custom")]=q.prototype.inspect);q.from=function(a,e,r){if(arguments.length<3&&(r=wP.guessLength(a),typeof r!="number"))throw new Error("mnemonist/vector.from: could not guess iterable length. Please provide desired capacity as last argument.");var o=new q(e,r);return xP(a,function(s){o.push(s)}),o};function Ce(a){var e=function(o){q.call(this,a,o)};for(var r in q.prototype)q.prototype.hasOwnProperty(r)&&(e.prototype[r]=q.prototype[r]);return e.from=function(o,s){return q.from(o,a,s)},typeof Symbol!="undefined"&&(e.prototype[Symbol.iterator]=e.prototype.values),e}q.Int8Vector=Ce(Int8Array);q.Uint8Vector=Ce(Uint8Array);q.Uint8ClampedVector=Ce(Uint8ClampedArray);q.Int16Vector=Ce(Int16Array);q.Uint16Vector=Ce(Uint16Array);q.Int32Vector=Ce(Int32Array);q.Uint32Vector=Ce(Uint32Array);q.Float32Vector=Ce(Float32Array);q.Float64Vector=Ce(Float64Array);q.PointerVector=Ce(_P);yh.exports=q});var P=class a{static get ZERO(){return new a(0,0)}static get ONE(){return new a(1,1)}static get UP(){return new a(0,-1)}static get DOWN(){return new a(0,1)}static get LEFT(){return new a(-1,0)}static get RIGHT(){return new a(1,0)}static get UP_LEFT(){return new a(-1,-1)}static get UP_RIGHT(){return new a(1,-1)}static get DOWN_RIGHT(){return new a(1,1)}static get DOWN_LEFT(){return new a(-1,1)}constructor(e,r){typeof e=="number"?(this.x=e,this.y=r||0):(this.x=e.x,this.y=e.y)}clone(){return new a(this.x,this.y)}add(e){return new a(this.x+e.x,this.y+e.y)}multiply(e){return new a(this.x*e.x,this.y*e.y)}divide(e){return new a(this.x/e.x,this.y/e.y)}subtract(e){return new a(this.x-e.x,this.y-e.y)}equals(e){return this.x===e.x&&this.y===e.y}abs(){return new a(Math.abs(this.x),Math.abs(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}modulo(e){return new a(this.x%e.x,this.y%e.y)}scalarModulo(e){return new a(this.x%e,this.y%e)}scalarMult(e){return new a(this.x*e,this.y*e)}toPosition(){return{x:this.x,y:this.y}}toString(){return`${this.x}#${this.y}`}};var A=class{static equal(e,r){return e.position.x===r.position.x&&e.position.y===r.position.y&&e.layer===r.layer}static copyOver(e,r){r.position.x=e.position.x,r.position.y=e.position.y,r.layer=e.layer}static clone(e){return{position:e.position.clone(),layer:e.layer}}static toString(e){return`${e.position.toString()}#${e.layer}`}static toInternal(e){return{position:new P(e.position.x,e.position.y),layer:e.charLayer}}static fromInternal(e){return{position:e.position.toPosition(),charLayer:e.layer}}};var At=(T=>(T.NONE="none",T.LEFT="left",T.UP_LEFT="up-left",T.UP="up",T.UP_RIGHT="up-right",T.RIGHT="right",T.DOWN_RIGHT="down-right",T.DOWN="down",T.DOWN_LEFT="down-left",T))(At||{}),Rb={up:"down",down:"up",left:"right",right:"left",none:"none","up-left":"down-right","up-right":"down-left","down-right":"up-left","down-left":"up-right"},Fb={up:P.UP,down:P.DOWN,left:P.LEFT,right:P.RIGHT,none:P.ZERO,"up-left":P.UP_LEFT,"up-right":P.UP_RIGHT,"down-right":P.DOWN_RIGHT,"down-left":P.DOWN_LEFT},bi={up:0,"up-right":1,right:2,"down-right":3,down:4,"down-left":5,left:6,"up-left":7,none:NaN},Pc=["up","up-right","right","down-right","down","down-left","left","up-left"],kb=["down-left","down-right","up-right","up-left"];function Pi(){return["up","down","left","right","none","up-left","up-right","down-right","down-left"]}function fr(a){return kb.includes(a)}function Tc(a,e=1){return a==="none"?"none":Pc[(bi[a]+8-Math.abs(e)%8)%8]}function ko(a,e=1){return a==="none"?"none":Pc[(bi[a]+e)%8]}function Ht(a){return Fb[a]}function Ti(a){return Rb[a]}function Pt(a,e){if(a.x===e.x){if(a.y>e.y)return"up";if(a.y<e.y)return"down"}else if(a.y===e.y){if(a.x>e.x)return"left";if(a.x<e.x)return"right"}else if(a.x>e.x){if(a.y<e.y)return"down-left";if(a.y>e.y)return"up-left"}else if(a.x<e.x){if(a.y<e.y)return"down-right";if(a.y>e.y)return"up-right"}return"none"}var Gr=(r=>(r[r.FOUR=4]="FOUR",r[r.EIGHT=8]="EIGHT",r))(Gr||{});function Qe(a){return typeof a=="string"&&Pi().includes(a)}var na=function(a,e){return na=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])},na(a,e)};function Ke(a,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");na(a,e);function r(){this.constructor=a}a.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function xc(a,e,r,o){function s(u){return u instanceof r?u:new r(function(h){h(u)})}return new(r||(r=Promise))(function(u,h){function p(L){try{T(o.next(L))}catch(D){h(D)}}function g(L){try{T(o.throw(L))}catch(D){h(D)}}function T(L){L.done?u(L.value):s(L.value).then(p,g)}T((o=o.apply(a,e||[])).next())})}function Vo(a,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},o,s,u,h=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return h.next=p(0),h.throw=p(1),h.return=p(2),typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(T){return function(L){return g([T,L])}}function g(T){if(o)throw new TypeError("Generator is already executing.");for(;h&&(h=0,T[0]&&(r=0)),r;)try{if(o=1,s&&(u=T[0]&2?s.return:T[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,T[1])).done)return u;switch(s=0,u&&(T=[T[0]&2,u.value]),T[0]){case 0:case 1:u=T;break;case 4:return r.label++,{value:T[1],done:!1};case 5:r.label++,s=T[1],T=[0];continue;case 7:T=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(T[0]===6||T[0]===2)){r=0;continue}if(T[0]===3&&(!u||T[1]>u[0]&&T[1]<u[3])){r.label=T[1];break}if(T[0]===6&&r.label<u[1]){r.label=u[1],u=T;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(T);break}u[2]&&r.ops.pop(),r.trys.pop();continue}T=e.call(a,r)}catch(L){T=[6,L],s=0}finally{o=u=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}}function ke(a){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&a[e],o=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&o>=a.length&&(a=void 0),{value:a&&a[o++],done:!a}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ye(a,e){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var o=r.call(a),s,u=[],h;try{for(;(e===void 0||e-- >0)&&!(s=o.next()).done;)u.push(s.value)}catch(p){h={error:p}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(h)throw h.error}}return u}function ve(a,e,r){if(r||arguments.length===2)for(var o=0,s=e.length,u;o<s;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return a.concat(u||Array.prototype.slice.call(e))}function pr(a){return this instanceof pr?(this.v=a,this):new pr(a)}function wc(a,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=r.apply(a,e||[]),s,u=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),p("next"),p("throw"),p("return",h),s[Symbol.asyncIterator]=function(){return this},s;function h(M){return function(H){return Promise.resolve(H).then(M,D)}}function p(M,H){o[M]&&(s[M]=function(B){return new Promise(function(st,ft){u.push([M,B,st,ft])>1||g(M,B)})},H&&(s[M]=H(s[M])))}function g(M,H){try{T(o[M](H))}catch(B){Y(u[0][3],B)}}function T(M){M.value instanceof pr?Promise.resolve(M.value.v).then(L,D):Y(u[0][2],M)}function L(M){g("next",M)}function D(M){g("throw",M)}function Y(M,H){M(H),u.shift(),u.length&&g(u[0][0],u[0][1])}}function Cc(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=a[Symbol.asyncIterator],r;return e?e.call(a):(a=typeof ke=="function"?ke(a):a[Symbol.iterator](),r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r);function o(u){r[u]=a[u]&&function(h){return new Promise(function(p,g){h=a[u](h),s(p,g,h.done,h.value)})}}function s(u,h,p,g){Promise.resolve(g).then(function(T){u({value:T,done:p})},h)}}function X(a){return typeof a=="function"}function Go(a){var e=function(o){Error.call(o),o.stack=new Error().stack},r=a(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var No=Go(function(a){return function(r){a(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(o,s){return s+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function xi(a,e){if(a){var r=a.indexOf(e);0<=r&&a.splice(r,1)}}var Nr=(function(){function a(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return a.prototype.unsubscribe=function(){var e,r,o,s,u;if(!this.closed){this.closed=!0;var h=this._parentage;if(h)if(this._parentage=null,Array.isArray(h))try{for(var p=ke(h),g=p.next();!g.done;g=p.next()){var T=g.value;T.remove(this)}}catch(B){e={error:B}}finally{try{g&&!g.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}else h.remove(this);var L=this.initialTeardown;if(X(L))try{L()}catch(B){u=B instanceof No?B.errors:[B]}var D=this._finalizers;if(D){this._finalizers=null;try{for(var Y=ke(D),M=Y.next();!M.done;M=Y.next()){var H=M.value;try{_c(H)}catch(B){u=u!=null?u:[],B instanceof No?u=ve(ve([],ye(u)),ye(B.errors)):u.push(B)}}}catch(B){o={error:B}}finally{try{M&&!M.done&&(s=Y.return)&&s.call(Y)}finally{if(o)throw o.error}}}if(u)throw new No(u)}},a.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)_c(e);else{if(e instanceof a){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},a.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},a.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},a.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&xi(r,e)},a.prototype.remove=function(e){var r=this._finalizers;r&&xi(r,e),e instanceof a&&e._removeParent(this)},a.EMPTY=(function(){var e=new a;return e.closed=!0,e})(),a})();var sa=Nr.EMPTY;function jo(a){return a instanceof Nr||a&&"closed"in a&&X(a.remove)&&X(a.add)&&X(a.unsubscribe)}function _c(a){X(a)?a():a.unsubscribe()}var ae={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var jr={setTimeout:function(a,e){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var s=jr.delegate;return s!=null&&s.setTimeout?s.setTimeout.apply(s,ve([a,e],ye(r))):setTimeout.apply(void 0,ve([a,e],ye(r)))},clearTimeout:function(a){var e=jr.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(a)},delegate:void 0};function Uo(a){jr.setTimeout(function(){var e=ae.onUnhandledError;if(e)e(a);else throw a})}function wi(){}var Lc=(function(){return aa("C",void 0,void 0)})();function Sc(a){return aa("E",void 0,a)}function Oc(a){return aa("N",a,void 0)}function aa(a,e,r){return{kind:a,value:e,error:r}}var mr=null;function Ur(a){if(ae.useDeprecatedSynchronousErrorHandling){var e=!mr;if(e&&(mr={errorThrown:!1,error:null}),a(),e){var r=mr,o=r.errorThrown,s=r.error;if(mr=null,o)throw s}}else a()}function Ec(a){ae.useDeprecatedSynchronousErrorHandling&&mr&&(mr.errorThrown=!0,mr.error=a)}var Ci=(function(a){Ke(e,a);function e(r){var o=a.call(this)||this;return o.isStopped=!1,r?(o.destination=r,jo(r)&&r.add(o)):o.destination=jb,o}return e.create=function(r,o,s){return new Ho(r,o,s)},e.prototype.next=function(r){this.isStopped?la(Oc(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?la(Sc(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?la(Lc,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,a.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Nr);var Vb=Function.prototype.bind;function ua(a,e){return Vb.call(a,e)}var Gb=(function(){function a(e){this.partialObserver=e}return a.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(o){Bo(o)}},a.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(o){Bo(o)}else Bo(e)},a.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){Bo(r)}},a})(),Ho=(function(a){Ke(e,a);function e(r,o,s){var u=a.call(this)||this,h;if(X(r)||!r)h={next:r!=null?r:void 0,error:o!=null?o:void 0,complete:s!=null?s:void 0};else{var p;u&&ae.useDeprecatedNextContext?(p=Object.create(r),p.unsubscribe=function(){return u.unsubscribe()},h={next:r.next&&ua(r.next,p),error:r.error&&ua(r.error,p),complete:r.complete&&ua(r.complete,p)}):h=r}return u.destination=new Gb(h),u}return e})(Ci);function Bo(a){ae.useDeprecatedSynchronousErrorHandling?Ec(a):Uo(a)}function Nb(a){throw a}function la(a,e){var r=ae.onStoppedNotification;r&&jr.setTimeout(function(){return r(a,e)})}var jb={closed:!0,next:wi,error:Nb,complete:wi};var Br=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Wo(a){return a}function ca(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return ha(a)}function ha(a){return a.length===0?Wo:a.length===1?a[0]:function(r){return a.reduce(function(o,s){return s(o)},r)}}var vt=(function(){function a(e){e&&(this._subscribe=e)}return a.prototype.lift=function(e){var r=new a;return r.source=this,r.operator=e,r},a.prototype.subscribe=function(e,r,o){var s=this,u=Bb(e)?e:new Ho(e,r,o);return Ur(function(){var h=s,p=h.operator,g=h.source;u.add(p?p.call(u,g):g?s._subscribe(u):s._trySubscribe(u))}),u},a.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},a.prototype.forEach=function(e,r){var o=this;return r=Dc(r),new r(function(s,u){var h=new Ho({next:function(p){try{e(p)}catch(g){u(g),h.unsubscribe()}},error:u,complete:s});o.subscribe(h)})},a.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},a.prototype[Br]=function(){return this},a.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return ha(e)(this)},a.prototype.toPromise=function(e){var r=this;return e=Dc(e),new e(function(o,s){var u;r.subscribe(function(h){return u=h},function(h){return s(h)},function(){return o(u)})})},a.create=function(e){return new a(e)},a})();function Dc(a){var e;return(e=a!=null?a:ae.Promise)!==null&&e!==void 0?e:Promise}function Ub(a){return a&&X(a.next)&&X(a.error)&&X(a.complete)}function Bb(a){return a&&a instanceof Ci||Ub(a)&&jo(a)}function Hb(a){return X(a==null?void 0:a.lift)}function Ct(a){return function(e){if(Hb(e))return e.lift(function(r){try{return a(r,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Wt(a,e,r,o,s){return new Wb(a,e,r,o,s)}var Wb=(function(a){Ke(e,a);function e(r,o,s,u,h,p){var g=a.call(this,r)||this;return g.onFinalize=h,g.shouldUnsubscribe=p,g._next=o?function(T){try{o(T)}catch(L){r.error(L)}}:a.prototype._next,g._error=u?function(T){try{u(T)}catch(L){r.error(L)}finally{this.unsubscribe()}}:a.prototype._error,g._complete=s?function(){try{s()}catch(T){r.error(T)}finally{this.unsubscribe()}}:a.prototype._complete,g}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;a.prototype.unsubscribe.call(this),!o&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e})(Ci);var Ic=Go(function(a){return function(){a(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var J=(function(a){Ke(e,a);function e(){var r=a.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var o=new Mc(this,this);return o.operator=r,o},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ic},e.prototype.next=function(r){var o=this;Ur(function(){var s,u;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var h=ke(o.currentObservers),p=h.next();!p.done;p=h.next()){var g=p.value;g.next(r)}}catch(T){s={error:T}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}}})},e.prototype.error=function(r){var o=this;Ur(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=r;for(var s=o.observers;s.length;)s.shift().error(r)}})},e.prototype.complete=function(){var r=this;Ur(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var o=r.observers;o.length;)o.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),a.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var o=this,s=this,u=s.hasError,h=s.isStopped,p=s.observers;return u||h?sa:(this.currentObservers=null,p.push(r),new Nr(function(){o.currentObservers=null,xi(p,r)}))},e.prototype._checkFinalizedStatuses=function(r){var o=this,s=o.hasError,u=o.thrownError,h=o.isStopped;s?r.error(u):h&&r.complete()},e.prototype.asObservable=function(){var r=new vt;return r.source=this,r},e.create=function(r,o){return new Mc(r,o)},e})(vt);var Mc=(function(a){Ke(e,a);function e(r,o){var s=a.call(this)||this;return s.destination=r,s.source=o,s}return e.prototype.next=function(r){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.next)===null||s===void 0||s.call(o,r)},e.prototype.error=function(r){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.error)===null||s===void 0||s.call(o,r)},e.prototype.complete=function(){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||o===void 0||o.call(r)},e.prototype._subscribe=function(r){var o,s;return(s=(o=this.source)===null||o===void 0?void 0:o.subscribe(r))!==null&&s!==void 0?s:sa},e})(J);var zo=new vt(function(a){return a.complete()});function Ac(a){return a&&X(a.schedule)}function Rc(a){return a[a.length-1]}function $o(a){return Ac(Rc(a))?a.pop():void 0}function qo(a,e){return typeof Rc(a)=="number"?a.pop():e}var Yo=(function(a){return a&&typeof a.length=="number"&&typeof a!="function"});function Xo(a){return X(a==null?void 0:a.then)}function Qo(a){return X(a[Br])}function Ko(a){return Symbol.asyncIterator&&X(a==null?void 0:a[Symbol.asyncIterator])}function Jo(a){return new TypeError("You provided "+(a!==null&&typeof a=="object"?"an invalid object":"'"+a+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function zb(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Zo=zb();function tn(a){return X(a==null?void 0:a[Zo])}function en(a){return wc(this,arguments,function(){var r,o,s,u;return Vo(this,function(h){switch(h.label){case 0:r=a.getReader(),h.label=1;case 1:h.trys.push([1,,9,10]),h.label=2;case 2:return[4,pr(r.read())];case 3:return o=h.sent(),s=o.value,u=o.done,u?[4,pr(void 0)]:[3,5];case 4:return[2,h.sent()];case 5:return[4,pr(s)];case 6:return[4,h.sent()];case 7:return h.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function rn(a){return X(a==null?void 0:a.getReader)}function Rt(a){if(a instanceof vt)return a;if(a!=null){if(Qo(a))return $b(a);if(Yo(a))return qb(a);if(Xo(a))return Yb(a);if(Ko(a))return Fc(a);if(tn(a))return Xb(a);if(rn(a))return Qb(a)}throw Jo(a)}function $b(a){return new vt(function(e){var r=a[Br]();if(X(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function qb(a){return new vt(function(e){for(var r=0;r<a.length&&!e.closed;r++)e.next(a[r]);e.complete()})}function Yb(a){return new vt(function(e){a.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,Uo)})}function Xb(a){return new vt(function(e){var r,o;try{for(var s=ke(a),u=s.next();!u.done;u=s.next()){var h=u.value;if(e.next(h),e.closed)return}}catch(p){r={error:p}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}e.complete()})}function Fc(a){return new vt(function(e){Kb(a,e).catch(function(r){return e.error(r)})})}function Qb(a){return Fc(en(a))}function Kb(a,e){var r,o,s,u;return xc(this,void 0,void 0,function(){var h,p;return Vo(this,function(g){switch(g.label){case 0:g.trys.push([0,5,6,11]),r=Cc(a),g.label=1;case 1:return[4,r.next()];case 2:if(o=g.sent(),!!o.done)return[3,4];if(h=o.value,e.next(h),e.closed)return[2];g.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return p=g.sent(),s={error:p},[3,11];case 6:return g.trys.push([6,,9,10]),o&&!o.done&&(u=r.return)?[4,u.call(r)]:[3,8];case 7:g.sent(),g.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Zt(a,e,r,o,s){o===void 0&&(o=0),s===void 0&&(s=!1);var u=e.schedule(function(){r(),s?a.add(this.schedule(null,o)):this.unsubscribe()},o);if(a.add(u),!s)return u}function on(a,e){return e===void 0&&(e=0),Ct(function(r,o){r.subscribe(Wt(o,function(s){return Zt(o,a,function(){return o.next(s)},e)},function(){return Zt(o,a,function(){return o.complete()},e)},function(s){return Zt(o,a,function(){return o.error(s)},e)}))})}function nn(a,e){return e===void 0&&(e=0),Ct(function(r,o){o.add(a.schedule(function(){return r.subscribe(o)},e))})}function kc(a,e){return Rt(a).pipe(nn(e),on(e))}function Vc(a,e){return Rt(a).pipe(nn(e),on(e))}function Gc(a,e){return new vt(function(r){var o=0;return e.schedule(function(){o===a.length?r.complete():(r.next(a[o++]),r.closed||this.schedule())})})}function Nc(a,e){return new vt(function(r){var o;return Zt(r,e,function(){o=a[Zo](),Zt(r,e,function(){var s,u,h;try{s=o.next(),u=s.value,h=s.done}catch(p){r.error(p);return}h?r.complete():r.next(u)},0,!0)}),function(){return X(o==null?void 0:o.return)&&o.return()}})}function sn(a,e){if(!a)throw new Error("Iterable cannot be null");return new vt(function(r){Zt(r,e,function(){var o=a[Symbol.asyncIterator]();Zt(r,e,function(){o.next().then(function(s){s.done?r.complete():r.next(s.value)})},0,!0)})})}function jc(a,e){return sn(en(a),e)}function Uc(a,e){if(a!=null){if(Qo(a))return kc(a,e);if(Yo(a))return Gc(a,e);if(Xo(a))return Vc(a,e);if(Ko(a))return sn(a,e);if(tn(a))return Nc(a,e);if(rn(a))return jc(a,e)}throw Jo(a)}function an(a,e){return e?Uc(a,e):Rt(a)}function be(a,e){return Ct(function(r,o){var s=0;r.subscribe(Wt(o,function(u){o.next(a.call(e,u,s++))}))})}function Bc(a,e,r,o,s,u,h,p){var g=[],T=0,L=0,D=!1,Y=function(){D&&!g.length&&!T&&e.complete()},M=function(B){return T<o?H(B):g.push(B)},H=function(B){u&&e.next(B),T++;var st=!1;Rt(r(B,L++)).subscribe(Wt(e,function(ft){s==null||s(ft),u?M(ft):e.next(ft)},function(){st=!0},void 0,function(){if(st)try{T--;for(var ft=function(){var er=g.shift();h?Zt(e,h,function(){return H(er)}):H(er)};g.length&&T<o;)ft();Y()}catch(er){e.error(er)}}))};return a.subscribe(Wt(e,M,function(){D=!0,Y()})),function(){p==null||p()}}function fa(a,e,r){return r===void 0&&(r=1/0),X(e)?fa(function(o,s){return be(function(u,h){return e(o,u,s,h)})(Rt(a(o,s)))},r):(typeof e=="number"&&(r=e),Ct(function(o,s){return Bc(o,s,a,r)}))}function un(a){return a===void 0&&(a=1/0),fa(Wo,a)}function pa(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=$o(a),o=qo(a,1/0),s=a;return s.length?s.length===1?Rt(s[0]):un(o)(an(s,r)):zo}function Tt(a,e){return Ct(function(r,o){var s=0;r.subscribe(Wt(o,function(u){return a.call(e,u,s++)&&o.next(u)}))})}function Ft(a){return a<=0?function(){return zo}:Ct(function(e,r){var o=0;e.subscribe(Wt(r,function(s){++o<=a&&(r.next(s),a<=o&&r.complete())}))})}function Hc(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var r=$o(a),o=qo(a,1/0);return Ct(function(s,u){un(o)(an(ve([s],ye(a)),r)).subscribe(u)})}function ma(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];return Hc.apply(void 0,ve([],ye(a)))}function gt(a){return Ct(function(e,r){Rt(a).subscribe(Wt(r,function(){return r.complete()},wi)),!r.closed&&e.subscribe(r)})}var Ve=1e3,ln=class{constructor(e,r){this.id=e;this.movementDirection="none";this._tilePos={position:new P(0,0),layer:void 0};this.movementStarted$=new J;this.movementStopped$=new J;this.directionChanged$=new J;this.positionChangeStarted$=new J;this.positionChangeFinished$=new J;this.tilePositionSet$=new J;this.autoMovementSet$=new J;this.lastMovementImpulse="none";this.facingDirection="down";this.depthChanged$=new J;this.movementProgress=0;this.currentMovementReverted=!1;var o,s,u;this.tilemap=r.tilemap,this.speed=r.speed,this.collidesWithTilesInternal=r.collidesWithTiles,this._tilePos.layer=r.charLayer,this.ignoreMissingTiles=(o=r.ignoreMissingTiles)!=null?o:!1,this.collisionGroups=new Set(r.collisionGroups||[]),this.ignoreCollisionGroups=new Set(r.ignoreCollisionGroups||[]),this.labels=new Set(r.labels||[]),this.numberOfDirections=r.numberOfDirections,r.facingDirection&&this.turnTowards(r.facingDirection),this.tileWidth=(s=r.tileWidth)!=null?s:1,this.tileHeight=(u=r.tileHeight)!=null?u:1}getId(){return this.id}getSpeed(){return this.speed}setSpeed(e){this.speed=e}setMovement(e){this.autoMovementSet$.next(e),this.movement=e}getMovement(){return this.movement}collidesWithTiles(){return this.collidesWithTilesInternal}setCollidesWithTiles(e){this.collidesWithTilesInternal=e}getIgnoreMissingTiles(){return this.ignoreMissingTiles}setIgnoreMissingTiles(e){this.ignoreMissingTiles=e}setTilePosition(e){this.currentMovementReverted=!1,this.isMoving()&&this.movementStopped$.next(this.movementDirection),this.tilePositionSet$.next(K({},e)),this.fire(this.positionChangeStarted$,this.tilePos,e),this.fire(this.positionChangeFinished$,this.tilePos,e),this.movementDirection="none",this.lastMovementImpulse="none",this.tilePos=e,this.movementProgress=0}getTilePos(){return this.tilePos}getNextTilePos(){if(!this.isMoving())return this.tilePos;if(this.currentMovementReverted)return this.tilePos;let e=this.tilePos.layer,r=this.tilePosInDirection(this.tilePos.position,this.movementDirection),o=this.tilemap.getTransition(r,this.tilePos.layer);return o&&(e=o),{position:this.tilePosInDirection(this.tilePos.position,this.movementDirection),layer:e}}getTileWidth(){return this.tileWidth}getTileHeight(){return this.tileHeight}move(e){this.lastMovementImpulse=e,e!="none"&&(this.isMoving()||(this.isBlockingDirection(e)?this.changeFacingDirection(e):this.startMoving(e)))}update(e){var r;(r=this.movement)==null||r.update(e),this.isMoving()&&this.updateCharacterPosition(e),this.lastMovementImpulse="none"}getMovementDirection(){return this.movementDirection}isBlockingDirection(e){if(e=="none")return!1;let r=this.tilePosInDirection(this.getNextTilePos().position,e),o=this.tilemap.getTransition(r,this.getNextTilePos().layer)||this.getNextTilePos().layer;return this.collidesWithTilesInternal&&this.isTileBlocking(e,o)?!0:this.isCharBlocking(e,o)}isTileBlocking(e,r){return this.someCharTile((o,s)=>{let u=this.tilePosInDirection(new P(o,s),e);return this.tilemap.hasBlockingTile(u,r,Ti(e),this.ignoreMissingTiles)})}revertCurrentMovement(){this.isMoving()&&(this.currentMovementReverted=!0,this.movementDirection=Ti(this.movementDirection),this.movementStopped$.next(this.facingDirection),this.facingDirection=this.movementDirection,this.movementProgress=Ve-this.movementProgress,this.movementStarted$.next(this.facingDirection))}isCurrentMovementReverted(){return this.currentMovementReverted}isCharBlocking(e,r){return this.someCharTile((o,s)=>{let u=this.tilePosInDirection(new P(o,s),e);return this.tilemap.hasBlockingChar(u,r,this.getCollisionGroups(),new Set([this.getId()]),this.ignoreCollisionGroups)})}isMoving(){return this.movementDirection!="none"}turnTowards(e){this.isMoving()||e!="none"&&this.changeFacingDirection(e)}changeFacingDirection(e){this.facingDirection!==e&&(this.facingDirection=e,this.directionChanged$.next(e))}getFacingDirection(){return this.facingDirection}getFacingPosition(){return this._tilePos.position.add(Ht(this.facingDirection))}addCollisionGroup(e){this.collisionGroups.add(e)}setCollisionGroups(e){this.collisionGroups=new Set(e)}setIgnoreCollisionGroups(e){this.ignoreCollisionGroups=new Set(e)}getCollisionGroups(){return Array.from(this.collisionGroups)}getIgnoreCollisionGroups(){return Array.from(this.ignoreCollisionGroups)}hasCollisionGroup(e){return this.collisionGroups.has(e)}removeCollisionGroup(e){this.collisionGroups.delete(e)}removeAllCollisionGroups(){this.collisionGroups.clear()}addLabels(e){for(let r of e)this.labels.add(r)}getLabels(){return[...this.labels.values()]}hasLabel(e){return this.labels.has(e)}clearLabels(){this.labels.clear()}removeLabels(e){for(let r of e)this.labels.delete(r)}getNumberOfDirections(){return this.numberOfDirections}movementStarted(){return this.movementStarted$}movementStopped(){return this.movementStopped$}directionChanged(){return this.directionChanged$}tilePositionSet(){return this.tilePositionSet$}positionChangeStarted(){return this.positionChangeStarted$}positionChangeFinished(){return this.positionChangeFinished$}autoMovementSet(){return this.autoMovementSet$}depthChanged(){return this.depthChanged$}getMovementProgress(){return this.movementProgress}setMovementProgress(e){let r=Math.max(0,Math.min(Ve,e));this.movementProgress=r}hasWalkedHalfATile(){return this.movementProgress>Ve/2}willCrossTileBorderThisUpdate(e){return this.movementProgress+this.maxProgressForDelta(e)>=Ve}updateCharacterPosition(e){let r=this.willCrossTileBorderThisUpdate(e),s=1-(r?Ve-this.movementProgress:this.maxProgressForDelta(e))/this.maxProgressForDelta(e);this.movementProgress=Math.min(this.movementProgress+this.maxProgressForDelta(e),Ve),r&&(this.movementProgress=0,this.shouldContinueMoving()?(this.fire(this.positionChangeFinished$,this.tilePos,this.getNextTilePos()),this.tilePos=this.getNextTilePos(),this.startMoving(this.lastMovementImpulse),s>0&&this.updateCharacterPosition(e*s)):this.stopMoving())}maxProgressForDelta(e){let o=e/1e3;return Math.floor(o*this.speed*Ve)}get tilePos(){return A.clone(this._tilePos)}set tilePos(e){A.copyOver(e,this._tilePos)}startMoving(e){e!=="none"&&(this.currentMovementReverted=!1,e!=this.movementDirection&&this.movementStarted$.next(e),this.movementDirection=e,this.facingDirection=e,this.fire(this.positionChangeStarted$,this.tilePos,this.getNextTilePos()))}tilePosInDirection(e,r){return e.add(Ht(this.tilemap.toMapDirection(r)))}shouldContinueMoving(){return this.lastMovementImpulse!=="none"&&!this.isBlockingDirection(this.lastMovementImpulse)}stopMoving(){if(this.movementDirection==="none")return;let e=this.tilePos,r=this.getNextTilePos(),o=this.movementDirection;this.tilePos=this.getNextTilePos(),this.movementDirection="none",this.movementStopped$.next(o),this.currentMovementReverted=!1,this.fire(this.positionChangeFinished$,e,r)}fire(e,{position:r,layer:o},{position:s,layer:u}){e.next({exitTile:r,enterTile:s,exitLayer:o,enterLayer:u})}someCharTile(e){let r=this.getNextTilePos().position;for(let o=r.x;o<r.x+this.getTileWidth();o++)for(let s=r.y;s<r.y+this.getTileHeight();s++)if(e(o,s))return!0;return!1}};var gr=class gr{constructor(e,r){this.walkingAnimationMapping=e;this.charsInRow=r;this.lastFootLeft=!1;this.directionToFrameRow={down:0,"down-left":1,"down-right":2,left:1,right:2,up:3,"up-left":1,"up-right":2};this._isEnabled=!0;this.frameChange$=new J;this.setWalkingAnimationMapping(e)}frameChange(){return this.frameChange$}setIsEnabled(e){this._isEnabled=e}isEnabled(){return this._isEnabled}updateCharacterFrame(e,r,o){this._isEnabled&&(r?this.setStandingFrameDuringWalk(e,o):this.setWalkingFrame(e))}setStandingFrame(e){this._isEnabled&&this._setStandingFrame(e)}setWalkingAnimationMapping(e){this.walkingAnimationMapping=e,this._isEnabled=this.walkingAnimationMapping!==void 0}getWalkingAnimationMapping(){return this.walkingAnimationMapping}getCharsInRow(){return this.charsInRow}setStandingFrameDuringWalk(e,r){this.isCurrentFrameStanding(e,r)||(this.lastFootLeft=!this.lastFootLeft),this._setStandingFrame(e)}setWalkingFrame(e){let r=this.framesOfDirection(e);r&&this.frameChange$.next(this.lastFootLeft?r.rightFoot:r.leftFoot)}_setStandingFrame(e){let r=this.framesOfDirection(e);r&&this.frameChange$.next(r.standing)}isCurrentFrameStanding(e,r){var o;return r===((o=this.framesOfDirection(e))==null?void 0:o.standing)}framesOfDirection(e){return typeof this.walkingAnimationMapping=="number"?this.getFramesForCharIndex(e,this.walkingAnimationMapping):this.getFramesForAnimationMapping(e)}getFramesForAnimationMapping(e){if(this.walkingAnimationMapping)return this.walkingAnimationMapping[e]||this.walkingAnimationMapping[this.fallbackDirection(e)]}fallbackDirection(e){switch(e){case"down-left":return"left";case"down-right":return"right";case"up-left":return"left";case"up-right":return"right"}return e}getFramesForCharIndex(e,r){var T;let o=Math.floor(r/this.charsInRow),s=r%this.charsInRow,u=this.charsInRow*gr.FRAMES_CHAR_ROW,h=gr.FRAMES_CHAR_ROW*s,p=((T=this.directionToFrameRow[e])!=null?T:0)+o*gr.FRAMES_CHAR_COL,g=h+p*u;return{rightFoot:g,standing:g+1,leftFoot:g+2}}};gr.FRAMES_CHAR_ROW=3,gr.FRAMES_CHAR_COL=4;var _i=gr;var dr=class{static shiftPad(e,r){let o=Math.floor(e),u=`${o}`.padStart(r,"0").length;return o/Math.pow(10,u)}};var ht=class a{static vec2str(e){return`${e.x}#${e.y}`}static equal(e,r){return a.vec2str(e)==a.vec2str(r)}static manhattanDistance(e,r){let o=Math.abs(e.x-r.x),s=Math.abs(e.y-r.y);return o+s}static chebyshevDistance(e,r){let o=Math.abs(e.x-r.x),s=Math.abs(e.y-r.y);return Math.max(o,s)}static scalarMult(e,r){return e.clone().multiply(new P(r,r))}};var te=class te{constructor(e){this.tilemap=e;this.charLayerDepths=new Map;this.setLayerDepths()}getTileWidth(){var r,o;let e=(o=(r=this.tilemap.layers[0])==null?void 0:r.tilemapLayer.scale)!=null?o:1;return this.tilemap.tileWidth*e}getTileHeight(){var r,o;let e=(o=(r=this.tilemap.layers[0])==null?void 0:r.tilemapLayer.scale)!=null?o:1;return this.tilemap.tileHeight*e}getDepthOfCharLayer(e){var r;return(r=this.charLayerDepths.get(e))!=null?r:0}tilePosToPixelPos(e){return this.isIsometric()?ht.scalarMult(this.getTileSize(),.5).multiply(new P(e.x-e.y,e.x+e.y)):e.clone().multiply(this.getTileSize())}getTileDistance(e){if(this.isIsometric())switch(e){case"down-left":case"down-right":case"up-left":case"up-right":return ht.scalarMult(this.getTileSize(),.5);default:return this.getTileSize()}return this.getTileSize()}getTileSize(){return new P(this.getTileWidth(),this.getTileHeight())}isIsometric(){return this.tilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()}isLayerAlwaysOnTop(e){return this.hasLayerProp(e,te.ALWAYS_TOP_PROP_NAME)}isCharLayer(e){return this.hasLayerProp(e,te.CHAR_LAYER_PROP_NAME)}setLayerDepths(){let e=[],r=-1,o=this.tilemap.layers.filter(u=>this.isLayerAlwaysOnTop(u));this.tilemap.layers.filter(u=>!this.isLayerAlwaysOnTop(u)).forEach(u=>{this.hasLayerProp(u,te.HEIGHT_SHIFT_PROP_NAME)?(this.createHeightShiftLayers(u,r),e.push(u.tilemapLayer)):this.setDepth(u,++r)}),this.charLayerDepths.set(void 0,r),o.forEach((u,h)=>{u.tilemapLayer.setDepth(h+1+r)}),e.forEach(u=>u.destroy())}setDepth(e,r){e.tilemapLayer.setDepth(r),this.isCharLayer(e)&&this.charLayerDepths.set(this.getLayerProp(e,te.CHAR_LAYER_PROP_NAME),r)}createHeightShiftLayers(e,r){let o=this.getLayerProp(e,te.HEIGHT_SHIFT_PROP_NAME);isNaN(o)&&(o=0);let s=1;for(let u=0;u<e.height;u++){let h=this.copyLayer(e,u);if(h){h.scale=e.tilemapLayer.scale;let p=this.isIsometric()?this.getTileHeight()/2:this.getTileHeight();h.setDepth(r+dr.shiftPad((u+o)*p+s,te.Z_INDEX_PADDING))}}}getLayerProp(e,r){let s=e.properties.find(u=>u.name==r);return s==null?void 0:s.value}hasLayerProp(e,r){return this.getLayerProp(e,r)!=null}copyLayer(e,r){let o=`${e.name}#${r}`,s=this.tilemap.createBlankLayer(o,e.tilemapLayer.tileset);if(s){if(s.name=o,this.isIsometric())for(let u=r;u>=0;u--){let h=r-u;s.putTileAt(e.data[u][h],h,u)}else for(let u=0;u<e.width;u++)s.putTileAt(e.data[r][u],u,r);return s}}};te.ALWAYS_TOP_PROP_NAME="ge_alwaysTop",te.CHAR_LAYER_PROP_NAME="ge_charLayer",te.HEIGHT_SHIFT_PROP_NAME="ge_heightShift",te.Z_INDEX_PADDING=7;var yr=te;var cn=class{constructor(e,r,o,s,u){this.charData=e;this.scene=r;this.tilemap=o;this.geHeadless=u;this.customOffset=new P(0,0);this.depthOffset=0;this.newSpriteSet$=new J;this.destroy$=new J;var h,p;this.layerOverlaySprite=s&&e.sprite?this.scene.add.sprite(0,0,e.sprite.texture):void 0,this.walkingAnimationMapping=e.walkingAnimationMapping,this.customOffset=new P(e.offsetX||0,e.offsetY||0),this.depthOffset=(h=e.depthOffset)!=null?h:0,this.sprite=e.sprite,this.container=e.container,this.cachedContainerBounds=(p=e.container)==null?void 0:p.getBounds(),this.geHeadless.directionChanged().pipe(Tt(({charId:g})=>g===this.charData.id)).subscribe(({direction:g})=>{var T;(T=this.animation)==null||T.setStandingFrame(g)}),this.sprite&&(this.sprite.setOrigin(0,0),this.resetAnimation(this.sprite),this.updateOverlaySprite(),this.updateGridChar())}destroy(){this.destroy$.next(),this.destroy$.complete(),this.newSpriteSet$.complete()}setSprite(e){e?(this.sprite&&(e.x=this.sprite.x,e.y=this.sprite.y),this.sprite=e,this.newSpriteSet$.next(),this.layerOverlaySprite=this.layerOverlaySprite?this.scene.add.sprite(0,0,this.sprite.texture):void 0,this.updateOverlaySprite(),this.resetAnimation(this.sprite),this.updateDepth()):(this.layerOverlaySprite=void 0,this.sprite=void 0)}getSprite(){return this.sprite}getLayerOverlaySprite(){return this.layerOverlaySprite}setContainer(e){this.container=e,this.cachedContainerBounds=e==null?void 0:e.getBounds()}getContainer(){return this.container}getOffsetX(){return this.customOffset.x}setOffsetX(e){this.customOffset.x=e}getOffsetY(){return this.customOffset.y}setOffsetY(e){this.customOffset.y=e}getWalkingAnimationMapping(){return this.walkingAnimationMapping}turnTowards(e){var r;this.geHeadless.isMoving(this.charData.id)||e!="none"&&(this.geHeadless.turnTowards(this.charData.id,e),(r=this.animation)==null||r.setStandingFrame(e))}getAnimation(){return this.animation}setAnimation(e){this.animation=e}update(e){this.updateGridChar()}getDepthOffset(){return this.depthOffset}getEngineOffset(){var o,s,u,h;if(!this.sprite)return P.ZERO;let e=this.tilemap.getTileWidth()/2-Math.floor(((s=(o=this.sprite)==null?void 0:o.displayWidth)!=null?s:0)/2),r=-((h=(u=this.sprite)==null?void 0:u.displayHeight)!=null?h:0)+this.tilemap.getTileHeight();return new P(e,r)}updatePixelPos(){let e=new P(this.geHeadless.getPosition(this.charData.id));this.geHeadless.isCurrentMovementReverted(this.charData.id)&&(e=new P(this.geHeadless.getTilePosInDirection(this.geHeadless.getPosition(this.charData.id),this.geHeadless.getCharLayer(this.charData.id),Ti(this.geHeadless.getFacingDirection(this.charData.id))).position));let r=this.geHeadless.getMovementProgress(this.charData.id)/1e3,s=this.tilemap.tilePosToPixelPos(e).add(this.getEngineOffset()).add(this.customOffset).add(Ht(this.geHeadless.getFacingDirection(this.charData.id)).multiply(this.tilemap.getTileDistance(this.geHeadless.getFacingDirection(this.charData.id)).scalarMult(r))),u=this.getGameObj();u&&(u.x=Math.floor(s.x),u.y=Math.floor(s.y))}getGameObj(){return this.container||this.sprite}updateGridChar(){var e;if(this.updatePixelPos(),this.sprite&&this.geHeadless.isMoving(this.charData.id)){let r=this.geHeadless.getMovementProgress(this.charData.id)>Ve/2;(e=this.getAnimation())==null||e.updateCharacterFrame(this.geHeadless.getFacingDirection(this.charData.id),r,Number(this.sprite.frame.name))}this.updateDepth()}resetAnimation(e){let r=new _i(this.walkingAnimationMapping,e.texture.source[0].width/e.width/_i.FRAMES_CHAR_ROW);this.setAnimation(r),r.frameChange().pipe(gt(this.newSpriteSet$)).subscribe(o=>{e==null||e.setFrame(o)}),r.setIsEnabled(this.walkingAnimationMapping!==void 0),r.setStandingFrame(this.geHeadless.getFacingDirection(this.charData.id))}updateOverlaySprite(){if(!this.layerOverlaySprite||!this.sprite)return;this.layerOverlaySprite.scale=this.sprite.scale;let e=this.tilemap.getTileHeight()/this.layerOverlaySprite.scale;this.layerOverlaySprite.setCrop(0,0,this.layerOverlaySprite.displayWidth,this.sprite.height-e),this.layerOverlaySprite.setOrigin(0,0)}updateDepth(){if(!this.getGameObj())return;let r=new P(this.geHeadless.getPosition(this.charData.id)),o=this.geHeadless.getCharLayer(this.charData.id);this.container?this.setContainerDepth(this.container,{position:r,layer:o}):this.sprite&&this.setSpriteDepth(this.sprite,{position:r,layer:o});let s=this.getLayerOverlaySprite();if(s){let u=new P(Bt(K({},r),{y:r.y-1}));this.setSpriteDepth(s,{position:u,layer:o})}}setSpriteDepth(e,r){e.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(r))+this.getPaddedPixelDepthSprite(e))}setContainerDepth(e,r){e.setDepth(this.tilemap.getDepthOfCharLayer(this.getTransitionLayer(r))+this.getPaddedPixelDepthContainer(e))}getPaddedPixelDepthContainer(e){var r,o,s,u;return dr.shiftPad(e.y+((o=(r=this.cachedContainerBounds)==null?void 0:r.y)!=null?o:0)+((u=(s=this.cachedContainerBounds)==null?void 0:s.height)!=null?u:0)+this.depthOffset,yr.Z_INDEX_PADDING)}getPaddedPixelDepthSprite(e){return dr.shiftPad(e.y+e.displayHeight+this.depthOffset,yr.Z_INDEX_PADDING)}getTransitionLayer(e){if(e.layer)return this.geHeadless.getTransition(e.position,e.layer)||e.layer}};var hn=(s=>(s.DONT_BLOCK="DONT_BLOCK",s.BLOCK_TWO_TILES="BLOCK_TWO_TILES",s.BLOCK_ONE_TILE_AHEAD="BLOCK_ONE_TILE_AHEAD",s.BLOCK_ONE_TILE_BEHIND="BLOCK_ONE_TILE_BEHIND",s))(hn||{});var Hr=(s=>(s.STOP="STOP",s.CLOSEST_REACHABLE="CLOSEST_REACHABLE",s.RETRY="RETRY",s.ALTERNATIVE_TARGETS="ALTERNATIVE_TARGETS",s))(Hr||{});var fn=class{distance(e,r){return ht.manhattanDistance(e,r)}direction(e,r){if(ht.equal(e,r))return"none";let o=e.clone().subtract(r);return Math.abs(o.x)>Math.abs(o.y)?o.x>0?"left":"right":o.y>0?"up":"down"}neighbors(e){return[new P(e.x,e.y+1),new P(e.x+1,e.y),new P(e.x-1,e.y),new P(e.x,e.y-1)]}getDirections(){return["up","right","down","left"]}};var pn=class{distance(e,r){return ht.chebyshevDistance(e,r)}neighbors(e){let r=[new P(e.x,e.y+1),new P(e.x+1,e.y),new P(e.x-1,e.y),new P(e.x,e.y-1)],o=[new P(e.x+1,e.y+1),new P(e.x+1,e.y-1),new P(e.x-1,e.y+1),new P(e.x-1,e.y-1)];return[...r,...o]}direction(e,r){return r.x>e.x?r.y>e.y?"down-right":r.y<e.y?"up-right":"right":r.x<e.x?r.y>e.y?"down-left":r.y<e.y?"up-left":"left":r.y<e.y?"up":r.y>e.y?"down":"none"}getDirections(){return["up","right","down","left","down-left","down-right","up-right","up-left"]}};var ue=class{static create(e){switch(e){case 4:return new fn;case 8:return new pn}}};var Li=class{constructor(e,r,o){this.backoffMs=e;this.maxRetries=r;this.onFinished=o;this.retries=0;this.elapsed=0}retry(e,r){this.shouldRetry()?(this.elapsed+=e,this.elapsed>=this.backoffMs&&(this.elapsed=0,this.retries++,r())):this.onFinished()}reset(){this.retries=0,this.elapsed=0}getMaxRetries(){return this.maxRetries}getBackoffMs(){return this.backoffMs}shouldRetry(){return this.maxRetries===-1||this.retries<this.maxRetries}};var Si=(o=>(o.WAIT="WAIT",o.RETRY="RETRY",o.STOP="STOP",o))(Si||{});var Pe=class{constructor(e,{shortestPathAlgorithm:r="BFS",pathWidth:o=1,pathHeight:s=1,numberOfDirections:u=4,isPositionAllowed:h=(st,ft)=>!0,collisionGroups:p=[],ignoredChars:g=[],ignoreTiles:T=!1,ignoreMapBounds:L=!1,ignoreBlockedTarget:D=!1,maxPathLength:Y=1/0,ignoreLayers:M=!1,considerCosts:H=!1,calculateClosestToTarget:B=!0}={}){this.gridTilemap=e;this.options={shortestPathAlgorithm:r,pathWidth:o,pathHeight:s,numberOfDirections:u,isPositionAllowed:h,collisionGroups:p,ignoredChars:g,ignoreTiles:T,ignoreMapBounds:L,ignoreBlockedTarget:D,maxPathLength:Y,ignoreLayers:M,considerCosts:H,calculateClosestToTarget:B},this.ignoredCharsSet=new Set(g)}findShortestPath(e,r){this.options.ignoreLayers&&(this.gridTilemap.fixCacheLayer(e.layer),r.layer=e.layer);let o=this.findShortestPathImpl(e,r);return this.gridTilemap.unfixCacheLayers(),o}getNeighbors(e,r){var h;return ue.create((h=this.options.numberOfDirections)!=null?h:4).neighbors(e.position).map(p=>{let g=e.layer;return this.options.ignoreLayers||(g=this.gridTilemap.getTransition(p,e.layer)),{position:p,layer:g||e.layer}}).filter(p=>!this.isBlocking(e,p)||this.options.ignoreBlockedTarget&&A.equal(p,r))}getTransition(e,r){if(!this.options.ignoreLayers)return this.gridTilemap.getTransition(e,r)}getCosts(e,r){if(!this.options.considerCosts)return 1;let o=Pt(r.position,e);return this.gridTilemap.getTileCosts(r,o)}isBlocking(e,r){return!(this.options.ignoreMapBounds||this.gridTilemap.isInRange(r.position))||!this.options.isPositionAllowed(r.position,r.layer)||!this.options.ignoreTiles&&this.hasBlockingTileFrom(e,r,this.options.pathWidth,this.options.pathHeight,this.options.ignoreMapBounds,this.gridTilemap)?!0:this.hasBlockingCharFrom(e,r,this.options.pathWidth,this.options.pathHeight,this.options.collisionGroups,this.ignoredCharsSet,this.gridTilemap)}distance(e,r){return(this.options.numberOfDirections===4?ht.manhattanDistance:ht.chebyshevDistance)(e,r)}getTilePosInDir(e,r){return this.options.ignoreLayers?{position:e.position.add(Ht(this.gridTilemap.toMapDirection(r))),layer:e.layer}:this.gridTilemap.getTilePosInDirection(e,r)}getReverseNeighbors(e,r){var p;let s=ue.create((p=this.options.numberOfDirections)!=null?p:4).neighbors(e.position),u;if(!this.options.ignoreLayers){let g=this.gridTilemap.getReverseTransitions(e.position,e.layer);u=g?[...g]:void 0}return s.map(g=>u?u.map(T=>({position:g,layer:T||e.layer})):[{position:g,layer:e.layer}]).flat().filter(g=>!this.isBlocking(g,e)||this.options.ignoreBlockedTarget&&A.equal(e,r))}hasBlockingCharFrom(e,r,o,s,u,h,p){if(o===1&&s===1)return p.hasBlockingChar(r.position,r.layer,u,h);let g=L=>p.hasBlockingChar(L,r.layer,u,h),T=Pt(e.position,r.position);return this.isBlockingMultiTile(e,T,o,s,g)}hasBlockingTileFrom(e,r,o,s,u,h){if(o===1&&s===1)return h.hasBlockingTile(r.position,r.layer,Pt(r.position,e.position),u);let p=Pt(e.position,r.position),g=T=>h.hasBlockingTile(T,r.layer,p,u);return this.isBlockingMultiTile(e,p,o,s,g)}isBlockingMultiTile(e,r,o,s,u){let h={src:new P(e.position.x+o,e.position.y),dest:new P(e.position.x+o,e.position.y+s-1)},p={src:new P(e.position.x-1,e.position.y),dest:new P(e.position.x-1,e.position.y+s-1)},g={src:new P(e.position.x,e.position.y-1),dest:new P(e.position.x+o-1,e.position.y-1)},T={src:new P(e.position.x,e.position.y+s),dest:new P(e.position.x+o-1,e.position.y+s)};switch(r){case"right":return this.checkLine(h,u);case"left":return this.checkLine(p,u);case"up":return this.checkLine(g,u);case"down":return this.checkLine(T,u);case"up-left":return this.checkLine({src:g.src,dest:new P(g.dest.x-1,g.dest.y)},u)||this.checkLine({src:new P(p.src.x,p.src.y-1),dest:new P(p.dest.x,p.dest.y-1)},u);case"up-right":return this.checkLine({src:new P(g.src.x+1,g.src.y),dest:g.dest},u)||this.checkLine({src:new P(h.src.x,h.src.y-1),dest:new P(h.dest.x,h.dest.y-1)},u);case"down-left":return this.checkLine({src:new P(p.src.x,p.src.y+1),dest:new P(p.dest.x,p.dest.y+1)},u)||this.checkLine({src:T.src,dest:new P(T.dest.x-1,T.dest.y)},u);case"down-right":return this.checkLine({src:new P(T.src.x+1,T.src.y),dest:T.dest},u)||this.checkLine({src:new P(h.src.x,h.src.y+1),dest:new P(h.dest.x,h.dest.y+1)},u)}return!1}checkLine(e,r){for(let o=e.src.x;o<=e.dest.x;o++)for(let s=e.src.y;s<=e.dest.y;s++)if(r(new P(o,s)))return!0;return!1}};var _a=Fo(th(),1),La=Fo(ah(),1),bh=Fo(fh(),1),le=Fo(vh(),1);var Mi=_a.default.MinFibonacciHeap,NC=_a.default.MaxFibonacciHeap,jC=La.default.MinHeap,UC=La.default.MaxHeap,BC=bh.default.GeneralizedSuffixArray,HC=le.default.Uint8Vector,WC=le.default.Uint8ClampedVector,zC=le.default.Int8Vector,$C=le.default.Uint16Vector,qC=le.default.Int16Vector,YC=le.default.Uint32Vector,XC=le.default.Int32Vector,QC=le.default.Float32Vector,KC=le.default.Float64Vector,JC=le.default.PointerVector;var vn=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"A_STAR"}}shortestPathBfs(e,r){let o=new Map,s=new Map,u=new Map,h=new Mi((L,D)=>Ai(u,L)-Ai(u,D)),p=e,g=this.distance(e.position,r.position),T=0;for(h.push(e),s.set(A.toString(e),0),u.set(A.toString(e),this.distance(e.position,r.position));h.size>0;){let L=h.pop();if(!L)break;T++;let D=this.distance(L.position,r.position);if(D<g&&(g=D,p=L),Ph(L,r))return{previous:o,closestToTarget:p,steps:T,maxPathLengthReached:!1};if(Ai(s,L)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:p,steps:T,maxPathLengthReached:!0};for(let Y of this.getNeighbors(L,r)){let M=Ai(s,L)+this.getCosts(L.position,Y),H=A.toString(Y);(!s.has(H)||M<Ai(s,Y))&&(o.set(H,L),s.set(H,M),u.set(H,M+this.distance(Y.position,r.position)),h.push(Y))}}return{previous:o,closestToTarget:p,steps:T,maxPathLengthReached:!1}}returnPath(e,r,o){let s=[],u=o;for(s.push(u);!Ph(u,r);){if(u=e.get(A.toString(u)),!u)return[];s.push(u)}return s.reverse()}};function Ai(a,e){var r;return(r=a.get(A.toString(e)))!=null?r:Number.MAX_VALUE}function Ph(a,e){return ht.equal(a.position,e.position)?a.layer===e.layer:!1}var bn=class{constructor(e){this.data=e}},Ge=class{constructor(){this.sizeInternal=0}dequeue(){if(this.tail===void 0)return;this.sizeInternal--;let e=this.tail.data;return this.tail.prev===void 0?(this.tail=void 0,this.head=void 0,e):(this.tail.prev.next=void 0,this.tail=this.tail.prev,e)}enqueue(e){if(this.sizeInternal++,this.head===void 0){this.head=new bn(e),this.tail=this.head;return}let r=new bn(e);r.next=this.head,this.head.prev=r,this.head=r}peek(){return this.tail?this.tail.data:void 0}peekAll(){let e=[],r=this.tail;for(;r;)e.push(r.data),r=r.prev;return e}clear(){this.head=void 0,this.tail=void 0,this.sizeInternal=0}peekEnd(){var e;return(e=this.head)==null?void 0:e.data}size(){return this.sizeInternal}};var zr=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"BFS"}}equal(e,r){return ht.equal(e.position,r.position)?e.layer===r.layer:!1}shortestPathBfs(e,r){let o=new Map,s=new Set,u=new Ge,h=e,p=this.distance(e.position,r.position),g=0;for(u.enqueue({node:e,dist:0}),s.add(A.toString(e));u.size()>0;){let T=u.dequeue();if(g++,!T)break;let{node:L,dist:D}=T;if(D>this.options.maxPathLength)return{previous:new Map,closestToTarget:h,steps:g,maxPathLengthReached:!0};let Y=this.distance(L.position,r.position);if(Y<p&&(p=Y,h=L),this.equal(L,r))return{previous:o,closestToTarget:h,steps:g,maxPathLengthReached:!1};for(let M of this.getNeighbors(L,r))s.has(A.toString(M))||(o.set(A.toString(M),L),u.enqueue({node:M,dist:D+1}),s.add(A.toString(M)))}return{previous:o,closestToTarget:h,steps:g,maxPathLengthReached:!1}}returnPath(e,r,o){let s=[],u=o;for(s.push(u);!this.equal(u,r);){if(u=e.get(A.toString(u)),!u)return[];s.push(u)}return s.reverse()}};var Pn=class{constructor(){this.previous=new Map;this.visited=new Map;this.queue=new Ge;this.minMatching=1/0;this.lastDist=0}isNewFrontier(){let e=this.queue.peek();return!!(e&&e.dist>this.lastDist)}step(e,r,o){var s;this.lastDist=o;for(let u of e){let h=A.toString(u);if(!this.visited.has(h)){this.previous.set(h,r),this.queue.enqueue({node:u,dist:o+1}),this.visited.set(h,o+1);let p=(s=this.otherBfs)==null?void 0:s.visited.get(h);p!==void 0&&p<this.minMatching&&(this.minMatching=p,this.minMatchingNode=u)}}}},Tn=class extends Pe{findShortestPathImpl(e,r){let o=this.shortestPathBfs(e,r);return{path:this.returnPath(o.previous,o.previous2,o.matchingPos,e,r),closestToTarget:o.closestToTarget,steps:o.steps,maxPathLengthReached:o.maxPathLengthReached,algorithmUsed:"BIDIRECTIONAL_SEARCH"}}equal(e,r){return ht.equal(e.position,r.position)?e.layer===r.layer:!1}shortestPathBfs(e,r){var g;if(A.equal(e,r))return{previous:new Map,previous2:new Map,closestToTarget:e,steps:0,maxPathLengthReached:!1};let o=new Pn,s=new Pn,u=0;o.otherBfs=s,s.otherBfs=o;let h=e,p=this.distance(e.position,r.position);for(o.queue.enqueue({node:e,dist:0}),s.queue.enqueue({node:r,dist:0}),o.visited.set(A.toString(e),0),s.visited.set(A.toString(r),0);this.shouldStop(o.queue.size()>0,s.queue.size()>0);){let T=o.queue.dequeue();if(!T)break;let{node:L,dist:D}=T;if(D+1+(((g=s.queue.peek())==null?void 0:g.dist)||0)>this.options.maxPathLength)return{previous:o.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(h),steps:u,maxPathLengthReached:!0};let Y=this.distance(L.position,r.position);if(Y<p&&(p=Y,h=L),u++,o.step(this.getNeighbors(L,r),L,D),o.isNewFrontier()&&o.minMatchingNode)return{previous:o.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(r),matchingPos:o.minMatchingNode,steps:u,maxPathLengthReached:!1};let M=s.queue.dequeue();if(!M)continue;let{node:H,dist:B}=M;if(u++,s.step(this.getReverseNeighbors(H,r),H,B),s.isNewFrontier()&&s.minMatchingNode)return{previous:o.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(r),matchingPos:s.minMatchingNode,steps:u,maxPathLengthReached:!1}}return{previous:o.previous,previous2:s.previous,closestToTarget:this.maybeClosestToTarget(h),steps:u,maxPathLengthReached:!1}}shouldStop(e,r){return this.options.calculateClosestToTarget?e||r:e&&r}maybeClosestToTarget(e){return this.options.calculateClosestToTarget?e:void 0}returnPath(e,r,o,s,u){if(o){let h=this.getPathFromPrev(e,s,o).reverse(),p=this.getPathFromPrev(r,u,o);return h.pop(),[...h,...p]}else return this.getPathFromPrev(e,s,u).reverse()}getPathFromPrev(e,r,o){let s=[],u=o;for(s.push(u);!this.equal(u,r);){if(u=e.get(A.toString(u)),!u)return[];s.push(u)}return s}};var $r=class extends Pe{constructor(r,o={}){super(r,o);this.openSet=new Mi;this.g=new Map;this.f=new Map;this.closestToTarget={position:new P(0,0),layer:void 0};this.smallestDistToTarget=0;this.steps=0;this.visits=[];this.maxFrontierSize=0;this.maxJumpSize=0}findShortestPathImpl(r,o){this.maxJumpSize=this.distance(r.position,o.position);let s=this.shortestPath(r,o);return{path:this.returnPath(s.previous,r,o),closestToTarget:s.closestToTarget,steps:s.steps,maxPathLengthReached:s.maxPathLengthReached,algorithmUsed:"JPS"}}shortestPath(r,o){this.steps=0;let s=new Map;this.g=new Map,this.f=new Map,this.closestToTarget=r,this.smallestDistToTarget=this.distance(r.position,o.position),this.openSet=new Mi((h,p)=>Ri(this.f,h)-Ri(this.f,p)),this.openSet.push(r);let u=A.toString(r);for(this.g.set(u,0),this.f.set(u,this.distance(r.position,o.position)),this.maxFrontierSize=Math.max(this.maxFrontierSize,this.openSet.size);this.openSet.size>0;){let h=this.openSet.pop();if(!h)break;if(this.steps++,A.equal(h,o))return{previous:s,closestToTarget:o,steps:this.steps,maxPathLengthReached:!1};if(Ri(this.g,h)+1>this.options.maxPathLength)return{previous:new Map,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!0};this.updateClosestToTarget(h,o);for(let p of this.getNeighborsInternal(h,s.get(A.toString(h)),o)){let g=A.toString(p.p),T=Ri(this.g,h)+p.dist;(!this.g.has(g)||T<Ri(this.g,p.p))&&(s.set(g,h),this.g.set(g,T),this.f.set(g,T+this.distance(p.p.position,o.position)),this.openSet.push(p.p))}}return{previous:s,closestToTarget:this.closestToTarget,steps:this.steps,maxPathLengthReached:!1}}updateClosestToTarget(r,o){let s=this.distance(r.position,o.position);s<this.smallestDistToTarget&&(this.smallestDistToTarget=s,this.closestToTarget=r)}addIfNotBlocked(r,o,s){this.blockOrTrans(o,s)||r.push(s)}blockOrTrans(r,o){return this.isBlocking(r,o)||this.getTransition(o.position,o.layer)!==void 0}getNeighborsInternal(r,o,s){if(!o||r.layer!==o.layer)return this.getNeighbors(r,s).map(p=>({p,dist:1}));let u=this.prune(o,r).filter(p=>!this.isBlockingIgnoreTarget(r,p,s)).map(p=>{let g=this.getTransition(p.position,r.layer);return{position:p.position,layer:g||r.layer}}),h=[];for(let p of u)if(this.isHorizontal(r.position,p.position))h.push({p,dist:1});else{let g=this.jump(r,p,s,1,Pt(r.position,p.position));g&&h.push(g)}return h}isBlockingIgnoreTarget(r,o,s){return this.isBlocking(r,o)&&!(this.options.ignoreBlockedTarget&&A.equal(o,s))}jump(r,o,s,u,h){if(!this.isBlockingIgnoreTarget(r,o,s))return A.equal(o,s)?{p:o,dist:u}:u>=this.maxJumpSize?{p:o,dist:u}:this.getTransition(o.position,r.layer)!==void 0?{p:o,dist:u}:this.hasForced(r,o)?{p:o,dist:u}:(this.updateClosestToTarget(o,s),this.jump(o,this.getTilePosInDir(o,h),s,u+1,h))}isHorizontal(r,o){return r.y===o.y}getForced(r,o,s,u,h,p){let g=[],T=r;return(this.blockOrTrans(T,s)||this.blockOrTrans(s,u))&&this.addIfNotBlocked(g,o,u),(this.blockOrTrans(T,h)||this.blockOrTrans(h,p))&&this.addIfNotBlocked(g,o,p),g}hasForced(r,o){let{topLeft:s,downLeft:u,top:h,bottom:p}=this.normalizedPositions(r,o);return!!((this.blockOrTrans(r,u)||this.blockOrTrans(u,p))&&!this.blockOrTrans(o,p)||(this.blockOrTrans(r,s)||this.blockOrTrans(s,h))&&!this.blockOrTrans(o,h))}prune(r,o){let{right:s,top:u,bottom:h,downLeft:p,topLeft:g}=this.normalizedPositions(r,o);return this.isHorizontal(r.position,o.position)?[s,u,h]:[s,...this.getForced(r,o,p,h,g,u)]}normalizedPositions(r,o){return r.position.x<o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y),layer:o.layer}}:r.position.x>o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y),layer:o.layer}}:r.position.y<o.position.y?{topLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y+1),layer:o.layer}}:{topLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y-1),layer:o.layer}}}posInDir(r,o){return{position:r.position.add(Ht(o)),layer:r.layer}}returnPath(r,o,s){let u=[],h=s;for(u.push(h);!A.equal(h,o);){let p=r.get(A.toString(h));if(!p)return[];this.distance(p.position,h.position)>1?this.fillPath(h,p,u):u.push(p),h=p}return u.reverse()}fillPath(r,o,s){let u=r;do{let h=Pt(u.position,o.position);u=this.getTilePosInDir(u,h),s.push(u)}while(!ht.equal(u.position,o.position))}};function Ri(a,e){var r;return(r=a.get(A.toString(e)))!=null?r:Number.MAX_VALUE}var xn=class{constructor(e,r,o,s={}){this.character=e;this.gridTilemap=r;this.charToFollow=o;let u={distance:0,noPathFoundStrategy:"STOP",maxPathLength:1/0,shortestPathAlgorithm:"BIDIRECTIONAL_SEARCH",ignoreLayers:!1,considerCosts:s.considerCosts||!1,facingDirection:"none",isPositionAllowedFn:()=>!0,ignoredChars:[]};this.options=K(K({},u),s),this.options.considerCosts&&this.options.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.options.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.options.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1")}init(){this.updateTarget(this.charToFollow.getTilePos().position,this.charToFollow.getTilePos().layer),this.charToFollow.positionChangeStarted().pipe(gt(this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)))).subscribe(({enterTile:e,enterLayer:r})=>{this.updateTarget(e,r)})}update(e){var r;(r=this.targetMovement)==null||r.update(e)}getInfo(){return{type:"Follow",config:{charToFollow:this.charToFollow.getId(),distance:this.options.distance,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,facingDirection:this.options.facingDirection,shortestPathAlgorithm:this.options.shortestPathAlgorithm,considerCosts:this.options.considerCosts,isPositionAllowedFn:this.options.isPositionAllowedFn,ignoredChars:this.options.ignoredChars}}}getFacingPos(){let e=bi[this.options.facingDirection]+bi[this.charToFollow.getFacingDirection()],r=ko("up",e),o={x:this.charToFollow.getTilePos().position.x,y:this.charToFollow.getTilePos().position.y};return r==="right"?o.x+=this.charToFollow.getTileWidth()-1:r==="down"?o.y+=this.charToFollow.getTileWidth()-1:r==="down-left"?o.y+=this.charToFollow.getTileWidth()-1:r==="down-right"?(o.y+=this.charToFollow.getTileWidth()-1,o.x+=this.charToFollow.getTileWidth()-1):r==="up-right"&&(o.x+=this.charToFollow.getTileWidth()-1),this.gridTilemap.getTilePosInDirection({position:new P(o),layer:this.charToFollow.getTilePos().layer},r).position}updateTarget(e,r){let o=this.options.facingDirection!=="none"&&this.options.distance===0;o&&(e=this.getFacingPos()),this.targetMovement=new qr(this.character,this.gridTilemap,{position:new P(e),layer:r},{distance:o?0:this.options.distance+1,config:{algorithm:this.options.shortestPathAlgorithm,noPathFoundStrategy:this.options.noPathFoundStrategy,maxPathLength:this.options.maxPathLength,ignoreLayers:this.options.ignoreLayers,considerCosts:this.options.considerCosts,ignoredChars:[this.charToFollow.getId(),...this.options.ignoredChars],isPositionAllowedFn:this.options.isPositionAllowedFn}}),this.targetMovement.init()}};var Fi=class{static getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}};var wn=class{constructor(e,r=0,o=-1){this.character=e;this.delay=r;this.radius=o;this.stepSize=0;this.delayLeft=this.delay,this.initialRow=e.getNextTilePos().position.y,this.initialCol=e.getNextTilePos().position.x,this.randomizeStepSize(),this.stepsWalked=0,this.currentMovementDirection="none",this.character.positionChangeStarted().pipe(gt(this.character.autoMovementSet().pipe(Tt(s=>s!==this),Ft(1)))).subscribe(()=>{this.stepsWalked++}),this.distanceUtils=ue.create(e.getNumberOfDirections())}init(){}update(e){if(this.shouldContinueWalkingCurrentDirection())this.character.move(this.currentMovementDirection);else if(this.delayLeft-=e,this.delayLeft<=0){this.delayLeft=this.delay;let r=this.getFreeRandomDirection();this.stepsWalked=0,this.character.move(r),this.currentMovementDirection=r,this.randomizeStepSize()}}getInfo(){return{type:"Random",config:{delay:this.delay,radius:this.radius}}}shouldContinueWalkingCurrentDirection(){return this.stepsWalked<this.stepSize&&this.currentMovementDirection!=="none"&&!this.character.isBlockingDirection(this.currentMovementDirection)&&this.isWithinRadius(this.currentMovementDirection)}getFreeDirections(){return this.distanceUtils.getDirections().filter(r=>!this.character.isBlockingDirection(r)).filter(r=>this.isWithinRadius(r))}isWithinRadius(e){return this.radius==-1?!0:this.getDist(e)<=this.radius}getDist(e){return this.distanceUtils.distance(this.character.getNextTilePos().position.add(Ht(e)),new P(this.initialCol,this.initialRow))}getFreeRandomDirection(){let e=this.getFreeDirections();return e.length==0?"none":e[Fi.getRandomInt(e.length)]}randomizeStepSize(){this.stepSize=Fi.getRandomInt(this.radius)+1}};function Th(a,e){return a.filter(r=>{var o,s,u,h,p,g;return(o=e.labels)!=null&&o.withAllLabels?(s=e.labels)==null?void 0:s.withAllLabels.every(T=>r.hasLabel(T)):(u=e.labels)!=null&&u.withOneOfLabels?(h=e.labels)==null?void 0:h.withOneOfLabels.some(T=>r.hasLabel(T)):(p=e.labels)!=null&&p.withNoneLabels?!((g=e.labels)!=null&&g.withNoneLabels.some(T=>r.hasLabel(T))):!0})}var Cn="2.48.0";var _n=class{constructor(e,r){this.collistionStrategy=e;this.collisionGroupRelation=r;this.tilePosToCharacters=new Sa;this.charRemoved$=new J}isCharBlockingAt(e,r,o,s=new Set,u=new Set){if(o.length===0)return!1;let h=this.tilePosToCharacters.get(e,r);return!!(h&&h.size>0&&[...h].filter(p=>!s.has(p.getId())).filter(p=>!this.doIntersect(p.getCollisionGroups(),u)).some(p=>o.some(g=>p.getCollisionGroups().some(T=>this.collidesWith(g,T)))))}doIntersect(e,r){for(let o of e)if(r.has(o))return!0;return!1}collidesWith(e,r){return this.collisionGroupRelation?(this.collisionGroupRelation.get(e)||new Set).has(r):e===r}getCharactersAt(e,r){return this.tilePosToCharacters.get(e,r)||new Set}addCharacter(e){this.addTilePositions(e.getTilePos(),e),this.addTilePositions(e.getNextTilePos(),e),this.addPositionChangeSub(e),this.addPositionChangeFinishedSub(e),this.addTilePosSetSub(e)}removeCharacter(e){let r=e.getId();this.charRemoved$.next(r),this.deleteTilePositions(e.getTilePos(),e),this.deleteTilePositions(e.getNextTilePos(),e)}add(e,r,o){let s=this.tilePosToCharacters.get(e,r);s||this.tilePosToCharacters.set(e,r,new Set([o])),s==null||s.add(o)}addTilePosSetSub(e){e.tilePositionSet().pipe(gt(this.charRemoved(e.getId()))).subscribe(r=>{this.deleteTilePositions(e.getNextTilePos(),e),this.addTilePositions(r,e)})}charRemoved(e){var r;return(r=this.charRemoved$)==null?void 0:r.pipe(Ft(1),Tt(o=>o==e))}addPositionChangeSub(e){e.positionChangeStarted().pipe(gt(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(r=>{this.collistionStrategy==="BLOCK_ONE_TILE_AHEAD"&&this.deleteTilePositions(r.exit,e),this.addTilePositions(r.enter,e)})}addPositionChangeFinishedSub(e){e.positionChangeFinished().pipe(gt(this.charRemoved(e.getId())),this.posChangeToLayerPos()).subscribe(r=>{this.deleteTilePositions(r.exit,e),this.addTilePositions(r.enter,e)})}addTilePositions(e,r){this.forEachCharTile(e,r,(o,s)=>{this.add(new P(o,s),e.layer,r)})}deleteTilePositions(e,r){this.forEachCharTile(e,r,(o,s)=>{var u;(u=this.tilePosToCharacters.get(new P(o,s),e.layer))==null||u.delete(r)})}forEachCharTile(e,r,o){let s=e.position;for(let u=s.x;u<s.x+r.getTileWidth();u++)for(let h=s.y;h<s.y+r.getTileHeight();h++)o(u,h)}posChangeToLayerPos(){return ca(be(e=>({enter:{position:new P(e.enterTile),layer:e.enterLayer},exit:{position:new P(e.exitTile),layer:e.exitLayer}})))}posToString(e,r){return`${e.x}#${e.y}#${r}`}},Sa=class{constructor(){this.memo=new Map}set(e,r,o){let s=this.memo.get(e.x);s||(s=new Map,this.memo.set(e.x,s));let u=s.get(e.y);u||(u=new Map,s.set(e.y,u)),u.set(r,o)}get(e,r){let o=this.memo.get(e.x);if(!o)return;let s=o.get(e.y);if(s)return s.get(r)}};var tr=class{constructor(e,r,o,s){this.x=e;this.y=r;this.width=o;this.height=s}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}isInRange(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}};var Yr="ge_charLayer";var xh=0,SP=1,Oa={none:1,left:2,"up-left":3,up:4,"up-right":5,right:6,"down-right":7,down:8,"down-left":9},Sn=class{constructor(e,r){this.tilemap=e;this.gridTilemap=r;this.tileCollisionCache=new Map}fixLayer(e){this.fixedLayer=this.tileCollisionCache.get(e)}unfixLayers(){this.fixedLayer=void 0}rebuild(e){e||(e=new tr(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()));let r=this.tilemap.getLayers().filter(o=>o.isCharLayer());for(let o of[...r,void 0]){let s=this.tileCollisionCache.get(o==null?void 0:o.getName());if(s===void 0){s=new Array(this.tilemap.getWidth());for(let u=0;u<this.tilemap.getWidth();u++)s[u]=new Array(this.tilemap.getHeight());this.tileCollisionCache.set(o==null?void 0:o.getName(),s)}for(let u=e.getY();u<e.getY()+e.getHeight();u++)for(let h=e.getX();h<e.getX()+e.getWidth();h++){let p=0;!this.gridTilemap.hasNoTileUncached(new P(h,u),o==null?void 0:o.getName())&&(p=Ea(p,0));for(let L of Pi())this.gridTilemap.hasBlockingTileUncached(new P(h,u),o==null?void 0:o.getName(),L,!0)&&(p=Ea(p,Oa[L]));this.gridTilemap.hasBlockingTileUncached(new P(h,u),o==null?void 0:o.getName(),void 0,!0)&&(p=Ea(p,Oa[1])),s[h][u]=p}}}hasTileAt(e,r,o){var h;let s=this.fixedLayer||this.tileCollisionCache.get(o),u=(h=s==null?void 0:s[e])==null?void 0:h[r];if(u!==void 0)return Ln(u,xh)}isBlockingFrom(e,r,o,s,u){var g;let h=this.fixedLayer||this.tileCollisionCache.get(o),p=(g=h==null?void 0:h[e])==null?void 0:g[r];if(p!==void 0)return!u&&!Ln(p,xh)?!0:s===void 0?Ln(p,SP):Ln(p,Oa[s])}};function Ea(a,e){return a|1<<e}function Ln(a,e){return(a>>e&1)==1}var wh="ge_cost",En=class En{constructor(e,r,o,s=void 0,u=!1){this.tilemap=e;this.collisionTilePropertyName=r;this.useTileCollisionCache=u;this.characters=new Map;this.transitions=new Map;this.reverseTransitions=new Map;this.collidesPropNames=new Map;this.tileCostPropNames=new Map;this.collisionRelevantLayersFrameCache=new Map;this.charBlockCache=new _n(o,s);for(let h of Pi())this.collidesPropNames.set(h,En.ONE_WAY_COLLIDE_PROP_PREFIX+h),this.tileCostPropNames.set(h,`${wh}_${h}`);this.useTileCollisionCache&&(this.tileCollisionCache=new Sn(e,this),this.tileCollisionCache.rebuild())}fixCacheLayer(e){var r;(r=this.tileCollisionCache)==null||r.fixLayer(e)}unfixCacheLayers(){var e;(e=this.tileCollisionCache)==null||e.unfixLayers()}addCharacter(e){this.characters.set(e.getId(),e);let r=e.getNextTilePos().layer;r===void 0?e.setTilePosition(Bt(K({},e.getNextTilePos()),{layer:this.getLowestCharLayer()})):this.getCharLayerNames().includes(r)||console.warn(`Char layer '${r}' of character '${e.getId()}' is unknown.`),this.charBlockCache.addCharacter(e)}removeCharacter(e){let r=this.characters.get(e);r&&(this.charBlockCache.removeCharacter(r),this.characters.delete(e))}getCharacters(){return[...this.characters.values()]}getCharactersAt(e,r){return this.charBlockCache.getCharactersAt(e,r)}rebuildTileCollisionCache(e){var r;(r=this.tileCollisionCache)==null||r.rebuild(e)}hasBlockingTileUncached(e,r,o,s){if(!s&&this.hasNoTileUncached(e,r))return!0;let u=this.getCollisionRelevantLayers(r);for(let h of u)if(this.isLayerBlockingAt(h.getName(),e,o))return!0;return!1}hasBlockingTile(e,r,o,s){var h;let u=(h=this.tileCollisionCache)==null?void 0:h.isBlockingFrom(e.x,e.y,r,o,s);return u!==void 0?u:this.hasBlockingTileUncached(e,r,o,s)}getTransition(e,r){let o=this.transitions.get(e.toString());if(o)return o.get(r)}getReverseTransitions(e,r){let o=this.reverseTransitions.get(e.toString());if(o)return o.get(r)}setTransition(e,r,o){var s,u,h,p,g;this.transitions.has(e.toString())||this.transitions.set(e.toString(),new Map),this.reverseTransitions.has(e.toString())||this.reverseTransitions.set(e.toString(),new Map),(s=this.transitions.get(e.toString()))==null||s.set(r,o),(u=this.reverseTransitions.get(e.toString()))!=null&&u.has(o)||(h=this.reverseTransitions.get(e.toString()))==null||h.set(o,new Set),(g=(p=this.reverseTransitions.get(e.toString()))==null?void 0:p.get(o))==null||g.add(r)}getTransitions(){return new Map([...this.transitions].map(([e,r])=>[e,new Map(r)]))}getTileCosts(e,r){let o=this.getCollisionRelevantLayers(e.layer),s=1;for(let u of o)s=Math.max(s,this.getTileCostsForLayer(Bt(K({},e),{layer:u.getName()}),r));return s}getTileCostsForLayer(e,r){let o=this.tilemap.getTileAt(e.position.x,e.position.y,e.layer);return r&&(o==null?void 0:o.getProperty(this.tileCostPropNames.get(r)||""))||(o==null?void 0:o.getProperty(wh))||1}hasNoTileUncached(e,r){return!this.getCollisionRelevantLayers(r).some(s=>this.tilemap.hasTileAt(e.x,e.y,s.getName()))}hasNoTile(e,r){var s;let o=(s=this.tileCollisionCache)==null?void 0:s.hasTileAt(e.x,e.y,r);return o!==void 0?o:this.hasNoTileUncached(e,r)}hasBlockingChar(e,r,o,s=new Set,u=new Set){return this.charBlockCache.isCharBlockingAt(e,r,o,s,u)}isInRange(e){return new tr(0,0,this.tilemap.getWidth(),this.tilemap.getHeight()).isInRange(e)}toMapDirection(e){return this.isIsometric()?Tc(e):e}fromMapDirection(e){return this.isIsometric()?ko(e):e}isIsometric(){return this.tilemap.getOrientation()==="isometric"}getTilePosInDirection(e,r){let o=e.position.add(Ht(this.toMapDirection(r))),s=this.getTransition(o,e.layer)||e.layer;return{position:o,layer:s}}invalidateFrameCache(){this.collisionRelevantLayersFrameCache.clear()}isLayerBlockingAt(e,r,o){let s=this.tilemap.getTileAt(r.x,r.y,e);return s?!!(s.getProperty(this.collisionTilePropertyName)||o&&s.getProperty(this.collidesPropNames.get(o)||"")):!1}getCharLayerIndexes(){return this.tilemap.getLayers().map((e,r)=>({layer:e,index:r})).filter(({layer:e})=>e.isCharLayer()).map(({index:e})=>e)}findPrevAndCharLayer(e){let r=this.getCharLayerIndexes(),o=this.tilemap.getLayers(),s=r.findIndex(u=>o[u].getProperty(Yr)==e);return s==0?{prevIndex:-1,charLayerIndex:r[s]}:{prevIndex:r[s-1],charLayerIndex:r[s]}}getCollisionRelevantLayers(e){if(!e)return this.tilemap.getLayers();let r=this.collisionRelevantLayersFrameCache.get(e);if(r)return r;let{prevIndex:o,charLayerIndex:s}=this.findPrevAndCharLayer(e),u=this.tilemap.getLayers().slice(o+1,s+1);return this.collisionRelevantLayersFrameCache.set(e,u),u}getLowestCharLayer(){for(let e of this.tilemap.getLayers())if(e.isCharLayer())return e.getProperty(Yr)}getCharLayerNames(){return this.tilemap.getLayers().filter(e=>e.isCharLayer()).map(e=>e.getProperty(Yr)).filter(OP)}};En.ONE_WAY_COLLIDE_PROP_PREFIX="ge_collide_";var On=En;function OP(a){return a!=null}var Da=(r=>(r.REMOVED="REMOVED",r.ADDED="ADDED",r))(Da||{});var Ch=(o=>(o.WAIT="WAIT",o.SKIP="SKIP",o.STOP="STOP",o))(Ch||{}),Dn=class{constructor(e,r){this.character=e;this.tilemap=r;this.queue=new Ge;this.finished$=new J;this.pathBlockedWaitElapsed=0;this.distanceUtils=ue.create(e.getNumberOfDirections())}init(){this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)).subscribe(()=>{this.queue.size()>0&&this.finishMovementTerminated(),this.finished$.complete()})}update(e){(!this.character.isMoving()||this.character.willCrossTileBorderThisUpdate(e))&&this.queue.size()>0&&this.moveCharOnPath(e)}getInfo(){return{type:"Queue"}}enqueue(e,r={}){var s,u,h;let o={pathBlockedStrategy:(s=r.pathBlockedStrategy)!=null?s:"STOP",pathBlockedWaitTimeoutMs:(r==null?void 0:r.pathBlockedWaitTimeoutMs)||-1,ignoreInvalidPositions:(u=r.ignoreInvalidPositions)!=null?u:!1,skipInvalidPositions:(h=r.skipInvalidPositions)!=null?h:!1};for(let p of e){let g={command:p,config:o};if(Qe(p)){this.queue.enqueue(g);continue}let T=this.queue.peekEnd(),L=T==null?void 0:T.command;if(L||(L=this.character.getNextTilePos()),Qe(L)){this.queue.enqueue(g);continue}let D=this.distanceUtils.distance(L.position,p.position)===1;(!r.ignoreInvalidPositions||D)&&this.queue.enqueue(g)}}peekAll(){return this.queue.peekAll()}size(){return this.queue.size()}finished(){return this.finished$}clear(){this.queue.clear()}moveCharOnPath(e){let r=this.queue.peek();if(!r)return;let o=r.command,s=r.config;if(Qe(o)&&(o=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),o)),s.skipInvalidPositions){if(o=this.getNextValidPosition(),!o){this.finishInvalidNextPos(o);return}}else if(!this.isNeighborPos(o)){this.finishInvalidNextPos(o);return}if(this.character.isBlockingDirection(Pt(this.character.getNextTilePos().position,o.position))){if(s.pathBlockedStrategy==="STOP")this.finishPathBlocked(o);else if(s.pathBlockedStrategy==="SKIP"){this.queue.dequeue(),this.moveCharOnPath(e);return}else s.pathBlockedStrategy==="WAIT"&&s.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=s.pathBlockedWaitTimeoutMs&&this.finishBlockedWaitTimeout(o,s.pathBlockedWaitTimeoutMs));return}this.pathBlockedWaitElapsed=0,this.queue.dequeue(),this.character.move(this.getDir(this.character.getNextTilePos().position,o.position)),this.isLastMovement()&&this.finish("SUCCESS","",o)}getNextValidPosition(){var e;for(;this.queue.size()>0;){let r=(e=this.queue.peek())==null?void 0:e.command;if(Qe(r)&&(r=this.tilemap.getTilePosInDirection(this.character.getNextTilePos(),r)),r&&this.isNeighborPos(r))return r;this.queue.dequeue()}}isLastMovement(){return this.queue.size()===0}isNeighborPos(e){let r=this.distanceUtils.distance(this.character.getNextTilePos().position,e.position)===1,o=this.tilemap.getTransition(e.position,this.character.getNextTilePos().layer);if(this.character.getNextTilePos().layer!==e.layer)return r&&o===e.layer;let s=o!==void 0&&o!==e.layer;return r&&!s}finishMovementTerminated(){this.finish("MOVEMENT_TERMINATED","New automatic movement has been set to character.")}finishInvalidNextPos(e){e?this.finish("INVALID_NEXT_POS",`Position ${this.posToStr(e)} is not reachable from ${this.posToStr(this.character.getNextTilePos())}.`):this.finish("INVALID_NEXT_POS",`No enqueued position is reachable from ${this.posToStr(this.character.getNextTilePos())}.`)}finishPathBlocked(e){this.finish("PATH_BLOCKED",`Position ${this.posToStr(e)} is blocked.`)}finishBlockedWaitTimeout(e,r){this.finish("PATH_BLOCKED_WAIT_TIMEOUT",`Position ${this.posToStr(e)} is blocked and the wait timeout of ${r} ms has been exceeded.`)}finish(e,r="",o=this.character.getNextTilePos()){this.queue=new Ge,this.finished$.next({position:o.position,result:e,description:r,layer:o.layer})}getDir(e,r){return this.tilemap.fromMapDirection(Pt(e,r))}posToStr(e){return`(${e.position.x}, ${e.position.y}, ${e.layer})`}};var In=class{constructor(e=!0){this.isCreatedInternal=!1;e&&console.log(`Using GridEngine v${Cn}`)}getCharLayer(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getTilePos().layer}getTransition(e,r){var o;return this.initGuard(),(o=this.gridTilemap)==null?void 0:o.getTransition(new P(e),r)}setTransition(e,r,o){var s;return this.initGuard(),(s=this.gridTilemap)==null?void 0:s.setTransition(new P(e),r,o)}create(e,r){this.isCreatedInternal=!0,this.gridCharacters=new Map;let o=this.setConfigDefaults(r);this.config=o,this.movementStopped$=new J,this.movementStarted$=new J,this.directionChanged$=new J,this.positionChangeStarted$=new J,this.positionChangeFinished$=new J,this.queueMovementFinished$=new J,this.charRemoved$=new J,this.charAdded$=new J,this.gridTilemap=new On(e,this.config.collisionTilePropertyName,this.config.characterCollisionStrategy,this.recordToMap(this.config.collisionGroupRelation),this.config.cacheTileCollisions),this.addCharacters()}recordToMap(e){return e?new Map(Object.entries(e).map(([o,s])=>[o,new Set(s)])):void 0}getPosition(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getTilePos().position}move(e,r){this.moveChar(e,r)}moveRandomly(e,r=0,o=-1){var h;this.initGuard();let s=(h=this.gridCharacters)==null?void 0:h.get(e);if(!s)throw this.createCharUnknownErr(e);let u=new wn(s,r,o);s.setMovement(u)}getMovement(e){var s;this.initGuard();let r=(s=this.gridCharacters)==null?void 0:s.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getMovement();return o?o.getInfo():{type:"None"}}moveTo(e,r,o){var p;let s=this.assembleMoveToConfig(o);this.initGuard();let u=(p=this.gridCharacters)==null?void 0:p.get(e);if(!u)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let h=new qr(u,this.gridTilemap,{position:new P(r),layer:(o==null?void 0:o.targetLayer)||u.getNextTilePos().layer},{distance:0,config:s});return u.setMovement(h),h.init(),h.finishedObs().pipe(be(g=>({charId:e,position:g.position,result:g.result,description:g.description,layer:g.layer})))}stopMovement(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.setMovement(void 0)}setSpeed(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setSpeed(r)}getSpeed(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getSpeed()}collidesWithTiles(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.collidesWithTiles()}update(e,r){var o;if(this.isCreatedInternal&&this.gridCharacters)for(let[s,u]of this.gridCharacters)u.update(r);(o=this.gridTilemap)==null||o.invalidateFrameCache()}addCharacter(e){var u,h,p,g,T;if(!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let r={speed:e.speed||4,tilemap:this.gridTilemap,collidesWithTiles:!0,collisionGroups:["geDefault"],ignoreCollisionGroups:[],charLayer:e.charLayer,facingDirection:e.facingDirection,labels:e.labels,numberOfDirections:(u=e.numberOfDirections)!=null?u:this.config.numberOfDirections,tileWidth:e.tileWidth,tileHeight:e.tileHeight};typeof e.collides=="boolean"?e.collides===!1&&(r.collidesWithTiles=!1,r.collisionGroups=[]):e.collides!==void 0&&(e.collides.collidesWithTiles===!1&&(r.collidesWithTiles=!1),e.collides.collisionGroups&&(r.collisionGroups=e.collides.collisionGroups),e.collides.ignoreCollisionGroups&&(r.ignoreCollisionGroups=e.collides.ignoreCollisionGroups),r.ignoreMissingTiles=(p=(h=e.collides)==null?void 0:h.ignoreMissingTiles)!=null?p:!1);let o=new ln(e.id,r);e.startPosition&&o.setTilePosition({position:new P(e.startPosition),layer:o.getTilePos().layer}),(g=this.gridCharacters)==null||g.set(e.id,o),this.gridTilemap.addCharacter(o);let s=o.getId();o.movementStopped().pipe(gt(this.charRemoved(s))).subscribe(L=>{var D;(D=this.movementStopped$)==null||D.next({charId:s,direction:L})}),o.movementStarted().pipe(gt(this.charRemoved(s))).subscribe(L=>{var D;(D=this.movementStarted$)==null||D.next({charId:s,direction:L})}),o.directionChanged().pipe(gt(this.charRemoved(s))).subscribe(L=>{var D;(D=this.directionChanged$)==null||D.next({charId:s,direction:L})}),o.positionChangeStarted().pipe(gt(this.charRemoved(s))).subscribe(L=>{var D;(D=this.positionChangeStarted$)==null||D.next(K({charId:s},L))}),o.positionChangeFinished().pipe(gt(this.charRemoved(s))).subscribe(L=>{var D;(D=this.positionChangeFinished$)==null||D.next(K({charId:s},L))}),(T=this.charAdded$)==null||T.next(s)}hasCharacter(e){var r;return this.initGuard(),!!((r=this.gridCharacters)!=null&&r.has(e))}removeCharacter(e){var o,s,u,h;if(this.initGuard(),!((o=this.gridCharacters)==null?void 0:o.get(e)))throw this.createCharUnknownErr(e);(s=this.gridTilemap)==null||s.removeCharacter(e),(u=this.gridCharacters)==null||u.delete(e),(h=this.charRemoved$)==null||h.next(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters)for(let e of this.gridCharacters.keys())this.removeCharacter(e)}getAllCharacters(e){if(this.initGuard(),!this.gridCharacters)return[];let r=[...this.gridCharacters.values()];return(e?Th(r,e):r).map(s=>s.getId())}getLabels(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getLabels()}addLabels(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.addLabels(r)}removeLabels(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.removeLabels(r)}clearLabels(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.clearLabels()}follow(e,r,o,s){var T,L,D,Y,M,H,B,st,ft;let u;o===void 0?u={distance:0,closestPointIfBlocked:!1}:typeof o=="number"?(u={distance:o,closestPointIfBlocked:!1},s&&(u.closestPointIfBlocked=!0)):u=o,this.initGuard();let h=(T=this.gridCharacters)==null?void 0:T.get(e),p=(L=this.gridCharacters)==null?void 0:L.get(r);if(!h)throw this.createCharUnknownErr(e);if(!p)throw this.createCharUnknownErr(r);if(!this.gridTilemap)throw this.createUninitializedErr();let g=new xn(h,this.gridTilemap,p,{distance:(D=u.distance)!=null?D:0,noPathFoundStrategy:u.closestPointIfBlocked?"CLOSEST_REACHABLE":"STOP",maxPathLength:(Y=u.maxPathLength)!=null?Y:1/0,shortestPathAlgorithm:(M=u.algorithm)!=null?M:"BIDIRECTIONAL_SEARCH",ignoreLayers:!!u.ignoreLayers,facingDirection:(H=u.facingDirection)!=null?H:"none",considerCosts:(B=u.considerCosts)!=null?B:!1,isPositionAllowedFn:(st=u.isPositionAllowedFn)!=null?st:(()=>!0),ignoredChars:(ft=u.ignoredChars)!=null?ft:[]});h.setMovement(g),g.init()}isMoving(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.isMoving()}getFacingDirection(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getFacingDirection()}getFacingPosition(e){var s;this.initGuard();let r=(s=this.gridCharacters)==null?void 0:s.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getFacingPosition();return{x:o.x,y:o.y}}turnTowards(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);return o.turnTowards(r)}getCharactersAt(e,r){if(this.initGuard(),!this.gridTilemap)return[];let o=this.gridTilemap.getCharactersAt(new P(e),r);return Array.from(o).map(s=>s.getId())}setPosition(e,r,o){var u;this.initGuard();let s=(u=this.gridCharacters)==null?void 0:u.get(e);if(!s)throw this.createCharUnknownErr(e);o||s.setTilePosition({position:new P(r),layer:s.getTilePos().layer}),s.setTilePosition({position:new P(r),layer:o})}isBlocked(e,r,o=["geDefault"]){var u,h;this.initGuard();let s=new P(e);return!!((u=this.gridTilemap)!=null&&u.hasBlockingTile(s,r)||(h=this.gridTilemap)!=null&&h.hasBlockingChar(s,r,o))}isTileBlocked(e,r){var o;return this.initGuard(),!!((o=this.gridTilemap)!=null&&o.hasBlockingTile(new P(e),r))}getCollisionGroups(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getCollisionGroups()||[]}setCollisionGroups(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setCollisionGroups(r)}getIgnoreCollisionGroups(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getIgnoreCollisionGroups()||[]}setIgnoreCollisionGroups(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setIgnoreCollisionGroups(r)}getTilePosInDirection(e,r,o){if(!this.gridTilemap)throw this.createUninitializedErr();let s=this.gridTilemap.getTilePosInDirection({position:new P(e),layer:r},o);return{position:s.position.toPosition(),charLayer:s.layer}}findShortestPath(e,r,o={}){if(!this.gridTilemap)throw this.createUninitializedErr();let s=o.shortestPathAlgorithm||"BFS";o.considerCosts&&s!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${s}'. It can only be used with A* algorithm.`);let u=o.pathWidth!==void 0&&o.pathWidth!==1,h=o.pathHeight!==void 0&&o.pathHeight!==1;(u||h)&&s==="JPS"&&console.warn("GridEngine: Pathfinding options 'pathWidth' and 'pathHeight' > 1 cannot be used with algorithm 'JPS'.");let g=new Xr(this.gridTilemap).findShortestPath(A.toInternal(e),A.toInternal(r),Bt(K({},o),{shortestPathAlgorithm:s}));return{path:g.path.map(A.fromInternal),closestToTarget:g.closestToTarget?A.fromInternal(g.closestToTarget):void 0,reachedMaxPathLength:!1,steps:g.steps}}steppedOn(e,r,o){return this.positionChangeFinished().pipe(Tt(s=>e.includes(s.charId)&&r.some(u=>u.x===s.enterTile.x&&u.y===s.enterTile.y)&&(o===void 0||o.includes(s.enterLayer))))}characterShifted(){if(!this.charAdded$||!this.charRemoved$)throw this.createUninitializedErr();return this.charAdded$.pipe(be(e=>({charId:e,action:"ADDED"})),ma(this.charRemoved$.pipe(be(e=>({charId:e,action:"REMOVED"})))))}movementStarted(){if(!this.movementStarted$)throw this.createUninitializedErr();return this.movementStarted$}movementStopped(){if(!this.movementStopped$)throw this.createUninitializedErr();return this.movementStopped$}directionChanged(){if(!this.directionChanged$)throw this.createUninitializedErr();return this.directionChanged$}positionChangeStarted(){if(!this.positionChangeStarted$)throw this.createUninitializedErr();return this.positionChangeStarted$}positionChangeFinished(){if(!this.positionChangeFinished$)throw this.createUninitializedErr();return this.positionChangeFinished$}getMovementProgress(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getMovementProgress()}rebuildTileCollisionCache(e,r,o,s){var u;(u=this.gridTilemap)==null||u.rebuildTileCollisionCache(new tr(e,r,o,s))}addQueueMovements(e,r,o){var h,p;this.initGuard();let s=(h=this.gridCharacters)==null?void 0:h.get(e);if(!s)throw this.createCharUnknownErr(e);if(!this.gridTilemap)throw this.createUninitializedErr();let u;((p=s==null?void 0:s.getMovement())==null?void 0:p.getInfo().type)==="Queue"?u=s.getMovement():(u=new Dn(s,this.gridTilemap),s.setMovement(u),u.init(),u.finished().pipe(gt(pa(this.charRemoved(e),s.autoMovementSet()))).subscribe(g=>{var T;(T=this.queueMovementFinished$)==null||T.next(K({charId:e},g))})),u.enqueue(r.map(g=>Qe(g)?g:{position:new P(g.position),layer:g.charLayer}),o)}queueMovementFinished(){if(!this.queueMovementFinished$)throw this.createUninitializedErr();return this.queueMovementFinished$}getEnqueuedMovements(e){var o,s;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return((s=r.getMovement())==null?void 0:s.getInfo().type)==="Queue"?r.getMovement().peekAll().map(h=>({command:Qe(h.command)?h.command:A.fromInternal(h.command),config:h.config})):[]}clearEnqueuedMovements(e){var o,s;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);((s=r.getMovement())==null?void 0:s.getInfo().type)==="Queue"&&r.getMovement().clear()}getTileCost(e,r,o){var s,u;return this.initGuard(),(u=(s=this.gridTilemap)==null?void 0:s.getTileCosts({position:new P(e),layer:r},o))!=null?u:1}getState(){let e=[];if(this.gridCharacters)for(let[r,o]of this.gridCharacters.entries())e.push({id:r,position:A.fromInternal(o.getTilePos()),facingDirection:o.getFacingDirection(),speed:o.getSpeed(),labels:o.getLabels(),movementProgress:o.getMovementProgress(),collisionConfig:{collisionGroups:o.getCollisionGroups(),ignoreCollisionGroups:o.getIgnoreCollisionGroups(),collidesWithTiles:o.collidesWithTiles(),ignoreMissingTiles:o.getIgnoreMissingTiles()}});return{characters:e}}setState(e){if(this.gridCharacters)for(let r of e.characters){let o=this.gridCharacters.get(r.id);if(o){let s=o.getTilePos();A.equal(s,A.toInternal(r.position))||o.setTilePosition(A.toInternal(r.position)),o.setSpeed(r.speed),o.turnTowards(r.facingDirection),r.collisionConfig.collisionGroups&&o.setCollisionGroups(r.collisionConfig.collisionGroups),r.collisionConfig.collidesWithTiles!==void 0&&o.setCollidesWithTiles(r.collisionConfig.collidesWithTiles),r.collisionConfig.ignoreMissingTiles!==void 0&&o.setIgnoreMissingTiles(r.collisionConfig.ignoreMissingTiles),o.setMovementProgress(r.movementProgress),o.clearLabels(),o.addLabels(r.labels)}}}revertCurrentMovement(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.revertCurrentMovement()}isCurrentMovementReverted(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.isCurrentMovementReverted()}charRemoved(e){var r;if(!this.charRemoved$)throw this.createUninitializedErr();return(r=this.charRemoved$)==null?void 0:r.pipe(Ft(1),Tt(o=>o==e))}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(r=>this.addCharacter(r))}moveChar(e,r){var s,u,h;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);if(o.getNumberOfDirections()===4){if(!((u=this.gridTilemap)!=null&&u.isIsometric())&&fr(r)){console.warn(`GridEngine: Character '${e}' can't be moved '${r}' in 4 direction mode.`);return}else if((h=this.gridTilemap)!=null&&h.isIsometric()&&!fr(r)){console.warn(`GridEngine: Character '${e}' can't be moved '${r}' in 4 direction isometric mode.`);return}}o.move(r)}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}assembleMoveToConfig(e={}){let r=Bt(K({},e),{noPathFoundStrategy:"STOP",pathBlockedStrategy:"WAIT"});return e!=null&&e.noPathFoundStrategy&&(Object.values(Hr).includes(e.noPathFoundStrategy)?r.noPathFoundStrategy=e.noPathFoundStrategy:console.warn(`GridEngine: Unknown NoPathFoundStrategy '${e.noPathFoundStrategy}'. Falling back to 'STOP'`)),e!=null&&e.pathBlockedStrategy&&(Object.values(Si).includes(e.pathBlockedStrategy)?r.pathBlockedStrategy=e.pathBlockedStrategy:console.warn(`GridEngine: Unknown PathBlockedStrategy '${e.pathBlockedStrategy}'. Falling back to 'WAIT'`)),r}setConfigDefaults(e){return K({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",cacheTileCollisions:!1},e)}};var Mn=class extends $r{constructor(r,o={}){super(r,o);this.jumpCache=new An}findShortestPathImpl(r,o){return this.jumpCache=new An,super.findShortestPathImpl(r,o)}getNeighborsInternal(r,o,s){if(!o||r.layer!==o.layer)return this.getNeighbors(r,s).map(p=>({p,dist:1}));let u=this.prune(o,r).map(p=>{let g=this.getTransition(p.position,r.layer);return{position:p.position,layer:g||r.layer}}),h=[];for(let p of u){let g=this.jump(r,p,s,1,Pt(r.position,p.position));g&&(g.dist=this.distance(r.position,g.p.position),h.push(g))}return h}getForced(r,o){let s=[],{topLeft:u,downLeft:h,top:p,bottom:g,topRight:T,downRight:L}=this.normalizedPositions(r,o),D=Pt(r.position,o.position);return fr(D)?(this.blockOrTrans(r,u)&&(this.addIfNotBlocked(s,o,p),this.addIfNotBlocked(s,o,T),this.blockOrTrans(h,u)&&this.addIfNotBlocked(s,o,u)),this.blockOrTrans(r,h)&&(this.addIfNotBlocked(s,o,g),this.addIfNotBlocked(s,o,L),this.blockOrTrans(u,h)&&this.addIfNotBlocked(s,o,h)),this.blockOrTrans(u,p)&&this.addIfNotBlocked(s,o,p),this.blockOrTrans(h,g)&&this.addIfNotBlocked(s,o,g),this.blockOrTrans(u,T)&&this.addIfNotBlocked(s,o,T),this.blockOrTrans(h,L)&&this.addIfNotBlocked(s,o,L)):((this.blockOrTrans(r,p)||this.blockOrTrans(p,T))&&this.addIfNotBlocked(s,o,T),(this.blockOrTrans(r,g)||this.blockOrTrans(g,L))&&this.addIfNotBlocked(s,o,L),this.blockOrTrans(r,u)&&this.blockOrTrans(r,p)&&(this.addIfNotBlocked(s,o,p),this.addIfNotBlocked(s,o,u)),this.blockOrTrans(r,h)&&this.blockOrTrans(r,g)&&(this.addIfNotBlocked(s,o,g),this.addIfNotBlocked(s,o,h)),this.blockOrTrans(u,p)&&this.blockOrTrans(r,p)&&this.addIfNotBlocked(s,o,p),this.blockOrTrans(h,g)&&this.blockOrTrans(r,g)&&this.addIfNotBlocked(s,o,g)),s}hasForced(r,o){let{topLeft:s,downLeft:u,top:h,bottom:p,topRight:g,downRight:T}=this.normalizedPositions(r,o),L=Pt(r.position,o.position);if(fr(L)){if(this.blockOrTrans(r,s)&&(!this.blockOrTrans(o,h)||!this.blockOrTrans(o,g)||this.blockOrTrans(u,s)&&!this.blockOrTrans(o,s))||this.blockOrTrans(r,u)&&(!this.blockOrTrans(o,p)||!this.blockOrTrans(o,T)||this.blockOrTrans(s,u)&&!this.blockOrTrans(o,u))||this.blockOrTrans(s,h)&&!this.blockOrTrans(o,h)||this.blockOrTrans(u,p)&&!this.blockOrTrans(o,p)||this.blockOrTrans(s,g)&&!this.blockOrTrans(o,g)||this.blockOrTrans(u,T)&&!this.blockOrTrans(o,T))return!0}else if((this.blockOrTrans(r,h)||this.blockOrTrans(h,g))&&!this.blockOrTrans(o,g)||(this.blockOrTrans(r,p)||this.blockOrTrans(p,T))&&!this.blockOrTrans(o,T)||this.blockOrTrans(r,s)&&this.blockOrTrans(r,h)&&(!this.blockOrTrans(o,h)||!this.blockOrTrans(o,s))||this.blockOrTrans(r,u)&&this.blockOrTrans(r,p)&&(!this.blockOrTrans(o,p)||!this.blockOrTrans(o,u))||this.blockOrTrans(s,h)&&this.blockOrTrans(r,h)&&!this.blockOrTrans(o,h)||this.blockOrTrans(u,p)&&this.blockOrTrans(r,p)&&!this.blockOrTrans(o,p))return!0;return!1}prune(r,o){let{top:s,right:u,topRight:h,downRight:p,bottom:g}=this.normalizedPositions(r,o),T=this.getForced(r,o),L=Pt(r.position,o.position);return fr(L)?[s,u,h,p,g,...T]:[u,...T]}jump(r,o,s,u,h){let p=this.jumpCache.get(r,o);if(p!==null)return p;if(this.isBlocking(r,o)&&!(A.equal(o,s)&&this.options.ignoreBlockedTarget)){this.jumpCache.set(r,o,void 0);return}if(A.equal(o,s))return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(u>=this.maxJumpSize)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.getTransition(o.position,r.layer)!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.hasForced(r,o))return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.updateClosestToTarget(o,s),h==="up-left"){if(this.jump(o,this.getTilePosInDir(o,"up"),s,u+1,"up")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"left"),s,u+1,"left")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="down-left"){if(this.jump(o,this.getTilePosInDir(o,"down"),s,u+1,"down")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"left"),s,u+1,"left")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="up-right"){if(this.jump(o,this.getTilePosInDir(o,"up"),s,u+1,"up")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"right"),s,u+1,"right")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}else if(h==="down-right"){if(this.jump(o,this.getTilePosInDir(o,"down"),s,u+1,"down")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0};if(this.jump(o,this.getTilePosInDir(o,"right"),s,u+1,"right")!==void 0)return this.jumpCache.set(r,o,{p:o,dist:0}),{p:o,dist:0}}let g=this.jump(o,this.getTilePosInDir(o,h),s,u+1,h);return this.jumpCache.set(r,o,g),g}normalizedPositions(r,o){return r.position.x<o.position.x&&r.position.y===o.position.y?{topLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer}}:r.position.x>o.position.x&&r.position.y===o.position.y?{topLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x===o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer}}:r.position.y>o.position.y&&r.position.x===o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y),layer:o.layer},right:{position:new P(o.position.x,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x<o.position.x?{topLeft:{position:new P(o.position.x,o.position.y-1),layer:o.layer},downLeft:{position:new P(o.position.x-1,o.position.y),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x+1,o.position.y),layer:o.layer},downRight:{position:new P(o.position.x,o.position.y+1),layer:o.layer}}:r.position.y<o.position.y&&r.position.x>o.position.x?{topLeft:{position:new P(o.position.x+1,o.position.y),layer:o.layer},downLeft:{position:new P(o.position.x,o.position.y-1),layer:o.layer},top:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},topRight:{position:new P(o.position.x,o.position.y+1),layer:o.layer},downRight:{position:new P(o.position.x-1,o.position.y),layer:o.layer}}:r.position.y>o.position.y&&r.position.x<o.position.x?{topLeft:{position:new P(o.position.x-1,o.position.y),layer:o.layer},downLeft:{position:new P(o.position.x,o.position.y+1),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y+1),layer:o.layer},right:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x,o.position.y-1),layer:o.layer},downRight:{position:new P(o.position.x+1,o.position.y),layer:o.layer}}:{topLeft:{position:new P(o.position.x,o.position.y+1),layer:o.layer},downLeft:{position:new P(o.position.x+1,o.position.y),layer:o.layer},top:{position:new P(o.position.x-1,o.position.y+1),layer:o.layer},bottom:{position:new P(o.position.x+1,o.position.y-1),layer:o.layer},right:{position:new P(o.position.x-1,o.position.y-1),layer:o.layer},topRight:{position:new P(o.position.x-1,o.position.y),layer:o.layer},downRight:{position:new P(o.position.x,o.position.y-1),layer:o.layer}}}},An=class{constructor(){this.memo=new Map}set(e,r,o){let s=this.memo.get(e.position.x);s||(s=new Map,this.memo.set(e.position.x,s));let u=s.get(e.position.y);u||(u=new Map,s.set(e.position.y,u));let h=u.get(e.layer);h||(h=new Map,u.set(e.layer,h));let p=h.get(r.position.x);p||(p=new Map,h.set(r.position.x,p));let g=p.get(r.position.y);g||(g=new Map,p.set(r.position.y,g)),g.get(r.layer)||(o===void 0?g.set(r.layer,null):g.set(r.layer,o))}get(e,r){let o=this.memo.get(e.position.x);if(!o)return null;let s=o.get(e.position.y);if(!s)return null;let u=s.get(e.layer);if(!u)return null;let h=u.get(r.position.x);if(!h)return null;let p=h.get(r.position.y);if(!p)return null;let g=p.get(r.layer);return g===void 0?null:g===null?void 0:g}};var Xr=class{constructor(e){this.gridTilemap=e}findShortestPath(e,r,o={}){return EP(o.shortestPathAlgorithm||"BIDIRECTIONAL_SEARCH",this.gridTilemap,o).findShortestPath(e,r)}};function EP(a,e,r){switch(a){case"BIDIRECTIONAL_SEARCH":return new Tn(e,r);case"A_STAR":return new vn(e,r);case"JPS":return r.numberOfDirections===8?new Mn(e,r):new $r(e,r)}return new zr(e,r)}var Ia=(g=>(g.SUCCESS="SUCCESS",g.NO_PATH_FOUND_MAX_RETRIES_EXCEEDED="NO_PATH_FOUND_MAX_RETRIES_EXCEEDED",g.PATH_BLOCKED_MAX_RETRIES_EXCEEDED="PATH_BLOCKED_MAX_RETRIES_EXCEEDED",g.PATH_BLOCKED="PATH_BLOCKED",g.NO_PATH_FOUND="NO_PATH_FOUND",g.PATH_BLOCKED_WAIT_TIMEOUT="PATH_BLOCKED_WAIT_TIMEOUT",g.MOVEMENT_TERMINATED="MOVEMENT_TERMINATED",g.MAX_PATH_LENGTH_REACHED="MAX_PATH_LENGTH_REACHED",g))(Ia||{}),qr=class{constructor(e,r,o,{config:s,ignoreBlockedTarget:u=!1,distance:h=0}={}){this.character=e;this.tilemap=r;this.targetPos=o;this.shortestPath=[];this.distOffset=0;this.posOnPath=0;this.stopped=!1;this.pathBlockedWaitElapsed=0;this.isPositionAllowed=()=>!0;this.shortestPathAlgorithm="BIDIRECTIONAL_SEARCH";this.maxPathLength=1/0;this.considerCosts=!1;this.ignoredChars=[];this.isBlocking=(e,r)=>e?new zr(this.tilemap,this.getPathfindingOptions()).isBlocking(this.character.getTilePos(),{position:e,layer:r}):!0;var p,g;this.shortestPathAlgorithm=(p=s==null?void 0:s.algorithm)!=null?p:this.shortestPathAlgorithm,this.ignoreBlockedTarget=u,this.distance=h,this.noPathFoundStrategy=(s==null?void 0:s.noPathFoundStrategy)||"STOP",this.pathBlockedStrategy=(s==null?void 0:s.pathBlockedStrategy)||"WAIT",this.noPathFoundRetryable=new Li((s==null?void 0:s.noPathFoundRetryBackoffMs)||200,(s==null?void 0:s.noPathFoundMaxRetries)||-1,()=>{this.stop("NO_PATH_FOUND_MAX_RETRIES_EXCEEDED")}),this.pathBlockedRetryable=new Li((s==null?void 0:s.pathBlockedRetryBackoffMs)||200,(s==null?void 0:s.pathBlockedMaxRetries)||-1,()=>{this.stop("PATH_BLOCKED_MAX_RETRIES_EXCEEDED")}),s!=null&&s.isPositionAllowedFn&&(this.isPositionAllowed=s.isPositionAllowedFn),s!=null&&s.maxPathLength&&(this.maxPathLength=s.maxPathLength),this.alternativeTargets=s==null?void 0:s.alternativeTargets,this.noPathFoundAlternativeTargetsFallbackStrategy=s==null?void 0:s.noPathFoundAlternativeTargetsFallbackStrategy,s!=null&&s.considerCosts&&this.shortestPathAlgorithm!=="A_STAR"&&console.warn(`GridEngine: Pathfinding option 'considerCosts' cannot be used with algorithm '${this.shortestPathAlgorithm}'. It can only be used with A* algorithm.`),this.shortestPathAlgorithm==="JPS"&&(this.character.getTileWidth()>1||this.character.getTileHeight()>1)&&console.warn("GridEngine: Pathfinding algorithm 'JPS' can only be used for characters with 'tileWidth' and 'tileHeight' of 1"),this.considerCosts=(s==null?void 0:s.considerCosts)||!1,this.ignoreLayers=!!(s!=null&&s.ignoreLayers),this.distanceUtils=ue.create(e.getNumberOfDirections()),this.pathBlockedWaitTimeoutMs=(s==null?void 0:s.pathBlockedWaitTimeoutMs)||-1,this.ignoredChars=(g=s==null?void 0:s.ignoredChars)!=null?g:[],this.finished$=new J}init(){this.noPathFoundRetryable.reset(),this.pathBlockedRetryable.reset(),this.pathBlockedWaitElapsed=0,this.calcShortestPath(),this.character.autoMovementSet().pipe(Tt(e=>e!==this),Ft(1)).subscribe(()=>{this.stop("MOVEMENT_TERMINATED")})}setPathBlockedStrategy(e){this.pathBlockedStrategy=e}getPathBlockedStrategy(){return this.pathBlockedStrategy}getPathfindingOptions(){return{shortestPathAlgorithm:this.shortestPathAlgorithm,pathWidth:this.character.getTileWidth(),pathHeight:this.character.getTileHeight(),numberOfDirections:this.character.getNumberOfDirections(),isPositionAllowed:this.isPositionAllowed,collisionGroups:this.character.getCollisionGroups(),ignoredChars:[this.character.getId(),...this.ignoredChars],ignoreTiles:!this.character.collidesWithTiles(),ignoreMapBounds:this.character.getIgnoreMissingTiles(),ignoreBlockedTarget:this.ignoreBlockedTarget,maxPathLength:this.maxPathLength,ignoreLayers:this.ignoreLayers,considerCosts:this.considerCosts,calculateClosestToTarget:!0}}update(e){var r,o,s,u;this.stopped||(this.noPathFound()&&(this.noPathFoundStrategy==="RETRY"?this.noPathFoundRetryable.retry(e,()=>this.calcShortestPath()):this.noPathFoundStrategy==="STOP"&&this.stop("NO_PATH_FOUND")),this.updatePosOnPath(),this.isBlocking((r=this.nextTileOnPath())==null?void 0:r.position,(o=this.character)==null?void 0:o.getNextTilePos().layer)?this.applyPathBlockedStrategy(e):this.pathBlockedWaitElapsed=0,this.updatePosOnPath(),this.hasArrived()?(this.stop("SUCCESS"),this.existsDistToTarget()&&this.turnTowardsTarget()):this.isBlocking((s=this.nextTileOnPath())==null?void 0:s.position,(u=this.character)==null?void 0:u.getNextTilePos().layer)||this.moveCharOnPath())}finishedObs(){return this.finished$}getInfo(){return{type:"Target",state:{pathAhead:this.shortestPath.slice(this.posOnPath).map(e=>A.fromInternal(e))},config:{algorithm:this.shortestPathAlgorithm,ignoreBlockedTarget:this.ignoreBlockedTarget,distance:this.distance,targetPos:A.fromInternal(this.targetPos),noPathFoundStrategy:this.noPathFoundStrategy,pathBlockedStrategy:this.pathBlockedStrategy,noPathFoundRetryBackoffMs:this.noPathFoundRetryable.getBackoffMs(),noPathFoundMaxRetries:this.noPathFoundRetryable.getMaxRetries()}}}resultToReason(e){switch(e){case"SUCCESS":return"Successfully arrived.";case"MOVEMENT_TERMINATED":return"Movement of character has been replaced before destination was reached.";case"PATH_BLOCKED":return"PathBlockedStrategy STOP: Path blocked.";case"NO_PATH_FOUND_MAX_RETRIES_EXCEEDED":return`NoPathFoundStrategy RETRY: Maximum retries of ${this.noPathFoundRetryable.getMaxRetries()} exceeded.`;case"NO_PATH_FOUND":return"NoPathFoundStrategy STOP: No path found.";case"PATH_BLOCKED_MAX_RETRIES_EXCEEDED":return`PathBlockedStrategy RETRY: Maximum retries of ${this.pathBlockedRetryable.getMaxRetries()} exceeded.`;case"PATH_BLOCKED_WAIT_TIMEOUT":return`PathBlockedStrategy WAIT: Wait timeout of ${this.pathBlockedWaitTimeoutMs}ms exceeded.`}}applyPathBlockedStrategy(e){this.pathBlockedStrategy==="RETRY"?this.pathBlockedRetryable.retry(e,()=>{let r=this.getShortestPath();r.path.length>0&&this.calcShortestPath(r)}):this.pathBlockedStrategy==="STOP"?this.stop("PATH_BLOCKED"):this.pathBlockedStrategy==="WAIT"&&this.pathBlockedWaitTimeoutMs>-1&&(this.pathBlockedWaitElapsed+=e,this.pathBlockedWaitElapsed>=this.pathBlockedWaitTimeoutMs&&this.stop("PATH_BLOCKED_WAIT_TIMEOUT"))}moveCharOnPath(){let e=this.nextTileOnPath();if(!e)return;let r=this.getDir(this.character.getNextTilePos().position,e.position);this.character.move(r)}nextTileOnPath(){return this.shortestPath[this.posOnPath+1]}stop(e){this.finished$.next({position:this.character.getTilePos().position,result:e,description:this.resultToReason(e),layer:this.character.getTilePos().layer}),this.finished$.complete(),this.stopped=!0}turnTowardsTarget(){let e=this.shortestPath[this.posOnPath+1],r=this.getDir(this.character.getNextTilePos().position,e.position);this.character.turnTowards(r)}existsDistToTarget(){return this.posOnPath<this.shortestPath.length-1}hasArrived(){return!this.noPathFound()&&this.posOnPath+Math.max(0,this.distance-this.distOffset)>=this.shortestPath.length-1}updatePosOnPath(){let e=this.shortestPath[this.posOnPath];for(;this.posOnPath<this.shortestPath.length-1&&(this.character.getNextTilePos().position.x!=e.position.x||this.character.getNextTilePos().position.y!=e.position.y);)this.posOnPath++,e=this.shortestPath[this.posOnPath]}noPathFound(){return this.shortestPath.length===0}calcShortestPath(e){e=e!=null?e:this.getShortestPath(),this.posOnPath=0,this.shortestPath=e.path,this.distOffset=e.distOffset}getShortestPath(){var u;let e=new Xr(this.tilemap),{path:r,closestToTarget:o}=e.findShortestPath(this.character.getNextTilePos(),this.targetPos,this.getPathfindingOptions());if(r.length==0){if(this.noPathFoundStrategy==="CLOSEST_REACHABLE"){if(!o)throw Error("ClosestToTarget should never be undefined in TargetMovement.");return this.pathToAlternativeTarget(o,e)}else if(this.noPathFoundStrategy==="ALTERNATIVE_TARGETS"){for(let h of(u=this.alternativeTargets)!=null?u:[]){let{path:p,distOffset:g}=this.pathToAlternativeTarget(A.toInternal(h),e);if(p.length>0)return{path:p,distOffset:g}}return this.noPathFoundStrategy=this.noPathFoundAlternativeTargetsFallbackStrategy||"STOP",this.getShortestPath()}}return{path:r,distOffset:0}}pathToAlternativeTarget(e,r){let o=r.findShortestPath(this.character.getNextTilePos(),e,this.getPathfindingOptions()).path,s=this.distanceUtils.distance(e.position,this.targetPos.position);return{path:o,distOffset:s}}getDir(e,r){return this.tilemap.fromMapDirection(this.distanceUtils.direction(e,r))}};var DP=Object.create,Lh=Object.defineProperty,IP=Object.getOwnPropertyDescriptor,MP=Object.getOwnPropertyNames,AP=Object.getPrototypeOf,RP=Object.prototype.hasOwnProperty,FP=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),kP=(a,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of MP(e))!RP.call(a,s)&&s!==r&&Lh(a,s,{get:()=>e[s],enumerable:!(o=IP(e,s))||o.enumerable});return a},Aa=(a,e,r)=>(r=a!=null?DP(AP(a)):{},kP(e||!a||!a.__esModule?Lh(r,"default",{value:a,enumerable:!0}):r,a)),Ra=FP((a,e)=>{(function(){var r,o="4.17.21",s=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",p="Invalid `variable` option passed into `_.template`",g="__lodash_hash_undefined__",T=500,L="__lodash_placeholder__",D=1,Y=2,M=4,H=1,B=2,st=1,ft=2,er=4,ce=8,Tr=16,he=32,xr=64,_e=128,Qr=256,kn=512,Dh=30,Ih="...",Mh=800,Ah=16,Na=1,Rh=2,Fh=3,rr=1/0,Ne=9007199254740991,kh=17976931348623157e292,Ui=NaN,fe=4294967295,Vh=fe-1,Gh=fe>>>1,Nh=[["ary",_e],["bind",st],["bindKey",ft],["curry",ce],["curryRight",Tr],["flip",kn],["partial",he],["partialRight",xr],["rearg",Qr]],wr="[object Arguments]",Bi="[object Array]",jh="[object AsyncFunction]",Kr="[object Boolean]",Jr="[object Date]",Uh="[object DOMException]",Hi="[object Error]",Wi="[object Function]",ja="[object GeneratorFunction]",ee="[object Map]",Zr="[object Number]",Bh="[object Null]",Le="[object Object]",Ua="[object Promise]",Hh="[object Proxy]",ti="[object RegExp]",re="[object Set]",ei="[object String]",zi="[object Symbol]",Wh="[object Undefined]",ri="[object WeakMap]",zh="[object WeakSet]",ii="[object ArrayBuffer]",Cr="[object DataView]",Vn="[object Float32Array]",Gn="[object Float64Array]",Nn="[object Int8Array]",jn="[object Int16Array]",Un="[object Int32Array]",Bn="[object Uint8Array]",Hn="[object Uint8ClampedArray]",Wn="[object Uint16Array]",zn="[object Uint32Array]",$h=/\b__p \+= '';/g,qh=/\b(__p \+=) '' \+/g,Yh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ba=/&(?:amp|lt|gt|quot|#39);/g,Ha=/[&<>"']/g,Xh=RegExp(Ba.source),Qh=RegExp(Ha.source),Kh=/<%-([\s\S]+?)%>/g,Jh=/<%([\s\S]+?)%>/g,Wa=/<%=([\s\S]+?)%>/g,Zh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tf=/^\w*$/,ef=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$n=/[\\^$.*+?()[\]{}|]/g,rf=RegExp($n.source),qn=/^\s+/,of=/\s/,nf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,sf=/\{\n\/\* \[wrapped with (.+)\] \*/,af=/,? & /,uf=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lf=/[()=,{}\[\]\/\s]/,cf=/\\(\\)?/g,hf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,za=/\w*$/,ff=/^[-+]0x[0-9a-f]+$/i,pf=/^0b[01]+$/i,mf=/^\[object .+?Constructor\]$/,gf=/^0o[0-7]+$/i,df=/^(?:0|[1-9]\d*)$/,yf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$i=/($^)/,vf=/['\n\r\u2028\u2029\\]/g,qi="\\ud800-\\udfff",bf="\\u0300-\\u036f",Pf="\\ufe20-\\ufe2f",Tf="\\u20d0-\\u20ff",$a=bf+Pf+Tf,qa="\\u2700-\\u27bf",Ya="a-z\\xdf-\\xf6\\xf8-\\xff",xf="\\xac\\xb1\\xd7\\xf7",wf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Cf="\\u2000-\\u206f",_f=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xa="A-Z\\xc0-\\xd6\\xd8-\\xde",Qa="\\ufe0e\\ufe0f",Ka=xf+wf+Cf+_f,Yn="['\u2019]",Lf="["+qi+"]",Ja="["+Ka+"]",Yi="["+$a+"]",Za="\\d+",Sf="["+qa+"]",tu="["+Ya+"]",eu="[^"+qi+Ka+Za+qa+Ya+Xa+"]",Xn="\\ud83c[\\udffb-\\udfff]",Of="(?:"+Yi+"|"+Xn+")",ru="[^"+qi+"]",Qn="(?:\\ud83c[\\udde6-\\uddff]){2}",Kn="[\\ud800-\\udbff][\\udc00-\\udfff]",_r="["+Xa+"]",iu="\\u200d",ou="(?:"+tu+"|"+eu+")",Ef="(?:"+_r+"|"+eu+")",nu="(?:"+Yn+"(?:d|ll|m|re|s|t|ve))?",su="(?:"+Yn+"(?:D|LL|M|RE|S|T|VE))?",au=Of+"?",uu="["+Qa+"]?",Df="(?:"+iu+"(?:"+[ru,Qn,Kn].join("|")+")"+uu+au+")*",If="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Mf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lu=uu+au+Df,Af="(?:"+[Sf,Qn,Kn].join("|")+")"+lu,Rf="(?:"+[ru+Yi+"?",Yi,Qn,Kn,Lf].join("|")+")",Ff=RegExp(Yn,"g"),kf=RegExp(Yi,"g"),Jn=RegExp(Xn+"(?="+Xn+")|"+Rf+lu,"g"),Vf=RegExp([_r+"?"+tu+"+"+nu+"(?="+[Ja,_r,"$"].join("|")+")",Ef+"+"+su+"(?="+[Ja,_r+ou,"$"].join("|")+")",_r+"?"+ou+"+"+nu,_r+"+"+su,Mf,If,Za,Af].join("|"),"g"),Gf=RegExp("["+iu+qi+$a+Qa+"]"),Nf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Uf=-1,ot={};ot[Vn]=ot[Gn]=ot[Nn]=ot[jn]=ot[Un]=ot[Bn]=ot[Hn]=ot[Wn]=ot[zn]=!0,ot[wr]=ot[Bi]=ot[ii]=ot[Kr]=ot[Cr]=ot[Jr]=ot[Hi]=ot[Wi]=ot[ee]=ot[Zr]=ot[Le]=ot[ti]=ot[re]=ot[ei]=ot[ri]=!1;var it={};it[wr]=it[Bi]=it[ii]=it[Cr]=it[Kr]=it[Jr]=it[Vn]=it[Gn]=it[Nn]=it[jn]=it[Un]=it[ee]=it[Zr]=it[Le]=it[ti]=it[re]=it[ei]=it[zi]=it[Bn]=it[Hn]=it[Wn]=it[zn]=!0,it[Hi]=it[Wi]=it[ri]=!1;var Bf={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Hf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Wf={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},zf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},$f=parseFloat,qf=parseInt,cu=typeof global=="object"&&global&&global.Object===Object&&global,Yf=typeof self=="object"&&self&&self.Object===Object&&self,dt=cu||Yf||Function("return this")(),Zn=typeof a=="object"&&a&&!a.nodeType&&a,ir=Zn&&typeof e=="object"&&e&&!e.nodeType&&e,hu=ir&&ir.exports===Zn,ts=hu&&cu.process,zt=(function(){try{var v=ir&&ir.require&&ir.require("util").types;return v||ts&&ts.binding&&ts.binding("util")}catch(w){}})(),fu=zt&&zt.isArrayBuffer,pu=zt&&zt.isDate,mu=zt&&zt.isMap,gu=zt&&zt.isRegExp,du=zt&&zt.isSet,yu=zt&&zt.isTypedArray;function kt(v,w,x){switch(x.length){case 0:return v.call(w);case 1:return v.call(w,x[0]);case 2:return v.call(w,x[0],x[1]);case 3:return v.call(w,x[0],x[1],x[2])}return v.apply(w,x)}function Xf(v,w,x,E){for(var V=-1,Q=v==null?0:v.length;++V<Q;){var pt=v[V];w(E,pt,x(pt),v)}return E}function $t(v,w){for(var x=-1,E=v==null?0:v.length;++x<E&&w(v[x],x,v)!==!1;);return v}function Qf(v,w){for(var x=v==null?0:v.length;x--&&w(v[x],x,v)!==!1;);return v}function vu(v,w){for(var x=-1,E=v==null?0:v.length;++x<E;)if(!w(v[x],x,v))return!1;return!0}function je(v,w){for(var x=-1,E=v==null?0:v.length,V=0,Q=[];++x<E;){var pt=v[x];w(pt,x,v)&&(Q[V++]=pt)}return Q}function Xi(v,w){var x=v==null?0:v.length;return!!x&&Lr(v,w,0)>-1}function es(v,w,x){for(var E=-1,V=v==null?0:v.length;++E<V;)if(x(w,v[E]))return!0;return!1}function nt(v,w){for(var x=-1,E=v==null?0:v.length,V=Array(E);++x<E;)V[x]=w(v[x],x,v);return V}function Ue(v,w){for(var x=-1,E=w.length,V=v.length;++x<E;)v[V+x]=w[x];return v}function rs(v,w,x,E){var V=-1,Q=v==null?0:v.length;for(E&&Q&&(x=v[++V]);++V<Q;)x=w(x,v[V],V,v);return x}function Kf(v,w,x,E){var V=v==null?0:v.length;for(E&&V&&(x=v[--V]);V--;)x=w(x,v[V],V,v);return x}function is(v,w){for(var x=-1,E=v==null?0:v.length;++x<E;)if(w(v[x],x,v))return!0;return!1}var Jf=os("length");function Zf(v){return v.split("")}function tp(v){return v.match(uf)||[]}function bu(v,w,x){var E;return x(v,function(V,Q,pt){if(w(V,Q,pt))return E=Q,!1}),E}function Qi(v,w,x,E){for(var V=v.length,Q=x+(E?1:-1);E?Q--:++Q<V;)if(w(v[Q],Q,v))return Q;return-1}function Lr(v,w,x){return w===w?fp(v,w,x):Qi(v,Pu,x)}function ep(v,w,x,E){for(var V=x-1,Q=v.length;++V<Q;)if(E(v[V],w))return V;return-1}function Pu(v){return v!==v}function Tu(v,w){var x=v==null?0:v.length;return x?ss(v,w)/x:Ui}function os(v){return function(w){return w==null?r:w[v]}}function ns(v){return function(w){return v==null?r:v[w]}}function xu(v,w,x,E,V){return V(v,function(Q,pt,rt){x=E?(E=!1,Q):w(x,Q,pt,rt)}),x}function rp(v,w){var x=v.length;for(v.sort(w);x--;)v[x]=v[x].value;return v}function ss(v,w){for(var x,E=-1,V=v.length;++E<V;){var Q=w(v[E]);Q!==r&&(x=x===r?Q:x+Q)}return x}function as(v,w){for(var x=-1,E=Array(v);++x<v;)E[x]=w(x);return E}function ip(v,w){return nt(w,function(x){return[x,v[x]]})}function wu(v){return v&&v.slice(0,Su(v)+1).replace(qn,"")}function Vt(v){return function(w){return v(w)}}function us(v,w){return nt(w,function(x){return v[x]})}function oi(v,w){return v.has(w)}function Cu(v,w){for(var x=-1,E=v.length;++x<E&&Lr(w,v[x],0)>-1;);return x}function _u(v,w){for(var x=v.length;x--&&Lr(w,v[x],0)>-1;);return x}function op(v,w){for(var x=v.length,E=0;x--;)v[x]===w&&++E;return E}var np=ns(Bf),sp=ns(Hf);function ap(v){return"\\"+zf[v]}function up(v,w){return v==null?r:v[w]}function Sr(v){return Gf.test(v)}function lp(v){return Nf.test(v)}function cp(v){for(var w,x=[];!(w=v.next()).done;)x.push(w.value);return x}function ls(v){var w=-1,x=Array(v.size);return v.forEach(function(E,V){x[++w]=[V,E]}),x}function Lu(v,w){return function(x){return v(w(x))}}function Be(v,w){for(var x=-1,E=v.length,V=0,Q=[];++x<E;){var pt=v[x];(pt===w||pt===L)&&(v[x]=L,Q[V++]=x)}return Q}function Ki(v){var w=-1,x=Array(v.size);return v.forEach(function(E){x[++w]=E}),x}function hp(v){var w=-1,x=Array(v.size);return v.forEach(function(E){x[++w]=[E,E]}),x}function fp(v,w,x){for(var E=x-1,V=v.length;++E<V;)if(v[E]===w)return E;return-1}function pp(v,w,x){for(var E=x+1;E--;)if(v[E]===w)return E;return E}function Or(v){return Sr(v)?gp(v):Jf(v)}function ie(v){return Sr(v)?dp(v):Zf(v)}function Su(v){for(var w=v.length;w--&&of.test(v.charAt(w)););return w}var mp=ns(Wf);function gp(v){for(var w=Jn.lastIndex=0;Jn.test(v);)++w;return w}function dp(v){return v.match(Jn)||[]}function yp(v){return v.match(Vf)||[]}var vp=function v(w){w=w==null?dt:He.defaults(dt.Object(),w,He.pick(dt,jf));var x=w.Array,E=w.Date,V=w.Error,Q=w.Function,pt=w.Math,rt=w.Object,cs=w.RegExp,bp=w.String,qt=w.TypeError,Ji=x.prototype,Pp=Q.prototype,Er=rt.prototype,Zi=w["__core-js_shared__"],to=Pp.toString,tt=Er.hasOwnProperty,Tp=0,Ou=(function(){var t=/[^.]+$/.exec(Zi&&Zi.keys&&Zi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})(),eo=Er.toString,xp=to.call(rt),wp=dt._,Cp=cs("^"+to.call(tt).replace($n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ro=hu?w.Buffer:r,We=w.Symbol,io=w.Uint8Array,Eu=ro?ro.allocUnsafe:r,oo=Lu(rt.getPrototypeOf,rt),Du=rt.create,Iu=Er.propertyIsEnumerable,no=Ji.splice,Mu=We?We.isConcatSpreadable:r,ni=We?We.iterator:r,or=We?We.toStringTag:r,so=(function(){try{var t=lr(rt,"defineProperty");return t({},"",{}),t}catch(i){}})(),_p=w.clearTimeout!==dt.clearTimeout&&w.clearTimeout,Lp=E&&E.now!==dt.Date.now&&E.now,Sp=w.setTimeout!==dt.setTimeout&&w.setTimeout,ao=pt.ceil,uo=pt.floor,hs=rt.getOwnPropertySymbols,Op=ro?ro.isBuffer:r,Au=w.isFinite,Ep=Ji.join,Dp=Lu(rt.keys,rt),mt=pt.max,xt=pt.min,Ip=E.now,Mp=w.parseInt,Ru=pt.random,Ap=Ji.reverse,fs=lr(w,"DataView"),si=lr(w,"Map"),ps=lr(w,"Promise"),Dr=lr(w,"Set"),ai=lr(w,"WeakMap"),ui=lr(rt,"create"),lo=ai&&new ai,Ir={},Rp=cr(fs),Fp=cr(si),kp=cr(ps),Vp=cr(Dr),Gp=cr(ai),co=We?We.prototype:r,li=co?co.valueOf:r,Fu=co?co.toString:r;function f(t){if(ut(t)&&!G(t)&&!(t instanceof z)){if(t instanceof Yt)return t;if(tt.call(t,"__wrapped__"))return kl(t)}return new Yt(t)}var Mr=(function(){function t(){}return function(i){if(!at(i))return{};if(Du)return Du(i);t.prototype=i;var n=new t;return t.prototype=r,n}})();function ho(){}function Yt(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}f.templateSettings={escape:Kh,evaluate:Jh,interpolate:Wa,variable:"",imports:{_:f}},f.prototype=ho.prototype,f.prototype.constructor=f,Yt.prototype=Mr(ho.prototype),Yt.prototype.constructor=Yt;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=fe,this.__views__=[]}function Np(){var t=new z(this.__wrapped__);return t.__actions__=Et(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Et(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Et(this.__views__),t}function jp(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Up(){var t=this.__wrapped__.value(),i=this.__dir__,n=G(t),l=i<0,c=n?t.length:0,m=Zm(0,c,this.__views__),d=m.start,y=m.end,b=y-d,C=l?y:d-1,_=this.__iteratees__,S=_.length,O=0,I=xt(b,this.__takeCount__);if(!n||!l&&c==b&&I==b)return nl(t,this.__actions__);var F=[];t:for(;b--&&O<I;){C+=i;for(var j=-1,k=t[C];++j<S;){var W=_[j],$=W.iteratee,jt=W.type,St=$(k);if(jt==Rh)k=St;else if(!St){if(jt==Na)continue t;break t}}F[O++]=k}return F}z.prototype=Mr(ho.prototype),z.prototype.constructor=z;function nr(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function Bp(){this.__data__=ui?ui(null):{},this.size=0}function Hp(t){var i=this.has(t)&&delete this.__data__[t];return this.size-=i?1:0,i}function Wp(t){var i=this.__data__;if(ui){var n=i[t];return n===g?r:n}return tt.call(i,t)?i[t]:r}function zp(t){var i=this.__data__;return ui?i[t]!==r:tt.call(i,t)}function $p(t,i){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ui&&i===r?g:i,this}nr.prototype.clear=Bp,nr.prototype.delete=Hp,nr.prototype.get=Wp,nr.prototype.has=zp,nr.prototype.set=$p;function Se(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function qp(){this.__data__=[],this.size=0}function Yp(t){var i=this.__data__,n=fo(i,t);if(n<0)return!1;var l=i.length-1;return n==l?i.pop():no.call(i,n,1),--this.size,!0}function Xp(t){var i=this.__data__,n=fo(i,t);return n<0?r:i[n][1]}function Qp(t){return fo(this.__data__,t)>-1}function Kp(t,i){var n=this.__data__,l=fo(n,t);return l<0?(++this.size,n.push([t,i])):n[l][1]=i,this}Se.prototype.clear=qp,Se.prototype.delete=Yp,Se.prototype.get=Xp,Se.prototype.has=Qp,Se.prototype.set=Kp;function Oe(t){var i=-1,n=t==null?0:t.length;for(this.clear();++i<n;){var l=t[i];this.set(l[0],l[1])}}function Jp(){this.size=0,this.__data__={hash:new nr,map:new(si||Se),string:new nr}}function Zp(t){var i=_o(this,t).delete(t);return this.size-=i?1:0,i}function tm(t){return _o(this,t).get(t)}function em(t){return _o(this,t).has(t)}function rm(t,i){var n=_o(this,t),l=n.size;return n.set(t,i),this.size+=n.size==l?0:1,this}Oe.prototype.clear=Jp,Oe.prototype.delete=Zp,Oe.prototype.get=tm,Oe.prototype.has=em,Oe.prototype.set=rm;function sr(t){var i=-1,n=t==null?0:t.length;for(this.__data__=new Oe;++i<n;)this.add(t[i])}function im(t){return this.__data__.set(t,g),this}function om(t){return this.__data__.has(t)}sr.prototype.add=sr.prototype.push=im,sr.prototype.has=om;function oe(t){var i=this.__data__=new Se(t);this.size=i.size}function nm(){this.__data__=new Se,this.size=0}function sm(t){var i=this.__data__,n=i.delete(t);return this.size=i.size,n}function am(t){return this.__data__.get(t)}function um(t){return this.__data__.has(t)}function lm(t,i){var n=this.__data__;if(n instanceof Se){var l=n.__data__;if(!si||l.length<s-1)return l.push([t,i]),this.size=++n.size,this;n=this.__data__=new Oe(l)}return n.set(t,i),this.size=n.size,this}oe.prototype.clear=nm,oe.prototype.delete=sm,oe.prototype.get=am,oe.prototype.has=um,oe.prototype.set=lm;function ku(t,i){var n=G(t),l=!n&&hr(t),c=!n&&!l&&Xe(t),m=!n&&!l&&!c&&kr(t),d=n||l||c||m,y=d?as(t.length,bp):[],b=y.length;for(var C in t)(i||tt.call(t,C))&&!(d&&(C=="length"||c&&(C=="offset"||C=="parent")||m&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Me(C,b)))&&y.push(C);return y}function Vu(t){var i=t.length;return i?t[Cs(0,i-1)]:r}function cm(t,i){return Lo(Et(t),ar(i,0,t.length))}function hm(t){return Lo(Et(t))}function ms(t,i,n){(n!==r&&!ne(t[i],n)||n===r&&!(i in t))&&Ee(t,i,n)}function ci(t,i,n){var l=t[i];(!(tt.call(t,i)&&ne(l,n))||n===r&&!(i in t))&&Ee(t,i,n)}function fo(t,i){for(var n=t.length;n--;)if(ne(t[n][0],i))return n;return-1}function fm(t,i,n,l){return ze(t,function(c,m,d){i(l,c,n(c),d)}),l}function Gu(t,i){return t&&me(i,yt(i),t)}function pm(t,i){return t&&me(i,It(i),t)}function Ee(t,i,n){i=="__proto__"&&so?so(t,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[i]=n}function gs(t,i){for(var n=-1,l=i.length,c=x(l),m=t==null;++n<l;)c[n]=m?r:Xs(t,i[n]);return c}function ar(t,i,n){return t===t&&(n!==r&&(t=t<=n?t:n),i!==r&&(t=t>=i?t:i)),t}function Xt(t,i,n,l,c,m){var d,y=i&D,b=i&Y,C=i&M;if(n&&(d=c?n(t,l,c,m):n(t)),d!==r)return d;if(!at(t))return t;var _=G(t);if(_){if(d=eg(t),!y)return Et(t,d)}else{var S=wt(t),O=S==Wi||S==ja;if(Xe(t))return ul(t,y);if(S==Le||S==wr||O&&!c){if(d=b||O?{}:Sl(t),!y)return b?Wm(t,pm(d,t)):Hm(t,Gu(d,t))}else{if(!it[S])return c?t:{};d=rg(t,S,y)}}m||(m=new oe);var I=m.get(t);if(I)return I;m.set(t,d),rc(t)?t.forEach(function(k){d.add(Xt(k,i,n,k,t,m))}):tc(t)&&t.forEach(function(k,W){d.set(W,Xt(k,i,n,W,t,m))});var F=C?b?Fs:Rs:b?It:yt,j=_?r:F(t);return $t(j||t,function(k,W){j&&(W=k,k=t[W]),ci(d,W,Xt(k,i,n,W,t,m))}),d}function mm(t){var i=yt(t);return function(n){return Nu(n,t,i)}}function Nu(t,i,n){var l=n.length;if(t==null)return!l;for(t=rt(t);l--;){var c=n[l],m=i[c],d=t[c];if(d===r&&!(c in t)||!m(d))return!1}return!0}function ju(t,i,n){if(typeof t!="function")throw new qt(h);return yi(function(){t.apply(r,n)},i)}function hi(t,i,n,l){var c=-1,m=Xi,d=!0,y=t.length,b=[],C=i.length;if(!y)return b;n&&(i=nt(i,Vt(n))),l?(m=es,d=!1):i.length>=s&&(m=oi,d=!1,i=new sr(i));t:for(;++c<y;){var _=t[c],S=n==null?_:n(_);if(_=l||_!==0?_:0,d&&S===S){for(var O=C;O--;)if(i[O]===S)continue t;b.push(_)}else m(i,S,l)||b.push(_)}return b}var ze=pl(pe),Uu=pl(ys,!0);function gm(t,i){var n=!0;return ze(t,function(l,c,m){return n=!!i(l,c,m),n}),n}function po(t,i,n){for(var l=-1,c=t.length;++l<c;){var m=t[l],d=i(m);if(d!=null&&(y===r?d===d&&!Nt(d):n(d,y)))var y=d,b=m}return b}function dm(t,i,n,l){var c=t.length;for(n=N(n),n<0&&(n=-n>c?0:c+n),l=l===r||l>c?c:N(l),l<0&&(l+=c),l=n>l?0:oc(l);n<l;)t[n++]=i;return t}function Bu(t,i){var n=[];return ze(t,function(l,c,m){i(l,c,m)&&n.push(l)}),n}function bt(t,i,n,l,c){var m=-1,d=t.length;for(n||(n=og),c||(c=[]);++m<d;){var y=t[m];i>0&&n(y)?i>1?bt(y,i-1,n,l,c):Ue(c,y):l||(c[c.length]=y)}return c}var ds=ml(),Hu=ml(!0);function pe(t,i){return t&&ds(t,i,yt)}function ys(t,i){return t&&Hu(t,i,yt)}function mo(t,i){return je(i,function(n){return Ae(t[n])})}function ur(t,i){i=qe(i,t);for(var n=0,l=i.length;t!=null&&n<l;)t=t[ge(i[n++])];return n&&n==l?t:r}function Wu(t,i,n){var l=i(t);return G(t)?l:Ue(l,n(t))}function _t(t){return t==null?t===r?Wh:Bh:or&&or in rt(t)?Jm(t):hg(t)}function vs(t,i){return t>i}function ym(t,i){return t!=null&&tt.call(t,i)}function vm(t,i){return t!=null&&i in rt(t)}function bm(t,i,n){return t>=xt(i,n)&&t<mt(i,n)}function bs(t,i,n){for(var l=n?es:Xi,c=t[0].length,m=t.length,d=m,y=x(m),b=1/0,C=[];d--;){var _=t[d];d&&i&&(_=nt(_,Vt(i))),b=xt(_.length,b),y[d]=!n&&(i||c>=120&&_.length>=120)?new sr(d&&_):r}_=t[0];var S=-1,O=y[0];t:for(;++S<c&&C.length<b;){var I=_[S],F=i?i(I):I;if(I=n||I!==0?I:0,!(O?oi(O,F):l(C,F,n))){for(d=m;--d;){var j=y[d];if(!(j?oi(j,F):l(t[d],F,n)))continue t}O&&O.push(F),C.push(I)}}return C}function Pm(t,i,n,l){return pe(t,function(c,m,d){i(l,n(c),m,d)}),l}function fi(t,i,n){i=qe(i,t),t=Il(t,i);var l=t==null?t:t[ge(Kt(i))];return l==null?r:kt(l,t,n)}function zu(t){return ut(t)&&_t(t)==wr}function Tm(t){return ut(t)&&_t(t)==ii}function xm(t){return ut(t)&&_t(t)==Jr}function pi(t,i,n,l,c){return t===i?!0:t==null||i==null||!ut(t)&&!ut(i)?t!==t&&i!==i:wm(t,i,n,l,pi,c)}function wm(t,i,n,l,c,m){var d=G(t),y=G(i),b=d?Bi:wt(t),C=y?Bi:wt(i);b=b==wr?Le:b,C=C==wr?Le:C;var _=b==Le,S=C==Le,O=b==C;if(O&&Xe(t)){if(!Xe(i))return!1;d=!0,_=!1}if(O&&!_)return m||(m=new oe),d||kr(t)?Cl(t,i,n,l,c,m):Qm(t,i,b,n,l,c,m);if(!(n&H)){var I=_&&tt.call(t,"__wrapped__"),F=S&&tt.call(i,"__wrapped__");if(I||F){var j=I?t.value():t,k=F?i.value():i;return m||(m=new oe),c(j,k,n,l,m)}}return O?(m||(m=new oe),Km(t,i,n,l,c,m)):!1}function Cm(t){return ut(t)&&wt(t)==ee}function Ps(t,i,n,l){var c=n.length,m=c,d=!l;if(t==null)return!m;for(t=rt(t);c--;){var y=n[c];if(d&&y[2]?y[1]!==t[y[0]]:!(y[0]in t))return!1}for(;++c<m;){y=n[c];var b=y[0],C=t[b],_=y[1];if(d&&y[2]){if(C===r&&!(b in t))return!1}else{var S=new oe;if(l)var O=l(C,_,b,t,i,S);if(!(O===r?pi(_,C,H|B,l,S):O))return!1}}return!0}function $u(t){if(!at(t)||sg(t))return!1;var i=Ae(t)?Cp:mf;return i.test(cr(t))}function _m(t){return ut(t)&&_t(t)==ti}function Lm(t){return ut(t)&&wt(t)==re}function Sm(t){return ut(t)&&Mo(t.length)&&!!ot[_t(t)]}function qu(t){return typeof t=="function"?t:t==null?Mt:typeof t=="object"?G(t)?Qu(t[0],t[1]):Xu(t):gc(t)}function Ts(t){if(!di(t))return Dp(t);var i=[];for(var n in rt(t))tt.call(t,n)&&n!="constructor"&&i.push(n);return i}function Om(t){if(!at(t))return cg(t);var i=di(t),n=[];for(var l in t)l=="constructor"&&(i||!tt.call(t,l))||n.push(l);return n}function xs(t,i){return t<i}function Yu(t,i){var n=-1,l=Dt(t)?x(t.length):[];return ze(t,function(c,m,d){l[++n]=i(c,m,d)}),l}function Xu(t){var i=Vs(t);return i.length==1&&i[0][2]?El(i[0][0],i[0][1]):function(n){return n===t||Ps(n,t,i)}}function Qu(t,i){return Ns(t)&&Ol(i)?El(ge(t),i):function(n){var l=Xs(n,t);return l===r&&l===i?Qs(n,t):pi(i,l,H|B)}}function go(t,i,n,l,c){t!==i&&ds(i,function(m,d){if(c||(c=new oe),at(m))Em(t,i,d,n,go,l,c);else{var y=l?l(Us(t,d),m,d+"",t,i,c):r;y===r&&(y=m),ms(t,d,y)}},It)}function Em(t,i,n,l,c,m,d){var y=Us(t,n),b=Us(i,n),C=d.get(b);if(C){ms(t,n,C);return}var _=m?m(y,b,n+"",t,i,d):r,S=_===r;if(S){var O=G(b),I=!O&&Xe(b),F=!O&&!I&&kr(b);_=b,O||I||F?G(y)?_=y:lt(y)?_=Et(y):I?(S=!1,_=ul(b,!0)):F?(S=!1,_=ll(b,!0)):_=[]:vi(b)||hr(b)?(_=y,hr(y)?_=nc(y):(!at(y)||Ae(y))&&(_=Sl(b))):S=!1}S&&(d.set(b,_),c(_,b,l,m,d),d.delete(b)),ms(t,n,_)}function Ku(t,i){var n=t.length;if(n)return i+=i<0?n:0,Me(i,n)?t[i]:r}function Ju(t,i,n){i.length?i=nt(i,function(m){return G(m)?function(d){return ur(d,m.length===1?m[0]:m)}:m}):i=[Mt];var l=-1;i=nt(i,Vt(R()));var c=Yu(t,function(m,d,y){var b=nt(i,function(C){return C(m)});return{criteria:b,index:++l,value:m}});return rp(c,function(m,d){return Bm(m,d,n)})}function Dm(t,i){return Zu(t,i,function(n,l){return Qs(t,l)})}function Zu(t,i,n){for(var l=-1,c=i.length,m={};++l<c;){var d=i[l],y=ur(t,d);n(y,d)&&mi(m,qe(d,t),y)}return m}function Im(t){return function(i){return ur(i,t)}}function ws(t,i,n,l){var c=l?ep:Lr,m=-1,d=i.length,y=t;for(t===i&&(i=Et(i)),n&&(y=nt(t,Vt(n)));++m<d;)for(var b=0,C=i[m],_=n?n(C):C;(b=c(y,_,b,l))>-1;)y!==t&&no.call(y,b,1),no.call(t,b,1);return t}function tl(t,i){for(var n=t?i.length:0,l=n-1;n--;){var c=i[n];if(n==l||c!==m){var m=c;Me(c)?no.call(t,c,1):Ss(t,c)}}return t}function Cs(t,i){return t+uo(Ru()*(i-t+1))}function Mm(t,i,n,l){for(var c=-1,m=mt(ao((i-t)/(n||1)),0),d=x(m);m--;)d[l?m:++c]=t,t+=n;return d}function _s(t,i){var n="";if(!t||i<1||i>Ne)return n;do i%2&&(n+=t),i=uo(i/2),i&&(t+=t);while(i);return n}function U(t,i){return Bs(Dl(t,i,Mt),t+"")}function Am(t){return Vu(Vr(t))}function Rm(t,i){var n=Vr(t);return Lo(n,ar(i,0,n.length))}function mi(t,i,n,l){if(!at(t))return t;i=qe(i,t);for(var c=-1,m=i.length,d=m-1,y=t;y!=null&&++c<m;){var b=ge(i[c]),C=n;if(b==="__proto__"||b==="constructor"||b==="prototype")return t;if(c!=d){var _=y[b];C=l?l(_,b,y):r,C===r&&(C=at(_)?_:Me(i[c+1])?[]:{})}ci(y,b,C),y=y[b]}return t}var el=lo?function(t,i){return lo.set(t,i),t}:Mt,Fm=so?function(t,i){return so(t,"toString",{configurable:!0,enumerable:!1,value:Js(i),writable:!0})}:Mt;function km(t){return Lo(Vr(t))}function Qt(t,i,n){var l=-1,c=t.length;i<0&&(i=-i>c?0:c+i),n=n>c?c:n,n<0&&(n+=c),c=i>n?0:n-i>>>0,i>>>=0;for(var m=x(c);++l<c;)m[l]=t[l+i];return m}function Vm(t,i){var n;return ze(t,function(l,c,m){return n=i(l,c,m),!n}),!!n}function yo(t,i,n){var l=0,c=t==null?l:t.length;if(typeof i=="number"&&i===i&&c<=Gh){for(;l<c;){var m=l+c>>>1,d=t[m];d!==null&&!Nt(d)&&(n?d<=i:d<i)?l=m+1:c=m}return c}return Ls(t,i,Mt,n)}function Ls(t,i,n,l){var c=0,m=t==null?0:t.length;if(m===0)return 0;i=n(i);for(var d=i!==i,y=i===null,b=Nt(i),C=i===r;c<m;){var _=uo((c+m)/2),S=n(t[_]),O=S!==r,I=S===null,F=S===S,j=Nt(S);if(d)var k=l||F;else C?k=F&&(l||O):y?k=F&&O&&(l||!I):b?k=F&&O&&!I&&(l||!j):I||j?k=!1:k=l?S<=i:S<i;k?c=_+1:m=_}return xt(m,Vh)}function rl(t,i){for(var n=-1,l=t.length,c=0,m=[];++n<l;){var d=t[n],y=i?i(d):d;if(!n||!ne(y,b)){var b=y;m[c++]=d===0?0:d}}return m}function il(t){return typeof t=="number"?t:Nt(t)?Ui:+t}function Gt(t){if(typeof t=="string")return t;if(G(t))return nt(t,Gt)+"";if(Nt(t))return Fu?Fu.call(t):"";var i=t+"";return i=="0"&&1/t==-rr?"-0":i}function $e(t,i,n){var l=-1,c=Xi,m=t.length,d=!0,y=[],b=y;if(n)d=!1,c=es;else if(m>=s){var C=i?null:Ym(t);if(C)return Ki(C);d=!1,c=oi,b=new sr}else b=i?[]:y;t:for(;++l<m;){var _=t[l],S=i?i(_):_;if(_=n||_!==0?_:0,d&&S===S){for(var O=b.length;O--;)if(b[O]===S)continue t;i&&b.push(S),y.push(_)}else c(b,S,n)||(b!==y&&b.push(S),y.push(_))}return y}function Ss(t,i){return i=qe(i,t),t=Il(t,i),t==null||delete t[ge(Kt(i))]}function ol(t,i,n,l){return mi(t,i,n(ur(t,i)),l)}function vo(t,i,n,l){for(var c=t.length,m=l?c:-1;(l?m--:++m<c)&&i(t[m],m,t););return n?Qt(t,l?0:m,l?m+1:c):Qt(t,l?m+1:0,l?c:m)}function nl(t,i){var n=t;return n instanceof z&&(n=n.value()),rs(i,function(l,c){return c.func.apply(c.thisArg,Ue([l],c.args))},n)}function Os(t,i,n){var l=t.length;if(l<2)return l?$e(t[0]):[];for(var c=-1,m=x(l);++c<l;)for(var d=t[c],y=-1;++y<l;)y!=c&&(m[c]=hi(m[c]||d,t[y],i,n));return $e(bt(m,1),i,n)}function sl(t,i,n){for(var l=-1,c=t.length,m=i.length,d={};++l<c;){var y=l<m?i[l]:r;n(d,t[l],y)}return d}function Es(t){return lt(t)?t:[]}function Ds(t){return typeof t=="function"?t:Mt}function qe(t,i){return G(t)?t:Ns(t,i)?[t]:Fl(Z(t))}var Gm=U;function Ye(t,i,n){var l=t.length;return n=n===r?l:n,!i&&n>=l?t:Qt(t,i,n)}var al=_p||function(t){return dt.clearTimeout(t)};function ul(t,i){if(i)return t.slice();var n=t.length,l=Eu?Eu(n):new t.constructor(n);return t.copy(l),l}function Is(t){var i=new t.constructor(t.byteLength);return new io(i).set(new io(t)),i}function Nm(t,i){var n=i?Is(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function jm(t){var i=new t.constructor(t.source,za.exec(t));return i.lastIndex=t.lastIndex,i}function Um(t){return li?rt(li.call(t)):{}}function ll(t,i){var n=i?Is(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function cl(t,i){if(t!==i){var n=t!==r,l=t===null,c=t===t,m=Nt(t),d=i!==r,y=i===null,b=i===i,C=Nt(i);if(!y&&!C&&!m&&t>i||m&&d&&b&&!y&&!C||l&&d&&b||!n&&b||!c)return 1;if(!l&&!m&&!C&&t<i||C&&n&&c&&!l&&!m||y&&n&&c||!d&&c||!b)return-1}return 0}function Bm(t,i,n){for(var l=-1,c=t.criteria,m=i.criteria,d=c.length,y=n.length;++l<d;){var b=cl(c[l],m[l]);if(b){if(l>=y)return b;var C=n[l];return b*(C=="desc"?-1:1)}}return t.index-i.index}function hl(t,i,n,l){for(var c=-1,m=t.length,d=n.length,y=-1,b=i.length,C=mt(m-d,0),_=x(b+C),S=!l;++y<b;)_[y]=i[y];for(;++c<d;)(S||c<m)&&(_[n[c]]=t[c]);for(;C--;)_[y++]=t[c++];return _}function fl(t,i,n,l){for(var c=-1,m=t.length,d=-1,y=n.length,b=-1,C=i.length,_=mt(m-y,0),S=x(_+C),O=!l;++c<_;)S[c]=t[c];for(var I=c;++b<C;)S[I+b]=i[b];for(;++d<y;)(O||c<m)&&(S[I+n[d]]=t[c++]);return S}function Et(t,i){var n=-1,l=t.length;for(i||(i=x(l));++n<l;)i[n]=t[n];return i}function me(t,i,n,l){var c=!n;n||(n={});for(var m=-1,d=i.length;++m<d;){var y=i[m],b=l?l(n[y],t[y],y,n,t):r;b===r&&(b=t[y]),c?Ee(n,y,b):ci(n,y,b)}return n}function Hm(t,i){return me(t,Gs(t),i)}function Wm(t,i){return me(t,_l(t),i)}function bo(t,i){return function(n,l){var c=G(n)?Xf:fm,m=i?i():{};return c(n,t,R(l,2),m)}}function Ar(t){return U(function(i,n){var l=-1,c=n.length,m=c>1?n[c-1]:r,d=c>2?n[2]:r;for(m=t.length>3&&typeof m=="function"?(c--,m):r,d&&Lt(n[0],n[1],d)&&(m=c<3?r:m,c=1),i=rt(i);++l<c;){var y=n[l];y&&t(i,y,l,m)}return i})}function pl(t,i){return function(n,l){if(n==null)return n;if(!Dt(n))return t(n,l);for(var c=n.length,m=i?c:-1,d=rt(n);(i?m--:++m<c)&&l(d[m],m,d)!==!1;);return n}}function ml(t){return function(i,n,l){for(var c=-1,m=rt(i),d=l(i),y=d.length;y--;){var b=d[t?y:++c];if(n(m[b],b,m)===!1)break}return i}}function zm(t,i,n){var l=i&st,c=gi(t);function m(){var d=this&&this!==dt&&this instanceof m?c:t;return d.apply(l?n:this,arguments)}return m}function gl(t){return function(i){i=Z(i);var n=Sr(i)?ie(i):r,l=n?n[0]:i.charAt(0),c=n?Ye(n,1).join(""):i.slice(1);return l[t]()+c}}function Rr(t){return function(i){return rs(pc(fc(i).replace(Ff,"")),t,"")}}function gi(t){return function(){var i=arguments;switch(i.length){case 0:return new t;case 1:return new t(i[0]);case 2:return new t(i[0],i[1]);case 3:return new t(i[0],i[1],i[2]);case 4:return new t(i[0],i[1],i[2],i[3]);case 5:return new t(i[0],i[1],i[2],i[3],i[4]);case 6:return new t(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=Mr(t.prototype),l=t.apply(n,i);return at(l)?l:n}}function $m(t,i,n){var l=gi(t);function c(){for(var m=arguments.length,d=x(m),y=m,b=Fr(c);y--;)d[y]=arguments[y];var C=m<3&&d[0]!==b&&d[m-1]!==b?[]:Be(d,b);if(m-=C.length,m<n)return Pl(t,i,Po,c.placeholder,r,d,C,r,r,n-m);var _=this&&this!==dt&&this instanceof c?l:t;return kt(_,this,d)}return c}function dl(t){return function(i,n,l){var c=rt(i);if(!Dt(i)){var m=R(n,3);i=yt(i),n=function(y){return m(c[y],y,c)}}var d=t(i,n,l);return d>-1?c[m?i[d]:d]:r}}function yl(t){return Ie(function(i){var n=i.length,l=n,c=Yt.prototype.thru;for(t&&i.reverse();l--;){var m=i[l];if(typeof m!="function")throw new qt(h);if(c&&!d&&Co(m)=="wrapper")var d=new Yt([],!0)}for(l=d?l:n;++l<n;){m=i[l];var y=Co(m),b=y=="wrapper"?ks(m):r;b&&js(b[0])&&b[1]==(_e|ce|he|Qr)&&!b[4].length&&b[9]==1?d=d[Co(b[0])].apply(d,b[3]):d=m.length==1&&js(m)?d[y]():d.thru(m)}return function(){var C=arguments,_=C[0];if(d&&C.length==1&&G(_))return d.plant(_).value();for(var S=0,O=n?i[S].apply(this,C):_;++S<n;)O=i[S].call(this,O);return O}})}function Po(t,i,n,l,c,m,d,y,b,C){var _=i&_e,S=i&st,O=i&ft,I=i&(ce|Tr),F=i&kn,j=O?r:gi(t);function k(){for(var W=arguments.length,$=x(W),jt=W;jt--;)$[jt]=arguments[jt];if(I)var St=Fr(k),Ut=op($,St);if(l&&($=hl($,l,c,I)),m&&($=fl($,m,d,I)),W-=Ut,I&&W<C){var ct=Be($,St);return Pl(t,i,Po,k.placeholder,n,$,ct,y,b,C-W)}var se=S?n:this,Fe=O?se[t]:t;return W=$.length,y?$=fg($,y):F&&W>1&&$.reverse(),_&&b<W&&($.length=b),this&&this!==dt&&this instanceof k&&(Fe=j||gi(Fe)),Fe.apply(se,$)}return k}function vl(t,i){return function(n,l){return Pm(n,t,i(l),{})}}function To(t,i){return function(n,l){var c;if(n===r&&l===r)return i;if(n!==r&&(c=n),l!==r){if(c===r)return l;typeof n=="string"||typeof l=="string"?(n=Gt(n),l=Gt(l)):(n=il(n),l=il(l)),c=t(n,l)}return c}}function Ms(t){return Ie(function(i){return i=nt(i,Vt(R())),U(function(n){var l=this;return t(i,function(c){return kt(c,l,n)})})})}function xo(t,i){i=i===r?" ":Gt(i);var n=i.length;if(n<2)return n?_s(i,t):i;var l=_s(i,ao(t/Or(i)));return Sr(i)?Ye(ie(l),0,t).join(""):l.slice(0,t)}function qm(t,i,n,l){var c=i&st,m=gi(t);function d(){for(var y=-1,b=arguments.length,C=-1,_=l.length,S=x(_+b),O=this&&this!==dt&&this instanceof d?m:t;++C<_;)S[C]=l[C];for(;b--;)S[C++]=arguments[++y];return kt(O,c?n:this,S)}return d}function bl(t){return function(i,n,l){return l&&typeof l!="number"&&Lt(i,n,l)&&(n=l=r),i=Re(i),n===r?(n=i,i=0):n=Re(n),l=l===r?i<n?1:-1:Re(l),Mm(i,n,l,t)}}function wo(t){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=Jt(i),n=Jt(n)),t(i,n)}}function Pl(t,i,n,l,c,m,d,y,b,C){var _=i&ce,S=_?d:r,O=_?r:d,I=_?m:r,F=_?r:m;i|=_?he:xr,i&=~(_?xr:he),i&er||(i&=~(st|ft));var j=[t,i,c,I,S,F,O,y,b,C],k=n.apply(r,j);return js(t)&&Ml(k,j),k.placeholder=l,Al(k,t,i)}function As(t){var i=pt[t];return function(n,l){if(n=Jt(n),l=l==null?0:xt(N(l),292),l&&Au(n)){var c=(Z(n)+"e").split("e"),m=i(c[0]+"e"+(+c[1]+l));return c=(Z(m)+"e").split("e"),+(c[0]+"e"+(+c[1]-l))}return i(n)}}var Ym=Dr&&1/Ki(new Dr([,-0]))[1]==rr?function(t){return new Dr(t)}:ea;function Tl(t){return function(i){var n=wt(i);return n==ee?ls(i):n==re?hp(i):ip(i,t(i))}}function De(t,i,n,l,c,m,d,y){var b=i&ft;if(!b&&typeof t!="function")throw new qt(h);var C=l?l.length:0;if(C||(i&=~(he|xr),l=c=r),d=d===r?d:mt(N(d),0),y=y===r?y:N(y),C-=c?c.length:0,i&xr){var _=l,S=c;l=c=r}var O=b?r:ks(t),I=[t,i,n,l,c,_,S,m,d,y];if(O&&lg(I,O),t=I[0],i=I[1],n=I[2],l=I[3],c=I[4],y=I[9]=I[9]===r?b?0:t.length:mt(I[9]-C,0),!y&&i&(ce|Tr)&&(i&=~(ce|Tr)),!i||i==st)var F=zm(t,i,n);else i==ce||i==Tr?F=$m(t,i,y):(i==he||i==(st|he))&&!c.length?F=qm(t,i,n,l):F=Po.apply(r,I);var j=O?el:Ml;return Al(j(F,I),t,i)}function xl(t,i,n,l){return t===r||ne(t,Er[n])&&!tt.call(l,n)?i:t}function wl(t,i,n,l,c,m){return at(t)&&at(i)&&(m.set(i,t),go(t,i,r,wl,m),m.delete(i)),t}function Xm(t){return vi(t)?r:t}function Cl(t,i,n,l,c,m){var d=n&H,y=t.length,b=i.length;if(y!=b&&!(d&&b>y))return!1;var C=m.get(t),_=m.get(i);if(C&&_)return C==i&&_==t;var S=-1,O=!0,I=n&B?new sr:r;for(m.set(t,i),m.set(i,t);++S<y;){var F=t[S],j=i[S];if(l)var k=d?l(j,F,S,i,t,m):l(F,j,S,t,i,m);if(k!==r){if(k)continue;O=!1;break}if(I){if(!is(i,function(W,$){if(!oi(I,$)&&(F===W||c(F,W,n,l,m)))return I.push($)})){O=!1;break}}else if(!(F===j||c(F,j,n,l,m))){O=!1;break}}return m.delete(t),m.delete(i),O}function Qm(t,i,n,l,c,m,d){switch(n){case Cr:if(t.byteLength!=i.byteLength||t.byteOffset!=i.byteOffset)return!1;t=t.buffer,i=i.buffer;case ii:return!(t.byteLength!=i.byteLength||!m(new io(t),new io(i)));case Kr:case Jr:case Zr:return ne(+t,+i);case Hi:return t.name==i.name&&t.message==i.message;case ti:case ei:return t==i+"";case ee:var y=ls;case re:var b=l&H;if(y||(y=Ki),t.size!=i.size&&!b)return!1;var C=d.get(t);if(C)return C==i;l|=B,d.set(t,i);var _=Cl(y(t),y(i),l,c,m,d);return d.delete(t),_;case zi:if(li)return li.call(t)==li.call(i)}return!1}function Km(t,i,n,l,c,m){var d=n&H,y=Rs(t),b=y.length,C=Rs(i),_=C.length;if(b!=_&&!d)return!1;for(var S=b;S--;){var O=y[S];if(!(d?O in i:tt.call(i,O)))return!1}var I=m.get(t),F=m.get(i);if(I&&F)return I==i&&F==t;var j=!0;m.set(t,i),m.set(i,t);for(var k=d;++S<b;){O=y[S];var W=t[O],$=i[O];if(l)var jt=d?l($,W,O,i,t,m):l(W,$,O,t,i,m);if(!(jt===r?W===$||c(W,$,n,l,m):jt)){j=!1;break}k||(k=O=="constructor")}if(j&&!k){var St=t.constructor,Ut=i.constructor;St!=Ut&&"constructor"in t&&"constructor"in i&&!(typeof St=="function"&&St instanceof St&&typeof Ut=="function"&&Ut instanceof Ut)&&(j=!1)}return m.delete(t),m.delete(i),j}function Ie(t){return Bs(Dl(t,r,Nl),t+"")}function Rs(t){return Wu(t,yt,Gs)}function Fs(t){return Wu(t,It,_l)}var ks=lo?function(t){return lo.get(t)}:ea;function Co(t){for(var i=t.name+"",n=Ir[i],l=tt.call(Ir,i)?n.length:0;l--;){var c=n[l],m=c.func;if(m==null||m==t)return c.name}return i}function Fr(t){var i=tt.call(f,"placeholder")?f:t;return i.placeholder}function R(){var t=f.iteratee||Zs;return t=t===Zs?qu:t,arguments.length?t(arguments[0],arguments[1]):t}function _o(t,i){var n=t.__data__;return ng(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Vs(t){for(var i=yt(t),n=i.length;n--;){var l=i[n],c=t[l];i[n]=[l,c,Ol(c)]}return i}function lr(t,i){var n=up(t,i);return $u(n)?n:r}function Jm(t){var i=tt.call(t,or),n=t[or];try{t[or]=r;var l=!0}catch(m){}var c=eo.call(t);return l&&(i?t[or]=n:delete t[or]),c}var Gs=hs?function(t){return t==null?[]:(t=rt(t),je(hs(t),function(i){return Iu.call(t,i)}))}:ra,_l=hs?function(t){for(var i=[];t;)Ue(i,Gs(t)),t=oo(t);return i}:ra,wt=_t;(fs&&wt(new fs(new ArrayBuffer(1)))!=Cr||si&&wt(new si)!=ee||ps&&wt(ps.resolve())!=Ua||Dr&&wt(new Dr)!=re||ai&&wt(new ai)!=ri)&&(wt=function(t){var i=_t(t),n=i==Le?t.constructor:r,l=n?cr(n):"";if(l)switch(l){case Rp:return Cr;case Fp:return ee;case kp:return Ua;case Vp:return re;case Gp:return ri}return i});function Zm(t,i,n){for(var l=-1,c=n.length;++l<c;){var m=n[l],d=m.size;switch(m.type){case"drop":t+=d;break;case"dropRight":i-=d;break;case"take":i=xt(i,t+d);break;case"takeRight":t=mt(t,i-d);break}}return{start:t,end:i}}function tg(t){var i=t.match(sf);return i?i[1].split(af):[]}function Ll(t,i,n){i=qe(i,t);for(var l=-1,c=i.length,m=!1;++l<c;){var d=ge(i[l]);if(!(m=t!=null&&n(t,d)))break;t=t[d]}return m||++l!=c?m:(c=t==null?0:t.length,!!c&&Mo(c)&&Me(d,c)&&(G(t)||hr(t)))}function eg(t){var i=t.length,n=new t.constructor(i);return i&&typeof t[0]=="string"&&tt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Sl(t){return typeof t.constructor=="function"&&!di(t)?Mr(oo(t)):{}}function rg(t,i,n){var l=t.constructor;switch(i){case ii:return Is(t);case Kr:case Jr:return new l(+t);case Cr:return Nm(t,n);case Vn:case Gn:case Nn:case jn:case Un:case Bn:case Hn:case Wn:case zn:return ll(t,n);case ee:return new l;case Zr:case ei:return new l(t);case ti:return jm(t);case re:return new l;case zi:return Um(t)}}function ig(t,i){var n=i.length;if(!n)return t;var l=n-1;return i[l]=(n>1?"& ":"")+i[l],i=i.join(n>2?", ":" "),t.replace(nf,`{
/* [wrapped with `+i+`] */
`)}function og(t){return G(t)||hr(t)||!!(Mu&&t&&t[Mu])}function Me(t,i){var n=typeof t;return i=i!=null?i:Ne,!!i&&(n=="number"||n!="symbol"&&df.test(t))&&t>-1&&t%1==0&&t<i}function Lt(t,i,n){if(!at(n))return!1;var l=typeof i;return(l=="number"?Dt(n)&&Me(i,n.length):l=="string"&&i in n)?ne(n[i],t):!1}function Ns(t,i){if(G(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Nt(t)?!0:tf.test(t)||!Zh.test(t)||i!=null&&t in rt(i)}function ng(t){var i=typeof t;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?t!=="__proto__":t===null}function js(t){var i=Co(t),n=f[i];if(typeof n!="function"||!(i in z.prototype))return!1;if(t===n)return!0;var l=ks(n);return!!l&&t===l[0]}function sg(t){return!!Ou&&Ou in t}var ag=Zi?Ae:ia;function di(t){var i=t&&t.constructor,n=typeof i=="function"&&i.prototype||Er;return t===n}function Ol(t){return t===t&&!at(t)}function El(t,i){return function(n){return n==null?!1:n[t]===i&&(i!==r||t in rt(n))}}function ug(t){var i=Do(t,function(l){return n.size===T&&n.clear(),l}),n=i.cache;return i}function lg(t,i){var n=t[1],l=i[1],c=n|l,m=c<(st|ft|_e),d=l==_e&&n==ce||l==_e&&n==Qr&&t[7].length<=i[8]||l==(_e|Qr)&&i[7].length<=i[8]&&n==ce;if(!(m||d))return t;l&st&&(t[2]=i[2],c|=n&st?0:er);var y=i[3];if(y){var b=t[3];t[3]=b?hl(b,y,i[4]):y,t[4]=b?Be(t[3],L):i[4]}return y=i[5],y&&(b=t[5],t[5]=b?fl(b,y,i[6]):y,t[6]=b?Be(t[5],L):i[6]),y=i[7],y&&(t[7]=y),l&_e&&(t[8]=t[8]==null?i[8]:xt(t[8],i[8])),t[9]==null&&(t[9]=i[9]),t[0]=i[0],t[1]=c,t}function cg(t){var i=[];if(t!=null)for(var n in rt(t))i.push(n);return i}function hg(t){return eo.call(t)}function Dl(t,i,n){return i=mt(i===r?t.length-1:i,0),function(){for(var l=arguments,c=-1,m=mt(l.length-i,0),d=x(m);++c<m;)d[c]=l[i+c];c=-1;for(var y=x(i+1);++c<i;)y[c]=l[c];return y[i]=n(d),kt(t,this,y)}}function Il(t,i){return i.length<2?t:ur(t,Qt(i,0,-1))}function fg(t,i){for(var n=t.length,l=xt(i.length,n),c=Et(t);l--;){var m=i[l];t[l]=Me(m,n)?c[m]:r}return t}function Us(t,i){if(!(i==="constructor"&&typeof t[i]=="function")&&i!="__proto__")return t[i]}var Ml=Rl(el),yi=Sp||function(t,i){return dt.setTimeout(t,i)},Bs=Rl(Fm);function Al(t,i,n){var l=i+"";return Bs(t,ig(l,pg(tg(l),n)))}function Rl(t){var i=0,n=0;return function(){var l=Ip(),c=Ah-(l-n);if(n=l,c>0){if(++i>=Mh)return arguments[0]}else i=0;return t.apply(r,arguments)}}function Lo(t,i){var n=-1,l=t.length,c=l-1;for(i=i===r?l:i;++n<i;){var m=Cs(n,c),d=t[m];t[m]=t[n],t[n]=d}return t.length=i,t}var Fl=ug(function(t){var i=[];return t.charCodeAt(0)===46&&i.push(""),t.replace(ef,function(n,l,c,m){i.push(c?m.replace(cf,"$1"):l||n)}),i});function ge(t){if(typeof t=="string"||Nt(t))return t;var i=t+"";return i=="0"&&1/t==-rr?"-0":i}function cr(t){if(t!=null){try{return to.call(t)}catch(i){}try{return t+""}catch(i){}}return""}function pg(t,i){return $t(Nh,function(n){var l="_."+n[0];i&n[1]&&!Xi(t,l)&&t.push(l)}),t.sort()}function kl(t){if(t instanceof z)return t.clone();var i=new Yt(t.__wrapped__,t.__chain__);return i.__actions__=Et(t.__actions__),i.__index__=t.__index__,i.__values__=t.__values__,i}function mg(t,i,n){(n?Lt(t,i,n):i===r)?i=1:i=mt(N(i),0);var l=t==null?0:t.length;if(!l||i<1)return[];for(var c=0,m=0,d=x(ao(l/i));c<l;)d[m++]=Qt(t,c,c+=i);return d}function gg(t){for(var i=-1,n=t==null?0:t.length,l=0,c=[];++i<n;){var m=t[i];m&&(c[l++]=m)}return c}function dg(){var t=arguments.length;if(!t)return[];for(var i=x(t-1),n=arguments[0],l=t;l--;)i[l-1]=arguments[l];return Ue(G(n)?Et(n):[n],bt(i,1))}var yg=U(function(t,i){return lt(t)?hi(t,bt(i,1,lt,!0)):[]}),vg=U(function(t,i){var n=Kt(i);return lt(n)&&(n=r),lt(t)?hi(t,bt(i,1,lt,!0),R(n,2)):[]}),bg=U(function(t,i){var n=Kt(i);return lt(n)&&(n=r),lt(t)?hi(t,bt(i,1,lt,!0),r,n):[]});function Pg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),Qt(t,i<0?0:i,l)):[]}function Tg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),i=l-i,Qt(t,0,i<0?0:i)):[]}function xg(t,i){return t&&t.length?vo(t,R(i,3),!0,!0):[]}function wg(t,i){return t&&t.length?vo(t,R(i,3),!0):[]}function Cg(t,i,n,l){var c=t==null?0:t.length;return c?(n&&typeof n!="number"&&Lt(t,i,n)&&(n=0,l=c),dm(t,i,n,l)):[]}function Vl(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=n==null?0:N(n);return c<0&&(c=mt(l+c,0)),Qi(t,R(i,3),c)}function Gl(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=l-1;return n!==r&&(c=N(n),c=n<0?mt(l+c,0):xt(c,l-1)),Qi(t,R(i,3),c,!0)}function Nl(t){var i=t==null?0:t.length;return i?bt(t,1):[]}function _g(t){var i=t==null?0:t.length;return i?bt(t,rr):[]}function Lg(t,i){var n=t==null?0:t.length;return n?(i=i===r?1:N(i),bt(t,i)):[]}function Sg(t){for(var i=-1,n=t==null?0:t.length,l={};++i<n;){var c=t[i];l[c[0]]=c[1]}return l}function jl(t){return t&&t.length?t[0]:r}function Og(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=n==null?0:N(n);return c<0&&(c=mt(l+c,0)),Lr(t,i,c)}function Eg(t){var i=t==null?0:t.length;return i?Qt(t,0,-1):[]}var Dg=U(function(t){var i=nt(t,Es);return i.length&&i[0]===t[0]?bs(i):[]}),Ig=U(function(t){var i=Kt(t),n=nt(t,Es);return i===Kt(n)?i=r:n.pop(),n.length&&n[0]===t[0]?bs(n,R(i,2)):[]}),Mg=U(function(t){var i=Kt(t),n=nt(t,Es);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===t[0]?bs(n,r,i):[]});function Ag(t,i){return t==null?"":Ep.call(t,i)}function Kt(t){var i=t==null?0:t.length;return i?t[i-1]:r}function Rg(t,i,n){var l=t==null?0:t.length;if(!l)return-1;var c=l;return n!==r&&(c=N(n),c=c<0?mt(l+c,0):xt(c,l-1)),i===i?pp(t,i,c):Qi(t,Pu,c,!0)}function Fg(t,i){return t&&t.length?Ku(t,N(i)):r}var kg=U(Ul);function Ul(t,i){return t&&t.length&&i&&i.length?ws(t,i):t}function Vg(t,i,n){return t&&t.length&&i&&i.length?ws(t,i,R(n,2)):t}function Gg(t,i,n){return t&&t.length&&i&&i.length?ws(t,i,r,n):t}var Ng=Ie(function(t,i){var n=t==null?0:t.length,l=gs(t,i);return tl(t,nt(i,function(c){return Me(c,n)?+c:c}).sort(cl)),l});function jg(t,i){var n=[];if(!(t&&t.length))return n;var l=-1,c=[],m=t.length;for(i=R(i,3);++l<m;){var d=t[l];i(d,l,t)&&(n.push(d),c.push(l))}return tl(t,c),n}function Hs(t){return t==null?t:Ap.call(t)}function Ug(t,i,n){var l=t==null?0:t.length;return l?(n&&typeof n!="number"&&Lt(t,i,n)?(i=0,n=l):(i=i==null?0:N(i),n=n===r?l:N(n)),Qt(t,i,n)):[]}function Bg(t,i){return yo(t,i)}function Hg(t,i,n){return Ls(t,i,R(n,2))}function Wg(t,i){var n=t==null?0:t.length;if(n){var l=yo(t,i);if(l<n&&ne(t[l],i))return l}return-1}function zg(t,i){return yo(t,i,!0)}function $g(t,i,n){return Ls(t,i,R(n,2),!0)}function qg(t,i){var n=t==null?0:t.length;if(n){var l=yo(t,i,!0)-1;if(ne(t[l],i))return l}return-1}function Yg(t){return t&&t.length?rl(t):[]}function Xg(t,i){return t&&t.length?rl(t,R(i,2)):[]}function Qg(t){var i=t==null?0:t.length;return i?Qt(t,1,i):[]}function Kg(t,i,n){return t&&t.length?(i=n||i===r?1:N(i),Qt(t,0,i<0?0:i)):[]}function Jg(t,i,n){var l=t==null?0:t.length;return l?(i=n||i===r?1:N(i),i=l-i,Qt(t,i<0?0:i,l)):[]}function Zg(t,i){return t&&t.length?vo(t,R(i,3),!1,!0):[]}function td(t,i){return t&&t.length?vo(t,R(i,3)):[]}var ed=U(function(t){return $e(bt(t,1,lt,!0))}),rd=U(function(t){var i=Kt(t);return lt(i)&&(i=r),$e(bt(t,1,lt,!0),R(i,2))}),id=U(function(t){var i=Kt(t);return i=typeof i=="function"?i:r,$e(bt(t,1,lt,!0),r,i)});function od(t){return t&&t.length?$e(t):[]}function nd(t,i){return t&&t.length?$e(t,R(i,2)):[]}function sd(t,i){return i=typeof i=="function"?i:r,t&&t.length?$e(t,r,i):[]}function Ws(t){if(!(t&&t.length))return[];var i=0;return t=je(t,function(n){if(lt(n))return i=mt(n.length,i),!0}),as(i,function(n){return nt(t,os(n))})}function Bl(t,i){if(!(t&&t.length))return[];var n=Ws(t);return i==null?n:nt(n,function(l){return kt(i,r,l)})}var ad=U(function(t,i){return lt(t)?hi(t,i):[]}),ud=U(function(t){return Os(je(t,lt))}),ld=U(function(t){var i=Kt(t);return lt(i)&&(i=r),Os(je(t,lt),R(i,2))}),cd=U(function(t){var i=Kt(t);return i=typeof i=="function"?i:r,Os(je(t,lt),r,i)}),hd=U(Ws);function fd(t,i){return sl(t||[],i||[],ci)}function pd(t,i){return sl(t||[],i||[],mi)}var md=U(function(t){var i=t.length,n=i>1?t[i-1]:r;return n=typeof n=="function"?(t.pop(),n):r,Bl(t,n)});function Hl(t){var i=f(t);return i.__chain__=!0,i}function gd(t,i){return i(t),t}function So(t,i){return i(t)}var dd=Ie(function(t){var i=t.length,n=i?t[0]:0,l=this.__wrapped__,c=function(m){return gs(m,t)};return i>1||this.__actions__.length||!(l instanceof z)||!Me(n)?this.thru(c):(l=l.slice(n,+n+(i?1:0)),l.__actions__.push({func:So,args:[c],thisArg:r}),new Yt(l,this.__chain__).thru(function(m){return i&&!m.length&&m.push(r),m}))});function yd(){return Hl(this)}function vd(){return new Yt(this.value(),this.__chain__)}function bd(){this.__values__===r&&(this.__values__=ic(this.value()));var t=this.__index__>=this.__values__.length,i=t?r:this.__values__[this.__index__++];return{done:t,value:i}}function Pd(){return this}function Td(t){for(var i,n=this;n instanceof ho;){var l=kl(n);l.__index__=0,l.__values__=r,i?c.__wrapped__=l:i=l;var c=l;n=n.__wrapped__}return c.__wrapped__=t,i}function xd(){var t=this.__wrapped__;if(t instanceof z){var i=t;return this.__actions__.length&&(i=new z(this)),i=i.reverse(),i.__actions__.push({func:So,args:[Hs],thisArg:r}),new Yt(i,this.__chain__)}return this.thru(Hs)}function wd(){return nl(this.__wrapped__,this.__actions__)}var Cd=bo(function(t,i,n){tt.call(t,n)?++t[n]:Ee(t,n,1)});function _d(t,i,n){var l=G(t)?vu:gm;return n&&Lt(t,i,n)&&(i=r),l(t,R(i,3))}function Ld(t,i){var n=G(t)?je:Bu;return n(t,R(i,3))}var Sd=dl(Vl),Od=dl(Gl);function Ed(t,i){return bt(Oo(t,i),1)}function Dd(t,i){return bt(Oo(t,i),rr)}function Id(t,i,n){return n=n===r?1:N(n),bt(Oo(t,i),n)}function Wl(t,i){var n=G(t)?$t:ze;return n(t,R(i,3))}function zl(t,i){var n=G(t)?Qf:Uu;return n(t,R(i,3))}var Md=bo(function(t,i,n){tt.call(t,n)?t[n].push(i):Ee(t,n,[i])});function Ad(t,i,n,l){t=Dt(t)?t:Vr(t),n=n&&!l?N(n):0;var c=t.length;return n<0&&(n=mt(c+n,0)),Ao(t)?n<=c&&t.indexOf(i,n)>-1:!!c&&Lr(t,i,n)>-1}var Rd=U(function(t,i,n){var l=-1,c=typeof i=="function",m=Dt(t)?x(t.length):[];return ze(t,function(d){m[++l]=c?kt(i,d,n):fi(d,i,n)}),m}),Fd=bo(function(t,i,n){Ee(t,n,i)});function Oo(t,i){var n=G(t)?nt:Yu;return n(t,R(i,3))}function kd(t,i,n,l){return t==null?[]:(G(i)||(i=i==null?[]:[i]),n=l?r:n,G(n)||(n=n==null?[]:[n]),Ju(t,i,n))}var Vd=bo(function(t,i,n){t[n?0:1].push(i)},function(){return[[],[]]});function Gd(t,i,n){var l=G(t)?rs:xu,c=arguments.length<3;return l(t,R(i,4),n,c,ze)}function Nd(t,i,n){var l=G(t)?Kf:xu,c=arguments.length<3;return l(t,R(i,4),n,c,Uu)}function jd(t,i){var n=G(t)?je:Bu;return n(t,Io(R(i,3)))}function Ud(t){var i=G(t)?Vu:Am;return i(t)}function Bd(t,i,n){(n?Lt(t,i,n):i===r)?i=1:i=N(i);var l=G(t)?cm:Rm;return l(t,i)}function Hd(t){var i=G(t)?hm:km;return i(t)}function Wd(t){if(t==null)return 0;if(Dt(t))return Ao(t)?Or(t):t.length;var i=wt(t);return i==ee||i==re?t.size:Ts(t).length}function zd(t,i,n){var l=G(t)?is:Vm;return n&&Lt(t,i,n)&&(i=r),l(t,R(i,3))}var $d=U(function(t,i){if(t==null)return[];var n=i.length;return n>1&&Lt(t,i[0],i[1])?i=[]:n>2&&Lt(i[0],i[1],i[2])&&(i=[i[0]]),Ju(t,bt(i,1),[])}),Eo=Lp||function(){return dt.Date.now()};function qd(t,i){if(typeof i!="function")throw new qt(h);return t=N(t),function(){if(--t<1)return i.apply(this,arguments)}}function $l(t,i,n){return i=n?r:i,i=t&&i==null?t.length:i,De(t,_e,r,r,r,r,i)}function ql(t,i){var n;if(typeof i!="function")throw new qt(h);return t=N(t),function(){return--t>0&&(n=i.apply(this,arguments)),t<=1&&(i=r),n}}var zs=U(function(t,i,n){var l=st;if(n.length){var c=Be(n,Fr(zs));l|=he}return De(t,l,i,n,c)}),Yl=U(function(t,i,n){var l=st|ft;if(n.length){var c=Be(n,Fr(Yl));l|=he}return De(i,l,t,n,c)});function Xl(t,i,n){i=n?r:i;var l=De(t,ce,r,r,r,r,r,i);return l.placeholder=Xl.placeholder,l}function Ql(t,i,n){i=n?r:i;var l=De(t,Tr,r,r,r,r,r,i);return l.placeholder=Ql.placeholder,l}function Kl(t,i,n){var l,c,m,d,y,b,C=0,_=!1,S=!1,O=!0;if(typeof t!="function")throw new qt(h);i=Jt(i)||0,at(n)&&(_=!!n.leading,S="maxWait"in n,m=S?mt(Jt(n.maxWait)||0,i):m,O="trailing"in n?!!n.trailing:O);function I(ct){var se=l,Fe=c;return l=c=r,C=ct,d=t.apply(Fe,se),d}function F(ct){return C=ct,y=yi(W,i),_?I(ct):d}function j(ct){var se=ct-b,Fe=ct-C,dc=i-se;return S?xt(dc,m-Fe):dc}function k(ct){var se=ct-b,Fe=ct-C;return b===r||se>=i||se<0||S&&Fe>=m}function W(){var ct=Eo();if(k(ct))return $(ct);y=yi(W,j(ct))}function $(ct){return y=r,O&&l?I(ct):(l=c=r,d)}function jt(){y!==r&&al(y),C=0,l=b=c=y=r}function St(){return y===r?d:$(Eo())}function Ut(){var ct=Eo(),se=k(ct);if(l=arguments,c=this,b=ct,se){if(y===r)return F(b);if(S)return al(y),y=yi(W,i),I(b)}return y===r&&(y=yi(W,i)),d}return Ut.cancel=jt,Ut.flush=St,Ut}var Yd=U(function(t,i){return ju(t,1,i)}),Xd=U(function(t,i,n){return ju(t,Jt(i)||0,n)});function Qd(t){return De(t,kn)}function Do(t,i){if(typeof t!="function"||i!=null&&typeof i!="function")throw new qt(h);var n=function(){var l=arguments,c=i?i.apply(this,l):l[0],m=n.cache;if(m.has(c))return m.get(c);var d=t.apply(this,l);return n.cache=m.set(c,d)||m,d};return n.cache=new(Do.Cache||Oe),n}Do.Cache=Oe;function Io(t){if(typeof t!="function")throw new qt(h);return function(){var i=arguments;switch(i.length){case 0:return!t.call(this);case 1:return!t.call(this,i[0]);case 2:return!t.call(this,i[0],i[1]);case 3:return!t.call(this,i[0],i[1],i[2])}return!t.apply(this,i)}}function Kd(t){return ql(2,t)}var Jd=Gm(function(t,i){i=i.length==1&&G(i[0])?nt(i[0],Vt(R())):nt(bt(i,1),Vt(R()));var n=i.length;return U(function(l){for(var c=-1,m=xt(l.length,n);++c<m;)l[c]=i[c].call(this,l[c]);return kt(t,this,l)})}),$s=U(function(t,i){var n=Be(i,Fr($s));return De(t,he,r,i,n)}),Jl=U(function(t,i){var n=Be(i,Fr(Jl));return De(t,xr,r,i,n)}),Zd=Ie(function(t,i){return De(t,Qr,r,r,r,i)});function ty(t,i){if(typeof t!="function")throw new qt(h);return i=i===r?i:N(i),U(t,i)}function ey(t,i){if(typeof t!="function")throw new qt(h);return i=i==null?0:mt(N(i),0),U(function(n){var l=n[i],c=Ye(n,0,i);return l&&Ue(c,l),kt(t,this,c)})}function ry(t,i,n){var l=!0,c=!0;if(typeof t!="function")throw new qt(h);return at(n)&&(l="leading"in n?!!n.leading:l,c="trailing"in n?!!n.trailing:c),Kl(t,i,{leading:l,maxWait:i,trailing:c})}function iy(t){return $l(t,1)}function oy(t,i){return $s(Ds(i),t)}function ny(){if(!arguments.length)return[];var t=arguments[0];return G(t)?t:[t]}function sy(t){return Xt(t,M)}function ay(t,i){return i=typeof i=="function"?i:r,Xt(t,M,i)}function uy(t){return Xt(t,D|M)}function ly(t,i){return i=typeof i=="function"?i:r,Xt(t,D|M,i)}function cy(t,i){return i==null||Nu(t,i,yt(i))}function ne(t,i){return t===i||t!==t&&i!==i}var hy=wo(vs),fy=wo(function(t,i){return t>=i}),hr=zu((function(){return arguments})())?zu:function(t){return ut(t)&&tt.call(t,"callee")&&!Iu.call(t,"callee")},G=x.isArray,py=fu?Vt(fu):Tm;function Dt(t){return t!=null&&Mo(t.length)&&!Ae(t)}function lt(t){return ut(t)&&Dt(t)}function my(t){return t===!0||t===!1||ut(t)&&_t(t)==Kr}var Xe=Op||ia,gy=pu?Vt(pu):xm;function dy(t){return ut(t)&&t.nodeType===1&&!vi(t)}function yy(t){if(t==null)return!0;if(Dt(t)&&(G(t)||typeof t=="string"||typeof t.splice=="function"||Xe(t)||kr(t)||hr(t)))return!t.length;var i=wt(t);if(i==ee||i==re)return!t.size;if(di(t))return!Ts(t).length;for(var n in t)if(tt.call(t,n))return!1;return!0}function vy(t,i){return pi(t,i)}function by(t,i,n){n=typeof n=="function"?n:r;var l=n?n(t,i):r;return l===r?pi(t,i,r,n):!!l}function qs(t){if(!ut(t))return!1;var i=_t(t);return i==Hi||i==Uh||typeof t.message=="string"&&typeof t.name=="string"&&!vi(t)}function Py(t){return typeof t=="number"&&Au(t)}function Ae(t){if(!at(t))return!1;var i=_t(t);return i==Wi||i==ja||i==jh||i==Hh}function Zl(t){return typeof t=="number"&&t==N(t)}function Mo(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Ne}function at(t){var i=typeof t;return t!=null&&(i=="object"||i=="function")}function ut(t){return t!=null&&typeof t=="object"}var tc=mu?Vt(mu):Cm;function Ty(t,i){return t===i||Ps(t,i,Vs(i))}function xy(t,i,n){return n=typeof n=="function"?n:r,Ps(t,i,Vs(i),n)}function wy(t){return ec(t)&&t!=+t}function Cy(t){if(ag(t))throw new V(u);return $u(t)}function _y(t){return t===null}function Ly(t){return t==null}function ec(t){return typeof t=="number"||ut(t)&&_t(t)==Zr}function vi(t){if(!ut(t)||_t(t)!=Le)return!1;var i=oo(t);if(i===null)return!0;var n=tt.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&to.call(n)==xp}var Ys=gu?Vt(gu):_m;function Sy(t){return Zl(t)&&t>=-Ne&&t<=Ne}var rc=du?Vt(du):Lm;function Ao(t){return typeof t=="string"||!G(t)&&ut(t)&&_t(t)==ei}function Nt(t){return typeof t=="symbol"||ut(t)&&_t(t)==zi}var kr=yu?Vt(yu):Sm;function Oy(t){return t===r}function Ey(t){return ut(t)&&wt(t)==ri}function Dy(t){return ut(t)&&_t(t)==zh}var Iy=wo(xs),My=wo(function(t,i){return t<=i});function ic(t){if(!t)return[];if(Dt(t))return Ao(t)?ie(t):Et(t);if(ni&&t[ni])return cp(t[ni]());var i=wt(t),n=i==ee?ls:i==re?Ki:Vr;return n(t)}function Re(t){if(!t)return t===0?t:0;if(t=Jt(t),t===rr||t===-rr){var i=t<0?-1:1;return i*kh}return t===t?t:0}function N(t){var i=Re(t),n=i%1;return i===i?n?i-n:i:0}function oc(t){return t?ar(N(t),0,fe):0}function Jt(t){if(typeof t=="number")return t;if(Nt(t))return Ui;if(at(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=at(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=wu(t);var n=pf.test(t);return n||gf.test(t)?qf(t.slice(2),n?2:8):ff.test(t)?Ui:+t}function nc(t){return me(t,It(t))}function Ay(t){return t?ar(N(t),-Ne,Ne):t===0?t:0}function Z(t){return t==null?"":Gt(t)}var Ry=Ar(function(t,i){if(di(i)||Dt(i)){me(i,yt(i),t);return}for(var n in i)tt.call(i,n)&&ci(t,n,i[n])}),sc=Ar(function(t,i){me(i,It(i),t)}),Ro=Ar(function(t,i,n,l){me(i,It(i),t,l)}),Fy=Ar(function(t,i,n,l){me(i,yt(i),t,l)}),ky=Ie(gs);function Vy(t,i){var n=Mr(t);return i==null?n:Gu(n,i)}var Gy=U(function(t,i){t=rt(t);var n=-1,l=i.length,c=l>2?i[2]:r;for(c&&Lt(i[0],i[1],c)&&(l=1);++n<l;)for(var m=i[n],d=It(m),y=-1,b=d.length;++y<b;){var C=d[y],_=t[C];(_===r||ne(_,Er[C])&&!tt.call(t,C))&&(t[C]=m[C])}return t}),Ny=U(function(t){return t.push(r,wl),kt(ac,r,t)});function jy(t,i){return bu(t,R(i,3),pe)}function Uy(t,i){return bu(t,R(i,3),ys)}function By(t,i){return t==null?t:ds(t,R(i,3),It)}function Hy(t,i){return t==null?t:Hu(t,R(i,3),It)}function Wy(t,i){return t&&pe(t,R(i,3))}function zy(t,i){return t&&ys(t,R(i,3))}function $y(t){return t==null?[]:mo(t,yt(t))}function qy(t){return t==null?[]:mo(t,It(t))}function Xs(t,i,n){var l=t==null?r:ur(t,i);return l===r?n:l}function Yy(t,i){return t!=null&&Ll(t,i,ym)}function Qs(t,i){return t!=null&&Ll(t,i,vm)}var Xy=vl(function(t,i,n){i!=null&&typeof i.toString!="function"&&(i=eo.call(i)),t[i]=n},Js(Mt)),Qy=vl(function(t,i,n){i!=null&&typeof i.toString!="function"&&(i=eo.call(i)),tt.call(t,i)?t[i].push(n):t[i]=[n]},R),Ky=U(fi);function yt(t){return Dt(t)?ku(t):Ts(t)}function It(t){return Dt(t)?ku(t,!0):Om(t)}function Jy(t,i){var n={};return i=R(i,3),pe(t,function(l,c,m){Ee(n,i(l,c,m),l)}),n}function Zy(t,i){var n={};return i=R(i,3),pe(t,function(l,c,m){Ee(n,c,i(l,c,m))}),n}var tv=Ar(function(t,i,n){go(t,i,n)}),ac=Ar(function(t,i,n,l){go(t,i,n,l)}),ev=Ie(function(t,i){var n={};if(t==null)return n;var l=!1;i=nt(i,function(m){return m=qe(m,t),l||(l=m.length>1),m}),me(t,Fs(t),n),l&&(n=Xt(n,D|Y|M,Xm));for(var c=i.length;c--;)Ss(n,i[c]);return n});function rv(t,i){return uc(t,Io(R(i)))}var iv=Ie(function(t,i){return t==null?{}:Dm(t,i)});function uc(t,i){if(t==null)return{};var n=nt(Fs(t),function(l){return[l]});return i=R(i),Zu(t,n,function(l,c){return i(l,c[0])})}function ov(t,i,n){i=qe(i,t);var l=-1,c=i.length;for(c||(c=1,t=r);++l<c;){var m=t==null?r:t[ge(i[l])];m===r&&(l=c,m=n),t=Ae(m)?m.call(t):m}return t}function nv(t,i,n){return t==null?t:mi(t,i,n)}function sv(t,i,n,l){return l=typeof l=="function"?l:r,t==null?t:mi(t,i,n,l)}var lc=Tl(yt),cc=Tl(It);function av(t,i,n){var l=G(t),c=l||Xe(t)||kr(t);if(i=R(i,4),n==null){var m=t&&t.constructor;c?n=l?new m:[]:at(t)?n=Ae(m)?Mr(oo(t)):{}:n={}}return(c?$t:pe)(t,function(d,y,b){return i(n,d,y,b)}),n}function uv(t,i){return t==null?!0:Ss(t,i)}function lv(t,i,n){return t==null?t:ol(t,i,Ds(n))}function cv(t,i,n,l){return l=typeof l=="function"?l:r,t==null?t:ol(t,i,Ds(n),l)}function Vr(t){return t==null?[]:us(t,yt(t))}function hv(t){return t==null?[]:us(t,It(t))}function fv(t,i,n){return n===r&&(n=i,i=r),n!==r&&(n=Jt(n),n=n===n?n:0),i!==r&&(i=Jt(i),i=i===i?i:0),ar(Jt(t),i,n)}function pv(t,i,n){return i=Re(i),n===r?(n=i,i=0):n=Re(n),t=Jt(t),bm(t,i,n)}function mv(t,i,n){if(n&&typeof n!="boolean"&&Lt(t,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&i===r?(t=0,i=1):(t=Re(t),i===r?(i=t,t=0):i=Re(i)),t>i){var l=t;t=i,i=l}if(n||t%1||i%1){var c=Ru();return xt(t+c*(i-t+$f("1e-"+((c+"").length-1))),i)}return Cs(t,i)}var gv=Rr(function(t,i,n){return i=i.toLowerCase(),t+(n?hc(i):i)});function hc(t){return Ks(Z(t).toLowerCase())}function fc(t){return t=Z(t),t&&t.replace(yf,np).replace(kf,"")}function dv(t,i,n){t=Z(t),i=Gt(i);var l=t.length;n=n===r?l:ar(N(n),0,l);var c=n;return n-=i.length,n>=0&&t.slice(n,c)==i}function yv(t){return t=Z(t),t&&Qh.test(t)?t.replace(Ha,sp):t}function vv(t){return t=Z(t),t&&rf.test(t)?t.replace($n,"\\$&"):t}var bv=Rr(function(t,i,n){return t+(n?"-":"")+i.toLowerCase()}),Pv=Rr(function(t,i,n){return t+(n?" ":"")+i.toLowerCase()}),Tv=gl("toLowerCase");function xv(t,i,n){t=Z(t),i=N(i);var l=i?Or(t):0;if(!i||l>=i)return t;var c=(i-l)/2;return xo(uo(c),n)+t+xo(ao(c),n)}function wv(t,i,n){t=Z(t),i=N(i);var l=i?Or(t):0;return i&&l<i?t+xo(i-l,n):t}function Cv(t,i,n){t=Z(t),i=N(i);var l=i?Or(t):0;return i&&l<i?xo(i-l,n)+t:t}function _v(t,i,n){return n||i==null?i=0:i&&(i=+i),Mp(Z(t).replace(qn,""),i||0)}function Lv(t,i,n){return(n?Lt(t,i,n):i===r)?i=1:i=N(i),_s(Z(t),i)}function Sv(){var t=arguments,i=Z(t[0]);return t.length<3?i:i.replace(t[1],t[2])}var Ov=Rr(function(t,i,n){return t+(n?"_":"")+i.toLowerCase()});function Ev(t,i,n){return n&&typeof n!="number"&&Lt(t,i,n)&&(i=n=r),n=n===r?fe:n>>>0,n?(t=Z(t),t&&(typeof i=="string"||i!=null&&!Ys(i))&&(i=Gt(i),!i&&Sr(t))?Ye(ie(t),0,n):t.split(i,n)):[]}var Dv=Rr(function(t,i,n){return t+(n?" ":"")+Ks(i)});function Iv(t,i,n){return t=Z(t),n=n==null?0:ar(N(n),0,t.length),i=Gt(i),t.slice(n,n+i.length)==i}function Mv(t,i,n){var l=f.templateSettings;n&&Lt(t,i,n)&&(i=r),t=Z(t),i=Ro({},i,l,xl);var c=Ro({},i.imports,l.imports,xl),m=yt(c),d=us(c,m),y,b,C=0,_=i.interpolate||$i,S="__p += '",O=cs((i.escape||$i).source+"|"+_.source+"|"+(_===Wa?hf:$i).source+"|"+(i.evaluate||$i).source+"|$","g"),I="//# sourceURL="+(tt.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Uf+"]")+`
`;t.replace(O,function(k,W,$,jt,St,Ut){return $||($=jt),S+=t.slice(C,Ut).replace(vf,ap),W&&(y=!0,S+=`' +
__e(`+W+`) +
'`),St&&(b=!0,S+=`';
`+St+`;
__p += '`),$&&(S+=`' +
((__t = (`+$+`)) == null ? '' : __t) +
'`),C=Ut+k.length,k}),S+=`';
`;var F=tt.call(i,"variable")&&i.variable;if(!F)S=`with (obj) {
`+S+`
}
`;else if(lf.test(F))throw new V(p);S=(b?S.replace($h,""):S).replace(qh,"$1").replace(Yh,"$1;"),S="function("+(F||"obj")+`) {
`+(F?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(b?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+S+`return __p
}`;var j=mc(function(){return Q(m,I+"return "+S).apply(r,d)});if(j.source=S,qs(j))throw j;return j}function Av(t){return Z(t).toLowerCase()}function Rv(t){return Z(t).toUpperCase()}function Fv(t,i,n){if(t=Z(t),t&&(n||i===r))return wu(t);if(!t||!(i=Gt(i)))return t;var l=ie(t),c=ie(i),m=Cu(l,c),d=_u(l,c)+1;return Ye(l,m,d).join("")}function kv(t,i,n){if(t=Z(t),t&&(n||i===r))return t.slice(0,Su(t)+1);if(!t||!(i=Gt(i)))return t;var l=ie(t),c=_u(l,ie(i))+1;return Ye(l,0,c).join("")}function Vv(t,i,n){if(t=Z(t),t&&(n||i===r))return t.replace(qn,"");if(!t||!(i=Gt(i)))return t;var l=ie(t),c=Cu(l,ie(i));return Ye(l,c).join("")}function Gv(t,i){var n=Dh,l=Ih;if(at(i)){var c="separator"in i?i.separator:c;n="length"in i?N(i.length):n,l="omission"in i?Gt(i.omission):l}t=Z(t);var m=t.length;if(Sr(t)){var d=ie(t);m=d.length}if(n>=m)return t;var y=n-Or(l);if(y<1)return l;var b=d?Ye(d,0,y).join(""):t.slice(0,y);if(c===r)return b+l;if(d&&(y+=b.length-y),Ys(c)){if(t.slice(y).search(c)){var C,_=b;for(c.global||(c=cs(c.source,Z(za.exec(c))+"g")),c.lastIndex=0;C=c.exec(_);)var S=C.index;b=b.slice(0,S===r?y:S)}}else if(t.indexOf(Gt(c),y)!=y){var O=b.lastIndexOf(c);O>-1&&(b=b.slice(0,O))}return b+l}function Nv(t){return t=Z(t),t&&Xh.test(t)?t.replace(Ba,mp):t}var jv=Rr(function(t,i,n){return t+(n?" ":"")+i.toUpperCase()}),Ks=gl("toUpperCase");function pc(t,i,n){return t=Z(t),i=n?r:i,i===r?lp(t)?yp(t):tp(t):t.match(i)||[]}var mc=U(function(t,i){try{return kt(t,r,i)}catch(n){return qs(n)?n:new V(n)}}),Uv=Ie(function(t,i){return $t(i,function(n){n=ge(n),Ee(t,n,zs(t[n],t))}),t});function Bv(t){var i=t==null?0:t.length,n=R();return t=i?nt(t,function(l){if(typeof l[1]!="function")throw new qt(h);return[n(l[0]),l[1]]}):[],U(function(l){for(var c=-1;++c<i;){var m=t[c];if(kt(m[0],this,l))return kt(m[1],this,l)}})}function Hv(t){return mm(Xt(t,D))}function Js(t){return function(){return t}}function Wv(t,i){return t==null||t!==t?i:t}var zv=yl(),$v=yl(!0);function Mt(t){return t}function Zs(t){return qu(typeof t=="function"?t:Xt(t,D))}function qv(t){return Xu(Xt(t,D))}function Yv(t,i){return Qu(t,Xt(i,D))}var Xv=U(function(t,i){return function(n){return fi(n,t,i)}}),Qv=U(function(t,i){return function(n){return fi(t,n,i)}});function ta(t,i,n){var l=yt(i),c=mo(i,l);n==null&&!(at(i)&&(c.length||!l.length))&&(n=i,i=t,t=this,c=mo(i,yt(i)));var m=!(at(n)&&"chain"in n)||!!n.chain,d=Ae(t);return $t(c,function(y){var b=i[y];t[y]=b,d&&(t.prototype[y]=function(){var C=this.__chain__;if(m||C){var _=t(this.__wrapped__),S=_.__actions__=Et(this.__actions__);return S.push({func:b,args:arguments,thisArg:t}),_.__chain__=C,_}return b.apply(t,Ue([this.value()],arguments))})}),t}function Kv(){return dt._===this&&(dt._=wp),this}function ea(){}function Jv(t){return t=N(t),U(function(i){return Ku(i,t)})}var Zv=Ms(nt),tb=Ms(vu),eb=Ms(is);function gc(t){return Ns(t)?os(ge(t)):Im(t)}function rb(t){return function(i){return t==null?r:ur(t,i)}}var ib=bl(),ob=bl(!0);function ra(){return[]}function ia(){return!1}function nb(){return{}}function sb(){return""}function ab(){return!0}function ub(t,i){if(t=N(t),t<1||t>Ne)return[];var n=fe,l=xt(t,fe);i=R(i),t-=fe;for(var c=as(l,i);++n<t;)i(n);return c}function lb(t){return G(t)?nt(t,ge):Nt(t)?[t]:Et(Fl(Z(t)))}function cb(t){var i=++Tp;return Z(t)+i}var hb=To(function(t,i){return t+i},0),fb=As("ceil"),pb=To(function(t,i){return t/i},1),mb=As("floor");function gb(t){return t&&t.length?po(t,Mt,vs):r}function db(t,i){return t&&t.length?po(t,R(i,2),vs):r}function yb(t){return Tu(t,Mt)}function vb(t,i){return Tu(t,R(i,2))}function bb(t){return t&&t.length?po(t,Mt,xs):r}function Pb(t,i){return t&&t.length?po(t,R(i,2),xs):r}var Tb=To(function(t,i){return t*i},1),xb=As("round"),wb=To(function(t,i){return t-i},0);function Cb(t){return t&&t.length?ss(t,Mt):0}function _b(t,i){return t&&t.length?ss(t,R(i,2)):0}return f.after=qd,f.ary=$l,f.assign=Ry,f.assignIn=sc,f.assignInWith=Ro,f.assignWith=Fy,f.at=ky,f.before=ql,f.bind=zs,f.bindAll=Uv,f.bindKey=Yl,f.castArray=ny,f.chain=Hl,f.chunk=mg,f.compact=gg,f.concat=dg,f.cond=Bv,f.conforms=Hv,f.constant=Js,f.countBy=Cd,f.create=Vy,f.curry=Xl,f.curryRight=Ql,f.debounce=Kl,f.defaults=Gy,f.defaultsDeep=Ny,f.defer=Yd,f.delay=Xd,f.difference=yg,f.differenceBy=vg,f.differenceWith=bg,f.drop=Pg,f.dropRight=Tg,f.dropRightWhile=xg,f.dropWhile=wg,f.fill=Cg,f.filter=Ld,f.flatMap=Ed,f.flatMapDeep=Dd,f.flatMapDepth=Id,f.flatten=Nl,f.flattenDeep=_g,f.flattenDepth=Lg,f.flip=Qd,f.flow=zv,f.flowRight=$v,f.fromPairs=Sg,f.functions=$y,f.functionsIn=qy,f.groupBy=Md,f.initial=Eg,f.intersection=Dg,f.intersectionBy=Ig,f.intersectionWith=Mg,f.invert=Xy,f.invertBy=Qy,f.invokeMap=Rd,f.iteratee=Zs,f.keyBy=Fd,f.keys=yt,f.keysIn=It,f.map=Oo,f.mapKeys=Jy,f.mapValues=Zy,f.matches=qv,f.matchesProperty=Yv,f.memoize=Do,f.merge=tv,f.mergeWith=ac,f.method=Xv,f.methodOf=Qv,f.mixin=ta,f.negate=Io,f.nthArg=Jv,f.omit=ev,f.omitBy=rv,f.once=Kd,f.orderBy=kd,f.over=Zv,f.overArgs=Jd,f.overEvery=tb,f.overSome=eb,f.partial=$s,f.partialRight=Jl,f.partition=Vd,f.pick=iv,f.pickBy=uc,f.property=gc,f.propertyOf=rb,f.pull=kg,f.pullAll=Ul,f.pullAllBy=Vg,f.pullAllWith=Gg,f.pullAt=Ng,f.range=ib,f.rangeRight=ob,f.rearg=Zd,f.reject=jd,f.remove=jg,f.rest=ty,f.reverse=Hs,f.sampleSize=Bd,f.set=nv,f.setWith=sv,f.shuffle=Hd,f.slice=Ug,f.sortBy=$d,f.sortedUniq=Yg,f.sortedUniqBy=Xg,f.split=Ev,f.spread=ey,f.tail=Qg,f.take=Kg,f.takeRight=Jg,f.takeRightWhile=Zg,f.takeWhile=td,f.tap=gd,f.throttle=ry,f.thru=So,f.toArray=ic,f.toPairs=lc,f.toPairsIn=cc,f.toPath=lb,f.toPlainObject=nc,f.transform=av,f.unary=iy,f.union=ed,f.unionBy=rd,f.unionWith=id,f.uniq=od,f.uniqBy=nd,f.uniqWith=sd,f.unset=uv,f.unzip=Ws,f.unzipWith=Bl,f.update=lv,f.updateWith=cv,f.values=Vr,f.valuesIn=hv,f.without=ad,f.words=pc,f.wrap=oy,f.xor=ud,f.xorBy=ld,f.xorWith=cd,f.zip=hd,f.zipObject=fd,f.zipObjectDeep=pd,f.zipWith=md,f.entries=lc,f.entriesIn=cc,f.extend=sc,f.extendWith=Ro,ta(f,f),f.add=hb,f.attempt=mc,f.camelCase=gv,f.capitalize=hc,f.ceil=fb,f.clamp=fv,f.clone=sy,f.cloneDeep=uy,f.cloneDeepWith=ly,f.cloneWith=ay,f.conformsTo=cy,f.deburr=fc,f.defaultTo=Wv,f.divide=pb,f.endsWith=dv,f.eq=ne,f.escape=yv,f.escapeRegExp=vv,f.every=_d,f.find=Sd,f.findIndex=Vl,f.findKey=jy,f.findLast=Od,f.findLastIndex=Gl,f.findLastKey=Uy,f.floor=mb,f.forEach=Wl,f.forEachRight=zl,f.forIn=By,f.forInRight=Hy,f.forOwn=Wy,f.forOwnRight=zy,f.get=Xs,f.gt=hy,f.gte=fy,f.has=Yy,f.hasIn=Qs,f.head=jl,f.identity=Mt,f.includes=Ad,f.indexOf=Og,f.inRange=pv,f.invoke=Ky,f.isArguments=hr,f.isArray=G,f.isArrayBuffer=py,f.isArrayLike=Dt,f.isArrayLikeObject=lt,f.isBoolean=my,f.isBuffer=Xe,f.isDate=gy,f.isElement=dy,f.isEmpty=yy,f.isEqual=vy,f.isEqualWith=by,f.isError=qs,f.isFinite=Py,f.isFunction=Ae,f.isInteger=Zl,f.isLength=Mo,f.isMap=tc,f.isMatch=Ty,f.isMatchWith=xy,f.isNaN=wy,f.isNative=Cy,f.isNil=Ly,f.isNull=_y,f.isNumber=ec,f.isObject=at,f.isObjectLike=ut,f.isPlainObject=vi,f.isRegExp=Ys,f.isSafeInteger=Sy,f.isSet=rc,f.isString=Ao,f.isSymbol=Nt,f.isTypedArray=kr,f.isUndefined=Oy,f.isWeakMap=Ey,f.isWeakSet=Dy,f.join=Ag,f.kebabCase=bv,f.last=Kt,f.lastIndexOf=Rg,f.lowerCase=Pv,f.lowerFirst=Tv,f.lt=Iy,f.lte=My,f.max=gb,f.maxBy=db,f.mean=yb,f.meanBy=vb,f.min=bb,f.minBy=Pb,f.stubArray=ra,f.stubFalse=ia,f.stubObject=nb,f.stubString=sb,f.stubTrue=ab,f.multiply=Tb,f.nth=Fg,f.noConflict=Kv,f.noop=ea,f.now=Eo,f.pad=xv,f.padEnd=wv,f.padStart=Cv,f.parseInt=_v,f.random=mv,f.reduce=Gd,f.reduceRight=Nd,f.repeat=Lv,f.replace=Sv,f.result=ov,f.round=xb,f.runInContext=v,f.sample=Ud,f.size=Wd,f.snakeCase=Ov,f.some=zd,f.sortedIndex=Bg,f.sortedIndexBy=Hg,f.sortedIndexOf=Wg,f.sortedLastIndex=zg,f.sortedLastIndexBy=$g,f.sortedLastIndexOf=qg,f.startCase=Dv,f.startsWith=Iv,f.subtract=wb,f.sum=Cb,f.sumBy=_b,f.template=Mv,f.times=ub,f.toFinite=Re,f.toInteger=N,f.toLength=oc,f.toLower=Av,f.toNumber=Jt,f.toSafeInteger=Ay,f.toString=Z,f.toUpper=Rv,f.trim=Fv,f.trimEnd=kv,f.trimStart=Vv,f.truncate=Gv,f.unescape=Nv,f.uniqueId=cb,f.upperCase=jv,f.upperFirst=Ks,f.each=Wl,f.eachRight=zl,f.first=jl,ta(f,(function(){var t={};return pe(f,function(i,n){tt.call(f.prototype,n)||(t[n]=i)}),t})(),{chain:!1}),f.VERSION=o,$t(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){f[t].placeholder=f}),$t(["drop","take"],function(t,i){z.prototype[t]=function(n){n=n===r?1:mt(N(n),0);var l=this.__filtered__&&!i?new z(this):this.clone();return l.__filtered__?l.__takeCount__=xt(n,l.__takeCount__):l.__views__.push({size:xt(n,fe),type:t+(l.__dir__<0?"Right":"")}),l},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),$t(["filter","map","takeWhile"],function(t,i){var n=i+1,l=n==Na||n==Fh;z.prototype[t]=function(c){var m=this.clone();return m.__iteratees__.push({iteratee:R(c,3),type:n}),m.__filtered__=m.__filtered__||l,m}}),$t(["head","last"],function(t,i){var n="take"+(i?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),$t(["initial","tail"],function(t,i){var n="drop"+(i?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(Mt)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=U(function(t,i){return typeof t=="function"?new z(this):this.map(function(n){return fi(n,t,i)})}),z.prototype.reject=function(t){return this.filter(Io(R(t)))},z.prototype.slice=function(t,i){t=N(t);var n=this;return n.__filtered__&&(t>0||i<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),i!==r&&(i=N(i),n=i<0?n.dropRight(-i):n.take(i-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(fe)},pe(z.prototype,function(t,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),l=/^(?:head|last)$/.test(i),c=f[l?"take"+(i=="last"?"Right":""):i],m=l||/^find/.test(i);c&&(f.prototype[i]=function(){var d=this.__wrapped__,y=l?[1]:arguments,b=d instanceof z,C=y[0],_=b||G(d),S=function(W){var $=c.apply(f,Ue([W],y));return l&&O?$[0]:$};_&&n&&typeof C=="function"&&C.length!=1&&(b=_=!1);var O=this.__chain__,I=!!this.__actions__.length,F=m&&!O,j=b&&!I;if(!m&&_){d=j?d:new z(this);var k=t.apply(d,y);return k.__actions__.push({func:So,args:[S],thisArg:r}),new Yt(k,O)}return F&&j?t.apply(this,y):(k=this.thru(S),F?l?k.value()[0]:k.value():k)})}),$t(["pop","push","shift","sort","splice","unshift"],function(t){var i=Ji[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",l=/^(?:pop|shift)$/.test(t);f.prototype[t]=function(){var c=arguments;if(l&&!this.__chain__){var m=this.value();return i.apply(G(m)?m:[],c)}return this[n](function(d){return i.apply(G(d)?d:[],c)})}}),pe(z.prototype,function(t,i){var n=f[i];if(n){var l=n.name+"";tt.call(Ir,l)||(Ir[l]=[]),Ir[l].push({name:i,func:n})}}),Ir[Po(r,ft).name]=[{name:"wrapper",func:r}],z.prototype.clone=Np,z.prototype.reverse=jp,z.prototype.value=Up,f.prototype.at=dd,f.prototype.chain=yd,f.prototype.commit=vd,f.prototype.next=bd,f.prototype.plant=Td,f.prototype.reverse=xd,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=wd,f.prototype.first=f.prototype.head,ni&&(f.prototype[ni]=Pd),f},He=vp();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(dt._=He,define(function(){return He})):ir?((ir.exports=He)._=He,Zn._=He):dt._=He}).call(a)}),Sh=class extends Set{constructor(a,e=!1){super(a),this.valuesAsFlags=e}};function ki(a){if(a instanceof Map)return Object.fromEntries([...a.entries()].map(([e,r])=>[e,ki(r)]));if(a instanceof Set)return Array.from(a.values()).map(ki);if(a instanceof Sh)return{values:[...a.values()],valuesAsFlags:a.valuesAsFlags};if(typeof a=="object"){let e={};return Object.entries(a).forEach(([r,o])=>{e[r]=ki(o)}),e}else return a}var V1=Aa(Ra(),1);var VP=Aa(Ra(),1);function br(a,e){if(typeof a!="object")throw new Error(`Cannot merge into non-object objectToMergeWith. Received: ${JSON.stringify(a)}`);if(typeof e!="object")throw new Error(`Cannot merge using non-object objectToMergeWith. Received: ${JSON.stringify(e)}`);let r=(0,VP.cloneDeep)(a);for(let[o,s]of Object.entries(e))typeof s!="object"||s instanceof Set||r[o]===void 0?r[o]=s:r[o]=br(r[o],s);return r}function Oh(a,e){if(!(a===void 0||typeof a!="object"))for(let r of Object.keys(a)){if(r===e)return a[r];let o=a[r];if(typeof o=="object"){let s=Oh(o,e);if(s!==void 0)return s}}}var Ma="@composite:",GP="@inherit:",NP=class{constructor(a,e,r){this.tiledClassToMembersMap=a,this.enumNameToValuesMap=e,this.parserOptions=r,this.memoiser=new Map}flattenMembers(a,e){return this.memoiser.has(a)?{[a]:this.memoiser.get(a)}:(this.memoiser.set(a,e.reduce((r,o)=>K(K({},r),this.flattenMemberProperty(o)),{})),{[a]:this.memoiser.get(a)})}flattenMemberProperty(a){var r;let e=(r=a.propertyType)!=null?r:a.propertytype;if(a.type==="class"){if(!this.memoiser.has(e)){let u=this.tiledClassToMembersMap.get(e).reduce((h,p)=>br(this.flattenMemberProperty(p),h),{});this.memoiser.set(e,u)}let o=this.memoiser.get(e),s=br(o,this.flattenValue(a.value,o));return this.checkIfShouldFlatten(a.name)?s:{[a.name.replace(Ma,"")]:s}}else return this.enumNameToValuesMap.has(e)?this.enumNameToValuesMap.get(e).valuesAsFlags?{[a.name]:new Set(a.value.split(",").filter(o=>o!==""))}:{[a.name]:a.value}:{[a.name]:a.value}}get memoisedFlattenedProperties(){return this.memoiser}flattenValue(a,e){return Object.entries(a).reduce((r,[o,s])=>{if(typeof s!="object")return Oh(e,o)instanceof Set?br({[o]:new Set(s.split(",").filter(u=>u!==""))},r):br({[o]:s},r);if(this.checkIfShouldFlatten(o))return br(this.flattenValue(s,e),r);{let u=o.replace(Ma,"");return br({[u]:this.flattenValue(s,e)},r)}},{})}checkIfShouldFlatten(a){var e;return((e=this.parserOptions)==null?void 0:e.defaultComposite)===!0?a.startsWith(GP):!a.startsWith(Ma)}},_h=Aa(Ra(),1),jP=class{constructor(a){this.flattener=a}flattenPropertiesOnObject(a){var e,r,o,s;return Bt(K(K({},this.flattener.memoisedFlattenedProperties.get((e=a.class)!=null?e:a.type)),(r=a.properties)==null?void 0:r.reduce((u,h)=>K(K({},u),this.flattener.flattenMemberProperty(h)),{})),{name:a.name,id:a.id,class:(s=(o=a.class)!=null?o:a.type)!=null?s:null,x:a.x,y:a.y})}flattenPropertiesOnTile(a){var e,r,o,s;return Bt(K(K({},this.flattener.memoisedFlattenedProperties.get((e=a.class)!=null?e:a.type)),(r=a.properties)==null?void 0:r.reduce((u,h)=>K(K({},u),this.flattener.flattenMemberProperty(h)),{})),{id:a.id,class:(s=(o=a.class)!=null?o:a.type)!=null?s:null})}getCustomTypesMap(){return new Map([...this.flattener.memoisedFlattenedProperties.entries()].map(([a,e])=>[a,(0,_h.cloneDeep)(e)]))}getEnumsMap(){return new Map([...this.flattener.enumNameToValuesMap.entries()].map(([a,e])=>[a,(0,_h.cloneDeep)(e)]))}toJSON(){return JSON.stringify({customTypes:ki(this.getCustomTypesMap()),enums:ki(this.getEnumsMap())},null,4)}};function UP(a,e){let r=new Map(a.propertyTypes.filter(u=>u.type==="enum").map(u=>[u.name,new Sh(u.values,u.valuesAsFlags)])),o=new Map(a.propertyTypes.filter(u=>u.type==="class").map(u=>[u.name,u.members])),s=new NP(o,r,e);return o.forEach((u,h)=>{s.flattenMembers(h,u)}),new jP(s)}var Eh={parse:UP};var Pr=class{constructor(e,r){this.phaserTile=e;this.tiledProject=r}getProperty(e){var s,u;let r={};if(this.tiledProject){let h=Eh.parse(this.tiledProject),p=this.getType();if(p){let g=(s=h.getCustomTypesMap())==null?void 0:s.get(p);if(g)for(let[T,L]of Object.entries(g))r[T]=L}}return(u=this.phaserTile.properties[e])!=null?u:r[e]}hasProperty(e){return this.getProperty(e)!=null}getType(){var e,r;return(r=(e=this.phaserTile.tileset)==null?void 0:e.tileData[this.phaserTile.index-1])==null?void 0:r.type}};var Vi=class{constructor(e,r){this.phaserTilemapLayer=e;this.tiledProject=r}getName(){return this.phaserTilemapLayer.layer.name}getProperty(e){let r=this.phaserTilemapLayer.layer.properties,o=r==null?void 0:r.find(s=>s.name==e);return o==null?void 0:o.value}hasProperty(e){return this.getProperty(e)!=null}isCharLayer(){return this.hasProperty(Yr)}getData(){return this.phaserTilemapLayer.layer.data.map(e=>e.map(r=>new Pr(r,this.tiledProject)))}};var Rn=class{constructor(e,r){this.phaserTilemap=e;this.tiledProject=r;for(let o of this.phaserTilemap.layers)if(o.tilemapLayer==null)throw new Error(`Error initializing tilemap. Layer '${o.name}' has no 'tilemapLayer'. This can happen if you call 'createLayer' with the wrong layer ID.`)}getTileWidth(){return this.phaserTilemap.tileWidth}getTileHeight(){return this.phaserTilemap.tileHeight}getWidth(){return this.phaserTilemap.width}getHeight(){return this.phaserTilemap.height}getOrientation(){return this.phaserTilemap.orientation==Phaser.Tilemaps.Orientation.ISOMETRIC.toString()?"isometric":"orthogonal"}getLayers(){return this.phaserTilemap.layers.map(e=>new Vi(e.tilemapLayer,this.tiledProject))}hasTileAt(e,r,o){return!!this.phaserTilemap.hasTileAt(e,r,o)}getTileAt(e,r,o){let s=this.phaserTilemap.getTileAt(e,r,!1,o);if(s)return new Pr(s,this.tiledProject)}};var Fa=class{constructor(e,r="orthogonal",o="ge_collide"){this.map=e;this.orientation=r;this.layerMap=new Map;this.layers=[];let s=-1,u=-1;Object.entries(e).map(([h,p])=>{var Y;let g=(Y=p.data[0])==null?void 0:Y.length,T=p.data.length;if(s!==-1&&s!==g||u!==-1&&u!==T)throw new Error("All tilemap layers must have the same dimensions.");s=g,u=T;let L=[];for(let M=0;M<p.data.length;M++){let H=[];for(let B=0;B<p.data[M].length;B++){let st=new Va(p.data[M][B]===1,o);H.push(st)}L.push(H)}let D=new ka(h,L,p.isCharLayer);this.layers.push(D),this.layerMap.set(h,D)})}getWidth(){var e,r;return((r=(e=Object.values(this.map)[0])==null?void 0:e.data[0])==null?void 0:r.length)||0}getHeight(){var e;return((e=Object.values(this.map)[0])==null?void 0:e.data.length)||0}getOrientation(){return this.orientation}getLayers(){return this.layers}hasTileAt(e,r,o){return!o||!this.layerMap.get(o)?!1:e>=0&&e<this.getWidth()&&r>=0&&r<this.getHeight()}getTileAt(e,r,o){if(!o)return;let s=this.layerMap.get(o);if(s)return s.getData()[r][e]}},ka=class{constructor(e,r,o=!1){this.name=e;this.tiles=r;this.isCharLayerInternal=o}getName(){return this.name}getProperty(e){if(e==="ge_charLayer"&&this.isCharLayerInternal)return this.name}hasProperty(e){return e==="ge_charLayer"&&this.isCharLayerInternal}getData(){return this.tiles}isCharLayer(){return this.isCharLayerInternal}},Va=class{constructor(e,r){this.isBlocking=e;this.collisionPropertyName=r}getProperty(e){return e===this.collisionPropertyName?this.isBlocking:!1}hasProperty(e){return e===this.collisionPropertyName}};var Gi=class{constructor(e,r){this.props={};var u;let o=e.find(h=>{var T;if(!h.tiles)return!1;let p=(T=h.firstgid)!=null?T:0;return!!h.tiles.find(L=>L.id+p===r)});if(!o)return;let s=(u=o.tiles)==null?void 0:u.find(h=>{var p;return h.id+((p=o.firstgid)!=null?p:0)===r});if(s!=null&&s.properties)for(let h of s.properties)h.name&&(this.props[h.name]=h.value)}getProperty(e){return this.props[e]}hasProperty(e){return this.props[e]!==void 0}};var Ni=class{constructor(e,r){this.layer=r;this.data=[];if(this.data=[],this.layer.data)for(let o=0;o<(this.layer.height||0);o++){let s=[];for(let u=0;u<(this.layer.width||0);u++){let h=this.layer.data[o*(this.layer.width||0)+u];h!==void 0?s.push(new Gi(e,h)):s.push(void 0)}this.data.push(s)}}getName(){return this.layer.name}getProperty(e){var r,o;return(o=(r=this.layer.properties)==null?void 0:r.find(s=>s.name===e))==null?void 0:o.value}hasProperty(e){return this.getProperty(e)!==void 0}getData(){return this.data}isCharLayer(){return this.hasProperty("ge_charLayer")}};var Ga=class{constructor(e){this.rawTilemap=e;this.layers=[];var r;this.layers=(r=this.rawTilemap.layers)==null?void 0:r.map(o=>new Ni(this.rawTilemap.tilesets,o))}hasTileAt(e,r,o){if(e<0||e>=this.rawTilemap.width||r<0||r>=this.rawTilemap.height||!this.rawTilemap.layers)return!1;let s=this.rawTilemap.layers.find(h=>h.name===o);if(!s)return!1;let u=r*this.rawTilemap.width+e;return s.data[u]>0}getTileAt(e,r,o){if(e<0||e>=this.rawTilemap.width||r<0||r>=this.rawTilemap.height||!this.rawTilemap.layers)return;let s=this.layers.find(u=>u.getName()===o);if(s)return s.getData()[r][e]}getOrientation(){return this.rawTilemap.orientation}getLayers(){return this.layers}getWidth(){return this.rawTilemap.width}getHeight(){return this.rawTilemap.height}};var ji=class ji{constructor(e){this.scene=e;this.geHeadless=new In(!1);this.isCreatedInternal=!1;ji.welcomeMessagePrinted||(console.log(`Using GridEngine Phaser Plugin v${Cn}`),ji.welcomeMessagePrinted=!0),this.scene.sys.events.once("boot",this.boot,this)}boot(){this.scene.sys.events.on("update",this.update,this)}getCharLayer(e){return this.geHeadless.getCharLayer(e)}getTransition(e,r){return this.geHeadless.getTransition(e,r)}setTransition(e,r,o){this.geHeadless.setTransition(e,r,o)}create(e,r){this.geHeadless.create(new Rn(e,r.tiledProject),r),this.isCreatedInternal=!0,this.gridCharacters=new Map;let o=this.setConfigDefaults(r);this.config=o,this.gridTilemap=new yr(e),this.addCharacters()}getPosition(e){return this.geHeadless.getPosition(e)}move(e,r){this.geHeadless.move(e,r)}moveRandomly(e,r=0,o=-1){this.geHeadless.moveRandomly(e,r,o)}getMovement(e){return this.geHeadless.getMovement(e)}moveTo(e,r,o){return this.geHeadless.moveTo(e,r,o)}stopMovement(e){this.geHeadless.stopMovement(e)}setSpeed(e,r){this.geHeadless.setSpeed(e,r)}getSpeed(e){return this.geHeadless.getSpeed(e)}setContainer(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setContainer(r)}getContainer(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getContainer()}getOffsetX(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getOffsetX()}setOffsetX(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setOffsetX(r)}getOffsetY(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getOffsetY()}setOffsetY(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.setOffsetY(r)}getDepthOffset(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getDepthOffset()}collidesWithTiles(e){return this.geHeadless.collidesWithTiles(e)}getWalkingAnimationMapping(e){var s;this.initGuard();let r=(s=this.gridCharacters)==null?void 0:s.get(e);if(!r)throw this.createCharUnknownErr(e);let o=r.getAnimation();return o==null?void 0:o.getWalkingAnimationMapping()}hasLayerOverlay(){var e;return this.initGuard(),!!((e=this.config)!=null&&e.layerOverlay)}setWalkingAnimationMapping(e,r){var u;this.initGuard();let o=(u=this.gridCharacters)==null?void 0:u.get(e);if(!o)throw this.createCharUnknownErr(e);let s=o.getAnimation();s==null||s.setWalkingAnimationMapping(r)}update(e,r){if(this.isCreatedInternal&&this.gridCharacters)for(let[o,s]of this.gridCharacters)s.update(r);this.geHeadless.update(e,r)}addCharacter(e){this.geHeadless.addCharacter(e),this.addCharacterInternal(e)}hasCharacter(e){return this.geHeadless.hasCharacter(e)}removeCharacter(e){var o,s;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);r.destroy(),(s=this.gridCharacters)==null||s.delete(e),this.geHeadless.removeCharacter(e)}removeAllCharacters(){if(this.initGuard(),!!this.gridCharacters){for(let e of this.gridCharacters.keys())this.removeCharacter(e);this.geHeadless.removeAllCharacters()}}getAllCharacters(e){return this.geHeadless.getAllCharacters(e)}getLabels(e){return this.geHeadless.getLabels(e)}addLabels(e,r){this.geHeadless.addLabels(e,r)}removeLabels(e,r){this.geHeadless.removeLabels(e,r)}clearLabels(e){this.geHeadless.clearLabels(e)}follow(e,r,o,s){let u;o===void 0?u={distance:0,closestPointIfBlocked:!1}:typeof o=="number"?(u={distance:o,closestPointIfBlocked:!1},s&&(u.closestPointIfBlocked=!0)):u=o,this.geHeadless.follow(e,r,u)}isMoving(e){return this.geHeadless.isMoving(e)}getFacingDirection(e){return this.geHeadless.getFacingDirection(e)}getFacingPosition(e){return this.geHeadless.getFacingPosition(e)}turnTowards(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);o.turnTowards(r),this.geHeadless.turnTowards(e,r)}getCharactersAt(e,r){return this.geHeadless.getCharactersAt(e,r)}setPosition(e,r,o){this.geHeadless.setPosition(e,r,o)}getSprite(e){var o;this.initGuard();let r=(o=this.gridCharacters)==null?void 0:o.get(e);if(!r)throw this.createCharUnknownErr(e);return r.getSprite()}setSprite(e,r){var s;this.initGuard();let o=(s=this.gridCharacters)==null?void 0:s.get(e);if(!o)throw this.createCharUnknownErr(e);r.setOrigin(0,0),o.setSprite(r)}isBlocked(e,r,o=["geDefault"]){return this.geHeadless.isBlocked(e,r,o)}isTileBlocked(e,r){return this.geHeadless.isTileBlocked(e,r)}getCollisionGroups(e){return this.geHeadless.getCollisionGroups(e)}setCollisionGroups(e,r){this.geHeadless.setCollisionGroups(e,r)}getIgnoreCollisionGroups(e){return this.geHeadless.getIgnoreCollisionGroups(e)}setIgnoreCollisionGroups(e,r){this.geHeadless.setIgnoreCollisionGroups(e,r)}getTilePosInDirection(e,r,o){return this.geHeadless.getTilePosInDirection(e,r,o)}findShortestPath(e,r,o={}){return this.geHeadless.findShortestPath(e,r,o)}steppedOn(e,r,o){return this.geHeadless.steppedOn(e,r,o)}characterShifted(){return this.geHeadless.characterShifted()}movementStarted(){return this.geHeadless.movementStarted()}movementStopped(){return this.geHeadless.movementStopped()}directionChanged(){return this.geHeadless.directionChanged()}positionChangeStarted(){return this.geHeadless.positionChangeStarted()}positionChangeFinished(){return this.geHeadless.positionChangeFinished()}getMovementProgress(e){return this.geHeadless.getMovementProgress(e)}rebuildTileCollisionCache(e,r,o,s){this.geHeadless.rebuildTileCollisionCache(e,r,o,s)}addQueueMovements(e,r,o){this.geHeadless.addQueueMovements(e,r,o)}getEnqueuedMovements(e){return this.geHeadless.getEnqueuedMovements(e)}queueMovementFinished(){return this.geHeadless.queueMovementFinished()}clearEnqueuedMovements(e){return this.geHeadless.clearEnqueuedMovements(e)}getState(){return{characters:this.geHeadless.getState().characters.map(e=>Bt(K({},e),{offsetX:this.getOffsetX(e.id),offsetY:this.getOffsetY(e.id)}))}}setState(e){if(this.geHeadless.setState(e),this.gridCharacters)for(let r of e.characters){let o=this.gridCharacters.get(r.id);o&&(o.setOffsetX(r.offsetX),o.setOffsetY(r.offsetY))}}getTileCost(e,r,o){return this.initGuard(),this.geHeadless.getTileCost(e,r,o)}revertCurrentMovement(e){this.geHeadless.revertCurrentMovement(e)}isCurrentMovementReverted(e){return this.geHeadless.isCurrentMovementReverted(e)}setConfigDefaults(e){return K({collisionTilePropertyName:"ge_collide",numberOfDirections:4,characterCollisionStrategy:"BLOCK_TWO_TILES",layerOverlay:!1,cacheTileCollisions:!1},e)}initGuard(){if(!this.isCreatedInternal)throw this.createUninitializedErr()}createUninitializedErr(){throw new Error("GridEngine not initialized. You need to call create() first.")}addCharacters(){var e;(e=this.config)==null||e.characters.forEach(r=>this.addCharacterInternal(r))}createCharUnknownErr(e){return new Error(`Character unknown: ${e}`)}addCharacterInternal(e){var o;if(this.initGuard(),!this.gridTilemap)throw this.createUninitializedErr();if(!this.config)throw this.createUninitializedErr();let r=new cn(e,this.scene,this.gridTilemap,this.config.layerOverlay,this.geHeadless);(o=this.gridCharacters)==null||o.set(e.id,r)}};ji.welcomeMessagePrinted=!1;var Fn=ji;var iO=Fn;export{Fa as ArrayTilemap,Da as CharacterShiftAction,hn as CollisionStrategy,At as Direction,Fn as GridEngine,In as GridEngineHeadless,Ia as MoveToResult,Hr as NoPathFoundStrategy,Gr as NumberOfDirections,Si as PathBlockedStrategy,Pr as PhaserTile,Vi as PhaserTileLayer,Rn as PhaserTilemap,Ch as QueuedPathBlockedStrategy,Ni as TiledLayer,Gi as TiledTile,Ga as TiledTilemap,iO as default,Pt as directionFromPos};
/*! Bundled license information:

tiled-property-flattener/dist/tiled_property_flattener.min.js:
  (*! Bundled license information:
  
  lodash/lodash.js:
    (**
     * @license
     * Lodash <https://lodash.com/>
     * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
     * Released under MIT license <https://lodash.com/license>
     * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
     * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
     *)
  *)
*/
